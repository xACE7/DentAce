<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Fracture Healing</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 10</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
  { q: "What is the primary definition of a bone fracture?", opts: ["Loss of bone integrity", "Reduction in bone density", "Inflammation of bone tissue", "Overgrowth of bone cells"], correct: 0, explain: "A fracture is defined as the loss of bone integrity resulting from mechanical injury or reduced bone strength." },
  { q: "Fracture healing is best described as:", opts: ["The immediate fusion of bone fragments", "A complex and sequential set of events to restore injured bone", "A simple process of bone regrowth", "The formation of scar tissue in the bone"], correct: 1, explain: "It is a complex, multi-stage process involving inflammation, cell proliferation, callus formation, and remodeling." },
  { q: "A fracture occurring in a bone weakened by a disease like osteoporosis is classified as:", opts: ["Traumatic", "Compound", "Pathological", "Simple"], correct: 2, explain: "Pathological fractures occur in bone that is weakened by an underlying disease process." },
  { q: "Which type of fracture is characterized by the overlying skin remaining intact?", opts: ["Compound fracture", "Comminuted fracture", "Greenstick fracture", "Simple fracture"], correct: 3, explain: "In a simple (or closed) fracture, the skin is not broken." },
  { q: "A fracture where the bone protrudes through the skin is known as a:", opts: ["Compound fracture", "Simple fracture", "Spiral fracture", "Transverse fracture"], correct: 0, explain: "A compound (or open) fracture involves a break in the skin, exposing the bone." },
  { q: "A comminuted fracture is defined by:", opts: ["A single clean break", "The bone bending but not breaking", "The bone being broken into multiple fragments", "A fracture caused by a twisting force"], correct: 2, explain: "Comminuted means the bone is shattered into several pieces." },
  { q: "Which fracture type is most common in the soft bones of children, where the bone bends and partially breaks?", opts: ["Compression fracture", "Greenstick fracture", "Comminuted fracture", "Pathological fracture"], correct: 1, explain: "Greenstick fractures are incomplete fractures common in children due to the flexibility of their bones." },
  { q: "Which cells primarily produce cytokines and growth factors like PDGF and TGF-Œ≤ in the initial stage of healing?", opts: ["Osteoblasts", "Osteoclasts", "Inflammatory cells (platelets, macrophages)", "Fibroblasts"], correct: 2, explain: "Inflammatory cells initiate the healing cascade by releasing crucial signaling molecules." },
  { q: "The removal of dead bone fragments during the demolition phase is carried out by:", opts: ["Osteoclasts", "Osteoblasts", "Chondrocytes", "Fibroblasts"], correct: 0, explain: "Osteoclasts are specialized cells that resorb bone tissue, which is essential for clearing debris." },
  { q: "The primary function of osteoblasts in fracture healing is to:", opts: ["Remove bone fragments", "Form cartilage", "Produce new bone", "Lay down collagen fibers"], correct: 2, explain: "Osteoblasts are the bone-forming cells responsible for creating the new bony matrix." },
  { q: "Primary union healing typically occurs under what condition?", opts: ["In all types of fractures", "When bone ends are surgically approximated", "When a large gap exists", "Without any medical intervention"], correct: 1, explain: "Primary union requires rigid fixation and perfect anatomical reduction, usually achieved surgically." },
  { q: "A key characteristic of primary union healing is:", opts: ["The formation of a large callus", "A slow but very strong healing process", "The absence of callus formation", "Its occurrence in non-immobilized fractures"], correct: 2, explain: "Because the bone ends are in direct contact, healing can occur without the intermediate step of callus formation." },
  { q: "The most common type of fracture healing, involving callus formation, is:", opts: ["Primary union", "Contact healing", "Gap healing", "Secondary union"], correct: 3, explain: "Secondary union is the natural healing process for most fractures that are not rigidly fixed." },
  { q: "What is the very first step in the process of secondary fracture healing?", opts: ["Soft callus formation", "Hematoma formation", "Remodeling", "Hard callus formation"], correct: 1, explain: "The process begins immediately with bleeding from the broken bone ends, forming a hematoma." },
  { q: "The hematoma and inflammation stage typically lasts for:", opts: ["48 hours to 7 days", "2 weeks", "Several months", "Up to a year"], correct: 0, explain: "This initial acute phase is relatively short, setting the stage for subsequent repair." },
  { q: "During fracture healing, the soft callus primarily acts as a:", opts: ["Permanent replacement for the bone", "Source of inflammation", "Barrier to blood flow", "Scaffold for new bone growth"], correct: 3, explain: "The soft callus provides initial stability and a framework upon which the hard callus can form." },
  { q: "The soft callus is primarily composed of:", opts: ["Woven bone", "Cartilage and fibrous tissue", "Mature lamellar bone", "Hematoma"], correct: 1, explain: "This fibrocartilaginous callus bridges the fracture gap before being replaced by bone." },
  { q: "The transition from soft callus to hard callus involves:", opts: ["Inflammation", "Demolition", "Ossification", "Hematoma reduction"], correct: 2, explain: "Ossification is the process where the soft, cartilaginous callus is converted into hard, woven bone." },
  { q: "The final stage of fracture healing, which can take years and involves reshaping the bone, is called:", opts: ["Remodeling", "Demolition", "Pro-callus formation", "Ossification"], correct: 0, explain: "Remodeling reshapes the bone to its original contour and strength, guided by mechanical stress." },
  { q: "Which cell type is most active during the remodeling phase to restore the bone's original shape?", opts: ["Osteoblasts", "Fibroblasts", "Neutrophils", "Osteoclasts"], correct: 3, explain: "Osteoclasts are responsible for resorbing the excess bone of the callus during remodeling." },
  { q: "Osteoid, or woven bone, seen in fracture healing is characterized as:", opts: ["Mature, highly calcified bone", "A type of cartilage", "Immature and soft bone with less mineral content", "Dead bone fragments"], correct: 2, explain: "Woven bone is a primitive, rapidly formed bone that is later replaced by stronger lamellar bone." },
  { q: "Which of the following is a local factor that can negatively influence fracture healing?", opts: ["Old age", "Infection at the fracture site", "Malnutrition", "Diabetes mellitus"], correct: 1, explain: "Infection, ischemia, and instability are key local factors that impair healing. The others are systemic." },
  { q: "Which of the following is a systemic factor that can impair fracture healing?", opts: ["Ischemia", "Instability of the fracture", "Malnutrition", "Presence of a foreign body"], correct: 2, explain: "Malnutrition, chronic diseases, and old age are systemic factors. The others are local." },
  { q: "Delayed union, mal-union, and non-union are classified as:", opts: ["Early complications of the fracture itself", "Systemic factors", "Late complications of healing", "Inevitable outcomes"], correct: 2, explain: "These are complications related to the healing process itself, occurring over time." },
  { q: "Fat embolism and avascular necrosis are considered:", opts: ["Late complications of healing", "Early complications of the fracture itself", "Local infections", "Desirable healing outcomes"], correct: 1, explain: "These are serious, immediate consequences that can result from the initial trauma." },
  { q: "Avascular necrosis is the death of bone tissue due to:", opts: ["Lack of blood supply", "Bacterial infection", "Excessive mechanical stress", "Overproduction of osteoclasts"], correct: 0, explain: "It is caused by ischemia, which is a disruption of the blood supply to a part of the bone." },
  { q: "In primary union, 'contact healing' occurs when the gap between bone ends is:", opts: ["Greater than 0.1 mm", "Filled with a large callus", "Less than 0.01 mm", "Not surgically reduced"], correct: 2, explain: "Contact healing happens when the gap is minuscule, allowing direct bone remodeling across the fracture line." },
  { q: "The pro-callus, or provisional callus, is a temporary tissue produced by the:", opts: ["Marrow cavity", "Periosteum", "Compact bone", "Endosteum"], correct: 1, explain: "The periosteum has a rich blood supply and contains cells that differentiate into osteoblasts, making it crucial for callus formation." },
  { q: "Hard callus formation signifies the:", opts: ["Initial blood clot", "Removal of dead tissue", "Union of the fracture gap with bone", "Final reshaping of the bone"], correct: 2, explain: "This stage marks the point where the fracture is bridged by new, albeit immature, bone." },
  { q: "The demolition phase, which lasts about 2 weeks, primarily involves:", opts: ["Fibroblasts laying down collagen", "Osteoclasts removing dead tissue", "Hematoma formation", "Osteoblasts creating new bone"], correct: 1, explain: "This is the clean-up phase where osteoclasts clear away necrotic bone tissue at the fracture edges." }
];

const tfs = [
  { q: "A compound fracture is one where the skin is torn open.", answer: true, explain: "Correct. A compound fracture, also known as an open fracture, breaks the integrity of the skin." },
  { q: "Osteoblasts are responsible for removing bone fragments during healing.", answer: false, explain: "Incorrect. Osteoclasts are responsible for removing (resorbing) bone fragments. Osteoblasts build new bone." },
  { q: "Primary union healing is the most common type and involves a large callus.", answer: false, explain: "Incorrect. Secondary union is the most common and involves a callus. Primary union is less common and has no callus." },
  { q: "The first stage of fracture healing is the formation of a soft callus.", answer: false, explain: "Incorrect. The very first stage is the formation of a hematoma (blood clot) and inflammation." },
  { q: "The remodeling stage is the final phase and can continue for many years.", answer: true, explain: "Correct. Bone remodeling is a long-term process to restore the bone's original shape and strength." },
  { q: "Woven bone (osteoid) is more mature and calcified than lamellar bone.", answer: false, explain: "Incorrect. Woven bone is immature, disorganized, and less mineralized. It is later replaced by mature lamellar bone." },
  { q: "Good blood supply is a critical local factor for successful fracture healing.", answer: true, explain: "Correct. Ischemia (inadequate blood supply) is a major cause of poor or failed healing." },
  { q: "Mal-union means the fracture has failed to heal completely.", answer: false, explain: "Incorrect. Failure to heal is non-union. Mal-union means the fracture has healed in an abnormal or deformed position." },
  { q: "The soft callus consists mainly of mature lamellar bone.", answer: false, explain: "Incorrect. The soft callus is primarily made of cartilage and fibrous tissue, which precedes the formation of bone." }
];

const saqs = [
  { q: "Describe the process of 'Demolition' in fracture healing and identify the primary cell type involved.", a: "Demolition is the second stage of fracture healing, following hematoma formation. It involves the removal of dead bone fragments and necrotic tissue from the fracture site. The primary cell type responsible for this 'clean-up' process is the osteoclast." },
  { q: "List four systemic factors that can negatively influence the fracture healing process.", a: "Four systemic factors that can impair healing are: <br>1. Malnutrition <br>2. Vitamin D deficiency <br>3. Chronic diseases (like diabetes) <br>4. Old age" },
  { q: "Compare Primary Union and Secondary Union in fracture healing, focusing on callus formation and typical conditions for each.", a: "<b>1. Primary Union:</b> Occurs when bone ends are rigidly fixed and surgically approximated with a very small gap. It does not involve the formation of a callus. Healing is faster but initially weaker. <br><b>2. Secondary Union:</b> This is the more common, natural healing process where a gap exists. It involves the formation of a soft callus (cartilage) followed by a hard callus (bone) to bridge the gap, resulting in a stronger union." },
  { q: "A 75-year-old woman with poorly controlled diabetes and a Vitamin D deficiency suffers a femur fracture. Despite proper immobilization, her healing is significantly slower than expected. What is this complication called, and which of her conditions are likely contributing factors?", a: "The complication is called <b>Delayed union</b>. The contributing systemic factors from her history are her old age, poorly controlled diabetes, and Vitamin D deficiency, all of which are known to impair the body's healing capacity." },
  { q: "What is a 'soft callus' and what is its main function in the healing process?", a: "A soft callus is a scaffold-like structure formed in the early stages of secondary fracture healing, composed mainly of cartilage and fibrous tissue. Its main function is to provide initial, temporary stabilization to the fracture site, bridging the gap and acting as a template for the subsequent formation of the hard, bony callus." },
  { q: "Name the six main sequential steps of secondary fracture healing.", a: "The six steps are: <br>1. Hematoma / Inflammation <br>2. Demolition <br>3. Granulation tissue formation <br>4. Soft callus formation <br>5. Hard (Bony) callus formation <br>6. Remodeling" }
];


// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').innerHTML;
    return s + (feedback.startsWith("<b>Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').innerHTML;
    return s + (feedback.startsWith("<b>Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
