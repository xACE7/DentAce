<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
    text-align: left;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
    flex-shrink: 0;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
  .answer table{width:100%; border-collapse:collapse; margin-top:10px;}
  .answer th, .answer td{border:1px solid var(--card-border); padding:8px; text-align:left;}
  .answer th{background-color:rgba(255,255,255,0.05);}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 5</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "Which of the following are the three main types of intra-oral radiographs?",
        opts: ["Intra-oral Periapical, Bitewing, and Occlusal", "Panoramic, Cephalometric, and CBCT", "Lateral Skull, Waters View, and Towne's View", "Digital, Film-based, and Phosphor Plate"],
        correct: 0,
        explain: "The lecture classifies intra-oral radiographs into three main types: Periapical, Bitewing, and Occlusal."
    },
    {
        q: "According to the criteria for a quality radiograph, a periapical film should show the complete root and at least how much of the surrounding periapical bone?",
        opts: ["2mm", "1mm", "3mm", "The entire bone structure"],
        correct: 0,
        explain: "An ideal periapical radiograph must show the complete area of interest, including the full root and at least 2mm of periapical bone."
    },
    {
        q: "The Bisecting Angle technique for periapical radiography is also known by what name?",
        opts: ["Cieszynski's Technique", "Paralleling Technique", "Clark's Rule", "Long Cone Technique"],
        correct: 0,
        explain: "The Bisecting Angle technique is also referred to as the Short Cone or Cieszynski's Technique."
    },
    {
        q: "What is the fundamental principle of the Bisecting Angle technique based on?",
        opts: ["Cieszynski's Rule of Isometry", "The Parallax Principle", "The Inverse Square Law", "The SLOB rule"],
        correct: 0,
        explain: "The technique is based on Cieszynski's Rule of Isometry, which states that two triangles are equal if they share one side and have two equal angles."
    },
    {
        q: "In the Bisecting Angle technique, the central X-ray beam is directed perpendicular to which of the following?",
        opts: ["The imaginary bisector of the angle between the tooth's long axis and the film", "The long axis of the tooth", "The surface of the film", "The occlusal plane"],
        correct: 0,
        explain: "The central ray should be aimed at a 90-degree angle to the imaginary line that bisects the angle formed by the tooth's long axis and the film plane."
    },
    {
        q: "What is the recommended vertical angulation for maxillary incisors when using the Bisecting Angle technique?",
        opts: ["+40°", "+45°", "+30°", "-15°"],
        correct: 0,
        explain: "The standard vertical angulation for maxillary incisors in the bisecting angle technique is +40 degrees."
    },
    {
        q: "What is the recommended vertical angulation for mandibular canines in the Bisecting Angle technique?",
        opts: ["-20°", "-15°", "+45°", "-10°"],
        correct: 0,
        explain: "The standard vertical angulation for mandibular canines in the bisecting angle technique is -20 degrees."
    },
    {
        q: "For taking maxillary radiographs with the bisecting angle technique, which anatomical guideline should be parallel to the floor?",
        opts: ["The Ala-tragal line", "The line from the corner of the mouth to the tragus", "The Frankfort horizontal plane", "The cantho-meatal line"],
        correct: 0,
        explain: "The patient's head should be positioned so that the Ala-tragal line (from the ala of the nose to the tragus of the ear) is parallel to the floor."
    },
    {
        q: "The Paralleling technique is commonly referred to as the:",
        opts: ["Long Cone Technique", "Short Cone Technique", "Rule of Isometry", "Tube-shift Technique"],
        correct: 0,
        explain: "The Paralleling technique is also known as the Long Cone Technique due to the increased target-film distance used."
    },
    {
        q: "What is the primary requirement for film placement in the Paralleling technique?",
        opts: ["The film is placed parallel to the long axis of the tooth", "The film must be in contact with the lingual surface of the tooth", "A short (8-inch) PID must be used", "The vertical angulation is always positive"],
        correct: 0,
        explain: "The core principle of this technique is that the film is placed in the mouth parallel to the long axis of the tooth being radiographed."
    },
    {
        q: "What is a primary indication for taking a Bitewing radiograph?",
        opts: ["Detecting incipient interproximal caries", "Diagnosing a periapical infection", "Locating an impacted canine", "Evaluating the temporomandibular joint"],
        correct: 0,
        explain: "Bitewing radiographs excel at showing the crowns of posterior teeth and are the primary tool for detecting early dental caries between teeth (interproximal)."
    },
    {
        q: "Which of the following conditions is a contraindication for using Bitewing radiography?",
        opts: ["Periapical infection", "Assessing restoration margins", "Detecting calculus deposits", "Monitoring incipient bone loss"],
        correct: 0,
        explain: "Since bitewings do not show the root apex, they are not suitable for diagnosing periapical infections."
    },
    {
        q: "What is the standard vertical angulation for a Bitewing radiograph?",
        opts: ["+10°", "0°", "-10°", "+20°"],
        correct: 0,
        explain: "A +10 degree vertical angulation is used for bitewings to compensate for the slight tilt of the maxillary posterior teeth and the curve of Spee."
    },
    {
        q: "A standard full mouth radiographic series (FMX) typically includes how many films?",
        opts: ["21 (17 periapical and 4 bitewing)", "18 (14 periapical and 4 bitewing)", "14 (all periapical)", "24 (18 periapical and 6 bitewing)"],
        correct: 0,
        explain: "The lecture specifies that a full mouth series consists of 21 films in total: 17 periapical views and 4 bitewing views."
    },
    {
        q: "Object localization techniques are necessary in dentistry because a standard radiograph is a:",
        opts: ["2D representation of a 3D object", "3D representation of a 2D object", "Perfect anatomical replica without distortion", "Cross-sectional image"],
        correct: 0,
        explain: "A conventional radiograph flattens three-dimensional structures into a two-dimensional image, losing information about depth (buccal-lingual relationship)."
    },
    {
        q: "Which of the following is a common reason to use an object localization technique?",
        opts: ["Determining the buccolingual position of an impacted tooth", "Diagnosing periodontal disease", "Detecting occlusal caries", "Assessing pulp vitality"],
        correct: 0,
        explain: "Localization techniques are essential for finding the precise position of objects like impacted teeth, foreign bodies, or root canals."
    },
    {
        q: "The two main methods for object localization described in the lecture are:",
        opts: ["Parallax and Right angle", "Bisecting and Paralleling", "Bitewing and Occlusal", "Horizontal and Vertical shift"],
        correct: 0,
        explain: "The lecture outlines two primary techniques: the Parallax (or Tube-shift) method and the Right Angle method."
    },
    {
        q: "The Parallax method for object localization is also known as:",
        opts: ["Clark's rule (SLOB rule)", "Cieszynski's rule", "Miller's technique", "Right Angle technique"],
        correct: 0,
        explain: "The Parallax method is also referred to as the Tube-shift Technique, Clark's rule, and most commonly, the SLOB rule."
    },
    {
        q: "The acronym 'SLOB' in object localization stands for:",
        opts: ["Same Lingual, Opposite Buccal", "Superior Lingual, Oblique Buccal", "Slow Lingual, Opposite Buccal", "Same Labial, Opposite Buccal"],
        correct: 0,
        explain: "SLOB is a mnemonic for Same Lingual, Opposite Buccal, which describes how the object's image moves in relation to the tube head shift."
    },
    {
        q: "According to the SLOB rule, if the X-ray tube is shifted distally and an unerupted tooth also appears to have moved distally on the new radiograph, the tooth is located:",
        opts: ["Lingually", "Buccally", "Directly in the arch", "Apically"],
        correct: 0,
        explain: "If the object moves in the SAME direction as the tube shift, it is located on the lingual side."
    },
    {
        q: "According to the SLOB rule, if the tube is shifted mesially and the object appears to move distally, where is it located?",
        opts: ["Buccally", "Lingually", "Palatally", "In the center of the alveolus"],
        correct: 0,
        explain: "If the object moves in the OPPOSITE direction of the tube shift, it is located on the buccal side."
    },
    {
        q: "The Right Angle technique for object localization most commonly uses a periapical radiograph in conjunction with what other type of film?",
        opts: ["An Occlusal radiograph", "A Bitewing radiograph", "A Panoramic radiograph", "A Cephalometric radiograph"],
        correct: 0,
        explain: "This technique uses two films taken at right angles to each other, typically a periapical view and an occlusal view, to determine an object's location."
    },
    {
        q: "Which is a primary indication for taking an Occlusal radiograph?",
        opts: ["Evaluating the size and extent of large lesions like cysts or tumors", "Detecting incipient interproximal caries", "Assessing routine periodontal health", "Checking for minor restoration overhangs"],
        correct: 0,
        explain: "Occlusal films are excellent for viewing large areas of the maxilla or mandible and are used to assess large lesions, fractures, and locate unerupted teeth."
    },
    {
        q: "Occlusal radiography is an especially valuable technique for patients who have:",
        opts: ["Trismus (limited mouth opening)", "A severe gag reflex", "High caries risk", "No remaining teeth"],
        correct: 0,
        explain: "Since placing an occlusal film requires minimal mouth opening, it is a very useful technique for patients with trismus."
    },
    {
        q: "What is the correct vertical angulation for a True (or Cross-sectional) Maxillary Occlusal radiograph?",
        opts: ["+65°", "+90°", "+45°", "-55°"],
        correct: 0,
        explain: "For a True Maxillary Occlusal view, the central ray is directed at +65 degrees through the bridge of the nose."
    },
    {
        q: "What is the correct vertical angulation for an Anterior Mandibular Occlusal radiograph?",
        opts: ["-55°", "-90°", "+45°", "0°"],
        correct: 0,
        explain: "The lecture states the angulation for an Anterior Mandibular Occlusal is -55 degrees. Note: The diagram on slide 40 shows a different angulation, but the list on slide 35 is the primary reference."
    },
    {
        q: "For a Cross-sectional Mandibular Occlusal view, the central ray is directed at what angle relative to the film?",
        opts: ["90°", "65°", "45°", "55°"],
        correct: 0,
        explain: "The central ray is projected at a 90-degree angle to the film from a point approximately 3 cm below the chin."
    },
    {
        q: "The point of entry for the central ray in an Anterior Maxillary (Topographic) Occlusal view is:",
        opts: ["The tip of the nose", "The bridge of the nose", "The outer canthus of the eye", "The tip of the chin"],
        correct: 0,
        explain: "For the anterior topographic maxillary view, the central ray is directed at +65 (or +45 as per other slides) degrees through the tip of the nose."
    },
    {
        q: "Which principle states that the apparent displacement of an object is caused by a change in the angulation of the x-ray beam?",
        opts: ["Parallax", "Isometry", "Right Angle", "Tomography"],
        correct: 0,
        explain: "This is the definition of Parallax, which is the underlying principle of the tube-shift or SLOB technique."
    },
    {
        q: "What is the recommended vertical angulation for maxillary molars in the Bisecting Angle technique?",
        opts: ["+20°", "+30°", "+40°", "-5°"],
        correct: 0,
        explain: "The standard vertical angulation for maxillary molars in the bisecting angle technique is +20 degrees."
    }
];

const tfs = [
    {
        q: "An ideal periapical radiograph should show only the crown and the cervical third of the root.",
        answer: false,
        explain: "False. An ideal radiograph must show the complete root structure and at least 2mm of surrounding periapical bone."
    },
    {
        q: "The Bisecting Angle technique is also known as the 'Long Cone' technique.",
        answer: false,
        explain: "False. The Bisecting Angle technique is the 'Short Cone' technique. The Paralleling technique is the 'Long Cone' technique."
    },
    {
        q: "In the Paralleling technique, the film and the long axis of the tooth should be perpendicular to each other.",
        answer: false,
        explain: "False. As the name suggests, the film and the long axis of the tooth must be parallel to each other."
    },
    {
        q: "The correct horizontal angulation for a bitewing radiograph is 0°, with the central ray aimed through the contact areas.",
        answer: true,
        explain: "True. This ensures that the interproximal spaces are open and can be evaluated for caries."
    },
    {
        q: "Bitewing radiographs are the best imaging choice for diagnosing a periapical abscess.",
        answer: false,
        explain: "False. This is a contraindication. Bitewings do not capture the apical region, so a periapical radiograph is required."
    },
    {
        q: "The SLOB rule is a mnemonic and a synonym for the Parallax method of object localization.",
        answer: true,
        explain: "True. The SLOB (Same Lingual, Opposite Buccal) rule is the practical application of the Parallax principle."
    },
    {
        q: "The Right Angle object localization technique requires taking only one standard periapical radiograph.",
        answer: false,
        explain: "False. It requires two radiographs taken at right angles to each other, typically a periapical and an occlusal film."
    },
    {
        q: "A valid indication for taking an occlusal radiograph is to detect sialoliths in the salivary ducts.",
        answer: true,
        explain: "True. Occlusal views are effective for visualizing the floor of the mouth and detecting calcifications like sialoliths."
    },
    {
        q: "For maxillary periapical radiographs, the patient's head should be positioned so the line from the corner of the mouth to the tragus is parallel to the floor.",
        answer: false,
        explain: "False. This head position is for mandibular radiographs. For maxillary radiographs, the ala-tragal line should be parallel to the floor."
    }
];

const saqs = [
    {
        q: "Describe the principle of Cieszynski's Rule of Isometry as it applies to the bisecting angle technique.",
        a: "It states that two triangles are equal when they share one complete side and have two equal angles. In radiography, this geometric principle is applied by creating two imaginary triangles. The accurate image length of the tooth is achieved by directing the central X-ray beam perpendicular to the imaginary bisector of the angle formed by the tooth's long axis and the film plane."
    },
    {
        q: "List three distinct indications for using Occlusal Radiography.",
        a: "A numbered list of acceptable answers includes:<br>1. Evaluation of the size and extent of large lesions like cysts and tumors.<br>2. Localization of foreign bodies, unerupted teeth, or sialoliths.<br>3. Assessment of the medial and lateral extent of fractures of the mandible or maxilla.<br>4. Periapical assessment for patients with trismus (limited mouth opening)."
    },
    {
        q: "In a numbered table, compare the Bisecting Angle and Paralleling techniques on three key features: cone length, film placement, and image distortion.",
        a: `
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Feature</th>
                        <th>Bisecting Angle Technique</th>
                        <th>Paralleling Technique</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Cone Length</td>
                        <td>Short Cone (8-inch PID)</td>
                        <td>Long Cone (16-inch PID)</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Film Placement</td>
                        <td>As close to the tooth as possible, forming an angle with it.</td>
                        <td>Parallel to the long axis of the tooth, often away from it.</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Image Distortion</td>
                        <td>More inherent geometric distortion (e.g., foreshortening).</td>
                        <td>Less geometric distortion, producing a more accurate image.</td>
                    </tr>
                </tbody>
            </table>
        `
    },
    {
        q: "A patient presents with a suspected impacted maxillary canine. The dentist takes a periapical radiograph but cannot determine if the tooth is positioned buccally or palatally. Describe the steps to take using the Parallax (SLOB) technique to make this determination.",
        a: "The dentist should take a second periapical radiograph after changing the horizontal angulation of the X-ray tube head (shifting it either mesially or distally). By comparing the two images, the buccolingual position can be determined:<br>1. If the impacted canine appears to move in the <b>SAME</b> direction as the tube shift, it is on the <b>Lingual</b> (or Palatal) side.<br>2. If it appears to move in the <b>OPPOSITE</b> direction of the tube shift, it is on the <b>Buccal</b> side."
    },
    {
        q: "What are the four criteria for an ideal quality radiograph as mentioned in the lecture?",
        a: "A numbered list of the four criteria:<br>1. It should record the complete area of interest, including the entire root.<br>2. It should show at least 2mm of periapical bone.<br>3. It should have the least possible amount of geometric distortion (mistake of shape/size).<br>4. It should have optimal density and contrast to facilitate interpretation."
    },
    {
        q: "List the recommended vertical angulations for all maxillary teeth (Incisors, Canines, Premolars, Molars) when using the Bisecting Angle Technique.",
        a: "A numbered list of the angulations:<br>1. <b>Incisors:</b> +40°<br>2. <b>Canines:</b> +45°<br>3. <b>Premolars:</b> +30°<br>4. <b>Molars:</b> +20°"
    }
];


// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[j]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      const originalSelectedIndex = visualToOriginal[v];
      state.mcq[idx] = originalSelectedIndex;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
    let mcqScore = 0;
    state.mcq.forEach((selectedIndex, i) => {
        if (selectedIndex === null) return;
        const item = mcqs[i];
        if (selectedIndex === item.correct) {
            mcqScore++;
        }
    });

    const tfScore = state.tf.reduce((s, v, i) => {
        if (v === null) return s;
        return s + (v === tfs[i].answer ? 1 : 0);
    }, 0);

    const saqScore = state.saq.filter(Boolean).length;
    const total = mcqScore + tfScore + saqScore;

    const ids = ["sMcq", "sTf", "sSaq", "sTotal", "sMcq2", "sTf2", "sSaq2", "sTotal2"];
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (id.includes('Mcq')) el.textContent = mcqScore;
        if (id.includes('Tf')) el.textContent = tfScore;
        if (id.includes('Saq')) el.textContent = saqScore;
        if (id.includes('Total')) el.textContent = total;
    });
}


document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>

