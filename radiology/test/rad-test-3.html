<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer ol, .answer ul { padding-left: 20px; }
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 3</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "According to the 'Bystander Effect' theory, how do irradiated cells cause damage to neighboring non-irradiated cells?",
        opts: [
            "By triggering cell-cell and cell-matrix communication.",
            "Through direct ionization of adjacent cells.",
            "By releasing heat and causing thermal damage.",
            "By absorbing all available nutrients in the local environment."
        ],
        correct: 0,
        explain: "The Bystander Effect involves irradiated cells releasing signals that affect nearby cells, unlike the Hit Theory where only directly ionized cells are damaged."
    },
    {
        q: "Which of the following is an example of a stochastic effect of radiation?",
        opts: [
            "Radiation-induced cancer",
            "Radiation mucositis",
            "Erythema",
            "Desquamation"
        ],
        correct: 0,
        explain: "Stochastic effects are probabilistic ('may develop') and not dependent on the dose amount for their severity, like cancer. Deterministic effects are definitive damaging effects at specific high doses."
    },
    {
        q: "What proportion of the harmful effects of radiation is caused by the indirect effect?",
        opts: [
            "1/3",
            "2/3",
            "1/2",
            "3/4"
        ],
        correct: 1,
        explain: "Approximately two-thirds of the harmful biological effects of x-radiation are caused by indirect effects, primarily through the radiolysis of water."
    },
    {
        q: "Which free radical, formed from the radiolysis of water, is considered more important in causing tissue damage?",
        opts: [
            "Hydrogen (H)",
            "Hydroxyl (OH)",
            "Superoxide (O2-)",
            "Peroxide (H2O2)"
        ],
        correct: 1,
        explain: "The hydroxyl radical (OH) is extremely reactive and is considered the more significant contributor to tissue damage among the free radicals formed from water."
    },
    {
        q: "Which of the following cell types is classified as the MOST radiosensitive?",
        opts: [
            "Vegetative Intermitotic Cells",
            "Reverting Post-mitotic Cells",
            "Fixed Post-mitotic Cells",
            "Multipotential Connective Tissue Cells"
        ],
        correct: 0,
        explain: "Vegetative Intermitotic Cells (e.g., basal cells of oral mucosa) divide regularly, have a long mitotic future, and are the most radiosensitive."
    },
    {
        q: "According to the organ radiosensitivity classification, which of the following has a HIGH radiosensitivity?",
        opts: [
            "Bone Marrow",
            "Salivary Glands",
            "Mature Erythrocytes",
            "Muscle Cells"
        ],
        correct: 0,
        explain: "Bone marrow, along with lymphoid organs, testes, and intestines, is classified as having high radiosensitivity. Salivary glands are intermediate, while mature erythrocytes and muscle are low."
    },
    {
        q: "Radiation exposure occurring in which phase of the cell cycle leads to a 'Chromosome Aberration' affecting both arms of the chromosome?",
        opts: [
            "G1 or early S phase",
            "G2 or late S phase",
            "Mitosis",
            "Anaphase"
        ],
        correct: 0,
        explain: "Chromosome Aberration occurs when radiation exposure happens before DNA replication (G1 or early S), causing damage that is replicated and appears in both arms."
    },
    {
        q: "What is the primary cause of long-term radiation damage to tissues and organs?",
        opts: [
            "Damage to the fine vasculature",
            "Direct damage to nerve cells",
            "Persistent inflammation",
            "Depletion of stem cells"
        ],
        correct: 0,
        explain: "Long-term effects depend primarily on the extent of damage to the fine vasculature, which leads to impaired nutrition, oxygenation, and waste removal, ultimately causing cell death."
    },
    {
        q: "Radiation-induced mucositis in the oral cavity typically begins to manifest at what point during radiotherapy?",
        opts: [
            "Immediately after the first dose",
            "At the end of the first week",
            "At the end of the second week",
            "Two months after treatment completion"
        ],
        correct: 2,
        explain: "At the end of the second week of radiotherapy, cells in the basal layer begin to die, leading to the breakdown of the mucous membrane and the formation of a pseudomembrane."
    },
    {
        q: "Which type of salivary gland acini are more radiosensitive?",
        opts: [
            "Serous acini",
            "Mucous acini",
            "Both are equally sensitive",
            "Neither are sensitive"
        ],
        correct: 0,
        explain: "Serous acini are more radiosensitive than mucous acini. This is why the parotid gland (predominantly serous) is more affected than submandibular or sublingual glands."
    },
    {
        q: "Osteoradionecrosis is a serious complication of radiation to the bone, characterized by what state?",
        opts: [
            "Hypovascular, Hypoxic, and Hypocellular",
            "Hypervascular, Hyperoxic, and Hypercellular",
            "Increased osteoblastic activity",
            "Rapid bone remodeling"
        ],
        correct: 0,
        explain: "Radiation damages bone vasculature (hypovascular), reduces oxygen (hypoxic), and destroys osteoblasts and osteoclasts (hypocellular), leading to osteoradionecrosis."
    },
    {
        q: "The initial interaction between ionizing radiation and tissues occurs within an extremely short timeframe, approximately:",
        opts: [
            "10^-13 seconds",
            "10^-3 seconds",
            "1 second",
            "10 minutes"
        ],
        correct: 0,
        explain: "The initial physical interaction of ionizing radiation with biologic matter is nearly instantaneous, taking place in about 10^-13 seconds."
    },
    {
        q: "Which is a characteristic of Differentiating Intermitotic Cells?",
        opts: [
            "They divide less often and undergo some differentiation.",
            "They are the most radiosensitive cell type.",
            "They are highly specialized and incapable of division.",
            "They divide regularly and have a long mitotic future."
        ],
        correct: 0,
        explain: "Differentiating Intermitotic Cells (e.g., spermatocytes) are less radiosensitive than vegetative cells because they divide less frequently and differentiate between divisions."
    },
    {
        q: "Damage to DNA by radiation can lead to which of the following outcomes?",
        opts: [
            "Mutation, Carcinogenesis, and Cell Death",
            "Only immediate cell death",
            "Increased protein synthesis",
            "Strengthening of hydrogen bonds"
        ],
        correct: 0,
        explain: "Radiation-induced DNA damage, such as base-pair changes or strand breaks, can result in mutation, cancer development (carcinogenesis), or cell death."
    },
    {
        q: "What happens to the oral microbial flora as a result of radiation-induced xerostomia?",
        opts: [
            "It becomes more acidogenic.",
            "It becomes more alkaline.",
            "It is completely eradicated.",
            "It is replaced by fungal flora only."
        ],
        correct: 0,
        explain: "The reduction in saliva flow, pH, and buffering capacity causes the oral microbial flora to shift towards being more acid-producing (acidogenic), increasing caries risk."
    },
    {
        q: "Which of the following is NOT a type of radiation caries described in the lecture?",
        opts: [
            "Pitting caries on the enamel surface.",
            "Superficial buccal, occlusal, and incisal caries.",
            "Cementum and dentine caries at the cervical region.",
            "Dark pigmentation of the entire crown."
        ],
        correct: 0,
        explain: "The lecture describes widespread superficial caries, cervical caries, and dark pigmentation. Pitting caries is a more typical pattern for non-radiation-related caries."
    },
    {
        q: "A 'Chromatid Aberration' results from radiation exposure during which phase of the cell cycle?",
        opts: [
            "G2 or late S phase",
            "G1 or early S phase",
            "Prophase",
            "Telophase"
        ],
        correct: 0,
        explain: "If radiation exposure occurs after DNA has been synthesized (in G2 or late S), only one arm of the chromosome (a chromatid) is affected."
    },
    {
        q: "What is the primary cause of mandibular dysfunction following radiotherapy?",
        opts: [
            "Fibrosis of the muscles of mastication",
            "Direct damage to the temporomandibular joint",
            "Ankylosis of the condyle",
            "Neurological damage to the trigeminal nerve"
        ],
        correct: 0,
        explain: "Musculoskeletal syndromes, including trismus and mandibular dysfunction, arise due to the development of fibrosis in the irradiated muscles."
    },
    {
        q: "Which tissue in a developing tooth is most radiosensitive?",
        opts: [
            "Pulpal tissue",
            "Enamel",
            "Dentin",
            "Cementum"
        ],
        correct: 0,
        explain: "If radiation occurs before tooth development, the pulpal tissue, containing reverting post-mitotic cells, is sensitive and the tooth bud can be destroyed."
    },
    {
        q: "A definitive damaging effect that occurs when exposed to a specific high dose of radiation is called a:",
        opts: [
            "Deterministic Effect",
            "Stochastic Effect",
            "Bystander Effect",
            "Indirect Effect"
        ],
        correct: 0,
        explain: "Deterministic effects are direct, dose-dependent consequences of high-dose radiation exposure, with a threshold below which they do not occur."
    },
    {
        q: "Which cells are classified as 'Reverting Post-mitotic cells' and are relatively radioresistant?",
        opts: [
            "Acinar and ductal cells of salivary glands",
            "Spermatogenic cells",
            "Basal cells of oral mucous membrane",
            "Erythroblastic series"
        ],
        correct: 0,
        explain: "Reverting post-mitotic cells are specialized, divide infrequently, and are therefore radioresistant. Examples include cells of the salivary glands, liver, and kidney."
    },
    {
        q: "What is the consequence of radiation damage to proteins?",
        opts: [
            "Changes in secondary and tertiary structures",
            "Formation of new, stronger proteins",
            "An increase in enzyme activity only",
            "Breakage of peptide bonds"
        ],
        correct: 0,
        explain: "Radiation can disrupt side chains, hydrogen bonds, and disulfide bonds, leading to changes in the secondary and tertiary structures of proteins, altering their function."
    },
    {
        q: "How does radiation affect taste buds?",
        opts: [
            "Taste perception is lost by the 2nd-3rd week but can recover.",
            "Taste is permanently and completely lost after a single dose.",
            "Only the ability to taste sweet flavors is affected.",
            "Taste perception becomes hypersensitive."
        ],
        correct: 0,
        explain: "Taste buds are affected in the second to third week of therapy, leading to loss of taste (ageusia). This usually reverts to normal in 2-4 months, though very high doses can cause permanent damage."
    },
    {
        q: "The direct effect of radiation involves:",
        opts: [
            "Direct ionization of a biologic molecule like DNA.",
            "Formation of free radicals from water.",
            "Communication between irradiated and non-irradiated cells.",
            "Damage to the fine vasculature."
        ],
        correct: 0,
        explain: "The direct effect occurs when the energy of a photon or secondary electron is deposited directly within and ionizes a critical biologic macromolecule."
    },
    {
        q: "Which of the following organs has LOW radiosensitivity?",
        opts: [
            "Nerves",
            "Intestine",
            "Testes",
            "Lymphoid tissue"
        ],
        correct: 0,
        explain: "Nerves and muscle cells are composed of fixed post-mitotic cells and are highly radioresistant (low sensitivity). Intestines, testes, and lymphoid tissues are highly radiosensitive."
    },
    {
        q: "Higher doses of radiation (30-50Gy) are required to cause significant damage to which part of the cell?",
        opts: [
            "Cytoplasmic organelles like mitochondria",
            "The cell nucleus",
            "The DNA within the nucleus",
            "The cell membrane"
        ],
        correct: 0,
        explain: "The nucleus and its DNA are the most radiosensitive components. Much higher doses are needed to directly damage cytoplasmic organelles like mitochondria."
    },
    {
        q: "How long after radiotherapy should non-emergency tooth extractions ideally be postponed?",
        opts: [
            "At least 6 months",
            "1 week",
            "1 month",
            "It can be done at any time"
        ],
        correct: 0,
        explain: "To minimize the risk of osteoradionecrosis, it is desirable to postpone extractions for at least 6 months following radiotherapy to allow for some tissue recovery."
    },
    {
        q: "Radiation before the initiation of tooth calcification can lead to:",
        opts: [
            "Destruction of the tooth bud",
            "Only dwarfed teeth",
            "Only retarded root development",
            "Accelerated tooth eruption"
        ],
        correct: 0,
        explain: "If radiation precedes calcification, the sensitive pulpal tissue can be destroyed, leading to failure of the tooth to form."
    },
    {
        q: "Which treatment agent is a sialogogue used to stimulate saliva flow in patients with xerostomia?",
        opts: [
            "Pilocarpine",
            "Chlorhexidine Gluconate",
            "Benzocaine",
            "Milk of Magnesia"
        ],
        correct: 0,
        explain: "Pilocarpine is a sialogogue, a medication that stimulates the salivary glands to produce more saliva. The others are for hygiene, anesthesia, or coating."
    },
    {
        q: "What change in irradiated bone leads to it being termed 'hypocellular'?",
        opts: [
            "Destruction of Osteoblasts and Osteoclasts",
            "Loss of mineral content only",
            "Replacement of marrow with vascular tissue",
            "Fibrosis of the periosteum"
        ],
        correct: 0,
        explain: "The term 'hypocellular' refers to the loss of cells. In irradiated bone, both bone-forming cells (osteoblasts) and bone-resorbing cells (osteoclasts) are destroyed."
    }
];

const tfs = [
    {
        q: "The 'Hit Theory' suggests that radiation damage is confined only to cells that are directly ionized.",
        answer: true,
        explain: "This is the core concept of the Hit Theory, which posits that damage only occurs in the cell directly 'hit' by ionization."
    },
    {
        q: "Stochastic effects of radiation, such as cancer, have a clear dose threshold below which they do not occur.",
        answer: false,
        explain: "Stochastic effects are probabilistic and do not have a dose threshold. Deterministic effects are the ones with a dose threshold."
    },
    {
        q: "Fixed post-mitotic cells, such as neurons, are the most radiosensitive cells in the body.",
        answer: false,
        explain: "Fixed post-mitotic cells are the most radioresistant because they are highly differentiated and do not divide. The most radiosensitive cells are those that divide regularly."
    },
    {
        q: "The indirect effect of radiation accounts for approximately one-third of the biological damage.",
        answer: false,
        explain: "The indirect effect, via radiolysis of water, accounts for two-thirds of the biological damage. The direct effect accounts for one-third."
    },
    {
        q: "Healing of radiation mucositis is typically complete within 2 weeks after therapy ends.",
        answer: false,
        explain: "Healing from mucositis typically completes by 2 months, not 2 weeks. The mucosa may remain thin and atrophic for much longer."
    },
    {
        q: "In developing teeth, radiation exposure after the initiation of calcification can still cause malformations like dwarfed teeth.",
        answer: true,
        explain: "Even after calcification has begun, radiation can interfere with development, leading to malformations such as retarded root development or dwarfed teeth."
    },
    {
        q: "The parotid gland is more radiosensitive than the submandibular gland.",
        answer: true,
        explain: "The parotid gland is predominantly serous acini, which are more radiosensitive than the mucous acini found in greater proportions in the submandibular and sublingual glands."
    },
    {
        q: "The nucleus of a cell is more radioresistant than its cytoplasm.",
        answer: false,
        explain: "The nucleus, and specifically the DNA within it, is the most radiosensitive part of the cell. Higher doses are required to damage cytoplasmic organelles."
    },
    {
        q: "Radiation caries is caused by direct radiation damage to the enamel structure, making it weaker.",
        answer: false,
        explain: "Radiation caries is an indirect effect caused by radiation-induced hyposalivation (xerostomia), which leads to a reduced pH, loss of buffering capacity, and a shift in oral flora."
    }
];

const saqs = [
    {
        q: "A 65-year-old patient is undergoing radiotherapy for a tumor in the tonsillar region. After three weeks, he reports severe oral pain, difficulty swallowing, and has a yellow pseudomembrane on his soft palate. What is this condition and why does it occur?",
        a: "<b>Condition:</b> Radiation Mucositis.<br><b>Mechanism:</b> It occurs because radiation kills the rapidly dividing basal cells of the oral mucous membrane (vegetative intermitotic cells). Without replacement cells, the mucosa thins and breaks down, leading to inflammation, ulceration, and the formation of a pseudomembrane."
    },
    {
        q: "List the 3 main factors that determine the radiosensitivity of a cell.",
        a: "The three main factors are: <ol><li><b>Mitotic Rate:</b> Cells that divide more frequently are more sensitive.</li><li><b>Future Mitosis Potential:</b> Cells that will undergo many future divisions are more sensitive.</li><li><b>Cell Differentiation:</b> Primitive, undifferentiated cells are more sensitive than specialized, mature cells.</li></ol>"
    },
    {
        q: "Compare and contrast the Direct and Indirect effects of radiation.",
        a: "<b>Direct Effect:</b><br><ul><li>The energy of the photon directly ionizes a critical biologic molecule (e.g., DNA).</li><li>Accounts for about 1/3 of biological damage.</li></ul><b>Indirect Effect:</b><br><ul><li>The photon ionizes water molecules, creating highly reactive free radicals (H• and OH•).</li><li>These free radicals then diffuse and damage biologic molecules.</li><li>Accounts for about 2/3 of biological damage.</li></ul>"
    },
    {
        q: "Explain the pathogenesis of Osteoradionecrosis in bone that has been irradiated.",
        a: "Radiation damages the fine vasculature of the periosteum and cortical bone, leading to a state that is:<br><b>1. Hypovascular:</b> Reduced blood supply.<br><b>2. Hypoxic:</b> Reduced oxygen supply.<br><b>3. Hypocellular:</b> Destroys osteoblasts and osteoclasts.<br>This compromised, non-vital bone has a greatly reduced ability to heal and respond to trauma or infection, leading to necrosis."
    },
    {
        q: "List three major effects of radiation on salivary glands and the resulting clinical condition.",
        a: "Effects of radiation on salivary glands include:<br><ol><li><b>Paranchymal Degeneration:</b> Progressive fibrosis and loss of acinar cells.</li><li><b>Loss of Fine Vasculature:</b> Reduces the gland's functional capacity.</li><li><b>Inflammation:</b> Acute and chronic inflammation of the gland tissue.</li></ol>The primary clinical condition resulting from this damage is <b>Xerostomia</b> (dry mouth)."
    },
    {
        q: "Describe the difference between a Chromosome Aberration and a Chromatid Aberration based on the timing of radiation exposure.",
        a: "<b>1. Chromosome Aberration:</b> Occurs when radiation exposure happens <u>before DNA replication</u> (in the G1 or early S phase). The damage is then duplicated, so both arms of the chromosome are affected after mitosis.<br><br><b>2. Chromatid Aberration:</b> Occurs when radiation exposure happens <u>after DNA synthesis</u> (in the G2 or late S phase). The damage affects only one arm (one chromatid) of the chromosome."
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;margin-bottom:10px;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    toggleBtn.style.borderColor = now ? "rgba(34,197,94,.7)" : "rgba(255,255,255,0.18)";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{
    b.textContent="I was correct";
    b.style.outline="none";
    b.style.borderColor = "rgba(255,255,255,0.18)";
  });

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>

