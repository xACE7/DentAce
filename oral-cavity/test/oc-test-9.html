<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam â€¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ğŸ¦· Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 9 (by ACE)</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù„Ø§ Ø³ÙÙ‡Ù’Ù„Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù…ÙØ§ Ø¬ÙØ¹ÙÙ„Ù’ØªÙÙ‡Ù Ø³ÙÙ‡Ù’Ù„Ù‹Ø§ØŒ ÙˆÙØ£ÙÙ†Ù’ØªÙ ØªÙØ¬Ù’Ø¹ÙÙ„Ù Ø§Ù„Ø­ÙØ²Ù’Ù†Ù Ø¥ÙØ°ÙØ§ Ø´ÙØ¦Ù’ØªÙ Ø³ÙÙ‡Ù’Ù„Ù‹Ø§</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled from lecture topic) -----------
const mcqs = [
  {q:"Which embryonic oral epithelium thickening initiates tooth development?",opts:["Dental papilla","Dental sac (follicle)","Dental lamina","Hertwig's epithelial root sheath"],correct:2,explain:"Tooth initiation begins with a horseshoe-shaped thickening of oral epithelium called the dental lamina."},
  {q:"Successional permanent teeth develop as:",opts:["Anterior extension of vestibular lamina","Localized proliferation on the lingual side of each primary tooth germ","Posterior extension of dental lamina","Migration from Meckel's cartilage"],correct:1,explain:"Successional teeth arise from a localized proliferative extension of the dental lamina associated with each primary tooth germ."},
  {q:"Accessional teeth (molars) form as:",opts:["Posterior extension of the dental lamina","From successional lamina of primary molars","Division of a primary bud","From the vestibular lamina"],correct:0,explain:"Molars are accessional teeth and arise from posterior growth of the dental lamina."},
  {q:"Which is the correct order of histological stages?",opts:["Cap â†’ Bud â†’ Early bell â†’ Advanced bell","Bud â†’ Cap â†’ Early bell â†’ Advanced bell","Bud â†’ Early bell â†’ Cap â†’ Advanced bell","Initiation â†’ Advanced bell â†’ Cap â†’ Bud"],correct:1,explain:"The classical sequence is Bud, Cap, Early Bell, Advanced Bell."},
  {q:"The enamel organ first appears in which stage?",opts:["Bud","Cap","Early bell","Advanced bell"],correct:1,explain:"At cap stage, the enamel organ shows a cap-shaped structure over the dental papilla."},
  {q:"Which component gives rise to dentin?",opts:["Inner enamel epithelium","Outer enamel epithelium","Dental papilla ectomesenchyme","Dental follicle"],correct:2,explain:"Odontoblasts differentiate from the dental papilla to form dentin."},
  {q:"Ameloblasts differentiate from:",opts:["Inner enamel epithelium","Stellate reticulum","Stratum intermedium","Dental follicle"],correct:0,explain:"Inner enamel epithelium cells elongate and differentiate into ameloblasts that form enamel."},
  {q:"The stellate reticulum is best described as:",opts:["A star-shaped cell network acting as a cushioning, hydrophilic layer","A signaling center for cusp patterning","A vascular connective tissue layer","An acellular cuticle on erupted enamel"],correct:0,explain:"Stellate reticulum cells form a hydrated cushion within the enamel organ."},
  {q:"Which temporary epithelial structure regulates cusp patterning?",opts:["Cervical loop","Enamel knot","HERS","Reduced enamel epithelium"],correct:1,explain:"Primary and secondary enamel knots act as transient signaling centers for cusp morphology."},
  {q:"The cervical loop is the meeting of:",opts:["Inner and outer enamel epithelium","Inner enamel epithelium and stratum intermedium","Outer enamel epithelium and stellate reticulum","Ameloblasts and odontoblasts"],correct:0,explain:"At the cervical loop, IEE and OEE meet; it is important for crown/root transition."},
  {q:"Hertwig's epithelial root sheath (HERS) forms from:",opts:["Fusion of IEE and OEE at the cervical loop extending apically","Fragmentation of reduced enamel epithelium","Condensation of dental papilla","Folding of vestibular lamina"],correct:0,explain:"Root formation begins as IEE and OEE proliferate apically to form HERS."},
  {q:"Cementoblasts are derived primarily from:",opts:["Dental papilla","Dental follicle (sac)","HERS cells","Stellate reticulum"],correct:1,explain:"The dental follicle gives rise to cementoblasts, fibroblasts (PDL) and osteoblasts (alveolar bone)."},
  {q:"The stratum intermedium is associated closely with:",opts:["Dentin mineralization","Terminal differentiation of ameloblasts and enamel maturation","PDL fiber formation","Cementum resorption"],correct:1,explain:"Stratum intermedium cooperates with ameloblasts during enamel formation and maturation."},
  {q:"Reciprocal induction during apposition starts when:",opts:["Odontoblasts secrete predentin first","Ameloblasts secrete enamel first","Both start simultaneously","Cementoblasts start first"],correct:0,explain:"Odontoblasts lay down predentin, which triggers ameloblasts to deposit enamel."},
  {q:"The first hard tissue formed during crown development is:",opts:["Enamel","Predentin/Dentin","Cementum","Alveolar bone"],correct:1,explain:"Predentin (later mineralized to dentin) precedes enamel."},
  {q:"Reduced enamel epithelium forms from:",opts:["Ameloblasts only","OEE only","Ameloblasts plus remnants of enamel organ (e.g., SI/OEE)","HERS"],correct:2,explain:"After enamel formation, ameloblasts and other enamel organ layers fuse to form the reduced enamel epithelium covering the crown prior to eruption."},
  {q:"Which statement about DEJ is TRUE?",opts:["It forms after enamel maturation","It is established where first enamel meets first predentin","It equals the CEJ","It is formed by HERS"],correct:1,explain:"The dentinoenamel junction is laid where first enamel contacts first formed dentin."},
  {q:"The dental follicle gives rise to all EXCEPT:",opts:["Periodontal ligament","Alveolar bone proper","Cementum","Enamel"],correct:3,explain:"Enamel is ectodermal and produced by ameloblasts of enamel organ, not the follicle."},
  {q:"Which is characteristic of the bud stage?",opts:["Clear cellular differentiation into IEE/OEE","Cap-shaped enamel organ","Simple rounded epithelial proliferation into ectomesenchyme","Presence of enamel knot"],correct:2,explain:"Bud stage shows a rounded epithelial bud with little histodifferentiation."},
  {q:"During the cap stage the mesenchyme under the enamel organ is called:",opts:["Dental papilla","Dental lamina","Dental follicle","Stellate reticulum"],correct:0,explain:"The condensed ectomesenchyme under the cap is the dental papilla."},
  {q:"Initiation of the dental lamina occurs around which week in utero for primary teeth?",opts:["2â€“3 weeks","6â€“7 weeks","14â€“16 weeks","Birth"],correct:1,explain:"Primary dental lamina appears around the 6thâ€“7th week in utero (approximate)."},
  {q:"Which tissue forms the PDL?",opts:["Dental follicle fibroblasts","HERS","Enamel organ","Dental papilla"],correct:0,explain:"Fibroblasts from the dental follicle elaborate Sharpey's fibers of the periodontal ligament."},
  {q:"Fragmentation of HERS creates:",opts:["Epithelial cell rests of Malassez","Reduced enamel epithelium","Secondary enamel knot","Nasmyth's membrane"],correct:0,explain:"HERS disintegrates into epithelial rests of Malassez within the PDL."},
  {q:"Nasmyth's membrane refers to:",opts:["Cuticle on enamel from reduced enamel epithelium","First layer of enamel","A neonatal line in enamel","A cementum hyperplasia"],correct:0,explain:"The primary enamel cuticle (Nasmyth's membrane) covers newly erupted enamel."},
  {q:"Which pair is CORRECT?",opts:["OEE â€“ columnar cells next to papilla","IEE â€“ cuboidal cells externally","Stellate reticulum â€“ star-shaped cells in enamel organ","Stratum intermedium â€“ vascular connective tissue"],correct:2,explain:"Stellate reticulum consists of star-shaped cells forming a loose network."},
  {q:"Permanent molars are called accessional because:",opts:["They replace primary molars","They develop later and posterior to primary dentition","They migrate from successional lamina","They are supernumerary"],correct:1,explain:"Molars do not replace any primary teeth; they arise as posterior extensions of the dental lamina."},
  {q:"The enamel organ layer directly adjacent to the dental papilla is:",opts:["Outer enamel epithelium","Inner enamel epithelium","Stratum intermedium","Stellate reticulum"],correct:1,explain:"IEE lies internal to the enamel organ and faces the dental papilla."},
  {q:"Crown shape is primarily determined during:",opts:["Bud stage","Cap to early bell stages","Advanced bell stage only","Eruption"],correct:1,explain:"Morphodifferentiation of cusp pattern occurs mainly in cap to early bell via enamel knots and folding of IEE."},
  {q:"Which event marks the transition to advanced bell stage?",opts:["Initial epithelial ingrowth","Apposition of hard tissues starts","Breakdown of dental lamina","Root formation begins"],correct:1,explain:"In advanced bell, cells are fully differentiated and enamel/dentin apposition proceeds."},
  {q:"Which best describes successional lamina?",opts:["A posterior extension that forms molars","A lingual epithelial band off the dental lamina of primary tooth germs that gives rise to permanent successors","Epithelial rests in PDL","Vestibular lamina forming the vestibule"],correct:1,explain:"Successional lamina buds lingual to primary incisors, canines, and molars to form their permanent successors."},
  {q:"Which statement about vestibular lamina is TRUE?",opts:["It forms the oral vestibule by cavitation","It forms the dental papilla","It becomes HERS","It differentiates into ameloblasts"],correct:0,explain:"The vestibular lamina hollows by cell death to create the oral vestibule."}
];

const tfs = [
  {q:"In the bud stage, there is little to no histodifferentiation.",answer:true,explain:"Cells are a rounded epithelial mass with minimal differentiation."},
  {q:"The enamel organ is mesenchymal in origin.",answer:false,explain:"It is ectodermal epithelium; mesenchyme forms papilla/follicle."},
  {q:"Dentin formation precedes enamel formation during crown development.",answer:true,explain:"Predentin is laid first, inducing ameloblast secretion."},
  {q:"HERS determines the number and shape of tooth cusps.",answer:false,explain:"Cusps are patterned earlier by enamel knots; HERS guides root shape."},
  {q:"Cementum is produced by cells derived from the dental follicle.",answer:true,explain:"Cementoblasts differentiate from follicle (sac)."},
  {q:"Stratum intermedium assists ameloblasts during enamel maturation.",answer:true,explain:"It supports enamel protein processing and mineralization."},
  {q:"All permanent teeth arise from successional lamina.",answer:false,explain:"Molars are accessional via posterior dental lamina extension."},
  {q:"Reduced enamel epithelium covers the crown before eruption.",answer:true,explain:"It protects enamel until eruption and contributes to junctional epithelium."},
  {q:"The DEJ is established where first enamel meets first-formed dentin.",answer:true,explain:"This interface is laid at the onset of apposition."},
  {q:"The dental lamina fragments and disappears after crown completion.",answer:true,explain:"It disintegrates leaving epithelial pearls/islands in places."},
  {q:"Epithelial rests of Malassez are remnants of HERS within the PDL.",answer:true,explain:"They persist after root formation."},
  {q:"The vestibular lamina gives rise to the successional teeth.",answer:false,explain:"It forms the oral vestibule; successional teeth arise from successional lamina."}
];

const saqs = [
  { q: "List the four classic histologic stages of tooth development and a key feature of each.", a: "Bud (rounded epithelial ingrowth, little differentiation); Cap (enamel organ forms over dental papilla, early morphodifferentiation); Early Bell (IEE/OEE, stellate reticulum, stratum intermedium appear; enamel knot signaling); Advanced Bell (cells fully differentiated; apposition of dentin then enamel begins)." },
  { q: "Differentiate successional vs. accessional teeth and state the epithelial source for each.", a: "Successional teeth replace primary teeth and arise from a localized lingual proliferation of the dental (successional) lamina of each primary tooth germ. Accessional teeth (permanent molars) do not replace primaries; they develop from posterior extension of the dental lamina." },
  { q: "Outline the sequence of events at the DEJ during early crown formation.", a: "Odontoblasts (from dental papilla) first secrete predentin; this induces IEE cells to differentiate into ameloblasts which secrete first enamel; the interface where first enamel meets first-formed dentin becomes the DEJ." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "âœ“ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
