<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position:sticky;top:0;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);} 
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 8 (by ACE)</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data filled from lecture 8.pdf -----------
const mcqs = [
  { q:"Morphological stages of tooth development include all EXCEPT:", opts:["Dental lamina","Bud stage","Initiation","Cap stage"], correct:2, explain:"Initiation is a physiological (histophysiological) stage, not a morphological stage." },
  { q:"Which stage immediately precedes the Bell stage?", opts:["Bud stage","Cap stage","Dental lamina","Apposition"], correct:1, explain:"Cap stage is followed by early bell stage as the enamel organ assumes a bell shape." },
  { q:"Histophysiological stages include all of the following EXCEPT:", opts:["Initiation","Proliferation","Apposition","Dental lamina"], correct:3, explain:"Dental lamina is a morphological stage, whereas initiation, proliferation, histodifferentiation, morphodifferentiation, and apposition are physiological." },
  { q:"Morphodifferentiation chiefly determines:", opts:["Tooth color","Shape and size of the tooth","Enamel mineral content","Root number only"], correct:1, explain:"Morphodifferentiation determines the shape and size of teeth during bell stage." },
  { q:"The bell shape of the enamel organ results from:", opts:["Decrease in enamel organ size","Differential growth with histo- and morphodifferentiation","Root formation","Apposition of enamel"], correct:1, explain:"During bell stage, differential growth with histo- and morphodifferentiation enlarges and shapes the enamel organ into a bell." },
  { q:"Early bell stage is defined as:", opts:["After hard tissue formation begins","Before any hard tissue formation","During root formation","After eruption"], correct:1, explain:"Early bell stage occurs before any mineralized tissue is formed; advanced bell starts with the first mineralized layer." },
  { q:"Which of the following layers is NOT part of the early bell stage?", opts:["Outer enamel epithelium","Inner enamel epithelium","Reduced enamel epithelium","Stellate reticulum"], correct:2, explain:"Reduced enamel epithelium forms later after enamel completion; early bell has OEE, IEE, stellate reticulum, and stratum intermedium." },
  { q:"Inner enamel epithelium cells in early bell stage are also called:", opts:["Preameloblasts","Odontoblasts","Ameloblasts","Stratum intermedium"], correct:0, explain:"IEE cells become tall columnar preameloblasts before differentiating to ameloblasts." },
  { q:"Stratum intermedium is located between:", opts:["OEE and dental sac","IEE and stellate reticulum","OEE and IEE","Dental papilla and OEE"], correct:1, explain:"It lies between inner enamel epithelium and stellate reticulum and functions with IEE in enamel formation." },
  { q:"A key enzyme abundant in stratum intermedium:", opts:["Alkaline phosphatase","Acid phosphatase","Amylase","Peroxidase"], correct:0, explain:"Stratum intermedium cells are rich in alkaline phosphatase essential for enamel mineralization." },
  { q:"Primary role of stratum intermedium includes:", opts:["Formation of dentin","Control of fluid diffusion to ameloblasts","Formation of cementum","Formation of dental sac"], correct:1, explain:"They control fluid diffusion into and out of ameloblasts and act as a functional unit in enamel formation." },
  { q:"Stellate reticulum expands mainly by:", opts:["Cell division only","Increase in intercellular fluid","Deposition of enamel","Formation of dentin"], correct:1, explain:"Its expansion is due largely to increased intercellular fluid; cells are linked by desmosomes." },
  { q:"Immediately before enamel formation, stellate reticulum:", opts:["Proliferates extensively","Collapses to reduce distance to capillaries","Becomes cementoblasts","Forms odontoblasts"], correct:1, explain:"It collapses, bringing ameloblasts closer to the capillary-rich OEE side for nutrition." },
  { q:"Outer enamel epithelium at end of bell stage shows:", opts:["Smooth surface","Formation of folds","Enamel secretion","Cementum deposition"], correct:1, explain:"OEE surface develops folds; dental sac mesenchyme forms papillae with capillary loops between folds." },
  { q:"Capillary loops within papillae adjacent to OEE primarily:", opts:["Provide vascular supply to avascular enamel organ","Form dentin","Form cementum","Form periodontal ligament"], correct:0, explain:"Papillae contain capillary loops providing nutrition for the metabolically active but avascular enamel organ." },
  { q:"Loss of nutritional supply from dental papilla due to dentin formation is compensated by:", opts:["Reduced enamel epithelium","OEE folds with capillary papillae","Stratum intermedium","Stellate reticulum expansion"], correct:1, explain:"As dentin mineralizes, OEE folding and vascular papillae compensate for reduced papillar supply." },
  { q:"Dental papilla peripheral cells differentiate into odontoblasts under the influence of:", opts:["Hertwig's epithelial root sheath","Inner enamel epithelium","Outer enamel epithelium","Dental sac"], correct:1, explain:"Before enamel formation, IEE organizes peripheral papilla cells to become odontoblasts." },
  { q:"Sequence of odontoblast differentiation is:", opts:["Columnar → cuboidal","Squamous → cuboidal","Cuboidal → columnar","Stellate → columnar"], correct:2, explain:"Papilla cells first become cuboidal, then columnar odontoblasts with dentin-forming potential." },
  { q:"The basement membrane between enamel organ and dental papilla just before dentin forms is called:", opts:["Reduced enamel epithelium","Membrana preformativa","Nasmyth's membrane","Dentinoid"], correct:1, explain:"Membrana preformativa separates IEE and dental papilla prior to dentin formation." },
  { q:"Future of membrana preformativa:", opts:["Cemento-enamel junction","Dentino-enamel junction","Apical foramen","Periodontal ligament"], correct:1, explain:"It becomes the dentino-enamel junction (DEJ)." },
  { q:"Cervical loop consists of:", opts:["All four enamel organ layers","Only OEE and IEE","IEE and stratum intermedium","OEE and stellate reticulum"], correct:1, explain:"Cervical loop is where OEE and IEE meet; its cells give rise to Hertwig's epithelial root sheath." },
  { q:"Hertwig's epithelial root sheath is derived from:", opts:["Dental papilla","Dental sac","Cervical loop epithelium","Reduced enamel epithelium"], correct:2, explain:"Cells in the cervical loop in advanced bell stage form HERS." },
  { q:"A failure of initiation may lead to:", opts:["Enamel hypocalcification","Anodontia","Dilaceration","Hypercementosis"], correct:1, explain:"Lack or abnormal initiation can cause anodontia; excessive initiation may cause supernumerary teeth." },
  { q:"Excess initiation may result in:", opts:["Microdontia","Supernumerary teeth","Taurodontism","Hypoplasia"], correct:1, explain:"Supernumerary teeth are linked to abnormal/excess initiation." },
  { q:"A defect in morphodifferentiation most directly affects:", opts:["Tooth color only","Tooth shape and size","Enamel mineralization only","Root apex closure"], correct:1, explain:"Morphodifferentiation determines shape and size; its defects alter morphology." },
  { q:"Defect in apposition may clinically present as:", opts:["Hypocalcified teeth","Ankylosis","Concrescence","Accessory roots"], correct:0, explain:"Hypocalcified teeth reflect issues in apposition/mineralization." },
  { q:"During advanced bell stage, hard tissue formation begins with:", opts:["Cementum first","Dentin first then enamel","Enamel first then dentin","PDL fibers"], correct:1, explain:"The stage begins with the first mineralized tissue; odontoblasts lay mantle dentin, then ameloblasts form enamel." },
  { q:"Which layer flattens to low cuboidal form toward the end of bell stage?", opts:["Inner enamel epithelium","Outer enamel epithelium","Stratum intermedium","Stellate reticulum"], correct:1, explain:"OEE cells become low cuboidal; its surface also forms folds." },
  { q:"The enamel organ is:", opts:["Highly vascular","Avascular","Part of dental papilla","Derived from mesenchyme"], correct:1, explain:"Enamel organ is epithelial and avascular; hence reliance on surrounding capillaries." },
  { q:"Root formation begins at:", opts:["Cervical loop","Cuspal tip","Apical papilla","Dental lamina"], correct:0, explain:"Root development is initiated at the cervical loop via HERS." }
];

const tfs = [
  { q:"Early bell stage occurs after any hard tissue has formed.", answer:false, explain:"Early bell stage is before any mineralized tissue forms; advanced bell starts with first mineralized layer." },
  { q:"Stratum intermedium and IEE act as a single functional unit in enamel formation.", answer:true, explain:"They cooperate in enamel formation and mineralization." },
  { q:"Stellate reticulum collapses just before enamel formation.", answer:true, explain:"Collapse reduces distance between ameloblasts and capillaries near OEE." },
  { q:"Outer enamel epithelium becomes tall columnar at the end of bell stage.", answer:false, explain:"OEE flattens to a low cuboidal form and develops folds." },
  { q:"Dental papilla gives rise to dentin and dental pulp.", answer:true, explain:"Papilla odontoblasts produce dentin; central cells form the pulp." },
  { q:"Membrana preformativa later forms the cementoenamel junction.", answer:false, explain:"It becomes the dentino-enamel junction (DEJ)." },
  { q:"Cervical loop is composed of only OEE and IEE.", answer:true, explain:"It is the rim where OEE and IEE meet; source of HERS." },
  { q:"Enamel organ is avascular.", answer:true, explain:"Hence the need for nutritional support from adjacent capillaries." },
  { q:"A defect in initiation can cause supernumerary teeth.", answer:true, explain:"Abnormal initiation may produce extra tooth buds." },
  { q:"Morphodifferentiation affects tooth shape and size.", answer:true, explain:"That is its defining role during bell stage." },
  { q:"Hypocalcified teeth result from defects in morphodifferentiation.", answer:false, explain:"They result from defects in apposition/mineralization rather than morphologic patterning." },
  { q:"In odontoblast differentiation, cells go from columnar to cuboidal.", answer:false, explain:"They go from cuboidal to columnar before producing dentin." }
];

const saqs = [
  { q: "List the four cellular layers present in the early bell stage and give one function for any one of them.", a: "Layers: Outer enamel epithelium (OEE), Inner enamel epithelium (IEE/preameloblasts), Stellate reticulum, Stratum intermedium. Example function: Stratum intermedium (2–3 squamous layers) is rich in alkaline phosphatase and acts with IEE to support enamel formation and mineralization; it also regulates fluid diffusion to ameloblasts." },
  { q: "Describe the sequence of events at the IEE–dental papilla interface leading to the first mineralized tissue.", a: "IEE induces peripheral dental papilla cells to differentiate: they become cuboidal then columnar odontoblasts, which lay down mantle dentin; the intervening basement membrane (membrana preformativa) later becomes the DEJ; subsequent to dentin deposition, ameloblasts begin secreting enamel." },
  { q: "Define the cervical loop and state its significance.", a: "The cervical loop is the region where OEE and IEE meet at the rim of the enamel organ. Its epithelial cells give rise to Hertwig’s epithelial root sheath (HERS), initiating root formation." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
