<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam â€¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position:sticky;top:0;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);} 
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ğŸ¦· Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 10 (by ACE)</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù„Ø§ Ø³ÙÙ‡Ù’Ù„Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù…ÙØ§ Ø¬ÙØ¹ÙÙ„Ù’ØªÙÙ‡Ù Ø³ÙÙ‡Ù’Ù„Ù‹Ø§ØŒ ÙˆÙØ£ÙÙ†Ù’ØªÙ ØªÙØ¬Ù’Ø¹ÙÙ„Ù Ø§Ù„Ø­ÙØ²Ù’Ù†Ù Ø¥ÙØ°ÙØ§ Ø´ÙØ¦Ù’ØªÙ Ø³ÙÙ‡Ù’Ù„Ù‹Ø§</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled from lecture topic) -----------
const mcqs = [
  { q:"The dental lamina gives rise to primary tooth germs as localized proliferations. What are these called?", opts:["Accessional teeth","Successional teeth","Supernumerary buds","Enamel knots"], correct:1, explain:"Successional teeth originate as localized proliferations from the dental lamina of each primary tooth germ." },
  { q:"Accessional teeth (permanent molars) arise as:", opts:["Anterior extension of vestibular lamina","Posterior extension of dental lamina","Division of enamel organ","Migration of HERS"], correct:1, explain:"Permanent molars develop from a posterior extension of the dental lamina." },
  { q:"Correct chronological order of histologic stages is:", opts:["Bud â†’ Bell â†’ Cap â†’ Apposition","Cap â†’ Bud â†’ Early Bell â†’ Advanced Bell","Bud â†’ Cap â†’ Early Bell â†’ Advanced Bell","Early Bell â†’ Bud â†’ Cap â†’ Advanced Bell"], correct:2, explain:"Standard progression: bud, cap, early bell, advanced bell." },
  { q:"Which component first appears as a rounded epithelial invagination into ectomesenchyme?", opts:["Bud stage enamel organ","Dental papilla","Dental follicle","Reduced enamel epithelium"], correct:0, explain:"The bud is an epithelial proliferation from the dental lamina." },
  { q:"The cap stage is characterized by formation of:", opts:["Hertwig's epithelial root sheath","Enamel knot and concave enamel organ","Cervical loop elongation","Reduced enamel epithelium"], correct:1, explain:"Cap stage shows a concave enamel organ with a primary enamel knot signaling center." },
  { q:"Which tissues constitute the tooth germ?", opts:["Enamel organ only","Dental papilla only","Enamel organ, dental papilla, dental follicle","Dental follicle and HERS"], correct:2, explain:"The classic triad forms the tooth germ in cap stage." },
  { q:"Inner enamel epithelium differentiates into:", opts:["Ameloblasts","Odontoblasts","Cementoblasts","Fibroblasts"], correct:0, explain:"IEE cells elongate and become ameloblasts to secrete enamel." },
  { q:"Odontoblasts are derived from:", opts:["Inner enamel epithelium","Outer enamel epithelium","Stratum intermedium","Dental papilla ectomesenchyme"], correct:3, explain:"Odontoblasts differentiate from peripheral dental papilla." },
  { q:"The sequence at the cusp tip is:", opts:["Amelogenesis precedes dentinogenesis","Dentinogenesis precedes amelogenesis","Cementogenesis precedes both","They start simultaneously with cementum"], correct:1, explain:"Predentin formation by odontoblasts induces ameloblasts to secrete enamel." },
  { q:"Which layer provides supportive metabolism for ameloblasts during bell stage?", opts:["Stratum intermedium","Outer enamel epithelium","Stellate reticulum","Reduced enamel epithelium"], correct:0, explain:"Stratum intermedium aids mineral transport and enamel maturation." },
  { q:"The stellate reticulum is best described as:", opts:["A layer of columnar cells producing dentin","A star-shaped cell network within enamel organ","A continuation of HERS","A connective tissue capsule"], correct:1, explain:"SR is a hydrated, star-shaped cell network that maintains enamel organ shape." },
  { q:"The cervical loop is the junction of:", opts:["IEE and OEE","IEE and stratum intermedium","OEE and stellate reticulum","Ameloblasts and odontoblasts"], correct:0, explain:"Cervical loop is where IEE meets OEE; later gives rise to HERS." },
  { q:"Hertwig's epithelial root sheath (HERS) is formed by:", opts:["IEE + OEE at the cervical loop","OEE only","SR + SI","Reduced enamel epithelium"], correct:0, explain:"HERS is a bilayer from the cervical loop that guides root formation." },
  { q:"Breakdown of HERS permits contact of dental papilla with dental follicle to form:", opts:["Enamel","Cementum","Dentin","Pulp"], correct:1, explain:"Disintegration of HERS allows ectomesenchyme to differentiate into cementoblasts forming cementum." },
  { q:"Which structure becomes the dentinoenamel junction (DEJ)?", opts:["Basement membrane between IEE and dental papilla","Basal lamina of OEE","HERS","Gubernacular canal"], correct:0, explain:"The early basement membrane location becomes the DEJ after apposition." },
  { q:"Reduced enamel epithelium (REE) forms from:", opts:["OEE alone","Ameloblasts + remnants of enamel organ after enamel completion","Stellate reticulum only","HERS"], correct:1, explain:"REE covers enamel and participates in eruption/attachment." },
  { q:"The gubernacular canal is associated with:", opts:["Eruption pathway of successional teeth","Root bifurcation","Formation of enamel rods","Fusion of dental lamina"], correct:0, explain:"It contains the gubernacular cord guiding eruption of successional teeth." },
  { q:"Primary enamel knot functions primarily as:", opts:["A mechanical spacer","A signaling center controlling cusp patterning","A nutrient channel","A resorptive organ"], correct:1, explain:"The enamel knot expresses signaling molecules guiding cusp morphogenesis." },
  { q:"Which is NOT part of the enamel organ in bell stage:", opts:["Inner enamel epithelium","Outer enamel epithelium","Dental papilla","Stratum intermedium"], correct:2, explain:"Dental papilla is mesenchyme; enamel organ is epithelial (IEE, OEE, SR, SI)." },
  { q:"Which event marks transition from early to advanced bell stage?", opts:["Cap formation","Histodifferentiation and morphodifferentiation completion","HERS formation","Eruption"], correct:1, explain:"Advanced bell shows hard tissue apposition after cell differentiation and crown shape determination." },
  { q:"Which is true about successional lamina?", opts:["Gives rise to permanent molars","Extends lingual to primary teeth to form successors","Derived from vestibular lamina","Part of HERS"], correct:1, explain:"Successional lamina forms lingual to primary teeth for incisors, canines, premolars." },
  { q:"Accessional teeth include:", opts:["Permanent incisors","Permanent canines","Permanent molars","Primary molars"], correct:2, explain:"Permanent molars have no primary predecessors (accessional)." },
  { q:"The dental follicle (sac) gives rise to all EXCEPT:", opts:["Cementum","Periodontal ligament","Alveolar bone proper","Enamel"], correct:3, explain:"Enamel is epithelial, produced by ameloblasts; follicle forms PDL, cementum, alveolar bone." },
  { q:"During apposition, the first mineralized tissue laid down is typically:", opts:["Enamel","Mantle dentin","Cementum","Secondary dentin"], correct:1, explain:"Odontoblasts lay mantle dentin first, then enamel deposition follows." },
  { q:"Which best describes the vestibular lamina?", opts:["A groove-forming epithelial band for oral vestibule","Future site of DEJ","Root sheath for molars","Epithelial rests of Malassez"], correct:0, explain:"Vestibular lamina splits to form the oral vestibule, distinct from dental lamina." },
  { q:"Epithelial rests of Malassez are remnants of:", opts:["Dental lamina","HERS","Stellate reticulum","Successional lamina"], correct:1, explain:"ERM in PDL are HERS remnants." },
  { q:"Which layer disappears as enamel matures toward eruption?", opts:["Stratum intermedium and stellate reticulum","OEE","IEE","Dental follicle"], correct:0, explain:"SR collapses and SI diminishes as REE forms." },
  { q:"Cervical loop proliferation apically mainly contributes to:", opts:["Cusp patterning","Root lengthening","Enamel rod orientation","Eruption pathway"], correct:1, explain:"Apical growth creates HERS guiding root length and shape." },
  { q:"Which reading is recommended for detailed tooth development per the lecture?", opts:["Guyton Physiology pp. 100-120","Ten Cate's Oral Histology pp. 70â€“94","Wheeler's Dental Anatomy ch. 2","Netter Atlas plates 1â€“10"], correct:1, explain:"Essential reading highlighted: Ten Cate pp. 70â€“94 and James K. Avery pp. 63â€“80." },
  { q:"According to the session outcomes, students should be able to:", opts:["Memorize eruption ages only","Illustrate and examine bud, cap, early bell, advanced bell stages","Perform clinical restorations","Describe cranial nerve nuclei"], correct:1, explain:"CLO/SLO emphasize illustrating and examining histologic stages of tooth development." }
];

const tfs = [
  { q:"In the cap stage, the tooth germ consists of enamel organ, dental papilla, and dental follicle.", answer:true, explain:"These three components define the tooth germ." },
  { q:"Ameloblasts derive from dental papilla.", answer:false, explain:"Ameloblasts derive from inner enamel epithelium; odontoblasts from papilla." },
  { q:"HERS is responsible for crown morphogenesis.", answer:false, explain:"Crown shape is set earlier; HERS guides root formation." },
  { q:"The DEJ corresponds to the site of the original basement membrane between IEE and papilla.", answer:true, explain:"That interface becomes the DEJ after apposition." },
  { q:"Permanent molars are successional teeth.", answer:false, explain:"They are accessional teeth forming from a posterior dental lamina extension." },
  { q:"The enamel knot acts as a transient signaling center for cusp patterning.", answer:true, explain:"It regulates morphogenesis during cap/bell stages." },
  { q:"The dental follicle contributes to PDL, cementum, and alveolar bone.", answer:true, explain:"Collectively termed the periodontium." },
  { q:"Dentinogenesis begins after amelogenesis starts.", answer:false, explain:"Dentin forms first; enamel follows." },
  { q:"Reduced enamel epithelium participates in eruption and forms the junctional epithelium after eruption.", answer:true, explain:"REE fuses with oral epithelium and contributes to JE." },
  { q:"Epithelial rests of Malassez are remnants of the dental lamina.", answer:false, explain:"They are remnants of HERS within the PDL." },
  { q:"Successional lamina forms lingual to primary teeth to produce incisors, canines, and premolars.", answer:true, explain:"These are successors of primary teeth." },
  { q:"Stellate reticulum is a mesenchymal structure.", answer:false, explain:"It is epithelial and lies within the enamel organ." }
];

const saqs = [
  { q: "Outline the key histologic differences between bud, cap, early bell, and advanced bell stages.", a: "Bud: epithelial knob invading ectomesenchyme. Cap: concave enamel organ with enamel knot; tooth germ visible (enamel organ, papilla, follicle). Early bell: IEE, OEE, stellate reticulum, stratum intermedium; histo- and morphodifferentiation. Advanced bell: onset of appositionâ€”predentin then enamel; DEJ established." },
  { q: "Differentiate successional from accessional teeth and specify their lamina origins.", a: "Successional teeth (incisors, canines, premolars) arise from successional lamina lingual to primary teeth via localized dental lamina proliferation. Accessional teeth (permanent molars) arise from a posterior extension of the dental lamina." },
  { q: "Describe the role of the cervical loop and HERS in root formation.", a: "Cervical loop (junction of IEE and OEE) proliferates apically to form HERS, a bilayer that molds root shape and induces root dentin. Disintegration of HERS allows dental follicle cells to contact dentin and differentiate into cementoblasts." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "âœ“ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
