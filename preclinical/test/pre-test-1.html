<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);} 
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 1</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled from Lecture 1: Terminology of Dental Caries & Tooth Preparation) -----------
const mcqs = [
  {
    q: "Dental caries is best defined as which of the following?",
    opts: [
      "A noninfectious chemical erosion of enamel only",
      "An infectious microbial disease of calcified tissues causing demineralization and organic matrix destruction",
      "A congenital malformation of enamel prisms",
      "A purely dietary demineralization without bacteria"
    ],
    correct: 1,
    explain: "Caries is an infectious microbial disease of the tooth's calcified tissues leading to inorganic demineralization and organic destruction."
  },
  {
    q: "Primary caries refers to:",
    opts: [
      "Caries occurring adjacent to an existing restoration",
      "The initial carious lesion on a previously unaffected surface",
      "Recurrent caries detected radiographically only",
      "Caries limited to cementum"
    ],
    correct: 1,
    explain: "Primary caries is the original (first) lesion on a tooth surface."
  },
  {
    q: "Which morphologic type of primary caries begins in developmental defects?",
    opts: [
      "Root surface caries",
      "Smooth surface caries",
      "Pit and fissure caries",
      "Secondary caries"
    ],
    correct: 2,
    explain: "Pit and fissure caries initiate in pits/fissures formed by imperfect coalescence of enamel lobes."
  },
  {
    q: "As pit and fissure caries progress and reach the DEJ, the lesion typically:",
    opts: [
      "Halts due to increased enamel hardness",
      "Spreads laterally along the DEJ and into dentin",
      "Remains confined to the enamel",
      "Reverses with saliva alone"
    ],
    correct: 1,
    explain: "At the DEJ, caries often spread laterally due to the structural junction and then advance in dentin."
  },
  {
    q: "Smooth surface caries MOST often begin on:",
    opts: [
      "Areas habitually clean with no plaque",
      "Areas habitually covered by plaque on otherwise intact enamel",
      "Only interproximal contact points",
      "Only the incisal edge of anterior teeth"
    ],
    correct: 1,
    explain: "They begin in smooth enamel areas that are habitually unclean and plaque covered."
  },
  {
    q: "Root surface caries are common in older adults primarily because:",
    opts: [
      "Fluoride exposure is higher",
      "Cementum is thick and resistant",
      "Gingival recession exposes thin cementum susceptible to demineralization",
      "Salivary flow always increases with age"
    ],
    correct: 2,
    explain: "Recession exposes thin cementum, which demineralizes faster than enamel."
  },
  {
    q: "Secondary (recurrent) caries MOST commonly indicates:",
    opts: [
      "Excellent marginal integrity",
      "Microleakage and conditions conducive to caries at restoration margins",
      "A traumatic occlusion only",
      "Over-fluoridation"
    ],
    correct: 1,
    explain: "Secondary caries occurs at restoration-tooth junctions and often reflects microleakage."
  },
  {
    q: "Incipient smooth-surface enamel caries typically appear how when air dried?",
    opts: [
      "Translucent and glossy",
      "Opaque/chalky white but partially disappear when wetted",
      "Brown/black and hard",
      "As a cavitated hole"
    ],
    correct: 1,
    explain: "Incipient lesions are opaque when dry and may fade when wet; they can remineralize."
  },
  {
    q: "Cavitated caries usually requires which management?",
    opts: [
      "No treatment; remineralization alone",
      "Only dietary counseling",
      "Tooth preparation and restoration",
      "Systemic antibiotics"
    ],
    correct: 2,
    explain: "Once enamel is non-intact and dentin is involved, operative care is generally indicated."
  },
  {
    q: "Acute (rampant) caries typically presents as:",
    opts: [
      "Slow, dark, leathery lesions",
      "Rapidly progressing soft, light-colored lesions and high infectivity",
      "Hard black arrested lesions",
      "Only root lesions"
    ],
    correct: 1,
    explain: "Acute caries is fast, soft, light-colored and highly infectious."
  },
  {
    q: "An arrested enamel caries lesion is usually:",
    opts: [
      "Soft and yellow",
      "Hard and brown/black, often more resistant than adjacent enamel",
      "Radiolucent and chalky",
      "Covered by thick plaque"
    ],
    correct: 1,
    explain: "Arrested lesions become hard and dark due to remineralization and fluoride uptake."
  },
  {
    q: "Forward caries describes progression:",
    opts: [
      "From dentin to enamel and back",
      "From pit/fissure through enamel to DEJ and then dentin",
      "Only along the DEJ without enamel involvement",
      "From the root toward the crown without DEJ spread"
    ],
    correct: 1,
    explain: "Forward caries proceeds from enamel to DEJ and then into dentin."
  },
  {
    q: "Backward caries is characterized by:",
    opts: [
      "Early cementum undermining",
      "Lateral spread at the DEJ with extension back into overlying enamel",
      "Sclerotic dentin formation only",
      "Exclusive root surface involvement"
    ],
    correct: 1,
    explain: "After reaching DEJ, lesion spreads laterally and extends back toward enamel."
  },
  {
    q: "Residual caries is acceptable only when:",
    opts: [
      "Located on prepared enamel walls for seal",
      "Located as affected dentin near the pulp under specific circumstances",
      "At any margin to avoid pulp exposure",
      "Never acceptable"
    ],
    correct: 1,
    explain: "Affected dentin near the pulp may be intentionally left; caries on enamel walls is unacceptable."
  },
  {
    q: "A simple tooth preparation involves:",
    opts: [
      "One surface",
      "Two surfaces",
      "Three or more surfaces",
      "The entire crown"
    ],
    correct: 0,
    explain: "Simple = one surface; compound = two; complex = three or more."
  },
  {
    q: "According to G.V. Black, Class II preparations are on:",
    opts: [
      "Occlusal pits and fissures of molars only",
      "Proximal surfaces of posterior teeth",
      "Proximal surfaces of anterior teeth without incisal angle",
      "Gingival third of all teeth"
    ],
    correct: 1,
    explain: "Class II = proximal surfaces of premolars and molars."
  },
  {
    q: "Class I lesions include which of the following sites?",
    opts: [
      "Lingual pits of maxillary incisors",
      "Proximal surfaces of canines",
      "Gingival third of premolars",
      "Incisal edges of mandibular incisors"
    ],
    correct: 0,
    explain: "All pit & fissures are Class I, including lingual pits of maxillary incisors."
  },
  {
    q: "Class III vs. Class IV distinction is based on involvement of:",
    opts: [
      "Cavosurface angle",
      "Incisal angle",
      "Pulpal floor",
      "Cuspal height"
    ],
    correct: 1,
    explain: "Class III does not involve the incisal angle; Class IV does."
  },
  {
    q: "Class V preparations are located on:",
    opts: [
      "Occlusal surfaces of molars",
      "Gingival third of facial or lingual surfaces of all teeth",
      "Proximal surfaces of anterior teeth",
      "Cusp tips of premolars"
    ],
    correct: 1,
    explain: "Class V = cervical (gingival) third on facial/lingual of any tooth."
  },
  {
    q: "Class VI lesions as later additions involve:",
    opts: [
      "Root furcations",
      "Incisal edges of anterior teeth or occlusal cusp tips of posterior teeth",
      "Only smooth surfaces",
      "Only pits and fissures"
    ],
    correct: 1,
    explain: "Class VI involves incisal edges and cusp tips."
  },
  {
    q: "An internal wall that is perpendicular to the long axis of the tooth is the:",
    opts: [
      "Axial wall",
      "Cavosurface angle",
      "Pulpal wall (floor)",
      "Line angle"
    ],
    correct: 2,
    explain: "Pulpal wall is internal and perpendicular to tooth's long axis."
  },
  {
    q: "Which is an internal wall parallel to the long axis of the tooth?",
    opts: [
      "Axial wall",
      "Gingival floor",
      "Cavosurface",
      "Point angle"
    ],
    correct: 0,
    explain: "Axial wall is internal and parallel to the long axis."
  },
  {
    q: "The cavosurface angle is formed by the junction of:",
    opts: [
      "Two internal walls",
      "A prepared wall and the external tooth surface",
      "Two enamel rods",
      "Two restoration surfaces"
    ],
    correct: 1,
    explain: "It's the angle between a prepared wall and the external tooth surface."
  },
  {
    q: "A line angle is defined as the junction of:",
    opts: [
      "Two planar surfaces of different orientation",
      "Three planar surfaces of different orientation",
      "Two curved surfaces only",
      "Two enamel prisms"
    ],
    correct: 0,
    explain: "Line angle = junction of two planes; point angle = three."
  },
  {
    q: "How many line angles exist in a typical Class I cavity as listed in the lecture?",
    opts: [
      "4",
      "6",
      "8",
      "10"
    ],
    correct: 2,
    explain: "Eight line angles were enumerated for Class I cavities."
  },
  {
    q: "Which of the following is NOT a named line angle in a Class I cavity?",
    opts: [
      "Disto-lingual",
      "Mesio-buccal",
      "Linguo-gingival",
      "Bucco-pulpal"
    ],
    correct: 2,
    explain: "The list includes bucco-pulpal, disto-buccal, disto-pulpal, disto-lingual, linguo-pulpal, mesio-lingual, mesio-pulpal, mesio-buccal‚Äîno 'linguo-gingival'."
  },
  {
    q: "Point angles in a Class I cavity are how many as per the lecture?",
    opts: [
      "Two",
      "Three",
      "Four",
      "Five"
    ],
    correct: 2,
    explain: "Four point angles were listed for Class I cavities."
  },
  {
    q: "Which combination correctly lists the five walls of a typical Class I preparation given?",
    opts: [
      "Mesial, distal, buccal/facial, lingual, pulpal",
      "Mesial, distal, gingival, axial, pulpal",
      "Buccal, lingual, axial, gingival, pulpal",
      "Occlusal, gingival, axial, buccal, lingual"
    ],
    correct: 0,
    explain: "The lecture enumerated mesial, distal, facial, lingual, and pulpal walls."
  },
  {
    q: "Which site is characteristic for Class I but NOT Class II lesions?",
    opts: [
      "Occlusal pits and fissures",
      "Proximal boxes of molars",
      "Gingival third of lingual surfaces",
      "Incisal edge of anterior teeth"
    ],
    correct: 0,
    explain: "Class I are pits/fissures; Class II are proximal posterior surfaces."
  },
  {
    q: "Which statement about smooth surface caries is TRUE?",
    opts: [
      "Begins at incisal edges due to attrition",
      "Initiates in habitually unclean plaque-retentive smooth enamel",
      "Occurs only on roots",
      "Cannot be remineralized"
    ],
    correct: 1,
    explain: "Smooth surface caries start in plaque-covered smooth areas and may remineralize if incipient."
  },
  {
    q: "Which BEST differentiates acute from chronic/arrested caries?",
    opts: [
      "Acute lesions are soft and light; chronic/arrested are hard and darker",
      "Acute lesions are dark and hard",
      "Chronic lesions always cavitate",
      "Acute lesions occur only in children"
    ],
    correct: 0,
    explain: "Texture and color differences reflect activity and mineral content."
  },
  {
    q: "Which site is specifically mentioned as Class I besides occlusal pits?",
    opts: [
      "Facial pits of molars",
      "Cervical caries of premolars",
      "Proximal surfaces of canines",
      "Root caries of incisors"
    ],
    correct: 0,
    explain: "Facial and lingual pits/fissures in molars are Class I."
  },
  {
    q: "Which statement about residual caries is CORRECT?",
    opts: [
      "Leaving infected enamel margins is acceptable if sealed",
      "Affected dentin may be left near the pulp; caries on prepared enamel walls is unacceptable",
      "Residual caries should be left wherever found to avoid exposure",
      "Residual caries is synonymous with secondary caries"
    ],
    correct: 1,
    explain: "Only affected dentin near pulp may be left; not on enamel walls."
  },
  {
    q: "Which G.V. Black class corresponds to lesions on cusp tips?",
    opts: [
      "Class IV",
      "Class V",
      "Class VI",
      "Class II"
    ],
    correct: 2,
    explain: "Cusp tips/ incisal edges are Class VI."
  },
  {
    q: "In a Class I preparation, which pairing correctly matches an angle type?",
    opts: [
      "Disto-linguo-pulpal = point angle",
      "Mesio-buccal = point angle",
      "Linguo-pulpal = point angle",
      "Mesio-lingual = point angle"
    ],
    correct: 0,
    explain: "Point angles are the junction of three planes, e.g., disto-linguo-pulpal."
  }
];

const tfs = [
  { q: "Incipient enamel caries can remineralize with fluoride and plaque control.", answer: true, explain: "Non-cavitated lesions may be reversible." },
  { q: "Secondary caries occurs on previously unaffected tooth surfaces away from restorations.", answer: false, explain: "It occurs at restoration margins." },
  { q: "Root surface caries progress slower than enamel caries due to thick cementum.", answer: false, explain: "Cementum is thin and less resistant, so progression is often faster." },
  { q: "Class III preparations involve the incisal angle.", answer: false, explain: "If the incisal angle is involved, it is Class IV." },
  { q: "Class V lesions are confined to the gingival third of facial or lingual surfaces.", answer: true, explain: "Definition of Class V." },
  { q: "The cavosurface angle is between two internal walls of a preparation.", answer: false, explain: "It is between a prepared wall and the external tooth surface." },
  { q: "An axial wall is parallel to the long axis of the tooth.", answer: true, explain: "By definition." },
  { q: "Arrested enamel caries are typically soft and chalky.", answer: false, explain: "Arrested lesions are hard and dark (brown/black)." },
  { q: "Forward caries moves from enamel to DEJ then dentin.", answer: true, explain: "That's the described pattern." },
  { q: "Class II preparations are on the proximal surfaces of anterior teeth.", answer: false, explain: "Class II are proximal posterior; anterior proximal are Class III/IV." },
  { q: "Eight line angles were listed for a Class I cavity in the lecture.", answer: true, explain: "Eight line angles and four point angles." },
  { q: "Residual caries on prepared enamel walls is acceptable if sealed.", answer: false, explain: "Unacceptable on enamel walls; only affected dentin near pulp may be left." }
];

const saqs = [
  { 
    q: "State the definition of dental caries in one sentence.", 
    a: "Infectious microbial disease of tooth calcified tissues causing inorganic demineralization and organic matrix destruction." 
  },
  { 
    q: "List three morphologic types of primary caries and provide one typical site for each.", 
    a: "1) Pit & fissure ‚Äî occlusal of molars. 2) Smooth surface ‚Äî plaque-retentive proximal/facial areas. 3) Root surface ‚Äî exposed root (recession)." 
  },
  { 
    q: "Compare Class III and Class IV preparations briefly.", 
    a: `<table style="width:100%;border-collapse:collapse"><thead><tr><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Item</th><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Class III</th><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Class IV</th></tr></thead><tbody>
      <tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Incisal angle</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Not involved</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Involved</td></tr>
      <tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Teeth</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Anterior</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Anterior</td></tr>
      <tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Location</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Proximal</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Proximal + incisal edge</td></tr>
    </tbody></table>` 
  }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
