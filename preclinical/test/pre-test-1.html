<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer ol, .answer ul { padding-left: 20px; }
  .answer table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  .answer th, .answer td { border: 1px solid var(--card-border); padding: 8px; text-align: left; }
  .answer th { background-color: rgba(255,255,255,0.05); }

  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 1</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
  {
    q: "According to the lecture, dental caries is defined as an infectious microbial disease characterized by demineralization of the inorganic portion and destruction of what?",
    opts: ["The organic portion of teeth", "The pulp tissue", "The gingival margin", "The periodontal ligament"],
    correct: 0,
    explain: "Dental caries involves the destruction of both the inorganic (demineralization) and organic portions of the calcified tissues of teeth."
  },
  {
    q: "Which of the following is NOT one of the primary classifications of caries based on its location?",
    opts: ["Primary caries", "Secondary caries", "Incipient caries", "Root caries"],
    correct: 2,
    explain: "Incipient caries is a classification based on the *extent* of the lesion, not its location. Primary, secondary, and root caries are location-based classifications."
  },
  {
    q: "A carious lesion that occurs at the junction of an existing restoration and the tooth is known as:",
    opts: ["Recurrent caries", "Primary caries", "Arrested caries", "Rampant caries"],
    correct: 0,
    explain: "Secondary caries, also termed recurrent caries, occurs at the margin of a restoration, often due to microleakage."
  },
  {
    q: "Which type of primary caries forms due to the imperfect coalescence of developmental enamel lobes?",
    opts: ["Pit and fissure caries", "Smooth surface caries", "Root surface caries", "Incipient caries"],
    correct: 0,
    explain: "Pit and fissure caries develop in the natural grooves and pits on tooth surfaces where enamel lobes did not perfectly fuse."
  },
  {
    q: "Root surface caries is typically more rapid than other forms because:",
    opts: ["The cementum is thin and offers little resistance", "Saliva does not reach the root surface", "It is always associated with rampant caries", "The root surface has more organic content than enamel"],
    correct: 0,
    explain: "The cementum covering the root is very thin and less mineralized than enamel, making it more susceptible to rapid demineralization."
  },
  {
    q: "An early carious lesion that appears as an opaque white spot when air-dried but seems to disappear when wetted is called:",
    opts: ["Incipient caries", "Cavitated caries", "Chronic caries", "Residual caries"],
    correct: 0,
    explain: "This describes the classic appearance of an incipient lesion, which is the first sign of caries and is potentially reversible."
  },
  {
    q: "A G.V. Black Class II preparation involves which surfaces?",
    opts: ["Proximal surfaces of posterior teeth", "Pit and fissures of any tooth", "Proximal surfaces of anterior teeth", "Gingival third of facial or lingual surfaces"],
    correct: 0,
    explain: "Class II specifically refers to preparations on the mesial or distal surfaces of premolars and molars."
  },
  {
    q: "A cavity preparation involving the proximal surface of an anterior tooth that also includes the incisal angle is classified as:",
    opts: ["Class IV", "Class II", "Class III", "Class V"],
    correct: 0,
    explain: "Class IV is a progression of a Class III lesion that undermines and includes the incisal angle."
  },
  {
    q: "In tooth preparation terminology, what is an axial wall?",
    opts: ["An internal wall parallel to the long axis of the tooth", "An internal wall perpendicular to the long axis of the tooth", "Any external wall of the preparation", "The junction of a prepared wall and the external surface"],
    correct: 0,
    explain: "The axial wall is an internal wall that runs parallel to the tooth's long axis, whereas the pulpal wall is perpendicular to it."
  },
  {
    q: "The junction of two planar surfaces of different orientation along a line within a cavity preparation is called a:",
    opts: ["Line angle", "Point angle", "Cavosurface margin", "Pulpal floor"],
    correct: 0,
    explain: "A line angle is formed by the meeting of two surfaces. A point angle is formed by the meeting of three surfaces."
  },
  {
    q: "According to Sturdevant's classification, a tooth preparation involving three surfaces (e.g., mesial-occlusal-distal) is termed:",
    opts: ["Complex", "Compound", "Simple", "Combined"],
    correct: 0,
    explain: "A simple preparation is one surface, a compound is two surfaces, and a complex preparation involves three or more surfaces."
  },
  {
    q: "G.V. Black's Class I classification applies to which of the following locations?",
    opts: ["Occlusal pits and fissures of molars", "Proximal surfaces of anterior teeth", "Incisal edges of canines", "Gingival third of all teeth"],
    correct: 0,
    explain: "Class I includes all pit and fissure lesions, most commonly on the occlusal surfaces of posterior teeth."
  },
  {
    q: "Which type of caries is characterized as being rapidly progressing, soft, and light-colored?",
    opts: ["Acute (Rampant) caries", "Chronic caries", "Arrested caries", "Secondary caries"],
    correct: 0,
    explain: "Acute or rampant caries describes a rapidly spreading disease process, often seen in individuals with high sugar intake or xerostomia."
  },
  {
    q: "An arrested enamel caries lesion often appears:",
    opts: ["Hard and dark brown or black", "Soft and opaque white", "Chalky and fragile", "Undetectable clinically"],
    correct: 0,
    explain: "Chronic or arrested lesions are typically hard and discolored (brown/black) due to mineral uptake and staining over a long period."
  },
  {
    q: "What is the term for caries that remains in a completed cavity preparation, either by accident or intention?",
    opts: ["Residual caries", "Backward caries", "Forward caries", "Secondary caries"],
    correct: 0,
    explain: "Residual caries is the term for carious tissue left behind after preparation. It may be intentional if it's affected dentin near the pulp."
  },
  {
    q: "A G.V. Black Class V lesion is found on the:",
    opts: ["Gingival third of the facial or lingual surface", "Occlusal cusp tips", "Proximal surface of a premolar", "Lingual pit of a maxillary incisor"],
    correct: 0,
    explain: "Class V lesions are specifically located on the cervical (gingival) third of any tooth, both anterior and posterior."
  },
  {
    q: "The cavosurface angle is the junction between:",
    opts: ["A prepared wall and the external tooth surface", "The axial wall and the pulpal wall", "Two external walls", "The enamel and the dentin"],
    correct: 0,
    explain: "The cavosurface angle (or margin) is the line or angle formed where the prepared cavity meets the original, unprepared tooth surface."
  },
  {
    q: "A Class VI preparation, an addition to Black's original classification, is located on the:",
    opts: ["Incisal edge of anterior teeth or occlusal cusp heights", "Root surface of any tooth", "The distal surface of the last molar", "Any smooth surface"],
    correct: 0,
    explain: "Class VI was added to describe lesions on incisal edges or cusp tips, often caused by attrition or erosion combined with caries."
  },
  {
    q: "In a typical pit and fissure lesion, how does the decay spread upon reaching the dentino-enamel junction (DEJ)?",
    opts: ["It spreads laterally", "It stops progressing", "It narrows towards the pulp", "It remineralizes immediately"],
    correct: 0,
    explain: "Once caries penetrates the enamel and reaches the softer dentin at the DEJ, it spreads laterally much more quickly than it did through the enamel."
  },
  {
    q: "A Class III preparation would be found on which tooth?",
    opts: ["Maxillary central incisor", "Mandibular first molar", "Maxillary first premolar", "Mandibular second molar"],
    correct: 0,
    explain: "Class III lesions are on the proximal surfaces of anterior teeth (incisors and canines) that do not involve the incisal angle."
  },
  {
    q: "The internal wall of a preparation that is perpendicular to the long axis of the tooth is the:",
    opts: ["Pulpal wall", "Axial wall", "Gingival wall", "Facial wall"],
    correct: 0,
    explain: "The pulpal wall, or floor, is the internal wall overlying the pulp and is oriented perpendicular to the long axis of the tooth."
  },
  {
    q: "Which of the following is considered a smooth surface carious lesion?",
    opts: ["Class II", "Class I", "Forward caries", "Pit and Fissure caries"],
    correct: 0,
    explain: "All classes except Class I (pit-and-fissure) are considered smooth-surface lesions. Class II occurs on the smooth proximal surfaces."
  },
  {
    q: "What is the primary factor that makes root caries more common in older patients?",
    opts: ["Increased incidence of gingival recession", "Changes in salivary pH with age", "Hardening of the enamel", "A diet higher in sugars"],
    correct: 0,
    explain: "Gingival recession, which is more prevalent in older populations, exposes the softer root surface to the oral environment, making it susceptible to caries."
  },
  {
    q: "Caries that extends from the DEJ back towards the enamel surface is known as:",
    opts: ["Backward caries", "Forward caries", "Incipient caries", "Residual caries"],
    correct: 0,
    explain: "Backward caries describes the process where decay spreads laterally at the DEJ and undermines the adjacent enamel from below."
  },
  {
    q: "A preparation on the lingual pit of a maxillary lateral incisor would be classified as:",
    opts: ["Class I", "Class III", "Class IV", "Class V"],
    correct: 0,
    explain: "Class I includes pit and fissure lesions, which encompasses the lingual pits of maxillary incisors."
  },
  {
    q: "The junction of three surfaces within a prepared cavity, such as the disto-facio-pulpal junction, is called a:",
    opts: ["Point angle", "Line angle", "Cavosurface angle", "Tripod junction"],
    correct: 0,
    explain: "The junction of three prepared surfaces forms a point angle."
  },
  {
    q: "A preparation that only involves the occlusal surface of a molar is described as:",
    opts: ["Simple", "Compound", "Complex", "Primary"],
    correct: 0,
    explain: "A preparation involving only one tooth surface is termed a simple preparation."
  },
  {
    q: "Remineralization is a possible treatment for which type of caries?",
    opts: ["Incipient caries", "Cavitated caries", "Secondary caries", "Acute caries"],
    correct: 0,
    explain: "Incipient caries is a non-cavitated lesion where the surface is intact. It can be reversed or arrested through measures like fluoride application and plaque control."
  },
  {
    q: "In a Class I cavity preparation on a mandibular molar, which wall is NOT an external wall?",
    opts: ["Pulpal wall", "Facial wall", "Lingual wall", "Distal wall"],
    correct: 0,
    explain: "The pulpal wall is an internal wall. The facial, lingual, mesial, and distal walls extend to the external tooth surface."
  },
  {
    q: "Which classification of caries is based on the rate of progression?",
    opts: ["Acute and Chronic", "Primary and Secondary", "Simple and Complex", "Class I and Class II"],
    correct: 0,
    explain: "The rate or speed of caries is described as either acute (rapid) or chronic (slow/arrested)."
  }
];

const tfs = [
  {
    q: "Primary caries is the first carious lesion to occur on a tooth surface.",
    answer: true,
    explain: "This is the definition of primary caries, which is the original lesion."
  },
  {
    q: "Root caries progresses more slowly than enamel caries due to the higher mineral content of cementum.",
    answer: false,
    explain: "Root caries is usually more rapid because cementum is thin and less mineralized than enamel."
  },
  {
    q: "A cavitated carious lesion can be reversed through the application of fluoride.",
    answer: false,
    explain: "Once the enamel surface is broken (cavitated), remineralization is generally not possible, and a restoration is required."
  },
  {
    q: "G.V. Black's Class I refers to all smooth-surface lesions.",
    answer: false,
    explain: "Class I refers to pit-and-fissure lesions. Classes II, III, IV, V, and VI are smooth-surface lesions."
  },
  {
    q: "An axial wall in a tooth preparation is parallel to the long axis of the tooth.",
    answer: true,
    explain: "This is the correct definition. The pulpal wall is perpendicular to the long axis."
  },
  {
    q: "A tooth preparation involving two surfaces is called a 'complex' preparation.",
    answer: false,
    explain: "A two-surface preparation is termed 'compound.' A 'complex' preparation involves three or more surfaces."
  },
  {
    q: "Secondary caries is also known as incipient caries.",
    answer: false,
    explain: "Secondary caries is also known as recurrent caries. Incipient caries refers to the earliest stage of a lesion."
  },
  {
    q: "A Class IV preparation involves the proximal surface of a posterior tooth.",
    answer: false,
    explain: "A Class IV preparation involves the proximal surface and incisal angle of an *anterior* tooth."
  },
  {
    q: "A point angle is formed by the junction of two prepared surfaces.",
    answer: false,
    explain: "A point angle is formed by the junction of three prepared surfaces. A line angle is formed by two."
  }
];

const saqs = [
  {
    q: "Define 'Dental Caries' as described in the lecture.",
    a: "It is an infectious microbial disease of the calcified tissues of teeth, characterized by demineralization of the inorganic portion and destruction of the organic portion of the tooth."
  },
  {
    q: "List the three primary morphologic types of primary caries.",
    a: "<ol><li>Pit and fissure caries</li><li>Smooth surface caries</li><li>Root surface caries</li></ol>"
  },
  {
    q: "Present a comparison between Acute (Rampant) Caries and Chronic (Arrested) Caries in a table format, covering their appearance and rate of progression.",
    a: "<table><thead><tr><th>Feature</th><th>Acute (Rampant) Caries</th><th>Chronic (Arrested) Caries</th></tr></thead><tbody><tr><td><strong>Rate</strong></td><td>Rapidly progressing</td><td>Slowly progressing or stopped</td></tr><tr><td><strong>Appearance</strong></td><td>Soft, light-colored (whitish/yellowish)</td><td>Hard, dark-colored (brown/black)</td></tr></tbody></table>"
  },
  {
    q: "A 19-year-old patient presents with a fractured mesio-incisal corner of their maxillary right central incisor. The fracture was caused by an underlying carious lesion on the mesial surface. According to G.V. Black's classification, what class of preparation would be required to restore this tooth?",
    a: "This would require a Class IV preparation. The lesion involves the proximal surface (mesial) of an anterior tooth and also involves the incisal angle."
  },
  {
    q: "Explain the difference between an internal wall and an external wall in a tooth preparation, and provide one example of each.",
    a: "An <strong>external wall</strong> is a prepared surface that extends to the external tooth surface (e.g., Facial, Lingual, Mesial, Distal, Gingival wall). An <strong>internal wall</strong> is a prepared surface that does not extend to the external tooth surface (e.g., Axial wall, Pulpal wall)."
  },
  {
    q: "List the six classes of tooth preparations according to G.V. Black's classification.",
    a: "<ul><li><strong>Class I:</strong> Pit and fissure lesions.</li><li><strong>Class II:</strong> Lesions on the proximal surfaces of posterior teeth.</li><li><strong>Class III:</strong> Lesions on the proximal surfaces of anterior teeth, not involving the incisal angle.</li><li><strong>Class IV:</strong> Lesions on the proximal surfaces of anterior teeth that do involve the incisal angle.</li><li><strong>Class V:</strong> Lesions on the gingival third of the facial or lingual surfaces of any tooth.</li><li><strong>Class VI:</strong> Lesions on the incisal edge of anterior teeth or occlusal cusp tips of posterior teeth.</li></ul>"
  }
];


// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return;
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').innerHTML;
    return s + (feedback.startsWith("<b>Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').innerHTML;
    return s + (feedback.startsWith("<b>Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>

