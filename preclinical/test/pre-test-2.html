<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}

  .answer table{
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
  }
  .answer th, .answer td{
      border: 1px solid var(--card-border);
      padding: 8px;
      text-align: left;
  }
  .answer th {
      background-color: var(--glass);
  }
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 2</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "What is a major disadvantage of using carbon steel for dental hand instruments?",
        opts: ["It corrodes when unprotected.", "It loses its sharp edge very quickly.", "It is too flexible for effective cutting.", "It cannot be properly sterilized."],
        correct: 0,
        explain: "Carbon steel is harder than stainless steel but it will corrode (rust) if left unprotected."
    },
    {
        q: "Which material used for hand instruments remains bright and resists corrosion but loses its sharpness more quickly during use?",
        opts: ["Stainless steel", "Carbon steel", "Titanium alloy", "Tungsten carbide"],
        correct: 0,
        explain: "Stainless steel alloys resist corrosion and stay bright, but they dull faster than carbon steel instruments."
    },
    {
        q: "According to Marzouk's classification, which category do instruments like chisels and excavators belong to?",
        opts: ["Cutting instruments", "Diagnostic instruments", "Restoring instruments", "Finishing and polishing instruments"],
        correct: 0,
        explain: "Chisels and excavators are designed to cut tooth structure, placing them in the 'Cutting instruments' category."
    },
    {
        q: "Which of the following is considered a 'Restoring instrument' under Marzouk's classification?",
        opts: ["Amalgam carriers", "Mouth mirrors", "Finishing burs", "Spoon excavators"],
        correct: 0,
        explain: "Amalgam carriers are used to transport and place restorative material, classifying them as restoring instruments."
    },
    {
        q: "Which of the following is NOT typically classified as a diagnostic instrument in operative dentistry?",
        opts: ["Cement spatula", "Mouth mirror", "Explorer", "Periodontal probe"],
        correct: 0,
        explain: "A cement spatula is a restoring instrument used for mixing materials, not for diagnosis."
    },
    {
        q: "Which of the following is NOT a primary use of the mouth mirror?",
        opts: ["Measuring periodontal pocket depth", "Indirect vision", "Light reflection", "Retraction of soft tissues"],
        correct: 0,
        explain: "Measuring pocket depth is the function of a periodontal probe, not a mouth mirror."
    },
    {
        q: "What is the sharp, pointed working end of a dental explorer called?",
        opts: ["Tine", "Shank", "Blade", "Nib"],
        correct: 0,
        explain: "The term for the sharp, pointed tip of an explorer is the 'tine'."
    },
    {
        q: "In operative dentistry, what is a primary use for the periodontal probe?",
        opts: ["Measuring the dimensions of a cavity preparation", "Detecting soft carious lesions", "Retracting the tongue for better access", "Polishing the final restoration"],
        correct: 0,
        explain: "Periodontal probes are used in operative dentistry to accurately measure the dimensions of prepared cavities."
    },
    {
        q: "What is the main function of cotton tweezers (pliers) in operative dentistry?",
        opts: ["Placing and removing cotton rolls for isolation", "Carving amalgam anatomy", "Condensing composite material", "Measuring the depth of the cavity"],
        correct: 0,
        explain: "Cotton tweezers are specifically designed with angled tips to handle cotton rolls, pellets, and wedges."
    },
    {
        q: "What are the three main parts of a typical dental hand instrument?",
        opts: ["Handle, Shank, Blade", "Handle, Neck, Tip", "Shaft, Bevel, Tine", "Grip, Arm, Nib"],
        correct: 0,
        explain: "A hand instrument is composed of the handle (or shaft), the shank, and the working end, which is the blade for cutting instruments."
    },
    {
        q: "The functional working end of a non-cutting or restoring instrument (like a condenser) is called the:",
        opts: ["Nib", "Blade", "Cutting edge", "Tine"],
        correct: 0,
        explain: "For non-cutting instruments, the working end is referred to as the 'nib', whereas for cutting instruments, it is the 'blade'."
    },
    {
        q: "An instrument with two angles in its shank is referred to as being:",
        opts: ["Binangled", "Monoangled", "Triple angled", "Contra-angled"],
        correct: 0,
        explain: "Shank design is named by the number of angles it contains: one angle is monoangled, two is binangled, and three is triple angled."
    },
    {
        q: "What is the primary purpose of contra-angling an instrument's shank?",
        opts: ["To bring the cutting edge close to the handle's axis for balance", "To increase the instrument's cutting force", "To allow for better sterilization and cleaning", "To make the instrument longer for better reach"],
        correct: 0,
        explain: "Contra-angling provides balance by aligning the working end with the long axis of the handle, preventing rotation during use."
    },
    {
        q: "A hatchet excavator is an example of which type of beveled instrument?",
        opts: ["Bi-Beveled", "Single beveled", "Circumferentially Beveled", "Non-beveled"],
        correct: 1,
        explain: "Hatchet excavators have two bevels on their cutting edge, making them bi-beveled."
    },
    {
        q: "Which instrument is characterized by a circumferentially beveled, spoon-shaped working end?",
        opts: ["Spoon Excavator", "Straight Chisel", "Enamel Hatchet", "Gingival Marginal Trimmer"],
        correct: 0,
        explain: "The spoon excavator is unique for its spoon shape and a cutting edge that extends around the perimeter (circumferentially beveled)."
    },
    {
        q: "What is the primary function of a straight chisel in cavity preparation?",
        opts: ["Removal of unsupported enamel", "Removal of soft carious dentin", "Beveling of axiopulpal line angles", "Condensing amalgam restorations"],
        correct: 0,
        explain: "Chisels are primarily designed for cutting enamel and are used to plane away unsupported enamel rods."
    },
    {
        q: "The primary cutting edge of an enamel hatchet is in a plane that is...",
        opts: ["parallel with the long axis of the handle.", "perpendicular to the long axis of the handle.", "at a 45-degree angle to the handle.", "curved away from the handle."],
        correct: 0,
        explain: "The design of an enamel hatchet places its cutting edge parallel to the instrument's handle axis."
    },
    {
        q: "An enamel hatchet is specifically used to remove unsupported enamel from which area in a Class II cavity preparation?",
        opts: ["Proximal area", "Occlusal floor", "Pulpal wall", "Gingival margin"],
        correct: 0,
        explain: "The enamel hatchet is designed for use in the proximal box of a Class II preparation to cleave away weak, unsupported enamel."
    },
    {
        q: "How does a Gingival Marginal Trimmer (GMT) primarily differ from an enamel hatchet in its design?",
        opts: ["Its blade is curved.", "Its blade is perfectly straight.", "It is always a single-ended instrument.", "It has no bevel on its cutting edge."],
        correct: 0,
        explain: "The GMT is similar to an enamel hatchet, but its blade is curved, and the cutting edge is at an angle other than 90 degrees to the blade."
    },
    {
        q: "A Gingival Marginal Trimmer (GMT) is specifically used for which of the following tasks?",
        opts: ["Rounding or beveling of the axiopulpal line angles", "Removing soft carious dentin from the pulpal floor", "Condensing restorative material into the proximal box", "Polishing the final occlusal anatomy"],
        correct: 0,
        explain: "One of the key uses of a GMT is to bevel the axiopulpal line angle of a Class II preparation to reduce stress concentration."
    },
    {
        q: "What is the primary use of a spoon excavator?",
        opts: ["Removal of soft caries", "Planing of enamel walls", "Carving occlusal anatomy of amalgam", "Placing cotton pellets into the cavity"],
        correct: 0,
        explain: "The spoon excavator is the instrument of choice for the careful removal of soft, carious dentin."
    },
    {
        q: "In G.V. Black's 3-unit instrument formula, what does the first unit represent?",
        opts: ["Width of the blade in tenths of a millimeter", "Length of the blade in millimeters", "Angle of the blade in centigrades", "Length of the handle in centimeters"],
        correct: 0,
        explain: "The first number in Black's formula always indicates the blade width in 0.1 mm increments (e.g., '10' means 1.0 mm)."
    },
    {
        q: "In G.V. Black's 3-unit instrument formula, what unit of measurement is used for the blade's angle (third unit)?",
        opts: ["Centigrade degrees", "Millimeters", "Microns", "Standard degrees (360¬∞ circle)"],
        correct: 0,
        explain: "The angle of the blade relative to the handle is expressed in centigrades, where a circle is 100 centigrades."
    },
    {
        q: "A fourth unit is added to Black's instrument formula for instruments like the GMT. What does this unit, placed in the second position, represent?",
        opts: ["Cutting edge angle", "Blade sharpness index", "Shank curvature degree", "Handle diameter in millimeters"],
        correct: 0,
        explain: "For instruments where the cutting edge is not perpendicular to the blade, a fourth unit is added as the second number to denote the cutting edge angle."
    },
    {
        q: "Which restoring instrument is specifically designed for mixing dental cements on a glass slab or paper pad?",
        opts: ["Cement spatula", "Plastic filling instrument", "Amalgam condenser", "Amalgam carver"],
        correct: 0,
        explain: "The flat, wide nib of a cement spatula is designed for the spatulation and mixing of various dental cements."
    },
    {
        q: "What is the primary use of a plastic filling instrument?",
        opts: ["To carry and place mixed cements into the cavity preparation", "To condense amalgam firmly into the cavity", "To carve the final occlusal anatomy of a restoration", "To excavate soft carious dentin"],
        correct: 0,
        explain: "Plastic filling instruments have smooth, blunt nibs designed to carry and manipulate plastic materials like cements or composites."
    },
    {
        q: "The primary function of an amalgam condenser is to:",
        opts: ["Compact amalgam into the prepared cavity", "Smooth the surface of the final restoration", "Mix the alloy and mercury together", "Remove excess material from the margins"],
        correct: 0,
        explain: "Condensers are used to apply vertical pressure to compact the amalgam, ensuring adaptation and minimizing voids."
    },
    {
        q: "Which instrument, often with a ball-shaped or egg-shaped nib, is used to make the surface of a restoration smooth before it sets?",
        opts: ["Burnisher", "Carver", "Excavator", "Condenser"],
        correct: 0,
        explain: "Burnishers are used with a rubbing motion to smooth the surface of amalgam, beginning the condensation of the surface layer."
    },
    {
        q: "Which of the following are examples of universally used amalgam carvers for shaping occlusal anatomy?",
        opts: ["Hollenbeck and Cleoid-discoid", "Spoon excavator and Hatchet", "Straight chisel and Wedelstaedt chisel", "Ball and Egg-shaped burnishers"],
        correct: 0,
        explain: "The Hollenbeck carver and the Cleoid-discoid carver (with its pointed and circular ends) are the most common instruments for carving amalgam."
    },
    {
        q: "Which instrument grasp is most commonly used in operative dentistry and involves the pads of the thumb, index, and middle fingers?",
        opts: ["Modified Pen Grasp", "Inverted Pen Grasp", "Palm and Thumb Grasp", "Reverse Pen Grasp"],
        correct: 0,
        explain: "The Modified Pen Grasp offers the greatest control and is the most frequently used grasp for hand instruments."
    }
];

const tfs = [
    {
        q: "Stainless steel is harder than carbon steel and maintains a sharper edge for a longer period.",
        answer: false,
        explain: "This is false. Carbon steel is harder and holds a sharp edge longer, while stainless steel is softer but resists corrosion."
    },
    {
        q: "The working end of a cutting instrument like a chisel is correctly referred to as a 'nib'.",
        answer: false,
        explain: "This is false. The working end of a cutting instrument is a 'blade'. A 'nib' refers to the end of a non-cutting instrument like a condenser."
    },
    {
        q: "For optimal anti-rotational design and balance, an instrument's cutting edge should be kept within 3 mm of the handle's long axis.",
        answer: true,
        explain: "This is true. This principle of balance, achieved through contra-angling, is crucial for instrument control."
    },
    {
        q: "A straight chisel is a classic example of a bi-beveled instrument.",
        answer: false,
        explain: "This is false. A chisel is single-beveled, meaning its cutting edge is formed by a bevel on only one side."
    },
    {
        q: "A Gingival Marginal Trimmer (GMT) comes in a single, universal design suitable for both mesial and distal surfaces.",
        answer: false,
        explain: "This is false. GMTs come in pairs, with one specifically designed for mesial margins and another for distal margins."
    },
    {
        q: "In G.V. Black's 3-unit formula, the second number describes the length of the blade in millimeters.",
        answer: true,
        explain: "This is true. The formula is (1) Blade Width, (2) Blade Length, (3) Blade Angle."
    },
    {
        q: "The Inverted Pen Grasp is commonly used for accessing the buccal surfaces of mandibular teeth.",
        answer: false,
        explain: "This is false. The Inverted Pen Grasp is used when the palm is facing upward, typically for the palatal surfaces of maxillary teeth."
    },
    {
        q: "The Palm-and-Thumb grasp offers the most precise control and is widely used for most delicate operative procedures.",
        answer: false,
        explain: "This is false. This grasp provides more power but has very limited use and less tactile sensitivity compared to the modified pen grasp."
    },
    {
        q: "A finger rest is essential for steadying the hand, preventing instrument slippage, and improving control during a procedure.",
        answer: true,
        explain: "This is true. The finger rest acts as a fulcrum point, providing stability for precise and safe instrument use."
    }
];

const saqs = [
    {
        q: "According to Marzouk's classification, what are the four main categories of hand instruments used in operative dentistry?",
        a: "The four main categories are: <br>1. Diagnostic instruments <br>2. Cutting instruments <br>3. Restoring instruments <br>4. Finishing and polishing instruments"
    },
    {
        q: "List the four primary uses of a mouth mirror in dentistry.",
        a: "The four primary uses are: <br>1. <strong>Indirect vision:</strong> To see tooth surfaces that cannot be seen directly. <br>2. <strong>Light reflection:</strong> To illuminate the operating area. <br>3. <strong>Retraction:</strong> To move soft tissues like the tongue, cheeks, or lips out of the way. <br>4. <strong>Tissue protection:</strong> To guard soft tissues against injury from rotary instruments."
    },
    {
        q: "Compare Stainless Steel and Carbon Steel for manufacturing dental hand instruments, focusing on hardness and corrosion resistance.",
        a: "<table><thead><tr><th>Feature</th><th>Stainless Steel</th><th>Carbon Steel</th></tr></thead><tbody><tr><td>1. Hardness</td><td>Softer</td><td>Harder</td></tr><tr><td>2. Edge Retention</td><td>Loses sharp edge more quickly</td><td>Maintains a keen edge longer</td></tr><tr><td>3. Corrosion Resistance</td><td>Remains bright (high resistance)</td><td>Will corrode (rust) if unprotected</td></tr></tbody></table>"
    },
    {
        q: "Explain what each of the three units in G.V. Black's original instrument formula represents.",
        a: "The three units represent: <br>‚Ä¢ <strong>First Unit:</strong> The width of the blade in tenths of a millimeter (e.g., a '10' represents 1.0 mm). <br>‚Ä¢ <strong>Second Unit:</strong> The length of the blade in millimeters. <br>‚Ä¢ <strong>Third Unit:</strong> The angle the blade forms with the long axis of the handle, expressed in centigrade degrees (based on a 100-degree circle)."
    },
    {
        q: "A patient presents with a deep carious lesion on a mandibular molar. The decayed tissue is soft and easily removable. Which hand cutting instrument is specifically designed for the bulk removal of such soft caries?",
        a: "A <strong>spoon excavator</strong> is the correct instrument. Its spoon-shaped, circumferentially beveled blade is ideal for scooping out soft, decayed dentin with a lateral cutting action, minimizing the risk of pulp exposure."
    },
    {
        q: "Describe the finger placement in the 'Modified Pen Grasp' and identify which fingers typically provide the 'rest'.",
        a: "In the Modified Pen Grasp, the pads of the <strong>thumb, index finger, and middle finger</strong> contact the instrument's handle. The middle finger pad provides pressure and control. The 'rest' is provided by placing the tips of the <strong>ring and little fingers</strong> on a stable surface, such as an adjacent tooth in the same arch, to steady the hand."
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      const originalSelection = visualToOriginal[v];
      state.mcq[idx] = originalSelection; // Store the original index

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
    const mcqScore = state.mcq.reduce((score, selectedOriginalIndex, i) => {
        if (selectedOriginalIndex === null) return score;
        return score + (selectedOriginalIndex === mcqs[i].correct ? 1 : 0);
    }, 0);

    const tfScore = state.tf.reduce((score, selectedValue, i) => {
        if (selectedValue === null) return score;
        return score + (selectedValue === tfs[i].answer ? 1 : 0);
    }, 0);

    const saqScore = state.saq.filter(Boolean).length;
    const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
