<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 8</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (from ocih-8.pdf) -----------
const mcqs = [
  { q: "Which morphological stage immediately follows the dental lamina stage?", opts:["Bud stage","Cap stage","Early bell stage","Advanced bell stage"], correct:0, explain:"Morphological sequence: dental lamina → bud → cap → early bell → advanced bell → matrix formation." },
  { q: "During which morphological stage does the tooth crown assume its final shape?", opts:["Bud stage","Cap stage","Early bell stage","Advanced bell stage"], correct:2, explain:"In the bell stage, morphodifferentiation gives the crown its definitive shape; this begins in the early bell stage." },
  { q: "The advanced (late) bell stage begins with the formation of the first layer of which tissue?", opts:["Predentin","Mineralized tissue","Enamel matrix only","Cementum"], correct:1, explain:"Advanced bell stage is defined by the appearance of the first mineralized tissue (initial dentin/enamel)." },
  { q: "Which of the following correctly lists the four layers of the enamel organ in early bell stage?", opts:["Outer enamel epithelium, Inner enamel epithelium, Stellate reticulum, Stratum intermedium","Outer enamel epithelium, Dental sac, Stellate reticulum, Inner enamel epithelium","Inner enamel epithelium, Odontoblasts, Stellate reticulum, Dental papilla","Outer enamel epithelium, Inner enamel epithelium, Dental papilla, Stratum intermedium"], correct:0, explain:"Early bell stage: OEE, IEE, stellate reticulum, and stratum intermedium." },
  { q: "Preameloblasts are another name used for which cells?", opts:["Outer enamel epithelium cells","Inner enamel epithelium cells","Stratum intermedium cells","Odontoblasts"], correct:1, explain:"IEE cells elongate to tall columnar cells termed preameloblasts before secreting enamel." },
  { q: "Stratum intermedium is typically composed of:", opts:["2–3 layers of flat/squamous cells","Single layer of cuboidal cells","Numerous polygonal cells with star-shaped processes","Tall columnar cells"], correct:0, explain:"Slides note 2–3 layers of flat cells connected by desmosomes between IEE and stellate reticulum." },
  { q: "Which enzyme is abundant in the stratum intermedium and is essential for enamel mineralization?", opts:["Amylase","Alkaline phosphatase","Acid phosphatase","Carbonic anhydrase"], correct:1, explain:"Stratum intermedium cells are rich in alkaline phosphatase, supporting enamel mineralization." },
  { q: "Functional role of stratum intermedium includes:", opts:["Collagen secretion for dentin","Controlling fluid diffusion into and out of ameloblasts","Initiating cementum formation","Forming Hertwig's epithelial root sheath"], correct:1, explain:"They act with IEE in enamel formation and regulate fluid movement for ameloblasts." },
  { q: "The stellate reticulum expands mainly due to:", opts:["Increase in intercellular fluid","Proliferation of odontoblasts","Deposition of enamel proteins","Invasion by blood vessels"], correct:0, explain:"It expands as intercellular fluid increases; cells connected by desmosomes." },
  { q: "Just before enamel formation, the stellate reticulum:", opts:["Thickens to support ameloblasts","Collapses to reduce distance to capillaries","Becomes vascular","Transforms into stratum intermedium"], correct:1, explain:"It collapses, bringing ameloblasts closer to nutrient capillaries near OEE." },
  { q: "In late bell stage, the surface of outer enamel epithelium becomes:", opts:["Thicker and smoother","Folded, allowing papillary capillary loops","Keratinized","Discontinuous"], correct:1, explain:"OEE develops folds; dental sac mesenchyme forms papillae with capillary loops for nutrition." },
  { q: "The dental sac papillae forming between OEE folds primarily provide:", opts:["Vascular supply to avascular enamel organ","Innervation to dental papilla","Mechanical attachment to bone","Matrix for dentin"], correct:0, explain:"Capillary loops in papillae deliver nutrition for the metabolic activity of the enamel organ." },
  { q: "Which structure is enclosed within the invaginated portion of the enamel organ?", opts:["Dental sac","Dental papilla","Cervical loop","Reduced enamel epithelium"], correct:1, explain:"Dental papilla lies inside the enamel organ invagination and will form dentin and pulp." },
  { q: "Before enamel formation, peripheral cells of the dental papilla differentiate under epithelial influence into:", opts:["Ameloblasts","Cementoblasts","Odontoblasts","Fibroblasts"], correct:2, explain:"IEE induces mesenchymal papilla cells to become odontoblasts that secrete dentin." },
  { q: "The basement membrane separating enamel organ from dental papilla prior to dentin formation is called:", opts:["Membrana limitans","Membrana preformativa","Lamina densa","Primary cuticle"], correct:1, explain:"That basement membrane later becomes the dentino-enamel junction (DEJ)." },
  { q: "Future fate of the membrana preformativa is to form the:", opts:["Cemento-dentinal junction","Dentino-enamel junction","Alveolar crest","Secondary enamel cuticle"], correct:1, explain:"Slides explicitly state it forms the DEJ." },
  { q: "Cervical loop is characterized by the presence of:", opts:["Only outer and inner enamel epithelium","All four enamel organ layers","Odontoblasts and IEE","Stratum intermedium only"], correct:0, explain:"Cervical loop consists of OEE and IEE only in the advanced bell stage." },
  { q: "Cells in the cervical loop give rise to:", opts:["Successional dental lamina","Hertwig's epithelial root sheath","Reduced enamel epithelium","Epithelial rests of Malassez directly"], correct:1, explain:"HERS arises from the apical proliferation of OEE and IEE at the cervical loop." },
  { q: "Which process best matches morphodifferentiation?", opts:["Determination of tooth shape and size","Cell type specification into ameloblasts/odontoblasts","Matrix secretion","Initiation of tooth germs"], correct:0, explain:"Morphodifferentiation concerns form (shape and size); histodifferentiation is cell specialization." },
  { q: "Histodifferentiation primarily refers to:", opts:["Hard tissue mineralization","Cellular specialization into functional cell types","Elongation of dental lamina","Root lengthening"], correct:1, explain:"It is the physiological stage of differentiation of cells (eg, IEE→preameloblast)." },
  { q: "Apposition stage is characterized by:", opts:["Establishment of tooth position","Shape determination","Matrix deposition of enamel and dentin","Crown eruption"], correct:2, explain:"Apposition = secretion of enamel and dentin matrices prior to mineralization." },
  { q: "Which of the following is a defect of initiation?", opts:["Anodontia","Hypocalcified enamel","Microdontia from morphodifferentiation defect","Taurodontism"], correct:0, explain:"Slides list anodontia and supernumerary teeth under abnormal initiation." },
  { q: "Supernumerary teeth are primarily associated with a problem in:", opts:["Apposition","Initiation","Eruption","Resorption"], correct:1, explain:"They result from abnormal initiation of tooth development." },
  { q: "A defect in morphodifferentiation would most likely affect:", opts:["Tooth shape/size","Enamel mineralization only","Number of teeth","Jaw growth"], correct:0, explain:"Morphodifferentiation determines shape and size; defects alter crown morphology." },
  { q: "Hypocalcified teeth mainly reflect a disturbance in:", opts:["Initiation","Morphodifferentiation","Apposition/mineralization","Eruption path"], correct:2, explain:"Slides list defect in apposition leading to hypocalcified teeth (mineralization problem)." },
  { q: "Which pairing is CORRECT?", opts:["Bud stage – DEJ formation","Cap stage – HERS formation","Early bell – four-layered enamel organ","Advanced bell – disappearance of IEE"], correct:2, explain:"Early bell has OEE, IEE, stellate reticulum, stratum intermedium." },
  { q: "Which cell layer is directly adjacent to inner enamel epithelium on its outer side?", opts:["Dental papilla","Stratum intermedium","Stellate reticulum","Outer enamel epithelium"], correct:1, explain:"Stratum intermedium lies between IEE and stellate reticulum." },
  { q: "Desmosomal junctions in the enamel organ are prominently observed in:", opts:["Stratum intermedium only","Stellate reticulum","Outer enamel epithelium","Hertwig's epithelial root sheath"], correct:1, explain:"Stellate reticulum cells interconnect via desmosomes while maintaining intercellular spaces." },
  { q: "Which structure ultimately gives rise to dentin and dental pulp?", opts:["Dental sac","Dental papilla","Outer enamel epithelium","Reduced enamel epithelium"], correct:1, explain:"Dental papilla differentiates into odontoblasts (dentin) and forms the dental pulp." },
  { q: "At the end of bell stage, increased folding of OEE is most closely related to:", opts:["Anchoring the tooth germ","Compensating for reduced papillary nutrition through dentin formation","Creating space for stellate reticulum expansion","Initiating eruption"], correct:1, explain:"Folds allow mesenchymal papillae with capillaries to enhance nutrition as dentin mineralizes." }
];

const tfs = [
  { q:"Morphological stages include dental lamina, bud, cap, early bell, advanced bell, and matrix formation.", answer:true, explain:"These are the six morphological stages described in the slides." },
  { q:"Histodifferentiation determines the final shape and size of the tooth.", answer:false, explain:"Morphodifferentiation determines shape/size; histodifferentiation = cell specialization." },
  { q:"The enamel organ is avascular and relies on surrounding capillaries for nutrition.", answer:true, explain:"Capillary loops approach near the OEE to nourish the avascular enamel organ." },
  { q:"Stellate reticulum thickens and persists throughout enamel formation to support ameloblasts.", answer:false, explain:"It collapses before enamel formation to reduce distance to nutrient capillaries." },
  { q:"Stratum intermedium works as a functional unit with IEE during enamel formation.", answer:true, explain:"They coordinate enamel production and mineralization." },
  { q:"Membrana preformativa later becomes the cemento-dentinal junction (CDJ).", answer:false, explain:"It becomes the dentino-enamel junction (DEJ)." },
  { q:"Cervical loop contains only OEE and IEE cells.", answer:true, explain:"By definition, cervical loop is composed of OEE and IEE." },
  { q:"Anodontia represents a defect of the apposition stage.", answer:false, explain:"Anodontia is a failure of initiation, not apposition." },
  { q:"Dental papilla cells differentiate into odontoblasts under the influence of inner enamel epithelium.", answer:true, explain:"Epithelial-mesenchymal interaction induces odontoblast differentiation." }
];

const saqs = [
  // 1. Direct Answer
  { q: "Define morphodifferentiation in tooth development.", a: "Determination of tooth crown shape and size during bell stage." },
  // 2. List / Enumeration (3 or more)
  { q: "List the four cell layers present in the early bell stage.", a: "1) Outer enamel epithelium 2) Inner enamel epithelium (preameloblasts) 3) Stellate reticulum 4) Stratum intermedium" },
  // 3. Comparison (numbered table)
  { q: "Compare histodifferentiation and morphodifferentiation.", a: `<table style="width:100%;border-collapse:collapse"><thead><tr><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">#</th><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Histodifferentiation</th><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Morphodifferentiation</th></tr></thead><tbody><tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">1</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Cell specialization</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Shape/size determination</td></tr><tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">2</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">IEE→preameloblasts; papilla→odontoblasts</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Crown form established (bell stage)</td></tr><tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">3</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Precedes matrix secretion</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Guides cusp/outline features</td></tr></tbody></table>` },
  // 4. Case-based Scenario
  { q: "A child presents with several additional erupted teeth beyond the normal count. Which developmental process is most likely abnormal, and at which physiological stage?", a: "Abnormal initiation—physiological Initiation stage (supernumerary teeth)." },
  // 5. Short direct
  { q: "What is the fate of the membrana preformativa?", a: "Forms the dentino–enamel junction (DEJ)." },
  // 6. Short direct
  { q: "Name the root-forming epithelial structure derived from the cervical loop.", a: "Hertwig's epithelial root sheath (HERS)." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
