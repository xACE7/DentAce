<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}  
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 8</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled from Lecture 8: Odontogenesis Part III) -----------
const mcqs = [
  { q:"Which event marks the transition from early to advanced bell stage?", opts:["Collapse of the stratum intermedium","First deposition of mineralized tissue","Appearance of dental lamina","Onset of morphodifferentiation"], correct:1, explain:"Advanced (late) bell stage begins with the first layer of mineralized tissue (predentin/dentin)." },
  { q:"During the bell stage, which processes run in parallel to give the crown its final shape?", opts:["Initiation and proliferation","Apposition and eruption","Histodifferentiation and morphodifferentiation","Keratinization and apposition"], correct:2, explain:"Differential growth with histodifferentiation and morphodifferentiation defines crown form in the bell stage." },
  { q:"Stratum intermedium typically consists of:", opts:["2‚Äì3 layers of squamous cells rich in alkaline phosphatase","A single cuboidal layer devoid of enzymes","Columnar cells forming tomes‚Äô processes","Anucleate keratinized cells"], correct:0, explain:"It is 2‚Äì3 flat cell layers with high alkaline phosphatase, essential for enamel mineralization." },
  { q:"Functional partnership essential for enamel formation is between:", opts:["Outer enamel epithelium and stellate reticulum","Inner enamel epithelium and stratum intermedium","Dental papilla and dental sac","Reduced enamel epithelium and oral epithelium"], correct:1, explain:"Stratum intermedium acts as a functional unit with the inner enamel epithelium (preameloblasts)." },
  { q:"Immediately before enamel formation, the stellate reticulum:", opts:["Proliferates and thickens centrally","Collapses to shorten the diffusion distance to capillaries","Keratinizes to form Nasmyth's membrane","Transforms into odontoblasts"], correct:1, explain:"It collapses, reducing the gap between ameloblasts and capillaries near the OEE." },
  { q:"The outer enamel epithelium at late bell stage shows:", opts:["Formation of folds with subjacent vascular papillae","Loss of all cell junctions","Metaplasia into odontoblasts","Direct secretion of enamel"], correct:0, explain:"OEE develops surface folds; dental sac mesenchyme forms vascular papillae between folds to nourish the avascular enamel organ." },
  { q:"Loss of nutrition from the dental papilla during hard tissue formation is compensated by:", opts:["Keratinization of inner enamel epithelium","Capillary loops within papillae adjacent to OEE folds","Hyperplasia of stellate reticulum","An increase in salivary gland flow"], correct:1, explain:"Vascular papillae containing capillary loops form next to OEE folds to support high metabolic activity." },
  { q:"Membrana preformativa is located between:", opts:["OEE and dental sac","Stratum intermedium and stellate reticulum","Inner enamel epithelium and dental papilla","Reduced enamel epithelium and oral epithelium"], correct:2, explain:"It is the basement membrane separating IEE (preameloblasts) and dental papilla before dentinogenesis; future DEJ." },
  { q:"Fate of membrana preformativa is:", opts:["Cementoenamel junction","Dentinoenamel junction","Pulp-dentin border","Epithelial rests of Malassez"], correct:1, explain:"It becomes the dentino‚Äëenamel junction (DEJ)." },
  { q:"Sequence for odontoblast differentiation under epithelial influence is:", opts:["Columnar ‚Üí cuboidal ‚Üí squamous","Squamous ‚Üí columnar ‚Üí anucleate","Cuboidal ‚Üí columnar with dentinogenic potential","Spindle ‚Üí pyramidal ‚Üí stellate"], correct:2, explain:"Peripheral papilla cells become odontoblasts: first cuboidal, then columnar and dentin-secreting." },
  { q:"Which pair is correctly matched with its primary role?", opts:["Stellate reticulum ‚Äì secretes enamel matrix","Stratum intermedium ‚Äì supports enamel mineralization","Outer enamel epithelium ‚Äì differentiates into odontoblasts","Dental lamina ‚Äì forms cementum"], correct:1, explain:"Stratum intermedium supports enamel formation/mineralization; ameloblasts (IEE) make enamel matrix." },
  { q:"Desmosomes are conspicuous between:", opts:["Cells of stratum intermedium only","OEE and dental sac cells","Stellate reticulum cells","Odontoblasts and predentin"], correct:2, explain:"Stellate reticulum cells show desmosomal junctions maintaining a network that later collapses." },
  { q:"The enamel organ increases in size and assumes a bell shape primarily due to:", opts:["Appositional growth of enamel early on","Differential growth with tissue differentiation","Root formation","Fusion with oral epithelium"], correct:1, explain:"During bell stage, differential growth with histo- and morphodifferentiation enlarges the enamel organ." },
  { q:"Cervical loop consists of:", opts:["All four enamel organ layers","Only outer and inner enamel epithelium","Inner enamel epithelium and stratum intermedium","OEE and stellate reticulum"], correct:1, explain:"Cervical loop = OEE + IEE; its cells give rise to Hertwig‚Äôs epithelial root sheath (HERS)." },
  { q:"Hertwig‚Äôs epithelial root sheath originates from:", opts:["Dental lamina remnants (rests of Serres)","Cervical loop cells","Reduced enamel epithelium","Dental papilla"], correct:1, explain:"HERS derives from the proliferating cervical loop (OEE + IEE)." },
  { q:"Which best explains why the enamel organ requires an external vascular supply during late bell stage?", opts:["Ameloblasts lose mitochondria","Enamel organ is avascular and metabolic demand spikes","Dentin blocks neural input","Stratum intermedium becomes cartilaginous"], correct:1, explain:"The enamel organ is avascular; hard tissue formation increases metabolic needs, necessitating capillary loops adjacent to OEE folds." },
  { q:"Identify the stage in which morphodifferentiation primarily determines tooth shape and size:", opts:["Bud stage","Cap stage","Bell stage","Eruption stage"], correct:2, explain:"Morphodifferentiation during the bell stage fixes crown shape and size." },
  { q:"Which statement about rests of Serres is TRUE?", opts:["They are remnants of HERS","They arise from degenerating dental lamina","They become odontoblasts in roots","They form the DEJ"], correct:1, explain:"Rests of Serres are dental lamina remnants; HERS remnants are rests of Malassez (not in this lecture text but contrasting)." },
  { q:"Initiation corresponds morphologically to:", opts:["Bell stage","Dental lamina formation","Apposition","Root formation"], correct:1, explain:"Among physiological stages, initiation aligns with dental lamina formation morphologically." },
  { q:"Which change occurs in the OEE as enamel formation begins?", opts:["Surface smoothens and thins","It folds, and adjacent dental sac develops vascular papillae","It dissociates into stratum intermedium","It becomes continuous with oral epithelium forming an eruption canal"], correct:1, explain:"Folding of OEE with vascular papillae ensures nutrition." },
  { q:"A defect in morphodifferentiation would MOST likely result in:", opts:["Amelogenesis imperfecta hypocalcified type","Abnormal crown shape/size","Anodontia","Hypercementosis"], correct:1, explain:"Morphodifferentiation defects ‚Üí shape/size anomalies (e.g., peg laterals)." },
  { q:"A defect in apposition is classically associated with:", opts:["Hypocalcified teeth","Anodontia","Supernumerary teeth","Taurodontism only"], correct:0, explain:"Apposition defects can lead to hypocalcification/hypoplasia of hard tissues." },
  { q:"Which clinical entity reflects lack of initiation?", opts:["Hypodontia/Anodontia","Fusion","Gemination","Dens invaginatus"], correct:0, explain:"Initiation failure ‚Üí missing teeth; abnormal initiation ‚Üí supernumeraries." },
  { q:"Before dentin forms, the basement membrane between IEE and dental papilla is termed:", opts:["Nasmyth‚Äôs membrane","Membrana preformativa","Reduced enamel epithelium","Internal limiting membrane"], correct:1, explain:"That specific basement membrane is the membrana preformativa." },
  { q:"Which layer directly regulates fluid diffusion to ameloblasts?", opts:["Outer enamel epithelium","Stratum intermedium","Stellate reticulum","Odontoblastic layer"], correct:1, explain:"Stratum intermedium controls diffusion into and out of ameloblasts." },
  { q:"During early bell stage, preameloblasts are best described as:", opts:["Low cuboidal with scant organelles","Tall columnar inner enamel epithelial cells","Flattened squamous cells","Synctytial multinucleated cells"], correct:1, explain:"IEE cells become tall columnar (preameloblasts)." },
  { q:"Which structure gives rise to dentin and pulp?", opts:["Dental sac","Dental papilla","Outer enamel epithelium","Stellate reticulum"], correct:1, explain:"Dental papilla differentiates into odontoblasts (dentin) and central pulp tissue." },
  { q:"Correct pairing of stage to primary physiologic process is:", opts:["Cap ‚Äì histodifferentiation only","Bell ‚Äì morphodifferentiation prominent","Bud ‚Äì apposition","Eruption ‚Äì initiation"], correct:1, explain:"During bell stage, morphodifferentiation is prominent alongside histodifferentiation." },
  { q:"Which statement about the enamel organ‚Äôs vascularity is CORRECT?", opts:["Highly vascular centrally","Avascular; relies on surrounding capillaries","Only the IEE is vascular","Becomes vascular after eruption"], correct:1, explain:"The enamel organ is avascular; nutrition diffuses from surrounding tissues." },
  { q:"Identify the CORRECT sequence just prior to enamel matrix secretion:", opts:["Odontoblasts lay dentin ‚Üí preameloblasts polarize ‚Üí ameloblasts secrete enamel","Ameloblasts secrete enamel ‚Üí odontoblasts respond ‚Üí predentin forms","OEE folds ‚Üí stellate reticulum expands ‚Üí enamel secreted","HERS forms ‚Üí enamel matrix is secreted coronally"], correct:0, explain:"Classic reciprocal induction: odontoblasts form dentin first; then ameloblasts begin enamel secretion." }
];

const tfs = [
  { q:"Morphodifferentiation during bell stage primarily sets the tooth‚Äôs final shape.", answer:true, explain:"Bell stage determines crown form via morphodifferentiation." },
  { q:"Stratum intermedium is absent during enamel formation.", answer:false, explain:"It acts with IEE and is rich in alkaline phosphatase for mineralization." },
  { q:"Stellate reticulum expands immediately before enamel formation to increase diffusion distance.", answer:false, explain:"It collapses to reduce diffusion distance to capillaries." },
  { q:"Outer enamel epithelium develops folds in late bell stage with vascular papillae between them.", answer:true, explain:"This enhances nutritional support to the avascular enamel organ." },
  { q:"Membrana preformativa later becomes the cementoenamel junction.", answer:false, explain:"It becomes the dentino‚Äëenamel junction (DEJ)." },
  { q:"Cervical loop comprises only OEE and IEE.", answer:true, explain:"By definition, cervical loop = OEE + IEE." },
  { q:"Hertwig‚Äôs epithelial root sheath derives from the cervical loop.", answer:true, explain:"HERS originates from proliferating cervical loop cells." },
  { q:"Anodontia reflects a defect in apposition.", answer:false, explain:"It reflects lack of initiation; apposition defects affect tissue deposition." },
  { q:"Dental papilla gives rise to cementum.", answer:false, explain:"Cementum arises from dental sac; papilla forms dentin and pulp." },
  { q:"Preameloblasts are tall columnar cells of the inner enamel epithelium.", answer:true, explain:"IEE cells elongate to preameloblasts before enamel formation." },
  { q:"Enamel organ is highly vascular at its center.", answer:false, explain:"It is avascular; relies on external capillaries." },
  { q:"Rests of Serres are remnants of the dental lamina.", answer:true, explain:"Yes‚Äîcontrast with rests of Malassez (HERS)." }
];

const saqs = [
  { q: "Briefly define the bell stage and its key outcome.", a: "Phase of tooth development with histo- and morphodifferentiation; crown attains definitive shape." },
  { q: "List three specialized layers present in the early bell stage and give one concise function each.", a: "1) Inner enamel epithelium ‚Äì differentiates to ameloblasts;\n2) Stratum intermedium ‚Äì supports enamel mineralization and diffusion;\n3) Stellate reticulum ‚Äì turgid network that later collapses to shorten diffusion path." },
  { q: "Contrast stratum intermedium and stellate reticulum in two points (structure & role).", a: `<table style="width:100%"><thead><tr><th>#</th><th>Stratum intermedium</th><th>Stellate reticulum</th></tr></thead><tbody><tr><td>1</td><td>2‚Äì3 squamous layers; rich in alkaline phosphatase</td><td>Star-shaped cells linked by desmosomes with extracellular fluid</td></tr><tr><td>2</td><td>Acts with IEE; regulates diffusion to ameloblasts</td><td>Expands during growth but collapses before enamel formation to reduce diffusion distance</td></tr></tbody></table>` }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
 tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
