<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  .answer th, .answer td { border: 1px solid var(--card-border); padding: 8px; text-align: left; }
  .answer th { background-color: var(--glass); }
  .answer ol, .answer ul { padding-left: 20px; }
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 6</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    { q: "What is the primitive oral cavity also known as?", opts: ["Stomodeum", "Buccopharyngeal membrane", "Foregut", "Oral ectoderm"], correct: 0, explain: "The primitive oral cavity, or stomodeum, is a key structure in early facial development." },
    { q: "When does the buccopharyngeal membrane typically rupture?", opts: ["4th week (27th day) of gestation", "6th week of gestation", "8th week of gestation", "2nd week of gestation"], correct: 0, explain: "This rupture establishes a connection between the primitive oral cavity and the foregut." },
    { q: "What is the origin of the cells that form the craniofacial skeleton and teeth?", opts: ["Cranial neural crest cells", "Vagal neural crest cells", "Trunk neural crest cells", "Sacral neural crest cells"], correct: 0, explain: "Neural crest cells are migratory and differentiate into various structures." },
    { q: "Which structure gives rise to both the dental lamina and the vestibular lamina?", opts: ["Primary epithelial band", "Oral ectoderm", "Ectomesenchyme", "Stomodeum"], correct: 0, explain: "The primary epithelial band is a horseshoe-shaped thickening in the primitive oral cavity." },
    { q: "What is the function of the vestibular lamina?", opts: ["Forms the oral vestibule", "Forms all deciduous teeth", "Forms permanent molars", "Degenerates into cell rests of Serres"], correct: 0, explain: "The oral vestibule is the space between the cheeks/lips and the teeth." },
    { q: "What are the remnants of the dental lamina found in the jaws and gingiva called?", opts: ["Cell rests of Serres", "Enamel knots", "Odontoblasts", "Ameloblasts"], correct: 0, explain: "These epithelial remnants are typically dormant but can sometimes form cysts." },
    { q: "The interaction between which two tissue types is essential for odontogenesis?", opts: ["Epithelium and mesenchyme", "Ectoderm and endoderm", "Mesoderm and ectoderm", "Neural crest and ectoderm"], correct: 0, explain: "This is known as epithelial-mesenchymal interaction." },
    { q: "The dental lamina is responsible for the formation of which teeth?", opts: ["All deciduous teeth and permanent molars", "Only deciduous teeth", "Only permanent teeth", "Only incisors and canines"], correct: 0, explain: "The successional lamina, an extension of the dental lamina, forms the other permanent teeth." },
    { q: "Which of the following is considered a morphological stage of tooth development?", opts: ["Bell stage", "Initiation", "Proliferation", "Apposition"], correct: 0, explain: "Morphological stages describe the changing shape of the developing tooth." },
    { q: "The successional lamina gives rise to which group of permanent teeth?", opts: ["Incisors, canines, and premolars", "Only molars", "All permanent teeth", "Only deciduous successors"], correct: 0, explain: "Permanent molars arise from the distal extension of the dental lamina." },
    { q: "At what stage of intrauterine life does the primary epithelial band form?", opts: ["5-6 weeks", "7 weeks", "4th week", "9 weeks"], correct: 0, explain: "This is a crucial early step in dental development." },
    { q: "What is the tissue underlying the oral ectoderm, containing neural crest cells, called?", opts: ["Ectomesenchyme", "Mesoderm", "Endoderm", "Stellate reticulum"], correct: 0, explain: "Ectomesenchyme plays a vital role in inducing tooth development." },
    { q: "The primary epithelial band divides into which two structures?", opts: ["Dental lamina and Vestibular lamina", "Enamel organ and Dental papilla", "Inner and Outer enamel epithelium", "Maxillary and Mandibular processes"], correct: 0, explain: "The dental lamina is lingual, and the vestibular lamina is buccal." },
    { q: "What is the fate of the dental lamina after tooth development is initiated?", opts: ["It starts to degenerate", "It forms the cementum", "It becomes the periodontal ligament", "It remains active throughout life"], correct: 0, explain: "Its remnants are the cell rests of Serres." },
    { q: "How many tooth buds initially appear on the dental lamina for primary teeth?", opts: ["20", "32", "10", "16"], correct: 0, explain: "This corresponds to the 20 primary (deciduous) teeth." },
    { q: "Which histophysiological stage involves the multiplication of cells?", opts: ["Proliferation", "Histodifferentiation", "Morphodifferentiation", "Initiation"], correct: 0, explain: "This stage leads to the growth of the tooth bud." },
    { q: "The term for the primitive oral cavity lined by stratified squamous epithelium is:", opts: ["Stomodeum", "Pharynx", "Oropharynx", "Cardiac bulge"], correct: 0, explain: "The lining is specifically called the oral ectoderm." },
    { q: "A persistent buccopharyngeal membrane would result in what clinical condition?", opts: ["Failure of connection between oral cavity and foregut", "Cleft lip", "Cleft palate", "Anodontia"], correct: 0, explain: "This membrane normally ruptures to connect the two cavities." },
    { q: "The dental lamina for permanent molars develops from the:", opts: ["Distal extension of the main dental lamina", "Successional lamina", "Lateral lamina", "Vestibular lamina"], correct: 0, explain: "This is why permanent molars are considered non-successional." },
    { q: "In which region does the dental lamina persist the longest?", opts: ["Third molar region", "Anterior incisor region", "Canine region", "Premolar region"], correct: 0, explain: "It can persist for up to 5 years in this area." },
    { q: "The formation of the tooth's shape and size occurs during which stage?", opts: ["Morphodifferentiation", "Histodifferentiation", "Apposition", "Proliferation"], correct: 0, explain: "This stage defines the final morphology of the crown." },
    { q: "Neural crest cells are characterized by their high capacity for:", opts: ["Migration and differentiation", "Contraction", "Secretion of enamel", "Oxygen transport"], correct: 0, explain: "These cells travel extensively to form various tissues in the head and neck." },
    { q: "The primary epithelial band appears as two horseshoe-shaped bands corresponding to the future:", opts: ["Dental arches", "Pharyngeal arches", "Nasal placodes", "Maxillary processes"], correct: 0, explain: "One band forms in the maxilla and one in the mandible." },
    { q: "After a primary tooth reaches the bell stage, its connection to the dental lamina is known as the:", opts: ["Lateral lamina", "Successional lamina", "General lamina", "Distal extension"], correct: 0, explain: "This describes its position relative to the developing successional lamina." },
    { q: "Which of the following is NOT a derivative of the primary epithelial band?", opts: ["Tongue muscles", "Dental lamina", "Vestibular lamina", "Deciduous teeth"], correct: 0, explain: "The tongue develops from the pharyngeal arches, not the primary epithelial band." },
    { q: "The deposition of the dental hard tissues (enamel and dentin) is known as:", opts: ["Apposition", "Initiation", "Calcification", "Eruption"], correct: 0, explain: "This is the final histophysiological stage before root formation." },
    { q: "What is the correct sequence of morphological stages in tooth development?", opts: ["Dental Lamina, Bud, Cap, Bell", "Bud, Cap, Bell, Dental Lamina", "Initiation, Proliferation, Histodifferentiation, Apposition", "Cap, Bud, Bell, Dental Lamina"], correct: 0, explain: "This sequence reflects the increasing complexity of the enamel organ's shape." },
    { q: "The oral ectoderm is composed of how many layers at 5-6 weeks I.U.?", opts: ["2-3 layers", "1 layer", "4-5 layers", "More than 5 layers"], correct: 0, explain: "It consists of a basal columnar layer and superficial flat cells." },
    { q: "The cells of the dental lamina are epithelial in origin, derived from the:", opts: ["Oral ectoderm", "Ectomesenchyme", "Neural crest", "Endoderm"], correct: 0, explain: "The oral ectoderm is the epithelial lining of the primitive mouth." },
    { q: "Pathologies like cysts or tumors can arise from which dormant structures?", opts: ["Cell rests of Serres", "Odontoblasts", "Stellate reticulum", "Cementoblasts"], correct: 0, explain: "These epithelial remnants have the potential to proliferate under certain stimuli." }
];

const tfs = [
    { q: "The primitive oral cavity is lined by endoderm.", answer: false, explain: "It's lined by oral ectoderm, which is a type of stratified squamous epithelium." },
    { q: "Epithelial-mesenchymal interaction is not required for tooth development.", answer: false, explain: "It is an essential and fundamental process for odontogenesis." },
    { q: "The vestibular lamina is located lingually to the dental lamina.", answer: false, explain: "It is located buccally (towards the cheek/lip) to the dental lamina." },
    { q: "All permanent teeth are successional.", answer: false, explain: "Permanent molars are not successional; they arise from the distal extension of the dental lamina." },
    { q: "The successional lamina forms the permanent molars.", answer: false, explain: "It forms the permanent incisors, canines, and premolars. Molars have a different origin." },
    { q: "Neural crest cells contribute to the formation of odontoblasts.", answer: true, explain: "Odontoblasts, which form dentin, differentiate from the ectomesenchymal cells derived from the neural crest." },
    { q: "The primary epithelial band divides into the dental lamina and the successional lamina.", answer: false, explain: "It divides into the dental lamina and the vestibular lamina." },
    { q: "The dental lamina completely disappears after tooth formation.", answer: false, explain: "It degenerates but leaves behind remnants called the cell rests of Serres." },
    { q: "The first stage of tooth development according to morphology is the Bud Stage.", answer: false, explain: "The first morphological stage is the Dental Lamina stage, which precedes the Bud Stage." }
];

const saqs = [
    { q: "Describe the process of epithelial-mesenchymal interaction in odontogenesis.", a: "It is a series of programmed, sequential, and reciprocal communications between the oral epithelium (ectoderm) and the underlying ectomesenchyme. This interaction is essential for initiating and guiding the development of teeth, leading to the differentiation of both cell populations into specific tooth structures like enamel and dentin." },
    { q: "List the five histophysiological stages of tooth development.", a: "<ol><li>Initiation</li><li>Proliferation</li><li>Histo-differentiation</li><li>Morpho-differentiation</li><li>Apposition</li></ol>" },
    { q: "Compare the derivatives of the Dental Lamina and the Vestibular Lamina.", a: "<table><thead><tr><th>Feature</th><th>Dental Lamina</th><th>Vestibular Lamina</th></tr></thead><tbody><tr><td>1. Primary Function</td><td>Gives rise to all teeth</td><td>Forms the oral vestibule</td></tr><tr><td>2. Derivatives</td><td>All deciduous teeth, permanent incisors, canines, premolars (via successional lamina), and permanent molars (via distal extension)</td><td>The groove/space between the lips/cheeks and the alveolar process</td></tr><tr><td>3. Fate</td><td>Degenerates, leaving behind epithelial remnants (cell rests of Serres)</td><td>Its central cells degenerate to create a cleft, forming the vestibule</td></tr></tbody></table>" },
    { q: "A 10-year-old patient presents with a developing cyst in the mandible, posterior to their second molar. Histological examination reveals the cyst lining is composed of epithelial cells. What is the most likely origin of these cells?", a: "The epithelial cells most likely originate from the cell rests of Serres, which are remnants of the dental lamina that persisted in the jaw after tooth development was complete. Specifically, remnants of the distal extension of the dental lamina that forms the permanent molars could be the source." },
    { q: "What is the stomodeum, and what important event happens to its posterior boundary during the 4th week of development?", a: "The stomodeum is the primitive oral cavity, lined by oral ectoderm. During the 4th week of gestation (around day 27), the buccopharyngeal membrane, which forms its posterior boundary and separates it from the foregut, ruptures. This establishes a connection between the oral cavity and the developing digestive tract." },
    { q: "List the four morphological stages of tooth development.", a: "<ol><li>Dental Lamina Stage</li><li>Bud Stage</li><li>Cap Stage</li><li>Bell Stage (Early and Late)</li></ol>" }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  if (!confirm("Are you sure you want to reset all progress?")) {
    return;
  }
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
