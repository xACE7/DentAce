<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);} 
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 7</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled from OCIH 7.pdf: Development of Tooth, Part II) -----------
const mcqs = [
  {
    q:"Which pairing correctly matches the two ways tooth development stages are classified?",
    opts:["Morphological & Physiochemical","Morphological & Histophysiological","Embryological & Functional","Chronological & Physiological"],
    correct:1,
    explain:"Stages are described by morphological changes and by histophysiological (initiation‚Üíapposition) processes."
  },
  {
    q:"Arrange the morphological stages in the correct early-to-late order.",
    opts:["Dental lamina ‚Üí Bell ‚Üí Cap ‚Üí Bud","Dental lamina ‚Üí Bud ‚Üí Cap ‚Üí Early Bell ‚Üí Advanced Bell ‚Üí Matrix formation","Bud ‚Üí Cap ‚Üí Dental lamina ‚Üí Bell","Dental lamina ‚Üí Cap ‚Üí Bud ‚Üí Bell"],
    correct:1,
    explain:"Sequence: Dental lamina ‚Üí Bud ‚Üí Cap ‚Üí Early Bell ‚Üí Advanced Bell ‚Üí enamel/dentin matrix formation."
  },
  {
    q:"Which list best represents the histophysiological stages?",
    opts:["Initiation, Proliferation, Histodifferentiation, Morphodifferentiation, Apposition","Induction, Proliferation, Calcification, Eruption, Attrition","Initiation, Calcification, Maturation, Eruption, Apposition","Proliferation, Induction, Maturation, Resorption, Eruption"],
    correct:0,
    explain:"Physiological stages given: initiation ‚Üí proliferation ‚Üí histodifferentiation ‚Üí morphodifferentiation ‚Üí apposition."
  },
  {
    q:"At 5‚Äì6 weeks intrauterine (W.I.U.), the primitive oral cavity is lined by which epithelium?",
    opts:["Endoderm, single cuboidal layer","Ectoderm, 2‚Äì3 layers: basal columnar and superficial flat cells","Mesoderm, stratified squamous","Neural crest‚Äìderived ectoderm, keratinized"],
    correct:1,
    explain:"The stomodeum is lined by ectoderm composed of basal columnar and superficial flat cells separated from mesoderm by basement membrane."
  },
  {
    q:"The primary epithelial band gives rise directly to which structure during early tooth development?",
    opts:["Dental papilla","Dental lamina","Stellate reticulum","Reduced enamel epithelium"],
    correct:1,
    explain:"Primary epithelial bands (around 6 W.I.U.) form the dental lamina."
  },
  {
    q:"How many epithelial outgrowths arise from the anterior dental lamina to form the bases of deciduous teeth?",
    opts:["20 in each arch","10 in upper and 10 in lower","16 total","8 in upper and 12 in lower"],
    correct:1,
    explain:"A series of 10 outgrowths in the maxilla and 10 in the mandible correspond to future deciduous teeth."
  },
  {
    q:"Each epithelial outgrowth from the dental lamina represents the beginning of which structure?",
    opts:["Stratum intermedium","Enamel organ of a deciduous tooth","Hertwig's epithelial root sheath","Reduced enamel epithelium"],
    correct:1,
    explain:"Each growth represents the start of the enamel organ of a deciduous tooth."
  },
  {
    q:"Condensation of ectomesenchyme beneath the enamel organ during the bud stage forms which structure?",
    opts:["Dental sac (follicle)","Dental papilla","Alveolar bone proper","Stratum intermedium"],
    correct:1,
    explain:"Condensed ectomesenchyme directly under the enamel organ ‚Üí dental papilla; the tissue encircling both forms the dental sac."
  },
  {
    q:"Which combination defines the tooth germ?",
    opts:["Enamel organ + Dental papilla","Dental papilla + Dental sac","Enamel organ + Dental sac","Enamel organ + Dental papilla + Dental sac"],
    correct:3,
    explain:"Tooth germ = enamel organ + dental papilla + dental sac (follicle)."
  },
  {
    q:"In the cap stage, histodifferentiation begins and the enamel organ shows early differentiation into which components?",
    opts:["OEE, IEE, Stellate reticulum","REE, SI, OEE","HERS, SI, OEE","SI, REE, HERS"],
    correct:0,
    explain:"Peripheral cells differentiate into Outer Enamel Epithelium (OEE) and Inner Enamel Epithelium (IEE); central cells become stellate reticulum."
  },
  {
    q:"What cellular change produces the stellate reticulum?",
    opts:["IEE apoptosis forming spaces","Deposition of enamel proteins between IEE cells","Central polygonal cells secrete hydrophilic GAGs drawing water and stretching cells into star shapes","Fusion of OEE and IEE at the cervical loop"],
    correct:2,
    explain:"Central cells synthesize hydrophilic glycosaminoglycans; water influx stretches cells into star-shaped network."
  },
  {
    q:"Which cell layer covers the convexity of the cap-shaped enamel organ?",
    opts:["Inner enamel epithelium (low columnar)","Outer enamel epithelium (cuboidal)","Stratum intermedium","Reduced enamel epithelium"],
    correct:1,
    explain:"OEE is cuboidal and covers the convex outer surface; IEE (low columnar) lines the concavity."
  },
  {
    q:"Which statement about the enamel knot and enamel cord is MOST accurate?",
    opts:["They are permanent nutritive canals","They are transient and help position the initial cusp","They form the future root sheath","They induce odontoblasts to secrete dentin directly"],
    correct:1,
    explain:"Enamel knot (central IEE condensation) and enamel cord (strand toward OEE) are transient and implicated in early cusp patterning."
  },
  {
    q:"Morphodifferentiation primarily determines which tooth characteristics?",
    opts:["Tissue mineral content","Shape and size of teeth","Timing of eruption","Number of roots"],
    correct:1,
    explain:"Morphodifferentiation governs crown shape and overall tooth size."
  },
  {
    q:"Which is TRUE of the bud stage?",
    opts:["IEE and OEE are well-defined","The enamel organ resembles a small bud arising from dental lamina","Stellate reticulum is abundant","HERS forms"],
    correct:1,
    explain:"Bud stage: proliferation creates rounded epithelial bud (early enamel organ) into ectomesenchyme."
  },
  {
    q:"During the cap stage, the connection to the dental lamina is typically:",
    opts:["Absent","Long and narrow","Short and broad","Replaced by the successional lamina"],
    correct:2,
    explain:"Cap stage shows a cap-shaped enamel organ with a short, broad connection to the dental lamina."
  },
  {
    q:"Which pairing is INCORRECT?",
    opts:["Initiation ‚Üí dental lamina formation","Proliferation ‚Üí bud and cap growth","Histodifferentiation ‚Üí ameloblast/odontoblast lineage commitment","Apposition ‚Üí morphologic shaping of crown"],
    correct:3,
    explain:"Apposition refers to matrix deposition (enamel/dentin), not shaping; shape is morphodifferentiation."
  },
  {
    q:"Which layer gives a cushion-like consistency to the enamel organ?",
    opts:["Stratum intermedium","Stellate reticulum","Outer enamel epithelium","Dental follicle"],
    correct:1,
    explain:"The stellate reticulum forms a star-shaped cellular network imparting cushion-like consistency."
  },
  {
    q:"Central cells becoming stellate reticulum primarily originate from:",
    opts:["Mesenchyme of the dental papilla","Inner enamel epithelium","Outer enamel epithelium","Central ectodermal cells of the enamel organ"],
    correct:3,
    explain:"They are central ectodermal cells within the enamel organ that secrete GAGs and stretch into stellate cells."
  },
  {
    q:"Which event FIRST signals histodifferentiation during cap stage?",
    opts:["Appearance of HERS","Segregation of IEE and OEE at periphery","Deposition of enamel matrix","Fusion of oral epithelium and REE"],
    correct:1,
    explain:"Peripheral cells differentiate into OEE and IEE‚Äîan early histodifferentiation event in the cap stage."
  },
  {
    q:"The tissue that encircles both enamel organ and dental papilla is termed:",
    opts:["Dental sac (follicle)","Alveolar crypt","Periodontal ligament","Reduced enamel epithelium"],
    correct:0,
    explain:"Encircling ectomesenchyme is the dental sac/follicle, future PDL, cementum, and alveolar bone contributors."
  },
  {
    q:"Which best describes the inner enamel epithelium (IEE) during cap stage?",
    opts:["Cuboidal cells covering convex surface","Low columnar cells lining the concavity","Spindle-shaped fibroblasts within papilla","Acellular mineralized layer"],
    correct:1,
    explain:"IEE lines the concave surface and is low columnar at this stage."
  },
  {
    q:"Which structure is most directly implicated in patterning the FIRST cusp tip?",
    opts:["Enamel knot","Cervical loop","Stratum intermedium","Dental lamina remnant"],
    correct:0,
    explain:"The enamel knot is a transient signaling center associated with initial cusp position."
  },
  {
    q:"Which of the following is NOT a morphological stage listed in the lecture?",
    opts:["Bud","Cap","Bell (early & advanced)","Eruption"],
    correct:3,
    explain:"Eruption is not listed among morphological stages in this lecture segment."
  },
  {
    q:"What is the principal role of glycosaminoglycans in the cap-stage enamel organ?",
    opts:["Chelate calcium for mineralization","Bind water to expand extracellular space","Inhibit odontoblast differentiation","Signal HERS formation"],
    correct:1,
    explain:"Hydrophilic GAGs pull water into the organ, stretching central cells into a stellate network."
  },
  {
    q:"Which statement about the dental lamina is TRUE?",
    opts:["It is mesenchymal in origin","It arises from primary epithelial bands and invaginates into ectomesenchyme","It forms Hertwig's sheath","It differentiates into odontoblasts"],
    correct:1,
    explain:"Dental lamina is epithelial (ectodermal) from the primary epithelial band and grows into ectomesenchyme."
  },
  {
    q:"Which structure later contributes to the periodontium (PDL, cementum, alveolar bone)?",
    opts:["Dental papilla","Enamel organ","Dental sac (follicle)","Stratum intermedium"],
    correct:2,
    explain:"Dental follicle is the source of many periodontal tissues."
  },
  {
    q:"During which stage is the shape of the crown most definitively established?",
    opts:["Bud","Cap","Early to Advanced Bell","Apposition"],
    correct:2,
    explain:"Crown morphogenesis finalizes through bell stage (morphodifferentiation)."
  },
  {
    q:"Which of the following appears FIRST in the sequence of events?",
    opts:["Apposition of enamel and dentin matrix","Advanced Bell stage","Cap stage","Bud stage"],
    correct:3,
    explain:"Sequence: Dental lamina ‚Üí Bud ‚Üí Cap ‚Üí Bell ‚Üí Matrix apposition."
  },
  {
    q:"What best explains the ‚Äòshort and broad‚Äô connection to the dental lamina noted in the lecture?",
    opts:["Rapid apoptosis of successional lamina","Differential growth at cervical loop in cap stage","Fusion of OEE with oral epithelium","Early eruption pathway formation"],
    correct:1,
    explain:"Differential growth during cap stage enlarges the organ and leaves a short, broad stalk to the dental lamina."
  },
  {
    q:"Which combination is CORRECT for the cap-stage cell shapes?",
    opts:["OEE‚Äîlow columnar; IEE‚Äîcuboidal; SR‚Äîflat","OEE‚Äîcuboidal; IEE‚Äîlow columnar; SR‚Äîstellate network","OEE‚Äîsquamous; IEE‚Äîpseudostratified; SR‚Äîcolumnar","OEE‚Äîtransitional; IEE‚Äîspindle; SR‚Äîreticular fibers"],
    correct:1,
    explain:"Cap stage: OEE cuboidal, IEE low columnar, central stellate reticulum."
  }
];

const tfs = [
  { q:"Morphodifferentiation determines mainly the shape and size of teeth.", answer:true, explain:"That is the defining role listed for morphodifferentiation." },
  { q:"Histodifferentiation begins in the bell stage only, after the cap stage is complete.", answer:false, explain:"It starts in the cap stage with differentiation into OEE and IEE." },
  { q:"At 5‚Äì6 W.I.U., the oral cavity is lined by endoderm.", answer:false, explain:"It is lined by ectoderm (2‚Äì3 layers)." },
  { q:"Each epithelial outgrowth from the dental lamina initiates an enamel organ of a deciduous tooth.", answer:true, explain:"Exactly as stated in the lecture." },
  { q:"The dental papilla is ectomesenchyme condensed beneath the enamel organ.", answer:true, explain:"Yes‚Äîcondensed ectomesenchyme directly under the enamel organ." },
  { q:"The dental sac encircles both enamel organ and dental papilla.", answer:true, explain:"That ring of ectomesenchyme is termed the dental sac/follicle." },
  { q:"The enamel knot and enamel cord are permanent conduits for nutrition.", answer:false, explain:"They are transient and related to cusp positioning." },
  { q:"Stellate reticulum forms because central enamel-organ cells secrete hydrophilic GAGs that draw in water.", answer:true, explain:"Water influx stretches the cells into star shapes." },
  { q:"OEE lines the concavity of the cap-shaped enamel organ.", answer:false, explain:"IEE lines the concavity; OEE covers the convexity." },
  { q:"Apposition refers to matrix deposition of enamel and dentin.", answer:true, explain:"Apposition = matrix formation, not shaping." },
  { q:"Twenty epithelial outgrowths form anteriorly: 10 in maxilla and 10 in mandible.", answer:true, explain:"That number corresponds to future deciduous teeth." },
  { q:"Eruption is listed among the morphological stages in this lecture.", answer:false, explain:"Morphological stages listed were lamina, bud, cap, bell, matrix formation." }
];

const saqs = [
  { 
    q: "Briefly define the tooth germ.", 
    a: "Composite of enamel organ + dental papilla + dental sac (follicle)." 
  },
  { 
    q: "List the histophysiological stages of tooth development (in order).", 
    a: "1) Initiation  2) Proliferation  3) Histodifferentiation  4) Morphodifferentiation  5) Apposition" 
  },
  { 
    q: "Compare OEE vs IEE during the cap stage (cell shape & location) in a tiny table.", 
    a: `<table style="width:100%;border-collapse:collapse">
          <tr><th style="text-align:left;border-bottom:1px solid rgba(255,255,255,.2)">#</th><th style="text-align:left;border-bottom:1px solid rgba(255,255,255,.2)">OEE</th><th style="text-align:left;border-bottom:1px solid rgba(255,255,255,.2)">IEE</th></tr>
          <tr><td>1</td><td>Cuboidal cells</td><td>Low columnar cells</td></tr>
          <tr><td>2</td><td>Covers convex outer surface</td><td>Lines concavity of enamel organ</td></tr>
          <tr><td>3</td><td>Peripheral layer</td><td>Peripheral layer opposite to OEE</td></tr>
        </table>` 
  }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
