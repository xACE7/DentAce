<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{border:1px solid var(--card-border);padding:8px 10px;text-align:left;}
  th{background:var(--glass);}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 2</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    { q: "What is the primary function of myoepithelial cells in salivary glands?", opts: ["To produce mucous secretion", "To contract and expel secretory products", "To form the basement membrane", "To modify the primary saliva"], correct: 1, explain: "Myoepithelial (basket) cells contain actin and myosin, allowing them to contract and squeeze secretions from the acini into the duct system." },
    { q: "Which major salivary gland is characterized by being purely serous?", opts: ["Sublingual Gland", "Submandibular Gland", "Parotid Gland", "Minor Salivary Glands"], correct: 2, explain: "The Parotid gland is composed entirely of serous acini, which produce a thin, watery secretion rich in enzymes." },
    { q: "During embryonic development, which part of the epithelial invagination forms the excretory duct?", opts: ["The distal part", "The central part", "The proximal part", "The ectomesenchyme"], correct: 2, explain: "The proximal part of the invagination remains connected to the surface epithelium and develops into the duct system." },
    { q: "What is the characteristic shape of the nucleus in a mucous acinar cell?", opts: ["Round and centrally located", "Oval and apical", "Spindle-shaped", "Flattened and basal in position"], correct: 3, explain: "Mucous cells are filled with mucigen droplets which push the nucleus, causing it to be flattened against the basal membrane of the cell." },
    { q: "A 'serous demilune' is a structure where:", opts: ["Serous and mucous cells mix randomly", "A mucous acinus is capped by serous cells", "A serous acinus is capped by mucous cells", "A tubular gland terminates in a flask shape"], correct: 1, explain: "A serous demilune (or 'half-moon') consists of serous cells forming a cap over a mucous acinus, with their secretions reaching the lumen via intercellular canaliculi." },
    { q: "Which type of duct is lined with simple cubical epithelium and is located immediately after the acinus?", opts: ["Striated duct", "Interlobular duct", "Intercalated duct", "Main excretory duct"], correct: 2, explain: "Intercalated ducts are the smallest ducts, leading directly from the acini, and are lined by simple cubical epithelium." },
    { q: "The parotid gland begins its development during which week of gestation?", opts: ["6th week", "8th week", "4th week", "10th week"], correct: 2, explain: "The parotid is the first major salivary gland to develop, initiating at the 4th week of embryonic life." },
    { q: "Which of the following best describes the secretion from a serous acinus?", opts: ["Thick, viscous, and rich in carbohydrates", "Thin, watery, and rich in proteins/enzymes", "A balanced mix of mucous and serous fluid", "Hormonal in nature"], correct: 1, explain: "Serous acini secrete a thin, watery fluid containing proteins like amylase. Mucous acini produce a thick, viscous secretion." },
    { q: "Striated ducts are named for their appearance, which is caused by:", opts: ["Abundant secretory granules", "Numerous cilia on the apical surface", "Basal infoldings of the cell membrane with aligned mitochondria", "A thick layer of myoepithelial cells"], correct: 2, explain: "The 'striations' are due to extensive basal membrane infoldings and numerous elongated mitochondria, which are involved in ion transport to modify saliva." },
    { q: "The sublingual gland is histologically distinct because it predominantly contains:", opts: ["Serous acini", "Mucous acini and serous demilunes", "A perfect 50/50 mix of serous and mucous acini", "Only striated ducts"], correct: 1, explain: "The sublingual gland is a mixed gland, but it is dominated by mucous acini, with some having serous demilunes. It contains no purely serous acini." },
    { q: "What is the correct developmental sequence for the major salivary glands?", opts: ["Sublingual, Submandibular, Parotid", "Parotid, Submandibular, Sublingual", "Submandibular, Parotid, Sublingual", "Parotid, Sublingual, Submandibular"], correct: 1, explain: "Development starts with the Parotid (4th week), followed by the Submandibular (6th week), and finally the Sublingual (8th week)." },
    { q: "The functional unit of a salivary gland, responsible for secretion, is called the:", opts: ["Lobule", "Stroma", "Secretory end piece (Acinus)", "Trabeculae"], correct: 2, explain: "The secretory end piece, also known as the acinus or tubule, is the group of specialized cells that produce the primary saliva." },
    { q: "What happens to the central cells of the epithelial cord during gland development to form the ductal system?", opts: ["They differentiate into myoepithelial cells", "They proliferate rapidly to lengthen the cord", "They undergo degeneration to form a lumen", "They migrate to form the surrounding connective tissue"], correct: 2, explain: "After the epithelial cord branches, the central cells degenerate through apoptosis to hollow out the cord and form the lumen of the ducts." },
    { q: "In a Hematoxylin and Eosin (H&E) stain, how do mucous acini typically appear?", opts: ["Deeply basophilic (purple) with round nuclei", "Strongly eosinophilic (pink) and granular", "Pale and lightly stained with flattened basal nuclei", "Dark purple with prominent striations"], correct: 2, explain: "The mucin in mucous acini does not stain well with H&E, causing the cytoplasm to appear clear or pale. The nucleus is flattened at the base." },
    { q: "The main excretory duct of a salivary gland has what type of epithelium near its opening into the oral cavity?", opts: ["Simple cuboidal", "Pseudostratified columnar", "Simple squamous", "Stratified squamous"], correct: 3, explain: "The epithelium transitions as it approaches the oral cavity, ultimately becoming stratified squamous to blend with the oral mucosa." },
    { q: "Which structure is NOT considered part of the intralobular duct system?", opts: ["Acinus", "Intercalated duct", "Striated duct", "Interlobular (excretory) duct"], correct: 3, explain: "Interlobular ducts are located in the connective tissue septa between lobules, not within them. Intercalated and striated ducts are intralobular." },
    { q: "What is the origin of the secretory cells that form a gland?", opts: ["Connective tissue", "Nervous tissue", "Surface epithelium", "Muscle tissue"], correct: 2, explain: "Glands are formed by the invagination of surface epithelium into the underlying connective tissue." },
    { q: "The submandibular gland in humans is best classified as a:", opts: ["Purely serous gland", "Purely mucous gland", "Seromucous gland (predominantly serous)", "Seromucous gland (predominantly mucous)"], correct: 2, explain: "It's a mixed seromucous gland, but in humans, about 90% of the acini are serous, making it predominantly serous." },
    { q: "Intercellular canaliculi are features found between cells of which acini type?", opts: ["They are not found in acini", "Mucous acini", "Serous acini", "Both serous and mucous acini"], correct: 2, explain: "Serous acinar cells have small channels called intercellular canaliculi between them to facilitate the flow of secretions into the central lumen." },
    { q: "A histological slide of a salivary gland shows numerous adipocytes (fat cells), a well-developed capsule, and only serous acini. Which gland is it?", opts: ["Sublingual", "Submandibular", "Parotid", "Von Ebner's gland"], correct: 2, explain: "These three features—abundant fat, a thick capsule, and purely serous acini—are classic identifying characteristics of the parotid gland." },
    { q: "The term 'acinus' refers to a secretory end piece with what shape?", opts: ["Cylindrical or tubular", "Flat and sheet-like", "Flask or berry-shaped", "Star-shaped"], correct: 2, explain: "An acinus is a flask-shaped or berry-shaped cluster of secretory cells, whereas a tubular gland has a cylindrical shape." },
    { q: "The secretion of salivary glands is modulated by:", opts: ["Blood pressure only", "Nervous and hormonal influences", "Temperature of ingested food", "Mechanical pressure from chewing only"], correct: 1, explain: "The autonomic nervous system (sympathetic and parasympathetic) and, to a lesser extent, hormones regulate both the volume and composition of saliva." },
    { q: "Which duct forms the largest portion of the duct system by volume?", opts: ["Intercalated ducts", "Striated ducts", "Excretory ducts", "Main duct"], correct: 1, explain: "Striated ducts are a major component of the intralobular duct system and are responsible for significant modification of saliva." },
    { q: "What is the primary component of the secretory granules found in serous cells?", opts: ["Mucinogen", "Zymogen (inactive enzymes)", "Glycogen", "Lipids"], correct: 1, explain: "Serous cells produce proteins, which are stored as zymogen granules (e.g., precursors to amylase) in the apical cytoplasm before secretion." },
    { q: "The connective tissue component of the gland, including the capsule and septa, is referred to as the:", opts: ["Parenchyma", "Stroma", "Acinus", "Duct system"], correct: 1, explain: "The stroma is the supportive framework of an organ, consisting of connective tissue, while the parenchyma is the functional tissue (acini and ducts)." },
    { q: "Which duct type transitions from columnar to pseudostratified columnar epithelium?", opts: ["Striated to Interlobular", "Intercalated to Striated", "Interlobular to Interlobar", "Acinus to Intercalated"], correct: 2, explain: "As ducts merge and get larger, the epithelium becomes more complex. Interlobular ducts (columnar) merge to form interlobar ducts (pseudostratified columnar)." },
    { q: "Myoepithelial cells are located between the secretory cells and the:", opts: ["Lumen", "Connective tissue", "Basement membrane", "Striated duct"], correct: 2, explain: "Their strategic position between the secretory acinar cells and the basement membrane allows them to effectively squeeze the acinus upon contraction." },
    { q: "Which gland has the smallest and least developed duct system, with few striated ducts?", opts: ["Parotid", "Submandibular", "Sublingual", "Pancreas"], correct: 2, explain: "The sublingual gland's duct system is less extensive than the other major glands, and its intercalated and striated ducts are short and difficult to identify." },
    { q: "The formation of a lumen in the developing salivary gland is an example of what cellular process?", opts: ["Hyperplasia", "Metaplasia", "Apoptosis", "Hypertrophy"], correct: 2, explain: "The central cells of the epithelial cord undergo programmed cell death, or apoptosis, to create a hollow tube that becomes the duct lumen." },
    { q: "What are the three main histological components of a salivary gland?", opts: ["Serous acini, Mucous acini, and Mixed acini", "Capsule, Lobules, and Septa", "Acini, Duct System, and Myoepithelial cells", "Intralobular, Interlobular, and Excretory ducts"], correct: 2, explain: "The gland is fundamentally composed of the secretory units (acini), the transport system (ducts), and the contractile cells that aid secretion (myoepithelial cells)." }
];

const tfs = [
    { q: "The distal part of the developing epithelial cord differentiates into the secretory cells of the acinus.", answer: true, explain: "The distal, or deepest, part of the invagination forms the functional secretory end piece, while the proximal part forms the duct." },
    { q: "Myoepithelial cells are derived from connective tissue and are also called 'basket cells'.", answer: false, explain: "While they are called 'basket cells,' myoepithelial cells are epithelial in origin, not derived from connective tissue." },
    { q: "The submandibular gland begins its development before the parotid gland.", answer: false, explain: "The parotid gland is the first to develop at 4 weeks, followed by the submandibular gland at 6 weeks." },
    { q: "Serous acini have a larger diameter and wider lumen compared to mucous acini.", answer: false, explain: "Mucous acini are generally larger and have a wider, more prominent lumen than the smaller, more compact serous acini." },
    { q: "Both intercalated and striated ducts are classified as intralobular ducts.", answer: true, explain: "These ducts are located within the gland's lobules. Interlobular ducts are found in the connective tissue septa between lobules." },
    { q: "The sublingual gland contains a significant number of purely serous acini.", answer: false, explain: "A key feature of the sublingual gland is the complete absence of purely serous acini; it is predominantly mucous and mucoserous." },
    { q: "Striated ducts are so named because of their function in secreting zymogen granules.", answer: false, explain: "The striations are due to basal membrane infoldings and mitochondria related to ion transport, not secretion of zymogen granules." },
    { q: "A serous demilune's secretion passes through canaliculi between mucous cells to reach the lumen.", answer: true, explain: "The serous cells of the demilune are offset from the main lumen and require small channels (canaliculi) to deliver their secretion." },
    { q: "The main excretory duct of a salivary gland is lined with simple cuboidal epithelium throughout its length.", answer: false, explain: "The epithelium of the duct system becomes more complex as it approaches the oral cavity, transitioning from columnar to stratified squamous." }
];

const saqs = [
    { q: "Define what a gland is based on its embryological origin and cellular composition.", a: "A gland is an organ of secretion made up of specialized secretory cells. These cells are derived from the surface epithelium, which invaginates into the underlying connective tissue. The gland maintains a connection to this surface via a duct." },
    { q: "List the five types of ducts in the salivary gland duct system, in order from the acinus to the oral cavity.", a: `
        <ol>
            <li><b>Intercalated duct:</b> Leads directly from the acinus.</li>
            <li><b>Striated (Intralobular) duct:</b> Follows the intercalated duct.</li>
            <li><b>Interlobular (Excretory) duct:</b> Located in the septa between lobules.</li>
            <li><b>Interlobar duct:</b> Formed by the joining of interlobular ducts.</li>
            <li><b>Main duct:</b> The final duct that opens into the oral cavity.</li>
        </ol>
    `},
    { q: "Present a comparison of three key histological features between serous acini and mucous acini.", a: `
        <table>
            <thead>
                <tr>
                    <th>Feature</th>
                    <th>Serous Acinus</th>
                    <th>Mucous Acinus</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><b>Nucleus Shape & Position</b></td>
                    <td>Round, located near the center</td>
                    <td>Flat, pressed against the basal membrane</td>
                </tr>
                <tr>
                    <td><b>Secretion Consistency</b></td>
                    <td>Thin and watery (protein-rich)</td>
                    <td>Thick and viscous (carbohydrate-rich)</td>
                </tr>
                <tr>
                    <td><b>Staining with H&E</b></td>
                    <td>Deeply stained (basophilic cytoplasm)</td>
                    <td>Lightly stained (pale or clear cytoplasm)</td>
                </tr>
            </tbody>
        </table>
    `},
    { q: "Describe the location and function of myoepithelial cells within a salivary gland.", a: "Myoepithelial cells, also known as basket cells, are star-shaped contractile cells. They are located between the basement membrane and the secretory cells of the acini (and parts of the intercalated ducts). They contain contractile filaments (actin and myosin), and their primary function is to contract and squeeze the acinus, helping to expel the saliva into the duct system." },
    { q: "A biopsy from a major salivary gland reveals that it is a mixed gland, but roughly 90% of the acini are serous, with the remaining 10% being mucous or mucoserous. Based on this histology, which major salivary gland is the most likely source of the sample?", a: "This is most likely the <b>Submandibular Gland</b>. While it is a mixed seromucous gland, in humans it is characterized by having a large predominance of serous acini (around 90%) compared to mucous acini." },
    { q: "Explain the process of salivary gland development, starting from the oral epithelium and mentioning the fate of the proximal and distal parts.", a: "Salivary glands develop as a solid cord of epithelial cells that invaginates (grows down) from the oral epithelium into the underlying ectomesenchyme. This cord then branches repeatedly. The <b>distal parts</b> of these branches differentiate into the secretory end pieces (acini). The <b>proximal parts</b> of the cord form the duct system. Later, the central cells of this solid cord undergo apoptosis (programmed cell death) to form a hollow lumen, creating the functional ducts." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      const originalSelection = visualToOriginal[v];
      state.mcq[idx] = originalSelection;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s, v, i) => {
    if (v === null) return s;
    return s + (mcqs[i].correct === v ? 1 : 0);
  }, 0);

  const tfScore = state.tf.reduce((s, v, i) => {
    if (v === null) return s;
    return s + (tfs[i].answer === v ? 1 : 0);
  }, 0);

  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
