<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 10</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (from lecture) -----------
const mcqs = [
  {
    q:"When does root development begin?",
    opts:[
      "At initiation of enamel organ",
      "Once enamel and dentin reach the future CEJ",
      "Only after tooth eruption",
      "Before crown mineralization"
    ],
    correct:1,
    explain:"Root formation starts when enamel and dentin formation reach the future cemento-enamel junction (CEJ)."
  },
  {
    q:"Hertwig’s Epithelial Root Sheath (HERS) arises from proliferation of which layers?",
    opts:[
      "Inner and outer enamel epithelium from the cervical loop",
      "Stratum intermedium and stellate reticulum",
      "Reduced enamel epithelium",
      "Dental follicle"
    ],
    correct:0,
    explain:"IEE and OEE proliferate from the cervical loop to form a double epithelial membrane (HERS)."
  },
  {
    q:"Which is NOT a function of HERS?",
    opts:[
      "Shapes the root",
      "Induces root dentin formation",
      "Forms enamel pearls directly",
      "Helps establish apical foramen via epithelial diaphragm"
    ],
    correct:2,
    explain:"HERS shapes the root and induces odontoblast differentiation; enamel pearls occur if HERS remnants differentiate into ameloblasts abnormally."
  },
  {
    q:"The epithelial diaphragm is best described as:",
    opts:[
      "A fold of REE sealing the crown pre-eruption",
      "An obtuse bend of HERS at the future CEJ narrowing the apical foramen",
      "A ligament at the apex",
      "The fusion line of dental lamina"
    ],
    correct:1,
    explain:"HERS bends at an obtuse angle at the CEJ to form the epithelial diaphragm, causing primary narrowing of the apical foramen."
  },
  {
    q:"Correct sequence for single-rooted tooth development:",
    opts:[
      "HERS → odontoblasts → dentin → HERS disintegration → cementoblasts",
      "Odontoblasts → HERS → dentin → cementoblasts → disintegration",
      "Dentin → cementoblasts → HERS → odontoblasts",
      "Cementoblasts → HERS → dentin → odontoblasts"
    ],
    correct:0,
    explain:"Cervical loop proliferates to HERS, which induces odontoblasts and dentin; HERS then disintegrates, allowing cementoblast differentiation."
  },
  {
    q:"Rests of Malassez are located primarily in the:",
    opts:[
      "Dental papilla",
      "Periodontal ligament",
      "Enamel",
      "Pulp chamber"
    ],
    correct:1,
    explain:"After HERS disintegration, epithelial cell rests of Malassez persist in the PDL throughout life."
  },
  {
    q:"Which event allows cementoblast differentiation?",
    opts:[
      "Persistence of intact HERS over dentin",
      "Contact of formed root dentin with the dental follicle",
      "Ameloblast migration into root",
      "Odontoclast activation"
    ],
    correct:1,
    explain:"When dentin contacts the dental follicle, follicular cells differentiate into cementoblasts and lay down cementum."
  },
  {
    q:"Enamel pearls most commonly arise when:",
    opts:[
      "HERS remains adherent and inner cells become ameloblasts",
      "Cervical loop fails to form",
      "Odontoblasts stop secreting dentin",
      "Cementoblasts overproduce cementum"
    ],
    correct:0,
    explain:"Adherent HERS cells may differentiate into ameloblasts in CEJ/furcation → enamel pearls."
  },
  {
    q:"Dilaceration is associated with:",
    opts:[
      "Early crown morphogenesis",
      "HERS dislocation after partial root mineralization",
      "Failure of dental lamina breakdown",
      "Hypercementosis"
    ],
    correct:1,
    explain:"Displacement of HERS after partial root mineralization can bend/twist the remaining root (dilaceration)."
  },
  {
    q:"Accessory root canals may form when:",
    opts:[
      "HERS loses continuity before odontoblast differentiation",
      "Odontoblasts deposit excessive predentin",
      "Ameloblasts remain active post-eruption",
      "Cementoblasts mineralize the pulp"
    ],
    correct:0,
    explain:"Loss of HERS continuity (or a large blood vessel interrupting it) before dentin formation can create accessory canals."
  },
  {
    q:"Reduced Enamel Epithelium (REE) forms from the fusion of:",
    opts:[
      "IEE + OEE only",
      "Ameloblasts + stratum intermedium + stellate reticulum + OEE",
      "HERS + dental follicle",
      "Odontoblasts + preameloblasts"
    ],
    correct:1,
    explain:"After enamel formation, these enamel organ layers collapse and fuse to form REE."
  },
  {
    q:"Primary role of REE before eruption:",
    opts:[
      "Initiates dentinogenesis",
      "Protects enamel from resorption and connective tissue invasion",
      "Forms cementum",
      "Maintains pulp vitality"
    ],
    correct:1,
    explain:"REE protects the newly formed enamel surface prior to eruption."
  },
  {
    q:"In multi-rooted teeth, the number of roots is determined when:",
    opts:[
      "Tongue-like processes from the epithelial diaphragm grow and fuse",
      "REE fuses with oral epithelium",
      "Dental lamina fragments",
      "PDL fibers insert into cementum"
    ],
    correct:0,
    explain:"Processes from the epithelial diaphragm divide the root trunk into 2 or 3 roots."
  },
  {
    q:"HERS induces differentiation of which cells for root dentin?",
    opts:[
      "Ameloblasts from enamel organ",
      "Odontoblasts from dental papilla",
      "Cementoblasts from dental follicle",
      "Fibroblasts from PDL"
    ],
    correct:1,
    explain:"IEE of HERS induces ectomesenchymal cells of dental papilla to become odontoblasts."
  },
  {
    q:"Which tissue gives rise to cementoblasts?",
    opts:[
      "Dental papilla",
      "Dental follicle (sac)",
      "Stellate reticulum",
      "Outer enamel epithelium"
    ],
    correct:1,
    explain:"Follicular undifferentiated mesenchymal cells become cementoblasts after dentin formation."
  },
  {
    q:"The apical foramen is initially narrowed due to:",
    opts:[
      "REE fusion",
      "Epithelial diaphragm",
      "PDL fiber formation",
      "Cementum deposition"
    ],
    correct:1,
    explain:"The epithelial diaphragm at the bending of HERS creates a primary narrowing of the apical foramen."
  },
  {
    q:"During root development, where does HERS remain intact?",
    opts:[
      "At the cervical loop only",
      "Across the entire root surface",
      "Only at the advancing root edge",
      "It never remains intact"
    ],
    correct:2,
    explain:"HERS disintegrates behind but stays intact at the advancing root edge where induction continues."
  },
  {
    q:"The ‘root trunk’ of molars initially develops like:",
    opts:[
      "A multi-rooted tooth",
      "A single-rooted tooth",
      "A rootless crown",
      "A deciduous tooth only"
    ],
    correct:1,
    explain:"Root trunk forms as in a single-rooted tooth before diaphragm processes divide it."
  },
  {
    q:"Which statement about epithelial rests of Malassez is TRUE?",
    opts:[
      "They calcify into enamel pearls",
      "They are found in PDL and may proliferate into cysts/tumors with chronic inflammation",
      "They produce cementum",
      "They disappear immediately after eruption"
    ],
    correct:1,
    explain:"Rests persist in PDL; chronic inflammation can drive cystic changes."
  },
  {
    q:"Which event immediately follows odontoblast differentiation during root formation?",
    opts:[
      "Cementum formation",
      "Root dentin formation",
      "REE formation",
      "Eruption"
    ],
    correct:1,
    explain:"Differentiated odontoblasts lay down the first layer of root dentin."
  },
  {
    q:"Which best describes the cervical loop?",
    opts:[
      "Junction of IEE and OEE at the rim of the enamel organ",
      "Fusion of REE with oral epithelium",
      "PDL insertion site",
      "Apical papilla remnant"
    ],
    correct:0,
    explain:"Proliferation from the cervical loop initiates HERS formation."
  },
  {
    q:"Failure of HERS continuity due to a large blood vessel may lead to:",
    opts:[
      "Hypercementosis",
      "Accessory root canals",
      "Taurodontism",
      "Ankylosis"
    ],
    correct:1,
    explain:"Interruption of HERS can create lateral/accessory canals."
  },
  {
    q:"Which combination is correct for enamel pearl location?",
    opts:[
      "Incisal edge exclusively",
      "CEJ and furcation areas, particularly molars",
      "Apical foramen only",
      "Pulp horns"
    ],
    correct:1,
    explain:"Enamel pearls are often seen at the CEJ or in molar furcations."
  },
  {
    q:"What primarily triggers cementoblast differentiation?",
    opts:[
      "Persistence of REE",
      "Exposure of dental follicle cells to formed dentin",
      "Ameloblast apoptosis",
      "PDL fiber maturation"
    ],
    correct:1,
    explain:"Dentin contacting follicle cells induces them to become cementoblasts."
  },
  {
    q:"Which layer directly protects enamel pre-eruption?",
    opts:[
      "HERS",
      "REE",
      "PDL",
      "Cementum"
    ],
    correct:1,
    explain:"Reduced Enamel Epithelium protects enamel from resorption and connective tissue invasion."
  },
  {
    q:"Which is TRUE regarding HERS fate?",
    opts:[
      "Persists around the entire root permanently",
      "Fully transforms into REE",
      "Disintegrates leaving cell rests in the PDL",
      "Mineralizes into dentin"
    ],
    correct:2,
    explain:"HERS fragments and leaves epithelial rests of Malassez in the PDL."
  },
  {
    q:"The first hard tissue of the root to form is:",
    opts:[
      "Cementum",
      "Dentin",
      "Enamel",
      "Alveolar bone"
    ],
    correct:1,
    explain:"Odontoblasts deposit the first layer of root dentin before cementum forms."
  },
  {
    q:"Which structure does NOT contribute to REE formation?",
    opts:[
      "Ameloblasts",
      "Stratum intermedium",
      "Stellate reticulum",
      "Dental follicle"
    ],
    correct:3,
    explain:"REE is formed by enamel organ components, not the dental follicle."
  },
  {
    q:"A primary function shared by HERS and the epithelial diaphragm is to:",
    opts:[
      "Shape the root anatomy and apical opening",
      "Produce enamel matrix",
      "Induce cementoid directly",
      "Anchor PDL fibers"
    ],
    correct:0,
    explain:"HERS shapes roots; its diaphragm portion helps define the apical opening."
  },
  {
    q:"Which BEST explains why dilaceration is more common in permanent teeth?",
    opts:[
      "Primary teeth lack HERS",
      "Permanent roots mineralize longer, increasing risk if HERS is displaced during development",
      "PDL is absent in primary teeth",
      "Enamel is thinner in permanent teeth"
    ],
    correct:1,
    explain:"Displacement during longer root development of permanent teeth can bend/twist roots (dilaceration)."
  },
  {
    q:"Multi-rooted development proceeds AFTER division of the root trunk such that each root:",
    opts:[
      "Develops independently like a single root",
      "Depends on crown enamel completion",
      "Grows only via cementum deposition",
      "Loses HERS entirely"
    ],
    correct:0,
    explain:"After diaphragm processes fuse, each root continues as in a single-rooted tooth."
  }
];

const tfs = [
  { q:"Root formation begins once enamel and dentin reach the future CEJ.", answer:true,  explain:"This timing initiates HERS formation and root induction." },
  { q:"HERS is derived from stratum intermedium and stellate reticulum only.", answer:false, explain:"It derives from IEE and OEE proliferating from the cervical loop." },
  { q:"The epithelial diaphragm causes the primary narrowing of the apical foramen.", answer:true,  explain:"It is the obtuse bend of HERS at the CEJ." },
  { q:"HERS remains intact around the entire root until eruption.", answer:false, explain:"It disintegrates except at the advancing root edge." },
  { q:"Epithelial rests of Malassez persist in the periodontal ligament (PDL).", answer:true,  explain:"They are remnants of HERS in the PDL." },
  { q:"Enamel pearls may form if adherent HERS cells differentiate into ameloblasts at CEJ/furcation.", answer:true,  explain:"This can produce small spherical enamel projections." },
  { q:"Dilaceration can result from HERS dislocation after partial root mineralization.", answer:true,  explain:"Remaining root may bend or twist." },
  { q:"Cementoblasts are derived from dental papilla cells.", answer:false, explain:"They differentiate from dental follicle cells after dentin formation." },
  { q:"Accessory root canals may develop if HERS loses continuity before dentin forms.", answer:true,  explain:"Or if a large blood vessel interrupts HERS." },
  { q:"Reduced Enamel Epithelium forms before enamel formation begins.", answer:false, explain:"REE forms after enamel formation when enamel organ layers fuse." },
  { q:"In multi-rooted teeth, tongue-like processes of the epithelial diaphragm fuse to divide the root trunk.", answer:true,  explain:"This creates two or three roots." },
  { q:"HERS induces differentiation of dental papilla cells into odontoblasts.", answer:true,  explain:"IEE of HERS drives odontoblast formation and root dentin." }
];

const saqs = [
  { q:"Outline the steps in development of a single-rooted tooth.", a:"1) IEE & OEE proliferate from the cervical loop → HERS. 2) HERS induces dental papilla cells to become odontoblasts. 3) Odontoblasts lay down first layer of root dentin. 4) HERS disintegrates → rests of Malassez remain. 5) Dentin contact with dental follicle induces cementoblasts → cementum deposition." },
  { q:"Describe Hertwig’s Epithelial Root Sheath (HERS) and the epithelial diaphragm.", a:"HERS is a double epithelial membrane formed by IEE+OEE proliferation from the cervical loop. It shapes the root and induces root dentin. At the CEJ it bends obtusely forming the epithelial diaphragm, which contributes to primary narrowing of the apical foramen." },
  { q:"Discuss the fate of HERS and two clinical considerations.", a:"HERS disintegrates during root formation, persisting only at the advancing edge; remnants remain as epithelial rests of Malassez in the PDL and can proliferate into cysts/tumors with chronic inflammation. Clinical: (1) Enamel pearls if adherent HERS cells become ameloblasts (often at CEJ/furcation). (2) Dilaceration from HERS dislocation after partial root mineralization; (3) Accessory canals if HERS continuity is lost before dentin forms." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null),
  tf: Array(tfs.length).fill(null),
  saq: Array(saqs.length).fill(false)
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return;
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return;
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
