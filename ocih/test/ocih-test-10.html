<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam â€¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ğŸ¦· Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 10</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù„Ø§ Ø³ÙÙ‡Ù’Ù„Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù…ÙØ§ Ø¬ÙØ¹ÙÙ„Ù’ØªÙÙ‡Ù Ø³ÙÙ‡Ù’Ù„Ù‹Ø§ØŒ ÙˆÙØ£ÙÙ†Ù’ØªÙ ØªÙØ¬Ù’Ø¹ÙÙ„Ù Ø§Ù„Ø­ÙØ²Ù’Ù†Ù Ø¥ÙØ°ÙØ§ Ø´ÙØ¦Ù’ØªÙ Ø³ÙÙ‡Ù’Ù„Ù‹Ø§</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled from Lecture 10: Root Formation / HERS) -----------
const mcqs = [
  {
    q:"Root development begins when which two tissues reach the future CEJ?",
    opts:["Enamel and dentin","Cementum and dentin","Enamel and pulp","Cementum and periodontal ligament"],
    correct:0,
    explain:"Initiation of root formation starts once crown formation is complete, i.e., enamel and dentin reach the future CEJ."
  },
  {
    q:"The epithelial structure that extends from the cervical loop as a bilayer to shape the root is:",
    opts:["Hertwig epithelial root sheath","Reduced enamel epithelium","Epithelial rests of Malassez","Nasmyth membrane"],
    correct:0,
    explain:"Inner + outer enamel epithelium proliferate from the cervical loop to form HERS, which defines root shape."
  },
  {
    q:"HERS forms an angulated inflection at the future CEJ creating a primary narrowing of the apical foramen. This angulated portion is termed:",
    opts:["Epithelial diaphragm","Epithelial attachment","Cervical collar","Dental lamina"],
    correct:0,
    explain:"The bend forms the epithelial diaphragm, initially narrowing the apical opening."
  },
  {
    q:"Which HERS component induces odontoblast differentiation in the root?",
    opts:["Inner enamel epithelium","Outer enamel epithelium","Stratum intermedium","Stellate reticulum"],
    correct:0,
    explain:"Inner enamel epithelium of HERS signals ectomesenchyme of dental papilla to form root odontoblasts."
  },
  {
    q:"Immediate tissue laid down by newly differentiated root odontoblasts is:",
    opts:["Predentin that mineralizes to dentin","Intermediate cementum","Enamel spindles","Cellular cementum"],
    correct:0,
    explain:"Odontoblasts secrete predentin, which mineralizes into root dentin."
  },
  {
    q:"After inducing root dentin, HERS largely:",
    opts:["Disintegrates into discrete epithelial clusters","Transforms into cementoblasts","Becomes the junctional epithelium","Calcifies into enamel pearls routinely"],
    correct:0,
    explain:"HERS fragments become epithelial rests of Malassez within the PDL."
  },
  {
    q:"Cementoblasts arise primarily from:",
    opts:["Dental follicle / sac cells","HERS inner enamel epithelium","Reduced enamel epithelium","Odontoblastic transdifferentiation"],
    correct:0,
    explain:"Contact of root dentin with dental follicle induces ectomesenchymal cells to become cementoblasts."
  },
  {
    q:"Which statement best describes the reduced enamel epithelium (REE)?",
    opts:["Fused remnants of enamel organ layers that protect enamel pre-eruptively","A bilayer shaping the root","Fragments of HERS in the PDL","Early junctional epithelium formed post-eruption only"],
    correct:0,
    explain:"After crown completion, ameloblasts with OEE, SR, SI flatten and fuse as REE to protect enamel."
  },
  {
    q:"A persistent adherence of HERS inner enamel cells to dentin may aberrantly form:",
    opts:["Enamel pearls","Cementicles","Dentin pearls","Hypercementosis"],
    correct:0,
    explain:"If HERS cells differentiate into ameloblasts on root/furcation surfaces, enamel pearls can form."
  },
  {
    q:"Dilaceration most likely results when:",
    opts:["HERS is displaced after partial root mineralization","Cervical loop fails to proliferate","Apical papilla is avascular","REE fails to fuse with oral epithelium"],
    correct:0,
    explain:"Trauma or displacement of developing root after mineralization causes bend/twistâ€”dilaceration."
  },
  {
    q:"Accessory root canals may form if:",
    opts:["HERS loses continuity before odontoblast differentiation","Odontoblasts overproduce predentin","REE breaks down too early","Cervical loop overgrows circumferentially"],
    correct:0,
    explain:"Loss of HERS continuity (or large BV interference) before dentin induction leaves non-dentinized channels."
  },
  {
    q:"Epithelial rests of Malassez are located primarily in:",
    opts:["Periodontal ligament","Pulpal periphery","Alveolar bone marrow spaces","Gingival sulcus"],
    correct:0,
    explain:"ERM are HERS remnants found within the PDL throughout life."
  },
  {
    q:"In multiâ€‘rooted tooth development, tongueâ€‘like extensions arise from:",
    opts:["Epithelial diaphragm at the furcation","Dental lamina buds","Reduced enamel epithelium","Apical papilla"],
    correct:0,
    explain:"Epithelial diaphragm produces processes that grow/fuse to partition the root trunk."
  },
  {
    q:"Which event occurs FIRST in singleâ€‘root formation?",
    opts:["HERS proliferation from the cervical loop","Cementoblast differentiation","Epithelial rests of Malassez appear","Sharpey fiber insertion"],
    correct:0,
    explain:"Sequence: HERS forms â†’ induces odontoblasts/dentin â†’ HERS breaks â†’ cementoblasts differentiate."
  },
  {
    q:"Primary role of HERS during root development is to:",
    opts:["Shape the root and induce root dentin","Form acellular cementum directly","Guide eruption pathway","Fuse with oral epithelium to form JE"],
    correct:0,
    explain:"HERS determines root outline and induces odontoblast differentiation."
  },
  {
    q:"A large blood vessel crossing the developing apex most directly predisposes to:",
    opts:["Accessory canal formation","Hypercementosis","Taurodontism","Root resorption"],
    correct:0,
    explain:"Interruption of HERS continuity by a vessel can create accessory canals."
  },
  {
    q:"Which combination correctly pairs structure with origin?",
    opts:["Cementoblast â€“ dental follicle","Odontoblast â€“ dental follicle","Ameloblast â€“ dental papilla","ERM â€“ dental lamina"],
    correct:0,
    explain:"Cementoblasts derive from follicular ectomesenchyme; odontoblasts from papilla; ameloblasts from IEE."
  },
  {
    q:"During root formation, the apical foramen initially narrows primarily due to:",
    opts:["Formation of epithelial diaphragm","Deposition of cellular cementum","Cortical plate development","Apical papilla regression"],
    correct:0,
    explain:"The bend of HERS creates the epithelial diaphragm causing a primary narrowing."
  },
  {
    q:"Which is TRUE regarding ERM (rests of Malassez)?",
    opts:["May proliferate into cystic lesions under chronic inflammation","Differentiate into odontoblasts during repair","Are the same as REE","Secrete enamel matrix during eruption"],
    correct:0,
    explain:"ERM can proliferate pathologically; they are HERS remnants, not REE."
  },
  {
    q:"The root trunk of molars initially develops like a singleâ€‘rooted tooth until:",
    opts:["Furcation processes from the diaphragm grow and fuse","REE forms junctional epithelium","Secondary dentin is laid down","Apical migration of epithelial attachment completes"],
    correct:0,
    explain:"Then diaphragm processes subdivide the trunk into multiple roots."
  },
  {
    q:"Which sequence is MOST accurate for singleâ€‘root formation?",
    opts:["HERS forms â†’ odontoblasts â†’ root dentin â†’ HERS disintegrates â†’ cementoblasts â†’ cementum","Odontoblasts â†’ HERS forms â†’ cementoblasts â†’ dentin â†’ cementum","Cementum â†’ HERS forms â†’ dentin â†’ odontoblasts","HERS forms â†’ cementoblasts â†’ dentin â†’ odontoblasts"],
    correct:0,
    explain:"This is the classic chronological order described for singleâ€‘rooted teeth."
  },
  {
    q:"Which statement about REE is INCORRECT?",
    opts:["It consists of flattened ameloblasts plus other enamel organ layers","It protects enamel from resorption before eruption","It induces root dentin formation","It forms a thin membrane over enamel"],
    correct:2,
    explain:"REE does not induce root dentin (HERS does); the other statements are correct."
  },
  {
    q:"Failure of HERS to break down after dentin formation at a localized site MOST likely leads to:",
    opts:["Enamel pearl at CEJ/furcation","Accessory canal apically","Ankylosis of root","Complete absence of cementum"],
    correct:0,
    explain:"Persistent HERS cells may become ameloblastâ€‘like and deposit enamel pearls."
  },
  {
    q:"Which best explains why cementum formation starts only after dentin is present?",
    opts:["Dentin contact induces follicular cells to become cementoblasts","Cementum is secreted by HERS once dentin forms","Cementum needs enamel as a template","Pulpal pressure triggers cementogenesis"],
    correct:0,
    explain:"Signal from exposed dentin to dental follicle triggers cementoblast differentiation."
  },
  {
    q:"The tissue band that originally gives rise to HERS is the:",
    opts:["Cervical loop of the enamel organ","Dental lamina","Successional lamina","Alveolar mucosa"],
    correct:0,
    explain:"Proliferation of inner + outer enamel epithelium from the cervical loop creates HERS."
  },
  {
    q:"Which outcome is MOST associated with trauma to a partially formed root?",
    opts:["Dilaceration","Supernumerary root","Taurodontism","Gemination"],
    correct:0,
    explain:"Traumaâ€‘related displacement of HERS after mineralization causes an abrupt root bend."
  },
  {
    q:"In multirooted teeth, after the diaphragm processes fuse, each emerging root then:",
    opts:["Develops like a singleâ€‘rooted tooth","Requires new REE formation","Forms enamel at the furcation","Skips cementogenesis"],
    correct:0,
    explain:"Each root proceeds via the same steps as in singleâ€‘root formation."
  },
  {
    q:"Which pairing is CORRECT regarding location?",
    opts:["Enamel pearl â€“ CEJ/furcation surfaces","ERM â€“ within pulp chamber","REE â€“ PDL space","Epithelial diaphragm â€“ coronal dentin"],
    correct:0,
    explain:"Enamel pearls are often seen at CEJ or molar furcations; ERM are in PDL, REE overlays enamel."
  },
  {
    q:"What is the most direct functional consequence of HERS disintegration?",
    opts:["Allows follicular cells to contact root dentin","Initiates enamel apposition","Seals the apical foramen permanently","Forms Sharpey fibers immediately"],
    correct:0,
    explain:"Breakdown exposes dentin to dental follicle, enabling cementoblast differentiation."
  },
  {
    q:"Which clinical finding most strongly suggests previous HERS disturbance before odontoblast induction?",
    opts:["Accessory canal near apex","Hypercementosis at midâ€‘root","Wide apical foramen in mature tooth","Periapical cementoâ€‘osseous dysplasia"],
    correct:0,
    explain:"Accessory canals result when HERS continuity is lost prior to dentin formation."
  },
  {
    q:"Which is MOST accurate regarding the fate of HERS during continued root elongation?",
    opts:["Remains intact only at the advancing root edge","Persists circumferentially along the whole root","Becomes junctional epithelium entirely","Calcifies into granular layer of Tomes"],
    correct:0,
    explain:"HERS fragments except near the actively growing apex, where induction continues."
  }
];

const tfs = [
  { q:"Root development begins only after both enamel and dentin have reached the future CEJ.", answer:true, explain:"Crown completion to CEJ precedes root formation." },
  { q:"HERS is composed of inner and outer enamel epithelium only.", answer:true, explain:"HERS is a bilayer from IEE+OEE (without SR or SI)." },
  { q:"Reduced enamel epithelium primarily induces root dentin formation.", answer:false, explain:"HERS, not REE, induces root odontoblasts." },
  { q:"Epithelial diaphragm formation initially narrows the apical foramen.", answer:true, explain:"The bend of HERS creates the primary constriction." },
  { q:"Cementoblasts are derived from dental papilla cells.", answer:false, explain:"They arise from dental follicle (sac) ectomesenchyme." },
  { q:"ERM (rests of Malassez) are HERS remnants in the periodontal ligament.", answer:true, explain:"They persist in PDL throughout life." },
  { q:"Enamel pearls can result when inner enamel cells of HERS remain adherent and differentiate into ameloblasts.", answer:true, explain:"This produces ectopic enamel at CEJ/furcation." },
  { q:"Accessory canals most often arise when REE loses continuity before dentin forms.", answer:false, explain:"Loss of HERS continuity (not REE) before odontoblast induction predisposes to accessory canals." },
  { q:"Dilaceration is usually due to displacement of HERS after partial root mineralization.", answer:true, explain:"Trauma/displacement at that stage bends the root." },
  { q:"In multirooted teeth, the root trunk initially forms like a singleâ€‘rooted tooth.", answer:true, explain:"Then diaphragm processes partition the trunk." },
  { q:"ERM commonly differentiate into cementoblasts during repair.", answer:false, explain:"They are epithelial and may form cysts under chronic inflammation, not cementum." },
  { q:"REE protects enamel from resorption and connective tissue invasion before eruption.", answer:true, explain:"That is a classic function of REE." }
];

const saqs = [
  // 1) Direct answer (very short)
  { q: "Briefly define Hertwig's epithelial root sheath (HERS).", a: "A bilayer from IEE+OEE proliferating from the cervical loop that shapes the root and induces root dentin." },
  // 2) List / Enumeration (numbered)
  { q: "List the chronological steps of singleâ€‘root formation (very brief).", a: "1) HERS forms from cervical loop. 2) Odontoblasts differentiate from dental papilla. 3) Root dentin is laid. 4) HERS disintegrates (ERM remain). 5) Follicle cells become cementoblasts. 6) Cementum is deposited." },
  // 3) Comparison (table + numbered)
  { q: "Compare REE vs HERS in a compact table.", a: "1) Origin: REE â€“ fused flattened enamel organ layers after crown completion; HERS â€“ IEE+OEE from cervical loop. 2) Main role: REE â€“ protects enamel preâ€‘eruption; HERS â€“ shapes root & induces root dentin. 3) Fate/location: REE â€“ becomes part of eruption/JE; HERS â€“ fragments â†’ ERM in PDL." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "âœ“ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
