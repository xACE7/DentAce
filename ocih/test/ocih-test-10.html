<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer table{width:100%; border-collapse: collapse;}
  .answer th, .answer td{border:1px solid var(--glass-border); padding:8px; text-align:left;}
  .answer th{font-weight:bold;}

  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 10</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
  {
    q: "When does the process of root development officially begin?",
    opts: [
      "Once the enamel and dentin reach the future Cemento-Enamel Junction (CEJ)",
      "After the crown of the tooth has fully erupted into the oral cavity",
      "Simultaneously with the formation of the enamel organ's cap stage",
      "Following the complete formation and mineralization of the coronal pulp"
    ],
    correct: 0,
    explain: "Root formation starts precisely when crown formation (enamel and dentin) has advanced to the cervical area, which will become the CEJ."
  },
  {
    q: "Hertwig's Epithelial Root Sheath (HERS) is formed by the proliferation of cells from which structure?",
    opts: [
      "The cervical loop",
      "The dental papilla",
      "The stratum intermedium",
      "The dental follicle"
    ],
    correct: 0,
    explain: "HERS is a double-layered membrane formed by the proliferation of the inner and outer enamel epithelium at the cervical loop of the enamel organ."
  },
  {
    q: "Which of the following is a primary function of HERS?",
    opts: [
      "Inducing the differentiation of odontoblasts for root dentin formation",
      "Depositing the first layer of cementum on the root surface",
      "Forming the periodontal ligament fibers",
      "Secretes enamel onto the root surface"
    ],
    correct: 0,
    explain: "The inner layer of HERS induces adjacent ectomesenchymal cells of the dental papilla to differentiate into odontoblasts, which then form root dentin."
  },
  {
    q: "The remnants of HERS found in the periodontal ligament of a fully formed tooth are known as:",
    opts: [
      "Epithelial rests of Malassez",
      "Dental lamina remnants",
      "Enamel pearls",
      "Cementicles"
    ],
    correct: 0,
    explain: "After HERS disintegrates, it leaves behind clusters of epithelial cells in the PDL called the epithelial cell rests of Malassez."
  },
  {
    q: "What is the direct trigger for the differentiation of cementoblasts?",
    opts: [
      "Contact of the newly formed root dentin with the dental follicle",
      "The disintegration of the epithelial rests of Malassez",
      "Signals from the odontoblasts in the root pulp",
      "The arrival of blood vessels into the developing root area"
    ],
    correct: 0,
    explain: "Once HERS breaks down, the undifferentiated mesenchymal cells of the dental follicle come into contact with the root dentin, which induces them to become cementoblasts."
  },
  {
    q: "How are multi-rooted teeth, like molars, formed?",
    opts: [
      "The epithelial diaphragm grows tongue-like processes that fuse together",
      "Multiple separate HERS structures develop independently for each root",
      "The single root trunk splits into two or three after it is fully formed",
      "Bone deposition from the inter-radicular area physically divides the root"
    ],
    correct: 0,
    explain: "For multi-rooted teeth, the epithelial diaphragm at the root trunk produces two or three extensions that grow horizontally and fuse, dividing the single opening into multiple openings, each forming a root."
  },
  {
    q: "An enamel pearl is a clinical anomaly that occurs when:",
    opts: [
      "HERS remains adherent to the dentin and its cells differentiate into ameloblasts",
      "A small piece of the enamel organ is trapped in the dental follicle",
      "Odontoblasts mistakenly produce enamel instead of dentin on the root surface",
      "Cementoblasts undergo metaplasia and form enamel-like tissue"
    ],
    correct: 0,
    explain: "If HERS doesn't detach properly from the newly formed dentin, its inner enamel epithelium cells can be induced to become functional ameloblasts and deposit a sphere of enamel."
  },
  {
    q: "What is the primary cause of an accessory root canal?",
    opts: [
      "A break in the continuity of HERS before dentin formation",
      "Excessive proliferation of epithelial rests of Malassez",
      "Premature calcification of the dental pulp",
      "Fusion of two adjacent tooth germs during development"
    ],
    correct: 0,
    explain: "If there is a gap in HERS, dentin does not form in that specific spot. This allows a direct connection to remain between the pulp and the periodontal ligament, forming an accessory canal."
  },
  {
    q: "The clinical condition known as dilaceration refers to:",
    opts: [
      "A sharp bend or twist in the root of a tooth",
      "The complete absence of a tooth root",
      "The formation of an abnormally short root",
      "Excessive deposition of cementum on the root surface"
    ],
    correct: 0,
    explain: "Dilaceration is a root distortion caused by the dislocation of HERS after partial root formation has already occurred, often due to trauma."
  },
  {
    q: "The epithelial diaphragm, formed by the bending of HERS, is responsible for:",
    opts: [
      "Forming the boundary for the future apical foramen",
      "Secreting the final layer of coronal enamel",
      "Inducing the formation of the periodontal ligament",
      "Initiating the breakdown of the dental lamina"
    ],
    correct: 0,
    explain: "The epithelial diaphragm is the growing end of HERS, and its opening outlines the primary apical foramen of the developing root."
  },
  {
    q: "Which layers of the enamel organ collapse to form the Reduced Enamel Epithelium (REE)?",
    opts: [
      "Ameloblasts, stratum intermedium, stellate reticulum, and outer enamel epithelium",
      "Only the ameloblasts and the outer enamel epithelium",
      "The stratum intermedium and stellate reticulum only",
      "The cervical loop and the dental papilla"
    ],
    correct: 0,
    explain: "The REE is formed by the compression of all four layers of the enamel organ after enamel formation is complete."
  },
  {
    q: "What is the primary protective function of the Reduced Enamel Epithelium (REE)?",
    opts: [
      "Protecting the enamel from resorption before eruption",
      "Preventing dentin from being exposed to the oral cavity",
      "Shielding the pulp from thermal stimuli",
      "Guiding the formation of cementum"
    ],
    correct: 0,
    explain: "The REE covers the newly formed enamel, protecting it from being resorbed by surrounding connective tissue cells before the tooth erupts."
  },
  {
    q: "In which part of the developing tooth are the epithelial rests of Malassez most likely to be found throughout life?",
    opts: [
      "Periodontal ligament (PDL)",
      "Dental pulp",
      "Alveolar bone",
      "Gingival tissue"
    ],
    correct: 0,
    explain: "These remnants of HERS persist within the periodontal ligament space adjacent to the root surface."
  },
  {
    q: "Under conditions of chronic inflammation, epithelial rests of Malassez can proliferate to form what?",
    opts: [
      "Cysts and tumours",
      "Accessory roots",
      "Cementicles",
      "Secondary dentin"
    ],
    correct: 0,
    explain: "These dormant epithelial cells can be stimulated by inflammation to grow and form pathological structures like periapical cysts."
  },
  {
    q: "The 'root trunk' is a term associated with the initial root development of which type of teeth?",
    opts: [
      "Multi-rooted teeth like molars",
      "Single-rooted teeth like incisors",
      "All permanent teeth",
      "All deciduous teeth"
    ],
    correct: 0,
    explain: "The root trunk is the undivided portion of the root in molars and premolars before it bifurcates or trifurcates into individual roots."
  },
    {
    q: "The inner cell layer of HERS induces the differentiation of which cells?",
    opts: [
      "Odontoblasts from the dental papilla",
      "Ameloblasts from the dental papilla",
      "Cementoblasts from the dental follicle",
      "Fibroblasts from the dental follicle"
    ],
    correct: 0,
    explain: "The inner epithelial cells of HERS provide the signal for undifferentiated mesenchymal cells in the adjacent dental papilla to become odontoblasts."
  },
  {
    q: "The structure responsible for shaping the root and determining if it will be straight, curved, single, or multiple is:",
    opts: [
      "Hertwig's Epithelial Root Sheath (HERS)",
      "The dental follicle",
      "The outer enamel epithelium",
      "The alveolar bone crypt"
    ],
    correct: 0,
    explain: "The proliferation, growth pattern, and eventual disintegration of HERS dictates the final morphology of the tooth's root system."
  },
  {
    q: "The formation of the first layer of root dentin is immediately followed by what event?",
    opts: [
      "The degeneration of HERS",
      "The formation of the apical foramen",
      "The eruption of the tooth crown",
      "The completion of enamel formation"
    ],
    correct: 0,
    explain: "Once the first layer of root dentin is laid down, HERS begins to break apart, allowing cells from the dental follicle to access the root surface."
  },
  {
    q: "Enamel pearls are most commonly found in which specific location on a molar?",
    opts: [
      "The furcation area",
      "The apex of the root",
      "The occlusal surface",
      "The pulp chamber floor"
    ],
    correct: 0,
    explain: "While they can be at the CEJ, they are particularly common in the area where the roots divide (the furcation) on multi-rooted teeth."
  },
  {
    q: "A large blood vessel that prevents the local continuity of HERS during development can lead to the formation of:",
    opts: [
      "An accessory root canal",
      "An enamel pearl",
      "Dilaceration",
      "Hypercementosis"
    ],
    correct: 0,
    explain: "The presence of a blood vessel can create a gap in the root sheath, preventing dentin formation in that area and resulting in a lateral or accessory canal."
  },
  {
    q: "The 'cervical loop' is structurally composed of:",
    opts: [
      "The junction of the inner and outer enamel epithelium",
      "The junction of the stratum intermedium and stellate reticulum",
      "The most apical cells of the dental papilla",
      "The most coronal cells of the dental follicle"
    ],
    correct: 0,
    explain: "The cervical loop is the deepest rim of the enamel organ where the inner and outer enamel epithelium meet, and it's the point from which HERS proliferates."
  },
  {
    q: "Which cell type is responsible for laying down the initial organic matrix of cementum?",
    opts: [
      "Cementoblasts",
      "Odontoblasts",
      "Fibroblasts",
      "Osteoblasts"
    ],
    correct: 0,
    explain: "Cementoblasts, which differentiate from the dental follicle cells, are responsible for secreting cementoid, the organic matrix that mineralizes to become cementum."
  },
  {
    q: "The initial narrowing of the wide apical foramen during development is caused by:",
    opts: [
      "The formation of the epithelial diaphragm",
      "The deposition of cellular cementum",
      "The constriction of pulpal blood vessels",
      "The growth of the alveolar bone"
    ],
    correct: 0,
    explain: "The inward bending of HERS to form the epithelial diaphragm creates the first constriction that defines the future apical foramen."
  },
  {
    q: "Which structure is NOT part of the original enamel organ?",
    opts: [
      "Dental Follicle",
      "Stellate Reticulum",
      "Stratum Intermedium",
      "Outer Enamel Epithelium"
    ],
    correct: 0,
    explain: "The dental follicle (or dental sac) is the mesenchymal tissue that surrounds the enamel organ, it is not part of the enamel organ itself."
  },
  {
    q: "The process of root dentin formation is analogous to coronal dentin formation, but it lacks the influence of:",
    opts: [
      "Stratum intermedium and stellate reticulum",
      "Odontoblasts",
      "Dental papilla",
      "The basement membrane"
    ],
    correct: 0,
    explain: "HERS is only composed of inner and outer enamel epithelium. It lacks the stratum intermedium and stellate reticulum, which are present during crown formation to support ameloblasts."
  },
  {
    q: "What would be the likely outcome if HERS failed to disintegrate after inducing dentin formation?",
    opts: [
      "Cementum would not be formed on the root",
      "The tooth would fail to erupt",
      "The root would be covered in enamel",
      "The periodontal ligament would not develop"
    ],
    correct: 0,
    explain: "If HERS remained as a barrier, cells from the dental follicle could not reach the dentin surface to differentiate into cementoblasts, preventing cementum deposition."
  },
  {
    q: "Dilaceration is most commonly associated with which teeth?",
    opts: [
      "Permanent teeth",
      "Deciduous teeth",
      "Both equally",
      "Supernumerary teeth"
    ],
    correct: 0,
    explain: "The lecture slide specifies that dilaceration is usually seen in permanent teeth, often due to trauma to the preceding deciduous tooth that displaces the developing permanent tooth germ."
  },
  {
    q: "The final fate of the Reduced Enamel Epithelium (REE) is to:",
    opts: [
      "Become part of the initial junctional epithelium after eruption",
      "Undergo apoptosis and disappear completely before eruption",
      "Transform into the periodontal ligament",
      "Merge with the alveolar bone"
    ],
    correct: 0,
    explain: "As the tooth erupts, the REE fuses with the oral epithelium and ultimately forms the primary epithelial attachment or junctional epithelium."
  },
  {
    q: "Which of the following events happens first in root development?",
    opts: [
      "Proliferation of the cervical loop to form HERS",
      "Differentiation of cementoblasts",
      "Disintegration of HERS",
      "Deposition of the first layer of cementum"
    ],
    correct: 0,
    explain: "The very first step is the growth and proliferation of the epithelial cells at the cervical loop to form HERS, which then orchestrates the subsequent events."
  },
  {
    q: "The cells that form root dentin originate from the:",
    opts: [
      "Dental Papilla",
      "Dental Follicle",
      "Stellate Reticulum",
      "Epithelial rests of Malassez"
    ],
    correct: 0,
    explain: "Odontoblasts, which form dentin, are differentiated from the undifferentiated ectomesenchymal cells of the dental papilla, under the influence of HERS."
  }
];

const tfs = [
  {
    q: "Hertwig's Epithelial Root Sheath is composed of all four layers of the enamel organ.",
    answer: false,
    explain: "HERS is a double layer of cells, formed only from the inner and outer enamel epithelium of the cervical loop."
  },
  {
    q: "The presence of epithelial rests of Malassez in the PDL is considered a pathological condition.",
    answer: false,
    explain: "The rests of Malassez are normal remnants of HERS and are found in a healthy PDL. They only become pathological if stimulated by chronic inflammation."
  },
  {
    q: "The formation of a two-rooted tooth involves the fusion of two separate tongue-like processes from the epithelial diaphragm.",
    answer: true,
    explain: "Correct. For a two-rooted tooth, two processes grow toward each other and fuse, dividing the root trunk into two canals."
  },
  {
    q: "Cementoblasts are derived from the same tissue as odontoblasts, the dental papilla.",
    answer: false,
    explain: "This is false. Cementoblasts are derived from undifferentiated mesenchymal cells in the dental follicle (or dental sac)."
  },
  {
    q: "An enamel pearl is essentially a small deposit of enamel on the root surface.",
    answer: true,
    explain: "Correct. It's caused by HERS cells differentiating into ameloblasts and producing a small sphere of enamel in an abnormal location."
  },
  {
    q: "Root formation is typically completed at the same time the tooth erupts into the oral cavity.",
    answer: false,
    explain: "Root formation continues for a significant time (2-3 years for permanent teeth) after the tooth has erupted."
  },
  {
    q: "Dilaceration is caused by a failure of HERS to disintegrate.",
    answer: false,
    explain: "Dilaceration is a bend or distortion of the root, caused by the displacement of HERS after some root has already formed, not by its failure to disintegrate."
  },
  {
    q: "The Reduced Enamel Epithelium (REE) plays a crucial role in inducing root dentin formation.",
    answer: false,
    explain: "The REE's role is to protect the crown's enamel pre-eruption. It is HERS, which proliferates from the cervical loop, that induces root dentin formation."
  },
  {
    q: "Accessory root canals can form if a blood vessel disrupts the continuity of HERS.",
    answer: true,
    explain: "Correct. A persistent blood vessel can create a pathway through HERS, preventing dentin formation and leaving a patent canal between the pulp and PDL."
  }
];

const saqs = [
  {
    q: "A 45-year-old patient presents with a slow-growing, painless swelling near the apex of a non-vital tooth. A radiograph reveals a well-defined radiolucency. Based on the developmental remnants discussed in the lecture, what is the most likely diagnosis for this lesion?",
    a: "This is likely a periapical cyst (or radicular cyst). It forms from the proliferation of the epithelial cell rests of Malassez, which are remnants of Hertwig's epithelial root sheath (HERS) located in the periodontal ligament. Chronic inflammation from the non-vital tooth stimulates these dormant epithelial cells to grow and form a cyst."
  },
  {
    q: "List the two primary functions of Hertwig's Epithelial Root Sheath (HERS).",
    a: `<ol>
          <li>It shapes the root of the tooth, determining its size, curvature, and whether it will be single or multi-rooted.</li>
          <li>It induces the differentiation of undifferentiated ectomesenchymal cells from the dental papilla into odontoblasts, which then form the root dentin.</li>
        </ol>`
  },
  {
    q: "Briefly describe the sequence of events that leads to the formation of the first layer of cementum, starting from the point where root dentin has just been formed.",
    a: "After the first layer of root dentin is formed, Hertwig's epithelial root sheath (HERS) begins to disintegrate. This breakdown allows undifferentiated mesenchymal cells from the adjacent dental follicle to come into direct contact with the newly formed dentin surface. This contact induces these cells to differentiate into cementoblasts, which then lay down the first layer of cementum (cementoid matrix)."
  },
  {
    q: "Compare the developmental causes and resulting appearances of Enamel Pearls and Dilaceration in a table format.",
    a: `<table>
          <thead>
            <tr>
              <th>Feature</th>
              <th>Enamel Pearl</th>
              <th>Dilaceration</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Cause</strong></td>
              <td>A portion of HERS remains adherent to the root dentin, and its inner cells differentiate into ameloblasts, producing enamel.</td>
              <td>Displacement or trauma to HERS after a portion of the root has already mineralized, causing the rest of the root to form at an angle.</td>
            </tr>
            <tr>
              <td><strong>Appearance</strong></td>
              <td>A small, spherical nodule of enamel, typically found at the CEJ or in the furcation area of molars.</td>
              <td>A sharp bend, curve, or twist anywhere along the length of the root. It is a distortion of the root's shape.</td>
            </tr>
          </tbody>
        </table>`
  },
  {
    q: "Explain how the root trunk of a mandibular molar (a two-rooted tooth) is divided into two distinct roots during development.",
    a: "Initially, the root trunk develops like a single-rooted tooth. At the level of the future furcation, the epithelial diaphragm of HERS stops growing vertically and instead produces two horizontal, tongue-like processes. These processes grow towards each other and eventually fuse in the middle. This fusion divides the single, wide cervical opening into two separate openings, each of which will then form an individual root."
  },
  {
    q: "What is the Reduced Enamel Epithelium (REE), and what four cell layers of the enamel organ collapse to form it?",
    a: "The Reduced Enamel Epithelium (REE) is a thin membrane that covers the enamel of the tooth crown after enamel formation is complete but before the tooth erupts. Its function is to protect the enamel from resorption.<br><br>The four layers that collapse and fuse to form it are: <ol><li>Ameloblasts</li><li>Stratum intermedium</li><li>Stellate reticulum</li><li>Outer enamel epithelium</li></ol>"
  }
];


// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').innerHTML;
    return s + (feedback.includes("<b>Correct ✔</b>") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').innerHTML;
    return s + (feedback.includes("<b>Correct ✔</b>") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
