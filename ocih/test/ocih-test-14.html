<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid var(--glass-border); padding: 8px; text-align: left; }
  th { background-color: var(--glass); }
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 14</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "What is the normal thickness of the mucous membrane lining the paranasal sinuses?",
        opts: ["1 mm", "3 mm", "5 mm", "10 mm"],
        correct: 0,
        explain: "The lining mucous membrane of the paranasal sinuses is normally about 1 mm thick."
    },
    {
        q: "In mucositis, the mucous membrane can increase in thickness by how much?",
        opts: ["2 to 5 times", "5 to 10 times", "10 to 15 times", "20 to 25 times"],
        correct: 2,
        explain: "When inflamed, the mucous membrane may increase in thickness 10 to 15 times its normal size."
    },
    {
        q: "Which of the following is considered an intrinsic inflammatory disease of the maxillary sinus?",
        opts: ["Periostitis", "Odontogenic cysts", "Mucositis", "Traumatic injuries"],
        correct: 2,
        explain: "Mucositis is listed under intrinsic inflammatory diseases of the maxillary sinus."
    },
    {
        q: "What is the term for inflammation of the mucosa of all sinuses simultaneously?",
        opts: ["Maxillary sinusitis", "Pansinusitis", "Mucositis", "Antroliths"],
        correct: 1,
        explain: "Pansinusitis is the inflammation of the mucosa of all sinuses simultaneously."
    },
    {
        q: "How long does acute maxillary sinusitis typically last?",
        opts: ["Up to 4 weeks", "4-12 weeks", "Over 12 weeks", "Up to 1 week"],
        correct: 0,
        explain: "Acute maxillary sinusitis lasts up to 4 weeks."
    },
    {
        q: "Which bacteria are commonly associated with maxillary sinusitis?",
        opts: ["Staphylococcus aureus", "Escherichia coli", "Hemophilus influenza & Streptococcus pneumonia", "Pseudomonas aeruginosa"],
        correct: 2,
        explain: "Hemophilus influenza and Streptococcus pneumonia are common etiological agents for maxillary sinusitis."
    },
    {
        q: "A key clinical feature of acute sinusitis is pain on the cheek when...",
        opts: ["Lying down", "Bending forward", "Eating", "Speaking"],
        correct: 1,
        explain: "A sense of fullness and pain on the cheek on bending forward is a characteristic symptom of acute sinusitis."
    },
    {
        q: "Which radiographic view is specifically mentioned for diagnosing maxillary sinusitis?",
        opts: ["Cephalometric view", "Panoramic view", "Periapical view", "Water's (Occipitomental) view"],
        correct: 3,
        explain: "Water's (Occipitomental) view is the recommended radiograph for diagnosing sinusitis."
    },
    {
        q: "What does an 'air-fluid level' on a radiograph indicate in the context of sinusitis?",
        opts: ["A normal, healthy sinus", "Fluid accumulation in the sinus", "A benign tumor", "A fractured sinus wall"],
        correct: 1,
        explain: "An air-fluid level indicates that fluid occupies the inferior aspect of the sinus, a common finding in sinusitis."
    },
    {
        q: "Subacute maxillary sinusitis is defined as lasting for what duration?",
        opts: ["Less than 4 weeks", "4-12 weeks", "Over 12 weeks", "1-2 weeks"],
        correct: 1,
        explain: "Subacute sinusitis is an intermediate stage lasting from 4 to 12 weeks."
    },
    {
        q: "Which condition is NOT listed as a cause for impaired drainage leading to chronic sinusitis?",
        opts: ["Polyps", "Adenoids", "Hypertension", "Tumors"],
        correct: 2,
        explain: "Polyps, DNS, Adenoids, Tumors, and Allergy can cause impaired drainage. Hypertension is not mentioned."
    },
    {
        q: "A common symptom of chronic sinusitis that is often absent in acute sinusitis is:",
        opts: ["Fever and malaise", "Pain on bending forward", "No pain, but purulent foul-smelling discharge", "Severe headache"],
        correct: 2,
        explain: "Chronic sinusitis is often characterized by a lack of pain but the presence of a purulent, foul-smelling discharge."
    },
    {
        q: "What is the primary goal of using decongestants in the management of acute sinusitis?",
        opts: ["To kill bacteria", "To relieve pain", "To promote drainage of the sinus", "To reduce fever"],
        correct: 2,
        explain: "Decongestants are used to help with the drainage of the sinus."
    },
    {
        q: "What is 'Antral lavage'?",
        opts: ["A surgical removal of the sinus", "A type of antibiotic", "Irrigating the sinus with lukewarm water", "A diagnostic imaging technique"],
        correct: 2,
        explain: "Antral lavage involves inserting a cannula and irrigating the sinus to drain exudate."
    },
    {
        q: "The Caldwell-Luc operation involves gaining entry into the maxillary sinus through the:",
        opts: ["Inferior meatus", "Canine fossa", "Nasal septum", "Orbital floor"],
        correct: 1,
        explain: "The Caldwell-Luc operation gains entry into the maxillary sinus via the canine fossa."
    },
    {
        q: "Which of the following is a potential complication of maxillary sinusitis?",
        opts: ["Hearing loss", "Orbital cellulitis", "Tooth decay", "Jaw dislocation"],
        correct: 1,
        explain: "Orbital cellulitis, osteomyelitis of the maxilla, and middle ear infections are listed as complications."
    },
    {
        q: "What is an Oroantral Fistula?",
        opts: ["A natural opening of the sinus", "A blockage in the sinus", "An unnatural communication between the oral cavity and maxillary sinus", "A type of sinus infection"],
        correct: 2,
        explain: "An oroantral fistula is an unnatural communication between the oral cavity and the maxillary sinus."
    },
    {
        q: "What is the most common cause of an Oroantral Fistula?",
        opts: ["Deep fungal infection", "Extraction of an upper tooth", "Malignancy", "Osteomyelitis"],
        correct: 1,
        explain: "The extraction of an upper tooth is a primary cause of oroantral fistula."
    },
    {
        q: "What is a sign of an oroantral fistula where liquids may pass from the mouth to the nose?",
        opts: ["Epistaxis", "Dysphagia", "Regurgitation of liquids", "Anosmia"],
        correct: 2,
        explain: "Regurgitation of liquids from the oral cavity into the nasal cavity is a key sign of an oroantral fistula."
    },
    {
        q: "Displacement of a tooth root into the maxillary sinus is most likely to happen with which tooth?",
        opts: ["Maxillary canine", "Maxillary central incisor", "Maxillary first molar", "Maxillary third molar"],
        correct: 2,
        explain: "The slides show an example of a maxillary first molar root accidentally pushed into the sinus."
    },
    {
        q: "What is the radiographic appearance of a tooth root in the sinus?",
        opts: ["A radiolucent area", "A radiopaque mass with layers of enamel, dentin & pulp", "A cotton-wool appearance", "A sun-ray appearance"],
        correct: 1,
        explain: "Radiographically, a displaced tooth appears as a radiopaque mass with the distinct layers of a tooth structure."
    },
    {
        q: "Which is a surgical procedure used to manage an oroantral fistula?",
        opts: ["Gingivectomy", "Apicoectomy", "Buccal Flap surgery", "Frenectomy"],
        correct: 2,
        explain: "Buccal Flap surgery and the Caldwell-Luc procedure are surgical management options for oroantral communications."
    },
    {
        q: "Which of the following is NOT an extrinsic disease of the maxillary sinus?",
        opts: ["Periostitis", "Osteomas", "Odontogenic tumors", "Traumatic injuries"],
        correct: 1,
        explain: "Osteomas are listed under benign neoplasms, which are intrinsic diseases."
    },
    {
        q: "The clinical features of mucositis are typically:",
        opts: ["Painful and symptomatic", "Asymptomatic", "Associated with fever", "Visible as a swelling on the cheek"],
        correct: 1,
        explain: "Mucositis is usually asymptomatic and discovered on routine radiographs."
    },
    {
        q: "In a Waters view radiograph of a patient with sinusitis, the border between the fluid and air is typically:",
        opts: ["Vertical", "Curved", "Irregular", "Horizontal"],
        correct: 3,
        explain: "The border between the radiopaque fluid and the radiolucent antrum is horizontal, known as an air-fluid level."
    },
    {
        q: "What is the purpose of the transillumination test in diagnosing sinusitis?",
        opts: ["To measure the sinus volume", "To show opacity in the involved sinus", "To culture bacteria", "To assess airflow"],
        correct: 1,
        explain: "The transillumination test shows opacity in the involved sinus, indicating it is filled with fluid or thickened mucosa rather than air."
    },
    {
        q: "What does 'unilateral epistaxis' refer to in the context of an oroantral fistula?",
        opts: ["Bleeding from both nostrils", "Nasal congestion", "Bleeding from the nose on one side", "Loss of smell"],
        correct: 2,
        explain: "Unilateral epistaxis means bleeding from the nose on one side, which can occur due to blood in the maxillary sinus."
    },
    {
        q: "Which condition can lead to odontogenic maxillary sinusitis?",
        opts: ["A healthy maxillary molar", "Overextension of dental material into the sinus", "Bruxism", "Gingivitis"],
        correct: 1,
        explain: "Overextension of materials like sealers, cements, or GP cones into the sinus can result in odontogenic maxillary sinusitis."
    },
    {
        q: "A simple clinical test for an oroantral communication after an extraction is:",
        opts: ["Percussion of adjacent teeth", "Asking the patient to hold their nose and blow gently", "Taking a panoramic radiograph", "Applying pressure to the socket"],
        correct: 1,
        explain: "Asking the patient to hold their nose and attempt to breathe out through it can show bubbles in the socket, indicating a communication."
    },
    {
        q: "The Caldwell-Luc operation combines entry via the canine fossa with what other procedure?",
        opts: ["A buccal flap", "A palatal flap", "A nasal antrostomy", "Extraction of a tooth"],
        correct: 2,
        explain: "The procedure involves gaining entry into the maxillary sinus via the canine fossa with a nasal antrostomy to facilitate drainage."
    }
];

const tfs = [
    {
        q: "Mucositis is a benign neoplasm of the maxillary sinus.",
        answer: false,
        explain: "Mucositis is an inflammatory disease, not a neoplasm."
    },
    {
        q: "The mucous membrane of the paranasal sinuses is composed of respiratory epithelium.",
        answer: true,
        explain: "The lining is indeed composed of respiratory epithelium."
    },
    {
        q: "Acute sinusitis is defined as an infection lasting over 12 weeks.",
        answer: false,
        explain: "Acute sinusitis lasts up to 4 weeks. Chronic sinusitis is over 12 weeks."
    },
    {
        q: "A Water's view radiograph is not useful for diagnosing sinusitis.",
        answer: false,
        explain: "A Water's (Occipitomental) view is a key diagnostic tool for sinusitis."
    },
    {
        q: "Chronic sinusitis is always associated with severe pain.",
        answer: false,
        explain: "Chronic sinusitis often presents with no pain, but with a purulent, foul-smelling discharge."
    },
    {
        q: "Antral lavage is a surgical procedure to remove the entire maxillary sinus.",
        answer: false,
        explain: "Antral lavage is the irrigation of the sinus to clear out exudate, not its removal."
    },
    {
        q: "An oroantral fistula is a natural communication between the oral cavity and the sinus.",
        answer: false,
        explain: "It is an unnatural communication, often caused by trauma or tooth extraction."
    },
    {
        q: "Regurgitation of liquids into the nose can be a sign of an oroantral fistula.",
        answer: true,
        explain: "This is a classic sign, as fluids can pass from the mouth to the sinus and then to the nose."
    },
    {
        q: "The Caldwell-Luc operation provides access to the maxillary sinus through the inferior meatus.",
        answer: false,
        explain: "It provides access through the canine fossa, not the inferior meatus."
    }
];

const saqs = [
    {
        q: "Define mucositis and describe its appearance on a radiograph.",
        a: "Mucositis is the inflammation and thickening of the mucous membrane lining the maxillary sinus. On a radiograph, it appears as a noticeably more radiopaque (brighter) band that parallels the bony wall of the sinus."
    },
    {
        q: "List three distinct causes of an oroantral fistula.",
        a: `
            <ol>
                <li>Extraction of an upper tooth (especially molars and premolars).</li>
                <li>Trauma to the face or maxilla.</li>
                <li>Pathological processes such as osteomyelitis, malignancy, or deep fungal infections.</li>
            </ol>
        `
    },
    {
        q: "Compare the typical clinical features of acute maxillary sinusitis versus chronic maxillary sinusitis.",
        a: `
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Acute Sinusitis</th>
                        <th>Chronic Sinusitis</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><b>Pain</b></td>
                        <td>Present, especially on bending forward. Tenderness over the cheek.</td>
                        <td>Often absent or non-specific.</td>
                    </tr>
                    <tr>
                        <td><b>Discharge</b></td>
                        <td>Nasal discharge is common.</td>
                        <td>Purulent, foul-smelling discharge is characteristic.</td>
                    </tr>
                    <tr>
                        <td><b>Constitutional Symptoms</b></td>
                        <td>Fever, malaise, and body ache are common.</td>
                        <td>Usually absent. Symptoms like insomnia or voice change can occur.</td>
                    </tr>
                     <tr>
                        <td><b>Duration</b></td>
                        <td>Up to 4 weeks.</td>
                        <td>Over 12 weeks, lasting for months or years.</td>
                    </tr>
                </tbody>
            </table>
        `
    },
    {
        q: "Describe the medical management steps for acute maxillary sinusitis.",
        a: `
            <ol>
                <li><b>Antibiotics:</b> Broad-spectrum antibiotics to combat the bacterial infection.</li>
                <li><b>Decongestants:</b> To reduce mucosal swelling and promote sinus drainage.</li>
                <li><b>Analgesics:</b> Pain relievers like paracetamol to manage pain and fever.</li>
                <li><b>Steam Inhalation:</b> Often with menthol, to help soothe membranes and promote drainage.</li>
                <li><b>Hot Fomentation:</b> Applying a warm compress to the cheek area for soothing relief.</li>
            </ol>
        `
    },
    {
        q: "A patient presents to your clinic a day after the extraction of their upper right first molar. They complain that liquids they drink are coming out of their right nostril. What is the most likely diagnosis, and what simple clinical test could you perform to confirm it?",
        a: "The most likely diagnosis is an oroantral fistula (or communication). This is an opening between the oral cavity and the maxillary sinus created during the extraction. A simple clinical test is to ask the patient to gently pinch their nose closed and try to blow out through it. If a fistula is present, air bubbles will be seen coming from the extraction socket."
    },
    {
        q: "Explain the Caldwell-Luc operation, including its purpose and point of entry.",
        a: "The Caldwell-Luc operation is a surgical procedure used to gain access to the maxillary sinus, typically for treating chronic sinusitis or removing foreign bodies. The purpose is to create an opening to clear out diseased tissue and establish better drainage. The entry point is made through the canine fossa, which is the depression in the maxillary bone above the canine tooth root."
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
