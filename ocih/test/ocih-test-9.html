<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);} 
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 9</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled) -----------
const mcqs = [
  { q:"Which sequence correctly orders the histologic stages of crown development?", opts:["Cap ‚Üí Bud ‚Üí Early bell ‚Üí Advanced bell","Bud ‚Üí Cap ‚Üí Early bell ‚Üí Advanced bell","Bud ‚Üí Early bell ‚Üí Cap ‚Üí Advanced bell","Cap ‚Üí Early bell ‚Üí Bud ‚Üí Advanced bell"], correct:1, explain:"Tooth morphogenesis proceeds Bud ‚Üí Cap ‚Üí Early bell ‚Üí Advanced bell." },
  { q:"The defining feature of the bud stage is:", opts:["Presence of enamel knot signaling","A hemispherical enamel organ with a concavity","Localized epithelial proliferation with little cytodifferentiation","Formation of stratum intermedium"], correct:2, explain:"Bud stage = focal proliferation of oral ectoderm into underlying ectomesenchyme without clear tissue layers." },
  { q:"During the cap stage, the first clear delineation of which tissues appears?", opts:["Enamel organ, dental papilla, and dental follicle","Hertwig's epithelial root sheath and cementoblasts","Secondary enamel knots and cusp tips","Reduced enamel epithelium and junctional epithelium"], correct:0, explain:"Cap stage shows enamel organ capping a condensed dental papilla, surrounded by dental follicle (sac)." },
  { q:"Primary enamel knot is best described as:", opts:["A mineralization front at the future DEJ","A transient epithelial signaling center that patterns cusps","The stem cell niche of the dental papilla","A vascular plexus within stellate reticulum"], correct:1, explain:"The primary enamel knot secretes morphogens that control cusp patterning; it is transient and undergoes apoptosis." },
  { q:"The dental lamina arises from:", opts:["Neural crest-derived ectomesenchyme","Oral ectoderm","Endoderm of the first pharyngeal arch","Mesodermal epithelium"], correct:1, explain:"Dental lamina is a thickening of the oral ectoderm." },
  { q:"Successional teeth (incisors, canines, premolars) develop from:", opts:["Posterior extension of the dental lamina","A lingual offshoot of the dental lamina adjacent to each primary tooth","Direct proliferation of dental papilla","Epithelial rests of Malassez"], correct:1, explain:"Successional lamina buds lingual to primary tooth germs; accessional teeth (molars) arise from posterior extension." },
  { q:"Which combination of epithelial layers is characteristic of the early bell stage?", opts:["IEE only","IEE and OEE with no intervening cells","IEE, OEE, stellate reticulum, and stratum intermedium","OEE and stratum intermedium only"], correct:2, explain:"The enamel organ differentiates into inner enamel epithelium, outer enamel epithelium, stellate reticulum, and stratum intermedium." },
  { q:"A major event of the advanced bell stage is:", opts:["Initiation of root formation","Breakdown of the dental lamina to form the dental cuticle","Histodifferentiation and onset of hard tissue formation","Eruption through oral mucosa"], correct:2, explain:"Advanced bell features histodifferentiation of IEE‚Üíameloblasts and peripheral papilla cells‚Üíodontoblasts with matrix deposition." },
  { q:"The basement membrane between IEE and dental papilla becomes the:", opts:["Cementoenamel junction (CEJ)","Dentinoenamel junction (DEJ)","Dentinocemental junction","Alveolodental ligament"], correct:1, explain:"Future DEJ corresponds to the initial basement membrane interface." },
  { q:"After induction by odontoblasts, IEE cells differentiate into:", opts:["Cementoblasts","Ameloblasts","Fibroblasts of PDL","Osteoblasts"], correct:1, explain:"Dentinogenesis precedes enamel formation; odontoblast-derived signals induce ameloblast differentiation." },
  { q:"Which occurs first at cusp tips?", opts:["Enamel matrix deposition","Dentin matrix deposition","Cementum deposition","Bone trabeculae formation"], correct:1, explain:"Odontoblasts lay down predentin first; ameloblasts follow with enamel matrix." },
  { q:"The cervical loop refers to:", opts:["Fusion of reduced enamel epithelium with oral epithelium","The rim where IEE meets OEE at the cervical margin","A condensation of follicle forming PDL","A groove on the developing crown"], correct:1, explain:"Cervical loop is the IEE‚ÄìOEE junction at the cervical edge; later contributes to HERS for roots." },
  { q:"Function of the stellate reticulum includes:", opts:["Secreting enamel matrix","Providing a hydrated cushion that maintains crown shape","Producing cementum","Inducing dentin formation"], correct:1, explain:"Star-shaped cells with GAG-rich ECM maintain space and protect IEE." },
  { q:"Stratum intermedium is notable for high activity of:", opts:["Tartrate-resistant acid phosphatase","Alkaline phosphatase","Carbonic anhydrase","Lactate dehydrogenase"], correct:1, explain:"Stratum intermedium supports ameloblast mineralization; ALP activity is high." },
  { q:"The dental papilla ultimately forms:", opts:["Cementum and PDL","Enamel and reduced enamel epithelium","Dentin and dental pulp","Alveolar bone and PDL"], correct:2, explain:"Papilla gives rise to odontoblasts (dentin) and the pulp." },
  { q:"Structures derived from the dental follicle (sac) include all EXCEPT:", opts:["Cementum","Periodontal ligament","Alveolar bone","Enamel"], correct:3, explain:"Follicle forms the periodontium (cementum, PDL, alveolar bone); enamel is ectodermal (ameloblasts)." },
  { q:"The successional lamina typically appears:", opts:["Before the cap stage of the primary tooth","During cap to early bell stages of the primary tooth","Only after eruption of the primary tooth","Only in molar regions"], correct:1, explain:"Successional buds arise lingual to primary germs around cap/early bell." },
  { q:"Vascular supply to the enamel organ is primarily:", opts:["Rich intravascular network within stellate reticulum","Absent within the enamel organ; vessels remain external","Confined to stratum intermedium","Carried by the IEE"], correct:1, explain:"Enamel organ is avascular; nutrients diffuse from vessels in surrounding follicle via OEE/SR." },
  { q:"Following crown completion, the enamel organ transforms into:", opts:["Reduced enamel epithelium","Junctional epithelium directly","Hertwig's epithelial root sheath","Epithelial rests of Malassez"], correct:0, explain:"Post-amelogenesis, enamel organ flattens to reduced enamel epithelium; it later contributes to junctional epithelium after eruption." },
  { q:"Determinants of crown shape reside mainly in:", opts:["Random deposition by ameloblasts","Patterning of IEE folding and enamel knot signals","Arrangement of Sharpey's fibers","Thickness of stratum intermedium alone"], correct:1, explain:"Morphodifferentiation is guided by enamel knot signaling and IEE architecture." },
  { q:"Mitotic activity that maintains growth at the crown rim is concentrated in the:", opts:["Cusp tip IEE","Stratum intermedium","Cervical loop","Dental papilla core"], correct:2, explain:"The cervical loop retains proliferative capacity during crown development." },
  { q:"Secondary enamel knots typically appear:", opts:["During bud stage","At late cap/early bell at future cusp sites","After eruption","Only in incisors"], correct:1, explain:"Secondary enamel knots form at future cusp tips and refine cusp patterning." },
  { q:"Which permanent teeth are accessional?", opts:["Incisors and canines","Premolars","First, second, and third molars","Primary molars"], correct:2, explain:"Accessional teeth (molars) arise from posterior extension of dental lamina, not from successional lamina." },
  { q:"Direction of enamel deposition in a developing cusp is primarily:", opts:["From cervical margin toward cusp tip","From cusp tip cervically toward the CEJ","Uniform in all directions","From DEJ toward enamel surface only at the end"], correct:1, explain:"Apposition starts at cusp/incisal edges and progresses cervically." },
  { q:"Earliest mineralization is expected at:", opts:["Cervical loop","Future cusp tips/incisal edges along the DEJ","Future CEJ","PDL attachment sites"], correct:1, explain:"Initial dentin/enamel formation begins at the highest points of the crown." },
  { q:"Which best separates dental papilla from surrounding ectomesenchyme?", opts:["Enamel organ","Dental follicle","Basement membrane","Reduced enamel epithelium"], correct:1, explain:"Outside the enamel organ+papilla complex lies the condensed ectomesenchyme called dental follicle (sac)." },
  { q:"A key trigger for ameloblast differentiation is the presence of:", opts:["Cementoid matrix","Predentin at the IEE basement membrane","Osteoid from alveolus","Vascular invasion of stellate reticulum"], correct:1, explain:"Odontoblasts lay predentin; its signals induce IEE to become ameloblasts." },
  { q:"Outer enamel epithelium (OEE) cells are typically:", opts:["Tall columnar with Tomes' processes","Low cuboidal and associated with an external vascular plexus","Spindle-shaped and fibroblastic","Osteoclastic"], correct:1, explain:"OEE is a protective low-cuboidal epithelium adjacent to follicular vasculature." },
  { q:"Crown morphodifferentiation is largely completed by the:", opts:["Bud stage","Cap stage","Early‚ÄìAdvanced bell stages","Root formation stage"], correct:2, explain:"Crown shape becomes finalized through early and advanced bell stages before root formation." },
  { q:"Breakdown of dental lamina islands within the jaw may leave:", opts:["Enamel spindles","Enamel lamellae","Epithelial pearls/rests","Odontoblastic processes"], correct:2, explain:"Detached dental lamina fragments can persist as epithelial pearls (rests)." }
];

const tfs = [
  { q:"Successional teeth arise lingual to their primary predecessors.", answer:true, explain:"They bud from the successional lamina on the lingual aspect of primary germs." },
  { q:"Accessional teeth originate from the successional lamina.", answer:false, explain:"Accessional teeth (molars) come from posterior extension of the dental lamina." },
  { q:"Dental lamina is mesenchymal in origin.", answer:false, explain:"It is epithelial, derived from oral ectoderm." },
  { q:"The basement membrane between IEE and papilla becomes the CEJ.", answer:false, explain:"It becomes the DEJ; CEJ is at the crown‚Äìroot junction formed later." },
  { q:"Odontoblast differentiation precedes ameloblast differentiation.", answer:true, explain:"Dentinogenesis starts first and induces ameloblasts to secrete enamel." },
  { q:"Stratum intermedium is a feature of the bud stage.", answer:false, explain:"It appears with the bell stage as enamel organ stratifies." },
  { q:"Stellate reticulum often collapses late to reduce diffusion distance before enamel secretion ends.", answer:true, explain:"Collapse brings vasculature closer to ameloblast layer during maturation." },
  { q:"Enamel is derived from neural crest cells.", answer:false, explain:"Enamel comes from epithelial ameloblasts; neural crest forms ectomesenchyme (papilla/follicle)." },
  { q:"Dental papilla originates from neural crest-derived ectomesenchyme.", answer:true, explain:"Papilla and follicle are ectomesenchymal (neural crest) derivatives." },
  { q:"The primary enamel knot undergoes apoptosis after signaling.", answer:true, explain:"It is a transient signaling center." },
  { q:"Hertwig's epithelial root sheath forms during crown (bell) stages.", answer:false, explain:"HERS forms after crown completion to shape roots." },
  { q:"Reduced enamel epithelium later contributes to junctional epithelium after eruption.", answer:true, explain:"REE fuses with oral epithelium and forms the initial junctional epithelium." }
];

const saqs = [
  // 1) Direct Answer
  { q: "Briefly describe the chief event of the advanced bell stage.", a: "Histodifferentiation with initial dentin then enamel matrix deposition (hard tissue)." },
  // 2) List / Enumeration (numbered)
  { q: "List three derivatives of the dental follicle.", a: "1) Cementum  2) Periodontal ligament  3) Alveolar bone" },
  // 3) Comparison (table + numbered)
  { q: "Compare successional vs accessional teeth in two points.", a: `<table style="width:100%;border-collapse:collapse"><thead><tr><th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.2)">#</th><th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.2)">Successional</th><th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.2)">Accessional</th></tr></thead><tbody><tr><td>1</td><td>Develop from successional lamina lingual to primary teeth</td><td>Develop from posterior extension of dental lamina</td></tr><tr><td>2</td><td>Form permanent incisors, canines, premolars</td><td>Form permanent molars (1st‚Äì3rd)</td></tr></tbody></table>` }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
 tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
