<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 9</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ŸÑŸéÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸéŸëÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (based on Lecture 19: Development of Tooth) -----------
const mcqs = [
  { q:"Which is the correct chronological order of histologic stages in tooth development?", opts:["Bud ‚Üí Cap ‚Üí Early Bell ‚Üí Advanced Bell","Cap ‚Üí Bud ‚Üí Early Bell ‚Üí Advanced Bell","Bud ‚Üí Early Bell ‚Üí Cap ‚Üí Advanced Bell","Initiation ‚Üí Apposition ‚Üí Bud ‚Üí Bell"], correct:0, explain:"Classic sequence: bud, cap, early bell (histodifferentiation), advanced bell (apposition)." },
  { q:"A hallmark of the bud stage is:", opts:["Proliferation of dental lamina into spherical epithelial outgrowths","Presence of enamel knot signaling center","Formation of stratum intermedium","Deposition of enamel and dentin"], correct:0, explain:"Bud stage = proliferation without pronounced morpho/histodifferentiation." },
  { q:"During the cap stage, the epithelial structure that first appears as a signaling center is the:", opts:["Enamel knot","Cervical loop","Hertwig‚Äôs epithelial root sheath","Tomes‚Äô process"], correct:0, explain:"The primary enamel knot is a transient signaling center guiding cusp patterning in the cap stage." },
  { q:"The EARLY bell stage is primarily associated with:", opts:["Histodifferentiation of IEE to preameloblasts and papilla cells to odontoblasts","Matrix deposition of enamel","Root formation","Eruption pathway formation"], correct:0, explain:"Early bell: morpho- and histodifferentiation in the enamel organ and papilla." },
  { q:"The ADVANCED bell stage is characterized by:", opts:["Apposition of dentin and enamel matrices","Initial formation of enamel organ","Breakdown of dental lamina into epithelial pearls","Formation of HERS"], correct:0, explain:"Advanced bell proceeds to apposition where dentin and enamel matrices are laid down." },
  { q:"Correct set of enamel organ layers at bell stage:", opts:["Outer enamel epithelium, Stellate reticulum, Stratum intermedium, Inner enamel epithelium","Outer enamel epithelium, Stratum intermedium, Outer dental epithelium, Inner enamel epithelium","Outer enamel epithelium, Dental follicle, Stratum intermedium, Inner dental epithelium","Osteoblast layer, Stellate reticulum, Stratum intermedium, Inner dentin epithelium"], correct:0, explain:"Enamel organ differentiates into OEE, SR, SI, and IEE." },
  { q:"Stratum intermedium is functionally linked to:", opts:["Enamel mineralization via high alkaline phosphatase activity","Cushioning the enamel organ by water-rich matrix","Inducing odontoblast differentiation","Root sheath formation"], correct:0, explain:"SI supports ameloblasts and shows high ALP aiding enamel mineralization." },
  { q:"Stellate reticulum‚Äôs main role is to:", opts:["Maintain space and protect the developing enamel organ","Secrete dentin sialophosphoprotein","Form the DEJ","Differentiate into cementoblasts"], correct:0, explain:"SR acts as a shock absorber maintaining crown shape and space." },
  { q:"The dental papilla ultimately forms:", opts:["Dentin and dental pulp","Cementum and PDL","Alveolar bone and cementum","Enamel and pulp"], correct:0, explain:"Papilla gives rise to odontoblasts (dentin) and dental pulp tissue." },
  { q:"The dental follicle (sac) gives rise to:", opts:["Cementum, periodontal ligament, alveolar bone","Enamel and dentin","Pulp and dentin","Stratum intermedium and stellate reticulum"], correct:0, explain:"Follicle forms the periodontium supporting tissues." },
  { q:"The basement membrane between IEE and papilla later becomes the:", opts:["Dentinoenamel junction (DEJ)","Cementoenamel junction (CEJ)","Pulp-dentin border","Alveolar crest"], correct:0, explain:"As dentin and enamel are laid, their junction corresponds to former basement membrane." },
  { q:"First hard tissue laid during apposition:", opts:["Mantle dentin","Enamel","Cementum","Bone"], correct:0, explain:"Odontoblasts lay mantle dentin first; enamel follows after reciprocal induction." },
  { q:"Reciprocal induction refers to:", opts:["Preameloblasts inducing odontoblast differentiation and then odontoblasts inducing ameloblasts","HERS inducing ameloblasts which induce cementoblasts","SR inducing SI which induces OEE","PDL inducing alveolar bone"], correct:0, explain:"Preameloblasts trigger odontoblasts; odontoblast dentin formation then triggers ameloblasts." },
  { q:"Hertwig‚Äôs epithelial root sheath (HERS) is derived from:", opts:["Cervical loop of IEE and OEE","Stratum intermedium","Dental papilla","Gubernacular cord"], correct:0, explain:"HERS forms from the proliferating cervical loop (IEE + OEE)." },
  { q:"Function of HERS:", opts:["Guides root dentin shape and length","Deposits cementum directly","Forms enamel rods","Creates stellate reticulum"], correct:0, explain:"HERS molds the root and induces radicular dentin formation." },
  { q:"Epithelial rests of Malassez represent remnants of:", opts:["Disintegrated HERS","Dental lamina","Reduced enamel epithelium","Stratum intermedium"], correct:0, explain:"After HERS breaks up, its remnants persist in PDL as rests of Malassez." },
  { q:"Successional teeth arise from:", opts:["Localized proliferation of dental lamina on the lingual of each primary tooth germ","Posterior extension of dental lamina behind last primary tooth","Divisions of HERS","Epithelial rests of Malassez"], correct:0, explain:"Successional lamina forms lingual to primary tooth germs for incisors, canines, premolars." },
  { q:"Accessional teeth (permanent molars) develop via:", opts:["Posterior extension of the dental lamina","Successional lamina lingual to primary molars","Fragmentation of REE","Secondary cementogenesis"], correct:0, explain:"Molars come from a backward extension of dental lamina." },
  { q:"Breakdown of the dental lamina may leave epithelial remnants known as:", opts:["Rests of Serres","Rests of Malassez","Rests of von Ebner","Nasmyth‚Äôs membrane"], correct:0, explain:"Rests of Serres are remnants of dental lamina in gingiva." },
  { q:"The cervical loop is defined as the junction of:", opts:["IEE and OEE at the rim of the enamel organ","SR and SI","IEE and dental papilla","Cementum and enamel"], correct:0, explain:"At the rim, IEE meets OEE; this region proliferates apically to form HERS." },
  { q:"The first-formed enamel is secreted by ameloblasts that develop a distal process called:", opts:["Tomes‚Äô process","Hunter-Schreger band","Korff‚Äôs fiber","Ruffle-ended process"], correct:0, explain:"Tomes‚Äô process shapes enamel prisms/rods." },
  { q:"Odontoblast processes reside within:", opts:["Dentinal tubules","Enamel rods","Cementocyte lacunae","Haversian canals"], correct:0, explain:"Long processes extend into dentinal tubules (Tom√©s fibers)." },
  { q:"Mantle dentin differs from circumpulpal dentin by:", opts:["Being the first, less mineralized layer with larger collagen fibers","Being laid after circumpulpal dentin","Having more peritubular dentin","Containing enamel prisms"], correct:0, explain:"Mantle dentin is initial, has large collagen fibers (Korff‚Äôs), slightly different mineralization." },
  { q:"Which statement about reduced enamel epithelium (REE) is TRUE?", opts:["It forms from the fusion of ameloblasts with residual OEE, SR, and SI after enamel maturation","It is another name for HERS","It differentiates into odontoblasts","It is part of dental papilla"], correct:0, explain:"REE covers the enamel and participates in eruption/junctional epithelium formation." },
  { q:"Gubernacular canal is related to:", opts:["Eruption pathway for successional teeth","Formation of CEJ","Root bifurcation of molars","Initiation of dental lamina"], correct:0, explain:"Contains gubernacular cord aiding eruption of permanent successors." },
  { q:"Enamel is derived from:", opts:["Ectoderm (oral epithelium)","Ectomesenchyme","Neural crest-derived follicle","Mesoderm of alveolar bone"], correct:0, explain:"Ameloblasts originate from oral ectoderm-derived enamel organ." },
  { q:"Dentin and pulp are derived from:", opts:["Ectomesenchyme of neural crest","Oral ectoderm","Endoderm","Paraxial mesoderm"], correct:0, explain:"Cranial neural crest ectomesenchyme forms papilla (dentin+pulp)." },
  { q:"Lateral (accessory) root canals most commonly arise due to:", opts:["Breaks in HERS or premature disintegration allowing papilla to contact follicle","Failure of SI to mineralize","Excess enamel deposition apically","Persistence of enamel organ in root"], correct:0, explain:"Gaps in HERS permit accessory canal formation in root dentin." },
  { q:"Lines of Retzius represent:", opts:["Incremental growth lines in enamel","Predentin band before mineralization","Increments in dentin","Cementum reversal lines"], correct:0, explain:"They are incremental growth lines in enamel visible in ground sections." },
  { q:"During cap stage, the tissue around the enamel organ that forms the periodontium is the:", opts:["Dental follicle (sac)","Dental papilla","Stratum intermedium","Reduced enamel epithelium"], correct:0, explain:"Follicle surrounds organ+papilla and later forms cementum, PDL, alveolar bone." }
];

const tfs = [
  { q:"Successional teeth develop from a successional lamina located lingual to primary tooth germs.", answer:true, explain:"This lamina buds off the dental lamina on the lingual side of primary teeth." },
  { q:"Enamel matrix is deposited before dentin during apposition.", answer:false, explain:"Dentin (by odontoblasts) forms first; enamel follows." },
  { q:"Outer enamel epithelium differentiates into ameloblasts.", answer:false, explain:"Ameloblasts arise from inner enamel epithelium (IEE)." },
  { q:"Hertwig‚Äôs epithelial root sheath contains stellate reticulum and stratum intermedium layers.", answer:false, explain:"HERS is formed from IEE and OEE only." },
  { q:"The dentinoenamel junction corresponds to the former basement membrane between IEE and papilla.", answer:true, explain:"As matrices are laid down, the old basement membrane position becomes DEJ." },
  { q:"Dental follicle gives rise to pulp tissue.", answer:false, explain:"Pulp derives from dental papilla, not follicle." },
  { q:"Enamel is of ectomesenchymal origin.", answer:false, explain:"Enamel is epithelial (ectodermal) in origin." },
  { q:"Stratum intermedium cells are rich in alkaline phosphatase activity.", answer:true, explain:"SI supports enamel mineralization and shows high ALP." },
  { q:"Permanent molars are examples of accessional teeth.", answer:true, explain:"They arise from posterior extension of dental lamina, not from successional lamina." }
];

const saqs = [
  // 1. Direct Answer
  { q: "Define the enamel knot and state when it appears.", a: "Transient signaling center in the cap stage guiding cusp patterning." },
  // 2. List / Enumeration (3+)
  { q: "List three derivatives of the dental follicle.", a: "1) Cementum 2) Periodontal ligament 3) Alveolar bone" },
  // 3. Comparison as a numbered table
  { q: "Compare BUD, CAP, and EARLY BELL stages in terms of key events.", a: `<table style='width:100%;border-collapse:collapse'><tr><th style='border:1px solid #555;padding:6px'>#</th><th style='border:1px solid #555;padding:6px'>Stage</th><th style='border:1px solid #555;padding:6px'>Key event</th></tr><tr><td style='border:1px solid #555;padding:6px'>1</td><td style='border:1px solid #555;padding:6px'>Bud</td><td style='border:1px solid #555;padding:6px'>Proliferation of dental lamina; no major histodifferentiation.</td></tr><tr><td style='border:1px solid #555;padding:6px'>2</td><td style='border:1px solid #555;padding:6px'>Cap</td><td style='border:1px solid #555;padding:6px'>Enamel organ cap-shape; enamel knot appears; papilla & follicle evident.</td></tr><tr><td style='border:1px solid #555;padding:6px'>3</td><td style='border:1px solid #555;padding:6px'>Early Bell</td><td style='border:1px solid #555;padding:6px'>Morpho- & histodifferentiation; IEE‚Üípreameloblasts; papilla‚Üíodontoblasts.</td></tr></table>` },
  // 4. Case-based Scenario
  { q: "A developing premolar shows a gubernacular canal above its crown on CBCT. What eruptive role does this structure serve?", a: "Provides a soft-tissue pathway (via gubernacular cord) guiding eruption of the successor." },
  // 5. Short direct
  { q: "Name the first hard tissue formed during tooth development and where it is first laid.", a: "Mantle dentin; at the cusp tip/incipient cusp area along the future DEJ." },
  // 6. Short direct
  { q: "State the origin of epithelial rests of Malassez.", a: "Remnants of Hertwig‚Äôs epithelial root sheath within the PDL." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
