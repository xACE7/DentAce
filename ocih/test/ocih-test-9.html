<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer table{width:100%;border-collapse:collapse;}
  .answer th, .answer td{border:1px solid var(--card-border);padding:8px;text-align:left;}
  .answer th{font-weight:bold;}
  .answer ol{padding-left:20px;margin:0;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 9</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    { q: "Which stage of tooth development is characterized by a small, localized proliferation of epithelial cells into the underlying ectomesenchyme?", opts: ["Cap Stage", "Bud Stage", "Bell Stage", "Late Cap Stage"], correct: 1, explain: "The Bud Stage is the initial stage, marked by the proliferation of the dental lamina into a small bud-shaped enamel organ." },
    { q: "The enamel organ, dental papilla, and dental follicle together are known as the:", opts: ["Tooth Germ", "Stellate Reticulum", "Dental Lamina", "Hertwig's Epithelial Root Sheath"], correct: 0, explain: "The tooth germ is comprised of the enamel organ, dental papilla, and dental follicle, which collectively give rise to the entire tooth." },
    { q: "In the Cap Stage, what is the term for the ectomesenchymal condensation located within the concavity of the enamel organ?", opts: ["Dental Sac", "Stellate Reticulum", "Dental Papilla", "Outer Enamel Epithelium"], correct: 2, explain: "The dental papilla is the condensation of ectomesenchymal cells that will eventually form the dentin and pulp of the tooth." },
    { q: "The outer layer of the enamel organ, composed of cuboidal cells, is known as the:", opts: ["Inner Enamel Epithelium", "Stellate Reticulum", "Stratum Intermedium", "Outer Enamel Epithelium"], correct: 3, explain: "The Outer Enamel Epithelium is the protective outer layer of the enamel organ." },
    { q: "Which structure is composed of star-shaped cells that form a network within the enamel organ, providing mechanical support?", opts: ["Dental Papilla", "Stellate Reticulum", "Inner Enamel Epithelium", "Dental Follicle"], correct: 1, explain: "The Stellate Reticulum's star-shaped cells and extracellular matrix act as a shock absorber, protecting the developing tooth." },
    { q: "The cells that will differentiate into ameloblasts and produce enamel are the:", opts: ["Odontoblasts", "Cementoblasts", "Inner Enamel Epithelium cells", "Outer Enamel Epithelium cells"], correct: 2, explain: "The tall, columnar cells of the Inner Enamel Epithelium differentiate into ameloblasts, which are responsible for enamel formation." },
    { q: "What is the primary function of the dental follicle (dental sac)?", opts: ["To form enamel", "To form dentin and pulp", "To form the supporting tissues of the tooth", "To nourish the stellate reticulum"], correct: 2, explain: "The dental follicle gives rise to the periodontium, which includes the cementum, periodontal ligament, and alveolar bone." },
    { q: "The Bell Stage is characterized by the differentiation of which two distinct cell layers within the enamel organ?", opts: ["Odontoblasts and Cementoblasts", "Inner and Outer Enamel Epithelium", "Ameloblasts and Odontoblasts", "Stratum Intermedium and Stellate Reticulum"], correct: 3, explain: "During the Bell Stage, the enamel organ becomes more complex with the appearance of the stratum intermedium, a layer of cells between the IEE and stellate reticulum." },
    { q: "The junction where the inner and outer enamel epithelium meet is called the:", opts: ["Cervical Loop", "Enamel Knot", "Dental Lamina", "Enamel Cord"], correct: 0, explain: "The cervical loop is the growing rim of the enamel organ and is crucial for root formation." },
    { q: "What is the fate of the dental lamina after it has fulfilled its role in tooth initiation?", opts: ["It forms the permanent teeth", "It disintegrates and its remnants are called epithelial rests of Serres", "It becomes the dental papilla", "It transforms into the stellate reticulum"], correct: 1, explain: "The dental lamina breaks down after initiating the tooth germs. Its remnants can sometimes form cysts." },
    { q: "The successional (permanent) teeth develop from a lingual extension of the:", opts: ["Dental Papilla", "Stellate Reticulum", "Dental Lamina", "Dental Follicle"], correct: 2, explain: "The dental lamina gives rise to both the primary tooth germ and a lingual bud that will form the successional permanent tooth." },
    { q: "Which structure is a transient signaling center that plays a role in determining the shape of the tooth crown?", opts: ["Cervical Loop", "Enamel Knot", "Stratum Intermedium", "Dental Sac"], correct: 1, explain: "The enamel knot is a cluster of non-dividing cells in the cap stage that orchestrates cusp development through signaling." },
    { q: "The overall shape of the enamel organ in the cap stage is determined by:", opts: ["The dental papilla", "The oral ectoderm", "Pressure from the surrounding ectomesenchyme", "Unequal and differential growth of epithelial cells"], correct: 3, explain: "Histodifferentiation and morphodifferentiation involve complex, unequal growth patterns within the enamel organ to define the cap and bell shapes." },
    { q: "In the bud stage, the enamel organ consists of peripheral columnar cells and central:", opts: ["Star-shaped cells", "Cuboidal cells", "Polyhedral cells", "Squamous cells"], correct: 2, explain: "As shown in diagrams of the bud stage, the core of the enamel organ is filled with closely packed polyhedral cells." },
    { q: "Accessional teeth, such as permanent molars, form from a:", opts: ["Lingual extension of the dental lamina", "Posterior extension of the dental lamina", "Bud from a primary tooth germ", "Separate, independent dental lamina"], correct: 1, explain: "Unlike successional teeth, permanent molars (accessional teeth) arise from a posterior growth of the main dental lamina." },
    { q: "The dental papilla is derived from which type of tissue?", opts: ["Oral Ectoderm", "Endoderm", "Ectomesenchyme", "Mesoderm"], correct: 2, explain: "Ectomesenchyme, derived from neural crest cells, migrates and condenses to form the dental papilla and follicle." },
    { q: "What is the primary role of the stratum intermedium?", opts: ["To protect the enamel organ", "To support the ameloblasts in enamel formation", "To form the dental papilla", "To provide nutrition to the stellate reticulum"], correct: 1, explain: "The stratum intermedium works with the inner enamel epithelium (ameloblasts) and is essential for enamel mineralization." },
    { q: "During which stage does the tooth germ acquire its definitive cap-like shape?", opts: ["Bud Stage", "Early Thickening", "Cap Stage", "Bell Stage"], correct: 2, explain: "The Cap Stage is defined by the invagination of the epithelial bud, creating a cap shape over the dental papilla." },
    { q: "The inner enamel epithelium consists of what type of cells at the concavity of the cap stage?", opts: ["Cuboidal cells", "Columnar cells", "Star-shaped cells", "Flat cells"], correct: 1, explain: "The cells of the inner enamel epithelium become elongated and columnar as they prepare to differentiate into ameloblasts." },
    { q: "What structure connects the enamel organ to the oral ectoderm during the early stages?", opts: ["Enamel Cord", "Cervical Loop", "Dental Lamina", "Dental Follicle"], correct: 2, explain: "The dental lamina is the band of epithelial tissue that connects the developing tooth bud to the surface oral epithelium." },
    { q: "The process of tooth development is also known as:", opts: ["Amelogenesis", "Dentinogenesis", "Odontogenesis", "Cementogenesis"], correct: 2, explain: "Odontogenesis is the complex process that results in the formation of teeth." },
    { q: "Which of the following is NOT part of the enamel organ?", opts: ["Outer enamel epithelium", "Stellate reticulum", "Dental papilla", "Inner enamel epithelium"], correct: 2, explain: "The dental papilla is a separate structure derived from the ectomesenchyme; it is not part of the epithelial enamel organ." },
    { q: "The early thickening of the oral epithelium marks the very first sign of tooth development, preceding which stage?", opts: ["Bud Stage", "Cap Stage", "Bell Stage", "Late Cap Stage"], correct: 0, explain: "Tooth development begins with the formation of a primary epithelial band, which then thickens before the bud stage begins." },
    { q: "What is the primary component of the stellate reticulum that gives it its characteristic appearance?", opts: ["Collagen fibers", "Glycosaminoglycans (GAGs)", "Keratin", "Odontoblasts"], correct: 1, explain: "The star-shaped cells secrete hydrophilic GAGs, which draw in water and expand the volume of the stellate reticulum." },
    { q: "The dental follicle is also known as the:", opts: ["Dental Papilla", "Dental Sac", "Enamel Organ", "Tooth Germ"], correct: 1, explain: "The terms dental follicle and dental sac are used interchangeably to refer to the ectomesenchymal sac surrounding the tooth germ." },
    { q: "In the late bell stage, the dental lamina starts to:", opts: ["Proliferate rapidly", "Form the enamel knot", "Disintegrate", "Form the dental papilla"], correct: 2, explain: "As tooth development progresses into the late bell stage, the connection to the oral epithelium via the dental lamina is no longer needed and it begins to break down." },
    { q: "Which cells are responsible for the formation of dentin?", opts: ["Ameloblasts", "Odontoblasts", "Cementoblasts", "Fibroblasts"], correct: 1, explain: "Odontoblasts differentiate from the outer cells of the dental papilla and are responsible for secreting the organic matrix of dentin." },
    { q: "The 'enamel cord' is a transient structure sometimes seen in which stage?", opts: ["Bud Stage", "Cap Stage", "Early Bell Stage", "Late Bell Stage"], correct: 1, explain: "The enamel cord is a vertical extension of epithelial cells from the enamel knot towards the outer enamel epithelium, most prominent in the cap stage." },
    { q: "What is the term for the process by which cells develop into specialized tissues and organs?", opts: ["Proliferation", "Morphodifferentiation", "Histodifferentiation", "Apposition"], correct: 2, explain: "Histodifferentiation is the specific process where embryonic cells become distinct from one another and specialize to perform specific functions, like IEE cells becoming ameloblasts." },
    { q: "The formation of the crown of the tooth is largely complete by the end of which stage?", opts: ["Bud Stage", "Cap Stage", "Bell Stage", "Eruption"], correct: 2, explain: "The Bell Stage is where the crown takes its final shape (morphodifferentiation) and mineralization begins (apposition)." }
];

const tfs = [
    { q: "The dental papilla will eventually form the enamel of the tooth.", answer: false, explain: "The dental papilla forms the dentin and pulp; the enamel is formed by the enamel organ." },
    { q: "The bud stage is the first histologically recognizable stage of tooth development.", answer: true, explain: "Following the initial thickening, the bud stage is the first distinct morphological stage." },
    { q: "The inner enamel epithelium is derived from ectomesenchyme.", answer: false, explain: "The inner enamel epithelium, like the entire enamel organ, is derived from the oral ectoderm (epithelium)." },
    { q: "The stellate reticulum is rich in blood vessels to provide nutrition.", answer: false, explain: "The enamel organ is avascular; nutrition comes from the surrounding dental sac and papilla." },
    { q: "All permanent teeth are 'successional,' meaning they replace a primary tooth.", answer: false, explain: "Permanent molars are 'accessional,' as they do not replace any primary teeth. Only incisors, canines, and premolars are successional." },
    { q: "The cervical loop is responsible for initiating root formation.", answer: true, explain: "The cervical loop gives rise to Hertwig's epithelial root sheath (HERS), which dictates root shape and size." },
    { q: "The dental follicle forms the cementum, periodontal ligament, and alveolar bone.", answer: true, explain: "These three structures, collectively known as the periodontium or attachment apparatus, arise from the dental follicle." },
    { q: "In the cap stage, all cells of the enamel organ are identical.", answer: false, explain: "The cap stage shows clear differentiation into outer enamel epithelium, inner enamel epithelium, and stellate reticulum." },
    { q: "The dental lamina remains active throughout a person's life.", answer: false, explain: "The dental lamina largely disintegrates after the initiation of the permanent teeth, though remnants can persist as epithelial rests." }
];

const saqs = [
    { q: "Describe the histological composition of the enamel organ during the Cap Stage of tooth development.", a: "During the Cap Stage, the enamel organ is composed of three distinct epithelial cell types: <br>1. <b>Outer Enamel Epithelium:</b> A single layer of cuboidal cells on the convexity. <br>2. <b>Inner Enamel Epithelium:</b> A single layer of columnar cells on the concavity. <br>3. <b>Stellate Reticulum:</b> A network of star-shaped cells with a large amount of intercellular fluid, located between the inner and outer enamel epithelia." },
    { q: "List the three main components of the tooth germ and state what each component will eventually form.", a: `<ol><li><b>Enamel Organ:</b> Forms the enamel of the tooth.</li><li><b>Dental Papilla:</b> Forms the dentin and pulp of the tooth.</li><li><b>Dental Follicle (Sac):</b> Forms the supporting structures (periodontium), including the cementum, periodontal ligament, and alveolar bone.</li></ol>` },
    { q: "Compare and contrast the Bud Stage and the Cap Stage of tooth development in a table.", a: `<table><tr><th>Feature</th><th>Bud Stage</th><th>Cap Stage</th></tr><tr><td><b>Shape</b></td><td>Small, round or ovoid epithelial proliferation (bud-like).</td><td>Epithelial bud grows unequally, forming a cap-like shape over the dental papilla.</td></tr><tr><td><b>Cellularity</b></td><td>Peripheral columnar cells and central polyhedral cells. Relatively undifferentiated.</td><td>Clear differentiation into Outer Enamel Epithelium, Inner Enamel Epithelium, and Stellate Reticulum.</td></tr><tr><td><b>Ectomesenchyme</b></td><td>Shows condensation around the epithelial bud.</td><td>Further condensation forms the distinct Dental Papilla and Dental Follicle.</td></tr></table>` },
    { q: "A 7-year-old patient presents for a dental check-up. Radiographs show the developing permanent first molar, which has no primary predecessor. From which structure did this 'accessional' tooth arise?", a: "The permanent first molar, being an accessional tooth, arose from a posterior extension of the dental lamina. Unlike successional teeth (like permanent incisors or canines) which bud off the lamina of their primary predecessors, the molars form from the lamina growing distally into the jaw." },
    { q: "Define the term 'Cervical Loop' and explain its significance in tooth development.", a: "The cervical loop is the region at the growing rim of the enamel organ where the inner enamel epithelium (IEE) and outer enamel epithelium (OEE) meet. It is an area of intense mitotic activity and is significant because it will later give rise to Hertwig's Epithelial Root Sheath (HERS), the structure that initiates and shapes the root of the tooth." },
    { q: "List the three key histological events that characterize the transition from the Cap Stage to the Bell Stage.", a: `<ol><li><b>Histodifferentiation:</b> Cells differentiate further, especially the inner enamel epithelium cells which become pre-ameloblasts.</li><li><b>Morphodifferentiation:</b> The enamel organ grows and deepens, outlining the final shape of the tooth's crown, including the formation of cusps.</li><li><b>Formation of Stratum Intermedium:</b> A new layer of squamous epithelial cells appears between the inner enamel epithelium and the stellate reticulum, which is essential for enamel formation.</li></ol>` }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null),
  tf: Array(tfs.length).fill(null),
  saq: Array(saqs.length).fill(false)
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return;
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;
      const isCorrect = (v === correctVisualIndex);

      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(!isCorrect){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return;
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    toggleBtn.style.borderColor = now ? "rgba(34,197,94,.7)" : "rgba(255,255,255,0.18)";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
    const mcqCorrectCount = mcqs.reduce((count, item, i) => {
        if (state.mcq[i] === null) return count;
        const card = mcqGrid.children[i];
        const buttons = card.querySelectorAll('.opt-btn');
        const map = Array.from(buttons).map(b => item.opts.indexOf(b.querySelector('.label').textContent));
        const originalToVisual = Array(4);
        map.forEach((orig, v) => { originalToVisual[orig] = v; });
        const correctVisualIndex = originalToVisual[item.correct];
        return count + (state.mcq[i] === correctVisualIndex ? 1 : 0);
    }, 0);

    const tfScore = state.tf.reduce((s, v, i) => {
        return s + (v !== null && v === tfs[i].answer ? 1 : 0);
    }, 0);

    const saqScore = state.saq.filter(Boolean).length;
    const total = mcqCorrectCount + tfScore + saqScore;

    const ids = ["sMcq", "sTf", "sSaq", "sTotal", "sMcq2", "sTf2", "sSaq2", "sTotal2"];
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (id.includes('Mcq')) el.textContent = mcqCorrectCount;
        if (id.includes('Tf')) el.textContent = tfScore;
        if (id.includes('Saq')) el.textContent = saqScore;
        if (id.includes('Total')) el.textContent = total;
    });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{
    b.textContent="I was correct"; 
    b.style.outline="none";
    b.style.borderColor = "rgba(255,255,255,0.18)";
  });

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
