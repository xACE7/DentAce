<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
  .answer table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  .answer th, .answer td { border: 1px solid var(--glass-border); padding: 8px; text-align: left; }
  .answer th { background-color: var(--glass); }
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 20</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "What is the primary function of odontoblast cells?",
        opts: ["To produce dentin", "To form enamel", "To nourish the pulp", "To create cementum"],
        correct: 0,
        explain: "Odontoblasts are specialized cells that reside at the periphery of the dental pulp and are responsible for the production of dentin."
    },
    {
        q: "Which type of dentin is formed prior to root completion?",
        opts: ["Primary dentin", "Secondary dentin", "Tertiary dentin", "Mantle dentin"],
        correct: 0,
        explain: "Primary dentin is all the dentin that is formed before the completion of root formation."
    },
    {
        q: "Secondary dentin is produced as a result of:",
        opts: ["Normal physiological aging after root completion", "Trauma or caries", "The initial phase of tooth development", "Genetic anomalies"],
        correct: 0,
        explain: "Secondary dentin is produced after root formation is complete and is not a response to trauma, but a part of the normal aging process."
    },
    {
        q: "Tertiary dentin is also known as:",
        opts: ["Reparative dentin", "Physiological dentin", "Mantle dentin", "Circumpulpal dentin"],
        correct: 0,
        explain: "Tertiary dentin is formed in response to stimuli like caries or attrition and is considered reparative."
    },
    {
        q: "What is contained within the dentinal tubules?",
        opts: ["Odontoblastic processes, dentinal fluid, and nerve terminals", "Only odontoblastic processes", "Blood vessels and lymphatics", "Enamel spindles and cementocytes"],
        correct: 0,
        explain: "Dentinal tubules are microscopic channels that house odontoblastic processes, dentinal fluid, and afferent nerve terminals."
    },
    {
        q: "The S-shaped pathway of dentinal tubules is referred to as the:",
        opts: ["Primary curvature", "Secondary curvature", "Terminal branching", "Contour lines of Owen"],
        correct: 0,
        explain: "The major S-shaped curve of the dentinal tubules as they extend from the pulp to the dentino-enamel junction is known as the primary curvature."
    },
    {
        q: "In which part of the tooth do dentinal tubules exhibit a more linear, less S-shaped path?",
        opts: ["In the root", "In the crown near the cusp tip", "In the mantle dentin", "In the interglobular dentin"],
        correct: 0,
        explain: "As you move from the crown down into the root, the S-shape of the dentinal tubules flattens out to a more linear shape."
    },
    {
        q: "What is peritubular dentin?",
        opts: ["Dentin that immediately surrounds the dentinal tubule", "Dentin located between the tubules", "The first layer of dentin formed", "Unmineralized dentin matrix"],
        correct: 0,
        explain: "Peritubular dentin is a hypermineralized cuff of dentin that lines the wall of the dentinal tubule."
    },
    {
        q: "The bulk of the dentin, located between the dentinal tubules, is called:",
        opts: ["Intertubular dentin", "Peritubular dentin", "Mantle dentin", "Predentin"],
        correct: 0,
        explain: "Intertubular dentin forms the main body of dentin and is located between the peritubular dentin of adjacent tubules."
    },
    {
        q: "Minor spiral-like kinks along the length of the primary curvature of dentinal tubules are known as:",
        opts: ["Secondary curvatures", "Primary curvatures", "Enamel spindles", "Dead tracts"],
        correct: 0,
        explain: "Secondary curvatures are small, wave-like deviations in the path of dentinal tubules, superimposed on the primary curvature."
    },
    {
        q: "What are 'dead tracts' in dentin?",
        opts: ["Empty dentinal tubules resulting from odontoblast death", "Hypomineralized areas in dentin", "Lines indicating rhythmic deposition of dentin", "Branches of dentinal tubules near the DEJ"],
        correct: 0,
        explain: "Dead tracts appear dark in ground sections because the dentinal tubules are empty due to the death of the odontoblasts and are filled with air."
    },
    {
        q: "Interglobular dentin represents:",
        opts: ["Areas of unmineralized or hypomineralized dentin matrix", "Hypermineralized dentin", "Dentin formed in response to injury", "The junction between primary and secondary dentin"],
        correct: 0,
        explain: "Interglobular dentin is formed due to the failure of fusion of calcospherites, resulting in unmineralized areas between them."
    },
    {
        q: "Where is Tomes' granular layer typically found?",
        opts: ["In the root dentin, adjacent to the cementum", "In the coronal dentin, near the enamel", "Throughout the entire dentin layer", "Only in tertiary dentin"],
        correct: 0,
        explain: "Tomes' granular layer is a specific granular-appearing region of dentin found only in the root, immediately under the cementum."
    },
    {
        q: "What do the incremental lines of von Ebner represent?",
        opts: ["The daily rhythmic pattern of dentin deposition", "A major interruption in dentin formation", "Faults in mineralization", "The branching of dentinal tubules"],
        correct: 0,
        explain: "The incremental lines of von Ebner are fine lines that represent the daily, cyclical deposition of dentin matrix."
    },
    {
        q: "Contour lines of Owen are indicative of:",
        opts: ["Major metabolic disruption during odontogenesis", "The speed of dentin formation", "The age of the tooth", "The direction of dentinal tubules"],
        correct: 0,
        explain: "Contour lines of Owen are accentuated incremental lines that reflect a significant disturbance in the body's metabolism during tooth formation."
    },
    {
        q: "Mantle dentin is the:",
        opts: ["First formed layer of dentin, adjacent to the enamel or cementum", "Dentin formed after root completion", "Dentin surrounding the pulp chamber", "Reparative dentin formed due to caries"],
        correct: 0,
        explain: "Mantle dentin is the outermost layer of primary dentin, formed first by newly differentiated odontoblasts."
    },
    {
        q: "What is the primary difference between a ground section and a decalcified section for viewing dentin?",
        opts: ["Ground sections show mineralized tissues, while decalcified sections show cellular components", "Ground sections are thicker than decalcified sections", "Decalcified sections are stained, while ground sections are not", "Ground sections show only tubules, while decalcified sections show only matrix"],
        correct: 0,
        explain: "Ground sections are prepared by grinding the tooth down to a thin slice, preserving hard mineralized structures. Decalcified sections remove the mineral content to better visualize the organic matrix and cellular details."
    },
    {
        q: "Enamel spindles are:",
        opts: ["Odontoblastic processes trapped in enamel", "Cracks in the enamel surface", "Hypomineralized enamel rods", "A type of tertiary dentin"],
        correct: 0,
        explain: "Enamel spindles are the trapped ends of odontoblastic processes that crossed the future dentino-enamel junction (DEJ) before enamel formation began."
    },
    {
        q: "The tissue immediately adjacent to the pulp, consisting of the cell bodies of odontoblasts, is the:",
        opts: ["Pulp", "Predentin", "Secondary dentin", "Cementum"],
        correct: 0,
        explain: "The cell bodies of odontoblasts line the periphery of the dental pulp, with their processes extending into the dentin."
    },
    {
        q: "What is predentin?",
        opts: ["The unmineralized organic matrix of dentin located next to the pulp", "The fully mineralized dentin", "The first layer of dentin formed", "Dentin found only in the root"],
        correct: 0,
        explain: "Predentin is the layer of newly secreted, unmineralized dentin matrix situated between the odontoblast layer and the mineralized dentin."
    },
    {
        q: "The dentino-enamel junction (DEJ) is characteristically:",
        opts: ["Scalloped", "A straight line", "Smooth and flat", "Undefined"],
        correct: 0,
        explain: "The DEJ has a scalloped appearance, with the convexities facing the dentin, which helps to lock the enamel and dentin together."
    },
    {
        q: "What is the main reason for dentin sensitivity?",
        opts: ["Fluid movement within the dentinal tubules stimulating nerve endings", "Direct exposure of odontoblasts to stimuli", "Presence of blood vessels in the dentin", "Thinning of the enamel layer"],
        correct: 0,
        explain: "The 'hydrodynamic theory' suggests that stimuli cause rapid movement of dentinal fluid within the tubules, which in turn activates nerve endings in the pulp."
    },
    {
        q: "Compared to coronal dentin, root dentin tubules are typically:",
        opts: ["Straighter", "More S-shaped", "More branched", "Larger in diameter"],
        correct: 0,
        explain: "The primary curvature of dentinal tubules in the root is much less pronounced, appearing more linear or straight compared to the S-shaped tubules in the crown."
    },
    {
        q: "What causes the appearance of interglobular dentin spaces?",
        opts: ["Failure of mineralizing globules (calcospherites) to fuse", "Death of odontoblasts", "Rapid formation of dentin", "Incorporation of pulp tissue"],
        correct: 0,
        explain: "Interglobular dentin is a mineralization defect where the globular zones of mineralization fail to coalesce, leaving areas of unmineralized matrix."
    },
    {
        q: "Which type of dentin is formed as a direct response to a specific injury like caries or attrition?",
        opts: ["Tertiary dentin", "Primary dentin", "Secondary dentin", "Mantle dentin"],
        correct: 0,
        explain: "Tertiary (reparative or reactionary) dentin is produced locally by odontoblasts in response to an external stimulus or injury."
    },
    {
        q: "The main organic component of dentin matrix is:",
        opts: ["Type I collagen", "Elastin", "Keratin", "Type II collagen"],
        correct: 0,
        explain: "The organic matrix of dentin is primarily composed of Type I collagen fibers, which provide a scaffold for mineralization."
    },
    {
        q: "What are the fine branches that connect adjacent dentinal tubules called?",
        opts: ["Lateral branches or canaliculi", "Secondary curvatures", "Terminal branches", "Enamel spindles"],
        correct: 0,
        explain: "Dentinal tubules are interconnected by numerous fine lateral branches, or canaliculi, along their length."
    },
    {
        q: "Which structure lies immediately external to the Tomes' granular layer?",
        opts: ["Cementum", "Dentin", "Enamel", "Pulp"],
        correct: 0,
        explain: "Tomes' granular layer is in the root dentin, and the tissue immediately outside of it is the cementum."
    },
    {
        q: "In a transverse section of dentin, the structure with the highest mineral content is:",
        opts: ["Peritubular dentin", "Intertubular dentin", "Odontoblast process", "Predentin"],
        correct: 0,
        explain: "Peritubular dentin is significantly more mineralized (hypermineralized) than the surrounding intertubular dentin."
    },
    {
        q: "A 56-year-old patient has a deep carious lesion. Pulp exposure is avoided during cavity preparation. This is likely due to the formation of:",
        opts: ["Tertiary dentin", "Excessive primary dentin", "Sclerotic dentin only", "Secondary dentin only"],
        correct: 0,
        explain: "In response to a slow-progressing stimulus like caries, the pulp forms tertiary (reparative) dentin, which increases the thickness of the dentin layer and protects the pulp from exposure."
    }
];

const tfs = [
    {
        q: "Dentin is a non-calcified tissue similar in composition to pulp.",
        answer: false,
        explain: "Dentin is a calcified, mineralized tissue, distinctly different from the soft connective tissue of the pulp."
    },
    {
        q: "Primary dentin formation ceases once the tooth erupts into the oral cavity.",
        answer: false,
        explain: "Primary dentin formation continues until root formation is complete, which occurs after the tooth has erupted."
    },
    {
        q: "Secondary dentin is formed at a slower rate than primary dentin.",
        answer: true,
        explain: "The deposition of secondary dentin is much slower and less regular than that of primary dentin throughout the life of the tooth."
    },
    {
        q: "Dentinal tubules are wider in diameter near the pulp and narrower near the DEJ.",
        answer: true,
        explain: "The tubules taper as they extend from the pulp towards the dentino-enamel junction (DEJ)."
    },
    {
        q: "Interglobular dentin contains dentinal tubules passing through it.",
        answer: true,
        explain: "Although interglobular dentin is unmineralized, the dentinal tubules pass through these areas uninterrupted."
    },
    {
        q: "Dead tracts appear white in transmitted light microscopy because they are filled with fluid.",
        answer: false,
        explain: "Dead tracts appear dark in transmitted light because the tubules are empty and filled with air, which has a different refractive index."
    },
    {
        q: "Tomes' granular layer is a result of a metabolic disturbance during tooth formation.",
        answer: false,
        explain: "Tomes' granular layer's origin is debated but it is a distinct structure in root dentin, not a result of metabolic disturbance like Contour lines of Owen."
    },
    {
        q: "Odontoblast cell bodies are located within the dentinal tubules.",
        answer: false,
        explain: "The cell bodies of odontoblasts are located in the pulp, at the pulp-dentin border. Only their processes extend into the dentinal tubules."
    },
    {
        q: "Peritubular dentin is less mineralized than intertubular dentin.",
        answer: false,
        explain: "Peritubular dentin is hypermineralized, meaning it is more calcified than the surrounding intertubular dentin."
    }
];

const saqs = [
    {
        q: "Define tertiary dentin and explain the circumstances under which it is formed.",
        a: "Tertiary dentin, also known as reparative or reactionary dentin, is a type of dentin that is formed in response to a specific stimulus or injury, such as caries, attrition, or a dental restoration. It is deposited locally at the pulp-dentin interface beneath the affected area to protect the pulp."
    },
    {
        q: "List three main components found within a dentinal tubule.",
        a: `
            <ol>
                <li><strong>Odontoblastic process:</strong> A cytoplasmic extension of an odontoblast cell.</li>
                <li><strong>Dentinal fluid:</strong> Tissue fluid that fills the space around the process.</li>
                <li><strong>Afferent nerve terminal:</strong> Sensory nerve endings that contribute to dentin sensitivity.</li>
            </ol>
        `
    },
    {
        q: "Compare the primary and secondary curvatures of dentinal tubules.",
        a: `
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Primary Curvature</th>
                        <th>Secondary Curvature</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Description</strong></td>
                        <td>The large, overall S-shaped path of the tubule from the pulp to the DEJ.</td>
                        <td>Small, delicate spiral-like kinks or waves along the length of the primary curve.</td>
                    </tr>
                    <tr>
                        <td><strong>Scale</strong></td>
                        <td>A major, large-scale curve determining the overall tubule direction.</td>
                        <td>Minor, small-scale oscillations along the main path.</td>
                    </tr>
                    <tr>
                        <td><strong>Location</strong></td>
                        <td>Most prominent in the crown, becoming straighter in the root.</td>
                        <td>Present along the entire length of the tubule.</td>
                    </tr>
                </tbody>
            </table>
        `
    },
    {
        q: "A patient complains of sharp, short pain when drinking cold beverages. Based on the histology of dentin, explain the most likely mechanism causing this sensitivity.",
        a: "The patient is experiencing dentin hypersensitivity. This is best explained by the 'hydrodynamic theory'. The cold stimulus causes the dentinal fluid within the dentinal tubules to contract and flow rapidly. This fluid movement stimulates mechanoreceptors on the afferent nerve endings located near the pulp, which is interpreted by the brain as sharp pain."
    },
    {
        q: "Describe the histological appearance and location of interglobular dentin.",
        a: "Interglobular dentin appears as irregular, arc-shaped, unmineralized or hypomineralized areas within the dentin. It is located in the coronal dentin, just below the mantle dentin. It is caused by the incomplete fusion of mineralizing globules called calcospherites during dentinogenesis. Dentinal tubules pass through these areas without interruption."
    },
    {
        q: "Explain the difference between incremental lines of von Ebner and contour lines of Owen.",
        a: `
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Incremental Lines of von Ebner</th>
                        <th>Contour Lines of Owen</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Represents</strong></td>
                        <td>Daily, rhythmic deposition of dentin (approx. 4 µm per day).</td>
                        <td>A major disturbance in metabolism or body physiology during odontogenesis.</td>
                    </tr>
                    <tr>
                        <td><strong>Appearance</strong></td>
                        <td>Fine, delicate lines running perpendicular to the dentinal tubules.</td>
                        <td>Accentuated, wider, and more prominent incremental lines.</td>
                    </tr>
                    <tr>
                        <td><strong>Significance</strong></td>
                        <td>Indicates the normal, daily pattern of dentin formation.</td>
                        <td>Indicates a significant systemic event (e.g., birth, major illness) occurred during tooth formation.</td>
                    </tr>
                </tbody>
            </table>
        `
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      const originalIndex = visualToOriginal[v];
      state.mcq[idx] = originalIndex;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      const isCorrect = (originalIndex === item.correct);
      if(!isCorrect){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      buttons.forEach(b=>b.classList.remove('correct','wrong'));
      
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s, selectedOriginalIndex, i) => {
    if (selectedOriginalIndex === null) return s;
    return s + (selectedOriginalIndex === mcqs[i].correct ? 1 : 0);
  }, 0);
  
  const tfScore = state.tf.reduce((s, v, i) => {
    if (v === null) return s;
    return s + (v === tfs[i].answer ? 1 : 0);
  }, 0);

  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
