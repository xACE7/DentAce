<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer table {width: 100%; border-collapse: collapse; margin-top: 10px;}
  .answer th, .answer td { border: 1px solid var(--card-border); padding: 8px; text-align: left;}
  .answer th { background-color: var(--glass);}

  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 26</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
  {
    q: "Which of the following is NOT one of the four principal components of the normal periodontium?",
    opts: ["Gingiva", "Periodontal ligament", "Enamel", "Alveolar bone"],
    correct: 2,
    explain: "The normal periodontium consists of Gingiva, Periodontal ligament, Cementum, and Alveolar bone. Enamel is the outer layer of the tooth crown, not part of the periodontium."
  },
  {
    q: "What is the clinically normal probing depth for a gingival sulcus?",
    opts: ["1 to 2 mm", "2 to 3 mm", "4 to 5 mm", "Less than 1 mm"],
    correct: 1,
    explain: "A healthy gingival sulcus has a clinical probing depth of 2 to 3 mm. Depths greater than this may indicate a periodontal pocket."
  },
  {
    q: "The attached gingiva is demarcated from the alveolar mucosa by the:",
    opts: ["Free gingival groove", "Gingival margin", "Mucogingival junction (MGJ)", "Cementoenamel junction (CEJ)"],
    correct: 2,
    explain: "The Mucogingival junction (MGJ) is the distinct line that separates the firm, resilient attached gingiva from the looser, movable alveolar mucosa."
  },
  {
    q: "What is the typical shape of the interdental gingiva in the anterior region?",
    opts: ["Col", "Blunted", "Pyramidal", "Rounded"],
    correct: 2,
    explain: "In the anterior region, where teeth are more triangular, the interdental gingiva typically has a pyramidal shape."
  },
  {
    q: "Radiographically, the thin outer layer of dense cortical bone lining the tooth socket is known as:",
    opts: ["Trabecular bone", "Spongy bone", "Alveolar crest", "Lamina dura"],
    correct: 3,
    explain: "The lamina dura appears as a dense radiopaque line on radiographs and represents the cortical bone that lines the tooth socket."
  },
  {
    q: "What is the normal distance from the alveolar crest to the cementoenamel junction (CEJ) of adjacent teeth?",
    opts: ["0.5-1 mm", "1.5-2 mm", "2.5-3 mm", "More than 3 mm"],
    correct: 1,
    explain: "The level of the alveolar crest is considered normal when it is not more than 1.5-2 mm from the CEJ of the adjacent teeth."
  },
  {
    q: "How does the Periodontal Ligament (PDL) space typically appear on a radiograph?",
    opts: ["Radiopaque line", "Radiolucent space", "Mixed density area", "It is not visible"],
    correct: 1,
    explain: "Because the PDL is composed primarily of collagen (soft tissue), it appears as a radiolucent (dark) space between the tooth root and the lamina dura."
  },
  {
    q: "Which of these is a primary factor responsible for the 'coral pink' color of healthy gingiva?",
    opts: ["Presence of inflammatory cells", "High number of nerve endings", "Vascular supply and epithelial thickness", "Amount of salivary flow"],
    correct: 2,
    explain: "The color of the gingiva is determined by the vascular supply, the thickness and degree of keratinization of the epithelium, and the presence of pigment-containing cells."
  },
  {
    q: "What term describes the contour of the gingival margin in a state of health?",
    opts: ["Rolled and thickened", "Scalloped and knife-edged", "Flat and uniform", "Blunted and bulbous"],
    correct: 1,
    explain: "Healthy gingiva has a scalloped contour that follows the shape of the teeth, with a thin, knife-edged margin."
  },
  {
    q: "The characteristic 'orange peel' appearance of healthy attached gingiva is known as:",
    opts: ["Keratinization", "Erythema", "Stippling", "Edema"],
    correct: 2,
    explain: "Stippling is the term for the textured, orange peel-like surface of healthy attached gingiva, caused by the rete pegs of the epithelium."
  },
  {
    q: "In periodontal disease, the interdental papilla may change its shape to become:",
    opts: ["Pyramidal", "Knife-edged", "Pointed", "Bulbous or blunted"],
    correct: 3,
    explain: "Inflammation in periodontal disease often causes the interdental papilla to become swollen (bulbous) or flattened (blunted)."
  },
  {
    q: "What is the consistency of healthy gingiva when palpated?",
    opts: ["Soft and edematous", "Firm and resilient", "Leathery and nodular", "Spongy and easily deflected"],
    correct: 1,
    explain: "Healthy gingiva is firm and resilient, tightly bound to the underlying periosteum."
  },
  {
    q: "A probing depth measurement of 5mm would most likely indicate:",
    opts: ["A healthy gingival sulcus", "Gingival recession", "A periodontal pocket", "Normal anatomy"],
    correct: 2,
    explain: "Probing depths greater than 3-4 mm are generally indicative of a periodontal pocket, a sign of periodontal disease."
  },
  {
    q: "What type of bone loss is characterized by the alveolar crest remaining horizontal but at a lower level?",
    opts: ["Vertical bone loss", "Angular bone loss", "Horizontal bone loss", "Fenestration"],
    correct: 2,
    explain: "Horizontal bone loss refers to a generalized reduction in the height of the alveolar bone, where the crest remains relatively horizontal."
  },
  {
    q: "The color of the alveolar mucosa is typically red because its epithelium is:",
    opts: ["Thick and keratinized", "Thin and non-keratinized", "Heavily pigmented", "Lacking blood vessels"],
    correct: 1,
    explain: "The alveolar mucosa is redder than the gingiva because its epithelium is thin and non-keratinized, allowing the underlying blood vessels to be more visible."
  },
  {
    q: "Which frenum is located on the underside of the tongue?",
    opts: ["Maxillary anterior frenum", "Mandibular anterior frenum", "Lingual frenum", "Buccal frenum"],
    correct: 2,
    explain: "The lingual frenum is the fold of mucosal tissue located on the underside of the tongue."
  },
  {
    q: "What happens to the shape of the interdental gingiva if a diastema (space between teeth) is present?",
    opts: ["It becomes pyramidal", "It forms a prominent col", "It becomes bulbous and inflamed", "It forms a smooth, rounded surface"],
    correct: 3,
    explain: "When there is no proximal tooth contact (diastema), the interdental papillae and col are absent, and the gingiva is firmly bound over the bone, creating a smooth surface."
  },
  {
    q: "Rounding of the sharp angle between the alveolar crest and lamina dura can be an early sign of:",
    opts: ["Tooth eruption", "Periodontal disease", "Healthy remodeling", "Orthodontic movement"],
    correct: 1,
    explain: "Radiographically, the crest of the bone normally forms a sharp angle with the lamina dura. Rounding or loss of this sharp angle is an early indicator of periodontal disease."
  },
  {
    q: "The part of the maxilla or mandible that forms and supports the tooth sockets is called the:",
    opts: ["Basal bone", "Cortical plate", "Alveolar process", "Ramus"],
    correct: 2,
    explain: "The alveolar process is the specific part of the jawbones that contains the tooth sockets (alveoli)."
  },
  {
    q: "What is the correct technique for using a periodontal probe to explore a pocket?",
    opts: ["Insert it at a 45-degree angle", "Push firmly to the base", "'Walk' the probe circumferentially", "Take a single measurement on the buccal side"],
    correct: 2,
    explain: "The correct technique is to 'walk' the probe with light pressure along the entire circumference of the tooth to detect variations in pocket depth."
  },
  {
    q: "A change in gingival color to a reddish or bluish-red is a clinical sign of:",
    opts: ["Health", "Gingivitis", "Gingival recession", "Hyperkeratosis"],
    correct: 1,
    explain: "Inflammation (gingivitis) causes increased vascularization and blood flow, leading to a change in color from coral pink to various shades of red or bluish-red (cyanotic)."
  },
  {
    q: "The PDL space is typically widest at which two points along the root?",
    opts: ["Mid-root and apex", "Coronally and apex", "Evenly distributed", "Only at the apex"],
    correct: 1,
    explain: "The periodontal ligament space is not uniform; it is widest coronally (near the crestal bone) and at the apex to accommodate tooth movement."
  },
  {
    q: "Gingival enlargement refers to an increase in the:",
    opts: ["Color", "Size", "Stippling", "Recession"],
    correct: 1,
    explain: "Gingival enlargement is an increase in the size of the gingiva, resulting from an increase in its cellular and intercellular elements."
  },
  {
    q: "In a state of periodontal disease, the surface texture of the gingiva often becomes:",
    opts: ["Matte and stippled", "Firm and leathery", "Smooth and shiny", "Fibrotic and nodular"],
    correct: 2,
    explain: "Inflammation and edema in gingivitis cause the loss of stippling, resulting in a smooth and shiny surface texture."
  },
  {
    q: "Which component of the periodontium provides attachment for the principal fibers of the PDL?",
    opts: ["Gingiva", "Alveolar mucosa", "Cementum", "Enamel"],
    correct: 2,
    explain: "The principal fibers of the periodontal ligament embed into the cementum on the root surface on one side and the alveolar bone proper on the other."
  },
  {
    q: "Vertical or angular bone loss is characterized by:",
    opts: ["Bone loss that is parallel to the CEJ", "Bone loss that is not horizontal and creates a trough-like defect", "A uniform decrease in bone height", "An increase in bone density"],
    correct: 1,
    explain: "Vertical (or angular) bone loss is an uneven pattern of bone destruction that results in a trough-like defect alongside the root."
  },
  {
    q: "Which of the following is NOT a type of gingiva?",
    opts: ["Marginal gingiva", "Attached gingiva", "Sulcular gingiva", "Interdental gingiva"],
    correct: 2,
    explain: "The main clinical types are marginal, attached, and interdental gingiva. Sulcular epithelium lines the gingival sulcus but isn't considered a main type of gingiva in this context."
  },
  {
    q: "What is the primary function of the normal periodontium?",
    opts: ["To produce saliva", "To provide support and maintain teeth in function", "To aid in mastication through muscle contraction", "To form the visible part of the tooth"],
    correct: 1,
    explain: "The primary role of the periodontium is to provide the necessary support structure to anchor the teeth within the jaws and maintain their function."
  },
  {
    q: "The absence of bleeding on probing is a strong indicator of:",
    opts: ["Deep periodontal pockets", "Aggressive periodontitis", "Periodontal health", "The need for surgery"],
    correct: 2,
    explain: "Bleeding on probing is a key sign of inflammation. Its absence is a reliable indicator of a healthy periodontium."
  },
  {
    q: "Gingival recession describes the:",
    opts: ["Movement of the gingival margin coronally", "Deepening of the gingival sulcus", "Exposure of the root surface by apical migration of the gingival margin", "Swelling of the interdental papilla"],
    correct: 2,
    explain: "Gingival recession is the condition where the gingival margin migrates apically (towards the root tip), exposing the root surface."
  }
];

const tfs = [
  {
    q: "The Periodontal Ligament (PDL) is composed primarily of elastic fibers, making it appear radiopaque on x-rays.",
    answer: false,
    explain: "The PDL is composed primarily of collagen fibers (soft tissue), which makes it appear as a radiolucent space on radiographs, not radiopaque."
  },
  {
    q: "In a healthy state, the gingiva is firm, resilient, and tightly bound to the underlying periosteum.",
    answer: true,
    explain: "This describes the correct consistency and attachment of healthy attached gingiva."
  },
  {
    q: "A clinical probing depth of 4 mm is always considered to be within the normal range for a healthy gingival sulcus.",
    answer: false,
    explain: "A normal, healthy sulcus is typically 2-3 mm deep. A depth of 4 mm or more usually indicates a periodontal pocket."
  },
  {
    q: "Stippling, the 'orange peel' texture, is always more prominent on the lingual surfaces of the gingiva.",
    answer: false,
    explain: "Stippling is generally less prominent on the lingual surfaces compared to the facial surfaces."
  },
  {
    q: "The lamina dura is a thin layer of cortical bone that is continuous with the alveolar crest.",
    answer: true,
    explain: "The lamina dura lines the socket and is continuous with the cortical bone of the alveolar crest, forming a sharp angle in health."
  },
  {
    q: "In the presence of inflammation, gingiva may become soft and edematous.",
    answer: true,
    explain: "Inflammation (gingivitis) leads to edema, which makes the gingival tissue soft and spongy."
  },
  {
    q: "If a diastema is present, the interdental gingiva forms a 'col' shape.",
    answer: false,
    explain: "A 'col' is present when there is contact between adjacent teeth. If a diastema exists, there is no col or interdental papilla."
  },
  {
    q: "The color of healthy gingiva can vary due to the presence of pigment-containing cells.",
    answer: true,
    explain: "While typically 'coral pink', the color can be influenced by physiologic pigmentation (melanin), especially in individuals with darker complexions."
  },
  {
    q: "The supporting alveolar bone consists of the lamina dura and the spongy bone.",
    answer: false,
    explain: "The alveolar process consists of the alveolar bone proper (lamina dura) and the supporting alveolar bone. The supporting bone is made of cortical plates and spongy bone."
  }
];

const saqs = [
  {
    q: "Define the gingival sulcus and state its normal clinical probing depth.",
    a: "The gingival sulcus is the shallow crevice or space around the tooth, bounded by the tooth surface on one side and the epithelium lining the free margin of the gingiva on the other. Its normal clinical probing depth is 2 to 3 mm."
  },
  {
    q: "List the four principal components of the normal periodontium.",
    a: `
      <ol>
        <li>Gingiva</li>
        <li>Periodontal ligament</li>
        <li>Cementum</li>
        <li>Alveolar bone</li>
      </ol>
    `
  },
  {
    q: "Compare the clinical features of healthy gingiva versus gingiva in a state of disease (gingivitis) based on color and consistency.",
    a: `
      <table>
        <thead>
          <tr>
            <th>Feature</th>
            <th>Healthy Gingiva</th>
            <th>Diseased Gingiva (Gingivitis)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><b>Color</b></td>
            <td>Coral pink or salmon pink. Uniform in color.</td>
            <td>Red, reddish-pink, or bluish-red (cyanotic). Can be localized or generalized.</td>
          </tr>
          <tr>
            <td><b>Consistency</b></td>
            <td>Firm and resilient when palpated. Tightly adapted to the teeth.</td>
            <td>Soft and edematous (swollen with fluid), or firm and fibrotic in chronic cases.</td>
          </tr>
        </tbody>
      </table>
    `
  },
  {
    q: "A new patient presents with bright red, swollen gums that bleed easily upon gentle probing. The interdental papillae between their lower incisors are swollen and rounded. Based on these signs, what is the likely condition and how do these signs deviate from a healthy state?",
    a: "The likely condition is gingivitis. These signs deviate from a healthy state in several ways: 1) The color should be coral pink, not bright red. 2) The consistency should be firm, not swollen (edematous). 3) Healthy gums do not bleed easily on probing. 4) The interdental papillae should be pointed and knife-edged, not swollen and rounded (bulbous)."
  },
  {
    q: "Describe the radiographic appearance of the lamina dura and the alveolar crest in a healthy periodontium.",
    a: "In a healthy periodontium, the lamina dura appears as a dense, continuous radiopaque (white) line around the tooth root. The alveolar crest is also radiopaque and forms a sharp, distinct angle where it meets the lamina dura of the adjacent teeth. The crest is typically located 1.5 to 2 mm apical to the cementoenamel junction (CEJ)."
  },
  {
    q: "List three factors that are responsible for the color of the gingiva.",
    a: `
      <ol>
        <li>Vascular supply (the number and proximity of blood vessels).</li>
        <li>Thickness and degree of keratinization of the epithelium.</li>
        <li>Presence of pigment-containing cells (e.g., melanocytes).</li>
      </ol>
    `
  }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    toggleBtn.style.borderColor = now ? "var(--ok)" : "rgba(255,255,255,0.18)";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v === null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);

  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v === null) return s;
    const isCorrect = (v === tfs[i].answer);
    return s + (isCorrect ? 1 : 0);
  },0);

  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{
    b.textContent="I was correct";
    b.style.outline="none";
    b.style.borderColor = "rgba(255,255,255,0.18)";
  });

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
