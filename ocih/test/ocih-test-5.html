<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer table { width: 100%; border-collapse: collapse; }
  .answer th, .answer td { border: 1px solid var(--card-border); padding: 8px; text-align: left;}
  .answer th { background-color: rgba(255,255,255,0.05); font-weight: 600; }

  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 5</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "What is the primary characteristic of saliva secreted by the acinar cells?",
        opts: ["Hypotonic", "Isotonic", "Hypertonic", "Acidic"],
        correct: 1,
        explain: "The primary secretion from the acini is isotonic, meaning it has the same solute concentration as blood plasma."
    },
    {
        q: "Which process occurs in the ductal system to modify primary saliva?",
        opts: ["Secretion of Na+ and Cl-", "Reabsorption of K+ and HCO3-", "Reabsorption of Na+ and Cl-", "Secretion of water"],
        correct: 2,
        explain: "In the ductal system, Na+ and Cl- are reabsorbed, while K+ and HCO3- are secreted, making the final saliva hypotonic."
    },
    {
        q: "The final saliva that enters the oral cavity is typically:",
        opts: ["Isotonic", "Hypertonic", "Hypotonic", "Neutral"],
        correct: 2,
        explain: "Due to the modification in the ducts (reabsorption of NaCl), the final saliva becomes hypotonic."
    },
    {
        q: "Which part of the autonomic nervous system increases salivary secretion?",
        opts: ["Sympathetic system", "Parasympathetic system", "Somatic system", "Enteric system"],
        correct: 1,
        explain: "The parasympathetic nervous system is the primary stimulator of salivary secretion, leading to a watery, high-volume saliva."
    },
    {
        q: "Xerostomia is a condition characterized by:",
        opts: ["Excessive salivation", "Reduced salivation (dry mouth)", "Painful swallowing", "Inflammation of the tongue"],
        correct: 1,
        explain: "Xerostomia is the clinical term for dry mouth, resulting from a reduction in salivary secretion."
    },
    {
        q: "Which of the following is NOT a common cause of xerostomia?",
        opts: ["Dehydration", "Radiation therapy to the head/neck", "Teething in infants", "Side effects of antidepressants"],
        correct: 2,
        explain: "Teething is associated with hypersalivation (sialorrhea), not xerostomia."
    },
    {
        q: "The condition of excessive salivation is known as:",
        opts: ["Hyposalivation", "Xerostomia", "Sialorrhea", "Ptyalism"],
        correct: 2, // Sialorrhea and Ptyalism are synonyms. Sialorrhea is more common.
        explain: "Sialorrhea, also known as hypersalivation or ptyalism, is the condition of excessive saliva production."
    },
    {
        q: "Which cells are responsible for producing the primary watery secretion in salivary glands?",
        opts: ["Mucous cells", "Ductal cells", "Serous cells", "Myoepithelial cells"],
        correct: 2,
        explain: "Serous cells in the acini produce a watery, enzyme-rich secretion, which forms the basis of primary saliva."
    },
    {
        q: "What is the function of myoepithelial cells in the salivary glands?",
        opts: ["To produce mucus", "To reabsorb ions", "To secrete enzymes", "To contract and expel saliva"],
        correct: 3,
        explain: "Myoepithelial cells have contractile properties; they surround the acini and contract to help expel saliva into the ducts."
    },
    {
        q: "Which ions are actively secreted into the saliva in the striated ducts?",
        opts: ["Sodium and Chloride", "Calcium and Phosphate", "Potassium and Bicarbonate", "Magnesium and Sulfate"],
        correct: 2,
        explain: "The secondary modification phase in the striated ducts involves the secretion of Potassium (K+) and Bicarbonate (HCO3-)."
    },
    {
        q: "A patient taking antihypertensive medication is most likely to complain of which oral condition?",
        opts: ["Sialorrhea", "Xerostomia", "Oral ulcers", "Tooth discoloration"],
        correct: 1,
        explain: "Antihypertensives are listed as one of the common drug classes that cause xerostomia (dry mouth) as a side effect."
    },
    {
        q: "What is a major clinical consequence of hyposalivation?",
        opts: ["Increased buffering capacity", "Reduced risk of oral infections", "Difficulty in speech and mastication", "Enhanced taste perception"],
        correct: 2,
        explain: "Decreased salivary volume makes it difficult to speak, chew, and swallow. It also increases the risk of caries and infections."
    },
    {
        q: "Which of these is a physiological cause of hypersalivation?",
        opts: ["Anxiety", "Dehydration", "Nausea and vomiting", "Depression"],
        correct: 2,
        explain: "Nausea and vomiting are common physiological triggers for hypersalivation."
    },
    {
        q: "The secretion of saliva is divided into how many phases?",
        opts: ["One", "Two", "Three", "Four"],
        correct: 1,
        explain: "Salivary secretion is a two-phase process: primary secretion in the acini and secondary modification in the ducts."
    },
    {
        q: "The primary secretion of saliva is rich in which compound?",
        opts: ["KCl", "H2O", "HCO3-", "NaCl"],
        correct: 3,
        explain: "The first secretory step involves the secretion of a primary isotonic fluid rich in NaCl."
    },
    {
        q: "What type of cells are found in the end pieces (acini) of salivary glands?",
        opts: ["Serous and ductal cells", "Serous and mucous cells", "Mucous and myoepithelial cells", "Ductal and myoepithelial cells"],
        correct: 1,
        explain: "The acini are composed of serous cells (watery secretion) and mucous cells (viscous, mucin-rich secretion)."
    },
    {
        q: "The sympathetic nervous system's effect on saliva is typically:",
        opts: ["Increased, watery flow", "Decreased, viscous flow", "No effect", "Increased, viscous flow"],
        correct: 1,
        explain: "The sympathetic system generally decreases salivary flow, resulting in a thicker, more viscous saliva. This is often associated with the 'fight or flight' response."
    },
    {
        q: "Which of these is considered a function of saliva related to tooth integrity?",
        opts: ["Digestion", "Buffering action", "Taste", "Swallowing"],
        correct: 1,
        explain: "The buffering action of saliva helps neutralize acids, protecting tooth enamel and maintaining tooth integrity."
    },
    {
        q: "What is a common consequence for oral tissues in a patient with xerostomia?",
        opts: ["Increased tissue repair", "Reduced susceptibility to infections", "Inflammation and ulceration", "Thickening of the mucosa"],
        correct: 2,
        explain: "Without the protective and lubricating effects of saliva, oral tissues are more prone to infections, inflammation, and ulceration."
    },
    {
        q: "Which type of duct is primarily responsible for the ion exchange that makes saliva hypotonic?",
        opts: ["Intercalated duct", "Excretory duct", "Striated duct", "Parotid duct"],
        correct: 2,
        explain: "Most of the ion exchange (reabsorption of NaCl, secretion of K+/HCO3-) occurs in the striated ducts."
    },
    {
        q: "Orthodontic appliances can sometimes lead to which condition?",
        opts: ["Xerostomia", "Hyposalivation", "Sialorrhea", "Decreased buffering"],
        correct: 2,
        explain: "The presence of a foreign material in the mouth, like an orthodontic appliance, can stimulate an increase in salivary flow (sialorrhea)."
    },
    {
        q: "The initial fluid formed in the acini is derived from what?",
        opts: ["Intracellular fluid", "Lymphatic fluid", "Interstitial fluid from blood", "Cerebrospinal fluid"],
        correct: 2,
        explain: "The process begins with the formation of interstitial fluid from blood in capillaries, which is then modified by acinar cells."
    },
    {
        q: "Which function of saliva is essential for forming a food bolus?",
        opts: ["Antimicrobial action", "Buffering action", "Mastication and swallowing", "Digestion"],
        correct: 2,
        explain: "Saliva's lubricating properties are crucial for binding masticated food into a bolus that can be safely swallowed."
    },
    {
        q: "Which drug class is NOT listed as a common cause of dry mouth?",
        opts: ["Anticholinergics", "Antidepressants", "Antibiotics", "Antipsychotics"],
        correct: 2,
        explain: "The lecture lists anticholinergics, antidepressants, antipsychotics, and antihypertensives as common causes of xerostomia. Antibiotics are not on this list."
    },
    {
        q: "The term 'ptyalism' is synonymous with:",
        opts: ["Hyposalivation", "Xerostomia", "Sialorrhea", "Dysgeusia"],
        correct: 2,
        explain: "Ptyalism is another term for sialorrhea or hypersalivation."
    },
    {
        q: "What role does bicarbonate (HCO3-) play in saliva?",
        opts: ["Antimicrobial action", "Lubrication", "Buffering capacity", "Enzymatic digestion"],
        correct: 2,
        explain: "Bicarbonate is a key component of the salivary buffering system, helping to neutralize acids in the oral cavity."
    },
    {
        q: "Which gland's duct is shown opening near the upper molars in diagrams?",
        opts: ["Sublingual gland", "Submandibular gland", "Parotid gland", "Von Ebner's gland"],
        correct: 2,
        explain: "The Parotid duct (Stensen's duct) opens into the oral cavity opposite the maxillary second molar."
    },
    {
        q: "Neurological disorders like cerebral palsy are often associated with:",
        opts: ["Xerostomia", "Normal salivation", "Hypersalivation", "Painful salivary glands"],
        correct: 2,
        explain: "The slides list neurological disorders such as cerebral palsy and mental retardation as causes of hypersalivation (sialorrhea)."
    },
    {
        q: "What is the main visual difference between a healthy mouth and one with xerostomia?",
        opts: ["Tooth color", "Gum color", "Tongue texture and moisture", "Lip size"],
        correct: 2,
        explain: "Images in the lecture highlight the difference: a healthy tongue is moist, while a dry mouth shows a dry, often fissured or coated tongue."
    },
    {
        q: "Salivary secretion control is NOT linked to which of the following stimuli?",
        opts: ["Smell of food", "Taste of food", "Masticatory stimuli", "Auditory stimuli (sound)"],
        correct: 3,
        explain: "The lecture mentions that secretion control is linked to smell, taste, and masticatory stimuli, but not auditory stimuli."
    }
];

const tfs = [
    {
        q: "The primary secretion of saliva from the acini is hypotonic.",
        answer: false,
        explain: "This is false. The primary secretion is isotonic; it becomes hypotonic after modification in the ducts."
    },
    {
        q: "The sympathetic nervous system activation typically results in a watery, high-volume salivary flow.",
        answer: false,
        explain: "This is false. The sympathetic system usually decreases secretion and makes saliva more viscous. The parasympathetic system increases watery flow."
    },
    {
        q: "Xerostomia increases a patient's susceptibility to dental caries.",
        answer: true,
        explain: "This is true. Reduced saliva compromises its protective functions, including buffering and remineralization, leading to a higher caries risk."
    },
    {
        q: "Sialorrhea is another term for hyposalivation.",
        answer: false,
        explain: "This is false. Sialorrhea means hypersalivation (excessive saliva), while hyposalivation means reduced saliva."
    },
    {
        q: "During the secondary phase of secretion, potassium (K+) and bicarbonate (HCO3-) are reabsorbed from the saliva.",
        answer: false,
        explain: "This is false. In the secondary phase, K+ and HCO3- are secreted into the saliva, while Na+ and Cl- are reabsorbed."
    },
    {
        q: "Myoepithelial cells are responsible for producing the mucous component of saliva.",
        answer: false,
        explain: "This is false. Myoepithelial cells have contractile properties to expel saliva. Mucous cells produce the mucous component."
    },
    {
        q: "Teething is a common cause of xerostomia in infants.",
        answer: false,
        explain: "This is false. Teething is associated with hypersalivation (sialorrhea), not xerostomia."
    },
    {
        q: "The final saliva is hypertonic compared to plasma.",
        answer: false,
        explain: "This is false. The final saliva is hypotonic due to the reabsorption of more solutes (NaCl) than water in the ducts."
    },
    {
        q: "Antidepressants and antipsychotics can lead to dry mouth.",
        answer: true,
        explain: "This is true. These medication classes are listed as common causes of xerostomia by interfering with neuroregulation."
    }
];

const saqs = [
    {
        q: "Define xerostomia and list four common causes mentioned in the lecture.",
        a: "Xerostomia is the clinical term for a dry mouth due to a reduction in the volume of secreted saliva.<br><br><b>Common Causes:</b><br>1. Destruction of glandular cells (e.g., by radiation).<br>2. Psychological causes like anxiety and depression.<br>3. Dehydration.<br>4. Side effects of medications (e.g., anticholinergics, antidepressants)."
    },
    {
        q: "Describe the two main phases of salivary secretion.",
        a: "<b>Phase 1 (Primary Secretion):</b> Occurs in the acini. Serous and mucous cells produce an isotonic fluid rich in NaCl, proteins, and water.<br><br><b>Phase 2 (Secondary Modification):</b> Occurs in the ducts (primarily striated ducts). Sodium (Na+) and chloride (Cl-) are actively reabsorbed from the primary saliva, while potassium (K+) and bicarbonate (HCO3-) are secreted into it. This makes the final saliva hypotonic."
    },
    {
        q: "List five conditions or situations that can lead to hypersalivation (sialorrhea).",
        a: "<ol><li>Acute inflammation of the mouth or tongue.</li><li>Neurological disorders (e.g., cerebral palsy).</li><li>Teething.</li><li>Nausea and vomiting.</li><li>Presence of a foreign material (e.g., orthodontic appliance).</li></ol>"
    },
    {
        q: "A 65-year-old patient reports persistent dry mouth, difficulty swallowing, and a recent increase in cavities. They are currently taking medication for high blood pressure and depression. What is the likely diagnosis for their oral condition, and what are the probable contributing factors?",
        a: "<b>Likely Diagnosis:</b> Xerostomia (hyposalivation).<br><br><b>Contributing Factors:</b> The patient's medications for high blood pressure (antihypertensives) and depression (antidepressants) are known to cause xerostomia as a side effect. Their age can also be a factor. The reported symptoms (difficulty swallowing, increased cavities) are classic consequences of this condition."
    },
    {
        q: "Compare the composition of primary saliva (in the acini) with final saliva (in the oral cavity) with respect to tonicity and key ion concentrations.",
        a: "<table><thead><tr><th>Feature</th><th>Primary Saliva (Acini)</th><th>Final Saliva (Oral Cavity)</th></tr></thead><tbody><tr><td>1. Tonicity</td><td>Isotonic (similar to plasma)</td><td>Hypotonic (less than plasma)</td></tr><tr><td>2. Na+ & Cl- Conc.</td><td>High (similar to plasma)</td><td>Low (reabsorbed in ducts)</td></tr><tr><td>3. K+ & HCO3- Conc.</td><td>Low (similar to plasma)</td><td>High (secreted in ducts)</td></tr></tbody></table>"
    },
    {
        q: "Explain the clinical consequences of decreased salivary volume on oral health.",
        a: "A decrease in salivary volume (hyposalivation) leads to:<br><br>1. <b>Difficulty with function:</b> Problems with speech, mastication, and taste perception. Swallowing can become painful.<br>2. <b>Increased Caries Risk:</b> The teeth become more susceptible to caries due to loss of buffering, remineralization, and cleansing actions.<br>3. <b>Tissue Susceptibility:</b> Oral tissues are more prone to frequent infections, inflammation, and ulceration without the protective lubricating film of saliva."
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      const originalIndex = visualToOriginal[v];
      state.mcq[idx] = originalIndex; // store original index

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');
      const isCorrect = (originalIndex === item.correct);

      if(!isCorrect){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
    const mcqScore = state.mcq.reduce((s, selectedOriginalIndex, i) => {
        if (selectedOriginalIndex === null) return s;
        return s + (selectedOriginalIndex === mcqs[i].correct ? 1 : 0);
    }, 0);
    const tfScore = state.tf.reduce((s, v, i) => {
        if (v === null) return s;
        return s + (v === tfs[i].answer ? 1 : 0);
    }, 0);
    const saqScore = state.saq.filter(Boolean).length;
    const total = mcqScore + tfScore + saqScore;

    const ids = ["sMcq", "sTf", "sSaq", "sTotal", "sMcq2", "sTf2", "sSaq2", "sTotal2"];
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (id.includes('Mcq')) el.textContent = mcqScore;
        if (id.includes('Tf')) el.textContent = tfScore;
        if (id.includes('Saq')) el.textContent = saqScore;
        if (id.includes('Total')) el.textContent = total;
    });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc(); // Initial calculation
</script>
</body>
</html>
