<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}

  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{padding:8px 12px;border:1px solid var(--card-border);text-align:left;}
  th{background-color:rgba(255,255,255,0.05);}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 1</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "Which of the following is considered a major salivary gland?",
        opts: ["Labial gland", "Parotid gland", "Buccal gland", "Palatal gland"],
        correct: 1,
        explain: "The major salivary glands are the Parotid, Submandibular, and Sublingual glands. The others listed are minor salivary glands."
    },
    {
        q: "The parotid gland is located below which structure?",
        opts: ["Zygomatic arch", "Angle of the mandible", "Hyoid bone", "Thyroid cartilage"],
        correct: 1,
        explain: "The parotid gland extends below the angle of the mandible."
    },
    {
        q: "Which nerve passes through the parotid gland and divides into its terminal branches within it?",
        opts: ["Trigeminal nerve (V)", "Facial nerve (VII)", "Glossopharyngeal nerve (IX)", "Vagus nerve (X)"],
        correct: 1,
        explain: "The Facial nerve (cranial nerve VII) is the most superficial structure passing through the parotid gland."
    },
    {
        q: "The parotid duct, also known as Stensen's duct, opens into the oral cavity opposite which tooth?",
        opts: ["Upper first molar", "Lower second molar", "Upper second molar", "Lower first premolar"],
        correct: 2,
        explain: "Stensen's duct opens into the vestibule of the mouth opposite the upper second molar tooth."
    },
    {
        q: "Which artery enters the parotid gland and divides into its two terminal branches, the superficial temporal and maxillary arteries?",
        opts: ["Internal carotid artery", "Facial artery", "Lingual artery", "External carotid artery"],
        correct: 3,
        explain: "The External Carotid Artery (ECA) is a deep structure within the gland that gives off its terminal branches there."
    },
    {
        q: "The retromandibular vein is formed within the parotid gland by the union of which two veins?",
        opts: ["Facial and lingual veins", "Superficial temporal and maxillary veins", "Posterior auricular and occipital veins", "Internal and external jugular veins"],
        correct: 1,
        explain: "The retromandibular vein is formed by the joining of the superficial temporal and maxillary veins within the parotid gland."
    },
    {
        q: "Parasympathetic (secretory) nerve supply to the parotid gland originates from which cranial nerve?",
        opts: ["Facial nerve (VII)", "Vagus nerve (X)", "Trigeminal nerve (V)", "Glossopharyngeal nerve (IX)"],
        correct: 3,
        explain: "The parasympathetic fibers originate from the glossopharyngeal nerve (IX), travel via the lesser petrosal nerve to the otic ganglion, and then to the gland via the auriculotemporal nerve."
    },
    {
        q: "The submandibular gland is located within which triangle of the neck?",
        opts: ["Carotid triangle", "Muscular triangle", "Submandibular triangle", "Submental triangle"],
        correct: 2,
        explain: "The submandibular gland is situated in the submandibular (or digastric) triangle."
    },
    {
        q: "The submandibular duct, also known as Wharton's duct, opens into the floor of the mouth at the:",
        opts: ["Sublingual fold", "Parotid papilla", "Frenulum of the tongue", "Sublingual papilla"],
        correct: 3,
        explain: "Wharton's duct opens at the sublingual papilla, on the side of the frenulum of the tongue."
    },
    {
        q: "Which muscle divides the submandibular gland into a superficial and a deep part?",
        opts: ["Hyoglossus", "Digastric (anterior belly)", "Mylohyoid", "Stylohyoid"],
        correct: 2,
        explain: "The mylohyoid muscle separates the submandibular gland into its superficial and deep lobes."
    },
    {
        q: "The parasympathetic (secretomotor) nerve supply to the submandibular and sublingual glands comes from which nerve?",
        opts: ["Hypoglossal nerve", "Glossopharyngeal nerve", "Chorda tympani branch of the Facial nerve", "Lingual nerve (sensory only)"],
        correct: 2,
        explain: "Secretomotor fibers originate from the facial nerve (VII) and travel via its chorda tympani branch, which then joins the lingual nerve to reach the submandibular ganglion."
    },
    {
        q: "Which of these structures is NOT a content of the carotid sheath, found posteromedial to the parotid gland?",
        opts: ["Internal carotid artery", "Internal jugular vein", "Vagus nerve", "Facial nerve"],
        correct: 3,
        explain: "The carotid sheath contains the internal carotid artery, internal jugular vein, and the lower four cranial nerves (IX, X, XI, XII). The facial nerve (VII) pierces the gland but is not in the sheath at this level."
    },
    {
        q: "What is the smallest of the three main salivary glands?",
        opts: ["Parotid gland", "Submandibular gland", "Sublingual gland", "Accessory parotid gland"],
        correct: 2,
        explain: "The sublingual gland is the smallest of the three major salivary glands."
    },
    {
        q: "The sensory innervation to the capsule of the parotid gland is provided by which nerve?",
        opts: ["Auriculotemporal nerve", "Great auricular nerve", "Lesser petrosal nerve", "Buccal branch of facial nerve"],
        correct: 1,
        explain: "The great auricular nerve provides sensory innervation to the parotid capsule (fascia), while the auriculotemporal nerve supplies sensory fibers to the gland itself."
    },
    {
        q: "Which of the following is NOT one of the five terminal branches of the facial nerve that emerge from the parotid gland?",
        opts: ["Temporal", "Zygomatic", "Auricular", "Cervical"],
        correct: 2,
        explain: "The five terminal branches are Temporal, Zygomatic, Buccal, Mandibular, and Cervical. The posterior auricular nerve is a branch given off before the nerve enters the gland."
    },
    {
        q: "The parotid duct pierces all the following structures EXCEPT:",
        opts: ["Buccal pad of fat", "Buccopharyngeal fascia", "Masseter muscle", "Buccinator muscle"],
        correct: 2,
        explain: "The parotid duct passes across the masseter muscle but pierces the buccal pad of fat, buccopharyngeal fascia, and buccinator muscle to enter the mouth."
    },
    {
        q: "The lingual nerve has a specific relationship with the submandibular duct. What is it?",
        opts: ["It runs superior to the duct", "It runs inferior to the duct", "It hooks around the duct from lateral to medial", "It pierces the duct"],
        correct: 2,
        explain: "The lingual nerve initially runs superior and lateral to the submandibular duct, then loops under it to become medial."
    },
    {
        q: "The deep part of the submandibular gland lies between which two muscles?",
        opts: ["Mylohyoid and Genioglossus", "Mylohyoid and Hyoglossus", "Hyoglossus and Styloglossus", "Digastric and Stylohyoid"],
        correct: 1,
        explain: "The deep part of the submandibular gland is located between the mylohyoid muscle laterally and the hyoglossus muscle medially."
    },
    {
        q: "Minor salivary glands contribute approximately what percentage of the total salivary volume?",
        opts: ["5%", "10%", "50%", "90%"],
        correct: 1,
        explain: "Minor salivary glands are numerous but produce only about 10% of the total saliva."
    },
    {
        q: "A common clinical issue associated with the parotid gland due to its tight capsule is:",
        opts: ["Facial paralysis", "Severe pain during infection (e.g., mumps)", "Formation of salivary stones (sialolithiasis)", "Development of mucoceles"],
        correct: 1,
        explain: "The unyielding nature of the outer (false) capsule of the parotid gland causes significant pain when the gland swells during infections like mumps."
    },
    {
        q: "What is the relationship of the facial nerve to the other major structures within the parotid gland?",
        opts: ["Deepest structure", "Intermediate structure", "Most superficial structure", "Anterior structure"],
        correct: 2,
        explain: "From deep to superficial, the structures are: External Carotid Artery, Retromandibular Vein, and Facial Nerve."
    },
    {
        q: "Which structures emerge from the anterior border of the parotid gland?",
        opts: ["Superficial temporal artery and vein", "Parotid duct, transverse facial artery, and branches of the facial nerve", "Auriculotemporal nerve", "Cervical branch of the facial nerve"],
        correct: 1,
        explain: "The parotid duct, transverse facial artery, and the zygomatic, buccal, and mandibular branches of the facial nerve emerge from the anterior border."
    },
    {
        q: "Sympathetic (vasomotor) nerve supply to the salivary glands comes from the:",
        opts: ["Vagus nerve", "Plexus around the internal carotid artery", "Plexus around the external carotid and facial arteries", "Trigeminal nerve"],
        correct: 2,
        explain: "Sympathetic fibers originate from the superior cervical ganglion and travel along the plexuses of arteries supplying the glands, such as the external carotid and facial arteries."
    },
    {
        q: "The anteromedial surface of the parotid gland is related to which muscles?",
        opts: ["Masseter and medial pterygoid", "Temporalis and lateral pterygoid", "Sternocleidomastoid and Digastric", "Buccinator and Orbicularis oris"],
        correct: 0,
        explain: "The anteromedial surface of the parotid gland is related to the posterior border of the ramus of the mandible, as well as the masseter and medial pterygoid muscles."
    },
    {
        q: "Which minor salivary glands are purely mucous in secretion type?",
        opts: ["Labial glands", "Buccal glands", "Palatine glands", "Anterior lingual glands"],
        correct: 2,
        explain: "The palatine and posterior lingual glands are purely mucous. The labial, buccal, and anterior lingual glands are mixed."
    },
    {
        q: "Injury to which nerve during submandibular gland excision can cause issues with tongue movement and sensation?",
        opts: ["Facial nerve and Hypoglossal nerve", "Lingual nerve and Hypoglossal nerve", "Glossopharyngeal nerve and Vagus nerve", "Accessory nerve and Phrenic nerve"],
        correct: 1,
        explain: "The lingual nerve (for sensation) and hypoglossal nerve (for motor function) are in close relation to the submandibular gland and its duct."
    },
    {
        q: "What structure forms the 'true' inner capsule of the parotid gland?",
        opts: ["Investing layer of deep cervical fascia", "Buccopharyngeal fascia", "Condensation of fibrous connective tissue", "Perimysium of the masseter muscle"],
        correct: 2,
        explain: "The inner (true) capsule is a condensation of the gland's own connective tissue, while the outer (false) capsule is derived from the deep cervical fascia."
    },
    {
        q: "The posteromedial surface of the parotid gland is related to which bony process?",
        opts: ["Zygomatic process", "Coronoid process", "Mastoid process", "Condylar process"],
        correct: 2,
        explain: "The posteromedial surface is related to the mastoid process and the styloid process."
    },
    {
        q: "How many ducts does the sublingual gland typically have?",
        opts: ["One main duct", "Two ducts", "Three ducts", "Multiple small ducts (8-20)"],
        correct: 3,
        explain: "The sublingual gland has numerous small ducts (of Rivinus) that open onto the sublingual fold, with some occasionally joining the submandibular duct."
    },
    {
        q: "Sialolithiasis (salivary stones) is most common in which gland's duct?",
        opts: ["Parotid (Stensen's duct)", "Submandibular (Wharton's duct)", "Sublingual ducts", "Minor salivary glands"],
        correct: 1,
        explain: "Due to the long, upward course of Wharton's duct and the thicker, mucous nature of the submandibular saliva, it is the most common site for salivary stones."
    }
];

const tfs = [
    {
        q: "The parotid gland is the largest of the major salivary glands.",
        answer: true,
        explain: "The parotid is the largest, followed by the submandibular, and then the sublingual."
    },
    {
        q: "The facial nerve is the deepest structure passing through the parotid gland.",
        answer: false,
        explain: "The facial nerve is the most superficial. The external carotid artery is the deepest, and the retromandibular vein is intermediate."
    },
    {
        q: "All major salivary glands are classified as exocrine glands.",
        answer: true,
        explain: "Salivary glands are exocrine because they secrete saliva into the oral cavity via ducts."
    },
    {
        q: "The submandibular gland produces purely serous saliva.",
        answer: false,
        explain: "The submandibular gland produces a mixed serous and mucous secretion. The parotid is purely serous."
    },
    {
        q: "The auriculotemporal nerve provides secretomotor (parasympathetic) fibers to the parotid gland.",
        answer: true,
        explain: "The parasympathetic fibers, having synapsed in the otic ganglion, travel with the auriculotemporal nerve to innervate the parotid gland."
    },
    {
        q: "Minor salivary glands are encapsulated.",
        answer: false,
        explain: "Minor salivary glands are unencapsulated and are scattered throughout the oral mucosa."
    },
    {
        q: "Wharton's duct is another name for the parotid duct.",
        answer: false,
        explain: "Wharton's duct is the name for the submandibular duct. The parotid duct is called Stensen's duct."
    },
    {
        q: "The deep part of the submandibular gland is located superior to the mylohyoid muscle.",
        answer: true,
        explain: "The deep part lies deep (superior) to the mylohyoid muscle, while the superficial part is superficial (inferior) to it."
    },
    {
        q: "The sensory innervation to the submandibular gland itself is provided by the hypoglossal nerve.",
        answer: false,
        explain: "Sensory innervation to the submandibular and sublingual glands is provided by the lingual nerve (a branch of V3)."
    }
];

const saqs = [
    {
        q: "List the three main structures that pass through the substance of the parotid gland, from deep to superficial.",
        a: "The three structures passing through the parotid gland are:<br>1. External Carotid Artery (deepest)<br>2. Retromandibular Vein (intermediate)<br>3. Facial Nerve (most superficial)"
    },
    {
        q: "Describe the course of the parotid (Stensen's) duct from the gland to its opening in the oral cavity.",
        a: "The parotid duct emerges from the anterior border of the gland, passes forward across the masseter muscle, then turns medially to pierce the buccal pad of fat, the buccopharyngeal fascia, and the buccinator muscle. It finally opens into the vestibule of the mouth on the parotid papilla, opposite the crown of the upper second molar tooth."
    },
    {
        q: "Compare the major and minor salivary glands based on three features.",
        a: "<table><tr><th>Feature</th><th>Major Salivary Glands</th><th>Minor Salivary Glands</th></tr><tr><td>1. Size</td><td>Large</td><td>Small, microscopic</td></tr><tr><td>2. Capsule</td><td>Encapsulated</td><td>Unencapsulated</td></tr><tr><td>3. Ducts</td><td>Long, distinct ducts</td><td>Short, simple ducts opening directly</td></tr><tr><td>4. Number</td><td>3 pairs (6 total)</td><td>Numerous (hundreds)</td></tr></table>"
    },
    {
        q: "A patient presents with painful swelling in the right cheek area that worsens during meals. Blockage of which structure is the most likely cause, and where would you check intraorally for its opening?",
        a: "The most likely cause is a blockage (sialolithiasis) of the right parotid (Stensen's) duct. You would check for its opening intraorally on the parotid papilla, located on the buccal mucosa opposite the upper right second molar tooth."
    },
    {
        q: "List the five terminal motor branches of the facial nerve that emerge from the parotid gland.",
        a: "The five terminal branches of the facial nerve are:<br>1. Temporal branch<br>2. Zygomatic branch<br>3. Buccal branch<br>4. Mandibular branch<br>5. Cervical branch"
    },
    {
        q: "During a surgical procedure to remove the submandibular gland, which two major nerves are at risk of injury due to their close proximity to the gland and its duct?",
        a: "The two nerves most at risk during submandibular gland excision are:<br>1. The Lingual Nerve (which hooks around the submandibular duct and provides sensation to the anterior two-thirds of the tongue).<br>2. The Hypoglossal Nerve (which runs deep to the gland and controls the motor functions of the tongue)."
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
