<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam â€¢ Salivary Glands (ocih-1)</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ğŸ¦· Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 1</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù„Ø§ Ø³ÙÙ‡Ù’Ù„Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù…ÙØ§ Ø¬ÙØ¹ÙÙ„Ù’ØªÙÙ‡Ù Ø³ÙÙ‡Ù’Ù„Ù‹Ø§ØŒ ÙˆÙØ£ÙÙ†Ù’ØªÙ ØªÙØ¬Ù’Ø¹ÙÙ„Ù Ø§Ù„Ø­ÙØ²Ù’Ù†Ù Ø¥ÙØ°ÙØ§ Ø´ÙØ¦Ù’ØªÙ Ø³ÙÙ‡Ù’Ù„Ù‹Ø§</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (from Lecture 1: Salivary glands) -----------
const mcqs = [
  { q:"Salivary glands are best classified as which type of glands?", opts:["Endocrine glands","Exocrine glands","Mixed endocrineâ€“exocrine glands","Apocrine skin glands"], correct:1, explain:"They secrete saliva into the oral cavity via ducts â†’ exocrine." },
  { q:"Which of the following are the three pairs of major salivary glands?", opts:["Parotid, sublingual, submandibular","Parotid, buccal, palatal","Labial, buccal, lingual","Parotid, palatal, sublingual"], correct:0, explain:"Major: parotid, submandibular, sublingual. Others are minor." },
  { q:"The parotid gland has how many surfaces and borders, respectively?", opts:["3 surfaces and 2 borders","2 surfaces and 3 borders","4 surfaces and 2 borders","3 surfaces and 4 borders"], correct:0, explain:"Surfaces: superficial, anteromedial, posteromedial; Borders: anterior & posterior." },
  { q:"Which structure does NOT pass inside the parotid gland?", opts:["Facial nerve (CN VII)","External carotid artery","Retromandibular vein","Hypoglossal nerve (CN XII)"], correct:3, explain:"CN XII does not traverse the parotid; CN VII, ECA and retromandibular vein do." },
  { q:"Within the parotid gland, the external carotid artery divides into which terminal branches?", opts:["Facial and maxillary arteries","Maxillary and superficial temporal arteries","Lingual and superficial temporal arteries","Occipital and maxillary arteries"], correct:1, explain:"ECA â†’ maxillary + superficial temporal within the parotid." },
  { q:"The retromandibular vein is formed by the union of which veins?", opts:["Facial and lingual veins","Maxillary and superficial temporal veins","Superficial temporal and occipital veins","Lingual and maxillary veins"], correct:1, explain:"It forms inside the parotid from maxillary + superficial temporal." },
  { q:"Which is the correct list of facial nerve terminal branches in the parotid?", opts:["Temporal, zygomatic, buccal, mandibular, cervical","Temporal, masseteric, buccal, lingual, cervical","Frontal, zygomatic, buccal, marginal, cervical","Temporal, auricular, buccal, mandibular, hypoglossal"], correct:0, explain:"Classically: temporal, zygomatic, buccal, mandibular (marginal), cervical." },
  { q:"Which structure emerges from the anterior border of the parotid gland?", opts:["Great auricular nerve","Parotid duct (Stensen's)","Auriculotemporal nerve","External jugular vein"], correct:1, explain:"Parotid duct and transverse facial artery, plus zygomatic/buccal/mandibular branches, exit anteriorly." },
  { q:"Which set correctly matches what leaves the LOWER end of the parotid?", opts:["Auriculotemporal nerve, temporal branch of facial nerve","Superficial temporal artery and vein","External carotid artery and retromandibular vein divisions","Parotid duct and transverse facial artery"], correct:2, explain:"Lower end gives off ECA and retromandibular vein (or its divisions) and the cervical branch of VII." },
  { q:"The auriculotemporal nerve is MOST closely related to which of the following regarding the parotid?", opts:["Motor supply to facial expression","Secretomotor pathway relay","Sensory to the gland and carrier of postganglionic fibers","Venous drainage"], correct:2, explain:"It provides sensory to the gland and carries postganglionic parasympathetics from otic ganglion." },
  { q:"Which is the correct sequence for the parasympathetic (secretomotor) pathway to the parotid gland?", opts:["Facial nerve â†’ chorda tympani â†’ submandibular ganglion â†’ lingual nerve â†’ parotid","Glossopharyngeal nerve â†’ tympanic branch â†’ lesser petrosal nerve â†’ otic ganglion â†’ auriculotemporal nerve","Vagus nerve â†’ pharyngeal plexus â†’ pterygopalatine ganglion â†’ auriculotemporal nerve","Trigeminal nerve â†’ lingual nerve â†’ otic ganglion â†’ facial nerve"], correct:1, explain:"CN IX â†’ tympanic plexus â†’ lesser petrosal â†’ otic ganglion; postganglionics via auriculotemporal to parotid." },
  { q:"Sympathetic fibers to the parotid gland are derived from:", opts:["Plexus around the external carotid artery","Superior cervical ganglion via internal carotid plexus only","Facial nerve within the gland","Hypoglossal nerve"], correct:0, explain:"Vasomotor sympathetics via the plexus around the ECA." },
  { q:"The parotid duct crosses which muscle before piercing the buccinator?", opts:["Masseter","Medial pterygoid","Temporalis","Mylohyoid"], correct:0, explain:"It runs horizontally over the masseter, then turns medially to pierce structures including buccinator." },
  { q:"The parotid duct opens into the oral vestibule opposite which tooth?", opts:["Lower first molar","Upper second molar","Upper first premolar","Lower second molar"], correct:1, explain:"Opposite the maxillary (upper) second molar." },
  { q:"Which statement about the parotid capsules is correct?", opts:["Single capsule from investing layer only","Inner true capsule of CT and an outer false capsule from investing deep cervical fascia","Capsule from pretracheal fascia only","Capsule absent"], correct:1, explain:"Parotid is enclosed by a true (CT) and a false (investing deep cervical) capsule." },
  { q:"Painful swelling in parotitis is partly due to:", opts:["Loose capsule allowing expansion","Tight outer capsule limiting expansion","Absent lymphatics","Overactive parasympathetic supply"], correct:1, explain:"The tough fascia-derived capsule restricts expansion â†’ pain." },
  { q:"Which muscle is NOT in the suprahyoid group listed for the submandibular region?", opts:["Digastric","Stylohyoid","Mylohyoid","Hyoglossus"], correct:3, explain:"Hyoglossus is an extrinsic tongue muscle; suprahyoids include digastric, stylohyoid, mylohyoid, geniohyoid." },
  { q:"The submandibular gland consists of:", opts:["Single lobe superficial to mylohyoid","Superficial part superficial to mylohyoid and deep part deep to mylohyoid","Both parts deep to mylohyoid","Only a deep part between buccinator and masseter"], correct:1, explain:"Superficial part over mylohyoid; deep part between mylohyoid and hyoglossus." },
  { q:"Which nerve lies superior to the deep part of the submandibular gland?", opts:["Hypoglossal nerve (XII)","Lingual nerve","Auriculotemporal nerve","Glossopharyngeal nerve (IX)"], correct:1, explain:"Lingual nerve and submandibular ganglion are superior to the deep part." },
  { q:"The submandibular duct (Whartonâ€™s) opens at:", opts:["Opposite upper second molar","Floor of mouth at the sublingual papilla beside the lingual frenulum","Behind the last molar in retromolar trigone","On the hard palate"], correct:1, explain:"It opens beside the frenulum at the sublingual papilla." },
  { q:"Parasympathetic secretomotor fibers to the submandibular gland reach it via:", opts:["Auriculotemporal nerve from otic ganglion","Chorda tympani joining the lingual nerve","Glossopharyngeal tympanic branch","Hypoglossal nerve"], correct:1, explain:"From superior salivatory nucleus via chorda tympani â†’ lingual nerve â†’ submandibular ganglion â†’ gland." },
  { q:"Which is TRUE regarding the sublingual gland?", opts:["Largest major salivary gland","Lies above the mylohyoid within the sublingual fold","Has a single long duct only","Opens mainly opposite the upper molars"], correct:1, explain:"Smallest major gland; lies under the mucosa in the sublingual fold; many small ducts." },
  { q:"The usual number of sublingual ducts is approximately:", opts:["1â€“2","3â€“5","8â€“20","30â€“40"], correct:2, explain:"Typically 8â€“20 small ducts opening into the floor of mouth." },
  { q:"Major salivary glands produce roughly what proportion of total saliva?", opts:["~10%","~30%","~60%","~90%"], correct:3, explain:"Major glands contribute the bulk (~90%)." },
  { q:"Minor salivary glands are typically:", opts:["Encapsulated and outside oral mucosa","Unencapsulated and scattered in oral mucosa/submucosa","Paired and large","Draining via a single long duct"], correct:1, explain:"They are numerous, small, unencapsulated and scattered with short ducts." },
  { q:"Which clinical statement is CORRECT?", opts:["Parotid pleomorphic adenoma is rare","Parotidectomy is simple because no major nerves run through the gland","Mumps commonly affects the parotid gland","Whartonâ€™s duct is rarely a site for stones"], correct:2, explain:"Mumps (viral parotitis) commonly targets parotid; parotidectomy is difficult due to facial nerve; Whartonâ€™s stones are common." },
  { q:"Mucocele is MOST commonly associated with which glands?", opts:["Parotid gland","Submandibular gland","Sublingual gland","Minor salivary glands (e.g., labial)"], correct:3, explain:"Mucoceles often arise from trauma/obstruction of minor glands, especially labial." },
  { q:"A stone causing mealâ€‘time pain and swelling in the cheek near the maxillary molars most likely obstructs:", opts:["Whartonâ€™s duct","Stensenâ€™s (parotid) duct","Sublingual common duct","Nasolacrimal duct"], correct:1, explain:"Stensenâ€™s duct opens opposite the upper 2nd molar; obstruction causes meal-time swelling." },
  { q:"Which relation is correct for the PAROTID gland surfaces?", opts:["Superficial surface relates to buccinator","Anteromedial surface relates to mandible and masseter","Posteromedial surface relates to carotid sheath contents and styloid apparatus","Posterior surface relates to mylohyoid"], correct:2, explain:"Posteromedial: styloid process/attachments, mastoid region and carotid sheath contents." },
  { q:"Which of the following emerges from the UPPER end of the parotid gland?", opts:["External carotid artery","Retromandibular vein divisions","Superficial temporal artery and vein","Parotid duct"], correct:2, explain:"Upper end gives off superficial temporal vessels and auriculotemporal nerve; ECA exits inferiorly." },
];

const tfs = [
  { q:"Minor salivary glands are only three pairs in number.", answer:false, explain:"They are numerous (hundreds), not just three pairs." },
  { q:"The parotid duct pierces the buccinator muscle before opening into the vestibule.", answer:true, explain:"It crosses masseter, turns medially, pierces buccinator, and opens opposite the upper 2nd molar." },
  { q:"Sympathetic fibers to the parotid are mainly secretomotor.", answer:false, explain:"They are vasomotor; parasympathetics are secretomotor." },
  { q:"The submandibular glandâ€™s deep part lies between mylohyoid and hyoglossus.", answer:true, explain:"Deep part is wedged between those muscles." },
  { q:"The facial nerve enters the parotid at its posteromedial surface.", answer:true, explain:"That is the classic entry point before branching." },
  { q:"Stensenâ€™s duct opens opposite the lower second molar tooth.", answer:false, explain:"It opens opposite the UPPER second molar." },
  { q:"The capsule around the parotid is loose and compliant, explaining mild pain in parotitis.", answer:false, explain:"Parotid fascia is tight â†’ severe pain with swelling." },
  { q:"Whartonâ€™s duct stones are a recognized cause of submandibular swelling.", answer:true, explain:"Sialolithiasis commonly affects Whartonâ€™s duct." },
  { q:"The auriculotemporal nerve provides sensory to the parotid gland and carries postganglionic parasympathetic fibers.", answer:true, explain:"From the otic ganglion to the gland via auriculotemporal." }
];

const saqs = [
  // 1. Direct Answer
  { q: "Briefly define the salivary glands and their function.", a: "Exocrine glands that secrete saliva via ducts to the oral cavity for lubrication, digestion initiation, buffering, and protection." },
  // 2. List / Enumeration (>=3)
  { q: "List the five terminal branches of the facial nerve within the parotid.", a: "1) Temporal 2) Zygomatic 3) Buccal 4) Mandibular (marginal) 5) Cervical" },
  // 3. Comparison (numbered table)
  { q: "Compare major vs. minor salivary glands in terms of number, capsule, duct system, and saliva contribution.", a: `<table style="width:100%;border-collapse:collapse"><thead><tr><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">#</th><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Feature</th><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Major</th><th style="border:1px solid rgba(255,255,255,0.2);padding:6px">Minor</th></tr></thead><tbody>
      <tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">1</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Number</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">3 pairs</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Hundreds</td></tr>
      <tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">2</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Capsule</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Encapsulated</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Unencapsulated</td></tr>
      <tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">3</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Duct system</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Distinct, long duct</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Short ducts open directly</td></tr>
      <tr><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">4</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">Saliva volume</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">~90%</td><td style="border:1px solid rgba(255,255,255,0.2);padding:6px">~10%</td></tr>
    </tbody></table>` },
  // 4. Case-based Scenario
  { q: "A 25-year-old presents with painful swelling over the cheek that worsens during meals; the papilla opposite the upper 2nd molar looks erythematous. What is the most likely diagnosis and obstructed structure?", a: "Sialolithiasis of Stensenâ€™s (parotid) duct causing obstructive parotitis." },
  // 5. Short description
  { q: "Summarize the course of the parotid duct.", a: "Runs over masseter below zygomatic arch â†’ turns medially â†’ pierces buccal fat pad, buccopharyngeal fascia, buccinator, and buccal mucosa â†’ opens opposite upper 2nd molar." },
  // 6. Pathway (very short)
  { q: "Outline the parasympathetic pathway to the parotid gland in one line.", a: "CN IX (tympanic) â†’ lesser petrosal â†’ otic ganglion â†’ auriculotemporal nerve â†’ parotid." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong âœ–</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct âœ”</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "âœ“ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
