<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
  .answer table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  .answer th, .answer td { border: 1px solid var(--card-border); padding: 8px; text-align: left; }
  .answer th { background-color: var(--glass); }
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 12</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
  {
    q: "The Temporomandibular Joint (TMJ) is technically classified as which type of joint?",
    opts: ["Ginglymodiarthroidal", "Synchondrosis", "Symphysis", "Gomphosis"],
    correct: 0,
    explain: "The TMJ provides both hinging (ginglymoid) and gliding (arthroidal) movements, making it a ginglymodiarthroidal joint."
  },
  {
    q: "Which movement occurs in the lower compartment (meniscomandibular) of the TMJ?",
    opts: ["Rotation (Hinge)", "Translation (Gliding)", "Protrusion only", "Retraction only"],
    correct: 0,
    explain: "The rotational or hinge movement occurs between the head of the mandible and the articular disc in the lower compartment."
  },
  {
    q: "What is the primary muscle responsible for the protrusion of the mandible?",
    opts: ["Lateral pterygoid", "Medial pterygoid", "Temporalis", "Masseter"],
    correct: 0,
    explain: "The lateral pterygoid muscle is the main muscle that pulls the mandible forward (protrusion)."
  },
  {
    q: "Which muscle is primarily responsible for elevating the mandible (closing the mouth)?",
    opts: ["Masseter", "Lateral pterygoid", "Digastric", "Geniohyoid"],
    correct: 0,
    explain: "The Masseter, along with the Temporalis and Medial Pterygoid, is a powerful elevator of the mandible."
  },
  {
    q: "The gliding movement (translation) of the TMJ primarily occurs in which compartment?",
    opts: ["Upper (Meniscotemporal)", "Lower (Meniscomandibular)", "Both compartments equally", "Within the articular disc itself"],
    correct: 0,
    explain: "Translation or gliding occurs between the articular disc and the temporal bone in the upper compartment of the TMJ."
  },
  {
    q: "Which fibers of the temporalis muscle are responsible for the retraction of the mandible?",
    opts: ["Posterior fibers", "Anterior fibers", "Superior fibers", "Medial fibers"],
    correct: 0,
    explain: "The posterior fibers of the temporalis muscle are oriented in a way that allows them to pull the mandible backward (retraction)."
  },
  {
    q: "Which group of muscles is primarily responsible for the depression (opening) of the mandible?",
    opts: ["Digastric, Mylohyoid, Geniohyoid", "Temporalis, Masseter, Medial pterygoid", "Lateral pterygoid only", "Masseter and Temporalis"],
    correct: 0,
    explain: "The suprahyoid muscles (Digastric, Mylohyoid, Geniohyoid), along with gravity and the lower head of the lateral pterygoid, are responsible for depressing the mandible."
  },
  {
    q: "During wide mouth opening, what is the sequence of movements in the TMJ?",
    opts: ["Rotation followed by translation", "Translation followed by rotation", "Only rotation occurs", "Only translation occurs"],
    correct: 0,
    explain: "Initial opening (first 20-25mm) is rotational. Wider opening involves the translational (gliding) movement of the condyle and disc forward."
  },
  {
    q: "Which of the following is considered a primary muscle of mastication?",
    opts: ["Medial pterygoid", "Digastric", "Geniohyoid", "Mylohyoid"],
    correct: 0,
    explain: "The four primary muscles of mastication are the Masseter, Temporalis, Medial pterygoid, and Lateral pterygoid."
  },
  {
    q: "A patient with condylar hyperplasia on the left side would likely exhibit which clinical sign?",
    opts: ["Chin deviation to the right (unaffected) side", "Chin deviation to the left (affected) side", "Anterior open bite", "Symmetrical jaw growth"],
    correct: 0,
    explain: "Overgrowth of the left condyle (hyperplasia) pushes the mandible to the opposite, unaffected side, resulting in chin deviation to the right."
  },
  {
    q: "The term for a condyle that has a vertical depression or cleft on its head is:",
    opts: ["Bifid condyle", "Condylar hypoplasia", "Condylar hyperplasia", "Ankylosis"],
    correct: 0,
    explain: "A bifid condyle is characterized by a split or cleft in the condylar head, often discovered as an incidental radiographic finding."
  },
  {
    q: "Which muscle originates from the temporal fossa and inserts on the coronoid process of the mandible?",
    opts: ["Temporalis", "Masseter", "Medial pterygoid", "Lateral pterygoid"],
    correct: 0,
    explain: "The Temporalis muscle has a broad origin from the temporal fossa and inserts on the coronoid process and anterior border of the ramus."
  },
  {
    q: "What is the typical maximum interincisal opening for a healthy adult?",
    opts: ["40-55 mm", "20-30 mm", "60-70 mm", "Less than 20 mm"],
    correct: 0,
    explain: "The normal range of motion for maximum mouth opening is between 40 and 55 millimeters."
  },
  {
    q: "The chewing motion involves alternating side-to-side movements. This is primarily achieved by the action of which muscles?",
    opts: ["Contralateral pterygoids", "Ipsilateral pterygoids", "Bilateral temporalis contraction", "Bilateral masseter contraction"],
    correct: 0,
    explain: "Lateral movement is produced by the contralateral (opposite side) medial and lateral pterygoid muscles contracting, pulling the jaw to one side."
  },
  {
    q: "Which of these is NOT a primary function of the TMJ?",
    opts: ["Hormone secretion", "Mastication (Chewing)", "Speech (Phonation)", "Swallowing (Deglutition)"],
    correct: 0,
    explain: "The TMJ is involved in mechanical functions like chewing, speech, and swallowing, but not in endocrine functions like hormone secretion."
  },
  {
    q: "Condylar hypoplasia is defined as:",
    opts: ["Failure of the condyle to attain normal size", "Overgrowth of the condyle", "Fusion of the joint", "A split in the condylar head"],
    correct: 1,
    explain: "Hypoplasia refers to the underdevelopment or failure of an organ or tissue to reach its normal size, so condylar hypoplasia is a smaller-than-normal condyle."
  },
  {
    q: "The Masseter muscle originates from the:",
    opts: ["Zygomatic arch", "Temporal fossa", "Sphenoid bone", "Maxillary tuberosity"],
    correct: 0,
    explain: "The powerful masseter muscle originates from the zygomatic arch and inserts on the angle of the mandible."
  },
  {
    q: "Which muscle has two heads, with one originating from the infratemporal surface of the sphenoid bone and the other from the lateral pterygoid plate?",
    opts: ["Lateral pterygoid", "Medial pterygoid", "Temporalis", "Digastric"],
    correct: 0,
    explain: "The Lateral Pterygoid muscle is described as having an upper (smaller) head and a lower (larger) head with these distinct origins."
  },
  {
    q: "What is the role of the articular disc in the TMJ?",
    opts: ["To absorb stress and allow complex movements", "To produce synovial fluid", "To limit mouth opening", "To retract the mandible"],
    correct: 0,
    explain: "The articular disc acts as a shock absorber and separates the joint into two compartments, facilitating the complex rotational and translational movements."
  },
  {
    q: "On a radiograph, a bifid condyle often presents with a characteristic shape. What is it?",
    opts: ["Heart shape", "Club shape", "Inverted 'L' shape", "Flat shape"],
    correct: 0,
    explain: "The depression on the superior surface gives the bifid condyle a heart-like appearance in an anteroposterior view."
  },
  {
    q: "Which of the following is an accessory muscle of mastication that aids in depression?",
    opts: ["Mylohyoid", "Temporalis", "Masseter", "Medial pterygoid"],
    correct: 0,
    explain: "The Mylohyoid is one of the suprahyoid muscles, which are considered accessory muscles of mastication and help in depressing the mandible."
  },
  {
    q: "The joint sound characterized by a grating or grinding noise is called:",
    opts: ["Crepitus", "Clicking", "Popping", "Thudding"],
    correct: 0,
    explain: "Crepitus refers to the grating, sand-paper like sound that can occur in joints, often associated with degenerative changes."
  },
  {
    q: "The superficial head of the medial pterygoid muscle originates from the:",
    opts: ["Maxillary tuberosity", "Medial surface of the lateral pterygoid plate", "Temporal fossa", "Zygomatic arch"],
    correct: 0,
    explain: "The medial pterygoid has two heads; the smaller, superficial head originates from the maxillary tuberosity."
  },
  {
    q: "During palpation, the TMJ can be examined using which two methods?",
    opts: ["Pre-auricular and intra-auricular", "Submandibular and sublingual", "Intraoral and extraoral only", "Anterior and posterior"],
    correct: 0,
    explain: "The lecture describes examining the joint by palpating in front of the ear (pre-auricular) and by placing a finger inside the ear canal (intra-auricular)."
  },
  {
    q: "Which movement primarily involves the articular disc and the head of the mandible gliding forward together?",
    opts: ["Protrusion", "Elevation", "Rotation", "Retraction"],
    correct: 0,
    explain: "During protrusion, the articular disc and the condylar head glide forward and downward along the articular eminence."
  },
  {
    q: "The insertion of the medial pterygoid muscle is on the:",
    opts: ["Medial surface of the angle of the mandible", "Coronoid process", "Neck of the mandible", "Lateral surface of the ramus"],
    correct: 0,
    explain: "The fibers of the medial pterygoid run downwards and laterally to insert on the medial surface of the mandibular angle."
  },
  {
    q: "What structure articulates with the mandibular condyle to form the TMJ?",
    opts: ["Mandibular fossa of the temporal bone", "Zygomatic process", "Styloid process", "Mastoid process"],
    correct: 0,
    explain: "The TMJ is the articulation between the condyle of the mandible and the mandibular fossa (or glenoid fossa) of the temporal bone."
  },
  {
    q: "Which clinical condition might show an elongated and thickened condylar neck, sometimes bent laterally?",
    opts: ["Condylar hyperplasia", "Condylar hypoplasia", "Bifid condyle", "TMJ ankylosis"],
    correct: 0,
    explain: "Condylar hyperplasia, or overgrowth, can lead to radiographic features like an elongated and thickened condylar neck."
  },
  {
    q: "A posterior open bite on the affected side is a clinical feature of:",
    opts: ["Condylar hyperplasia", "Condylar hypoplasia", "A normal occlusion", "Bifid condyle"],
    correct: 0,
    explain: "In condylar hyperplasia, the overgrowth on one side can cause the posterior teeth on that same side to not meet, resulting in a posterior open bite."
  },
  {
    q: "The term 'arthroidal' refers to which type of movement?",
    opts: ["Gliding", "Hinging", "Pivoting", "Flexing"],
    correct: 0,
    explain: "An arthroidal joint is a type of synovial joint that allows for gliding or sliding movements."
  }
];

const tfs = [
  {
    q: "The TMJ is classified as a synovial joint.",
    answer: true,
    explain: "The TMJ is a synovial joint, characterized by a fibrous capsule, articular disc, and synovial fluid."
  },
  {
    q: "The temporalis muscle is the primary muscle for protruding the jaw.",
    answer: false,
    explain: "The primary muscle for protrusion is the lateral pterygoid. The temporalis is mainly for elevation and retraction."
  },
  {
    q: "The first 20-25mm of mouth opening consists purely of translational movement.",
    answer: false,
    explain: "The initial phase of mouth opening is rotational (hinge) movement. Translation occurs during wider opening."
  },
  {
    q: "Condylar hypoplasia results in an enlargement of the condylar head.",
    answer: false,
    explain: "Hypoplasia is the failure to attain normal size (underdevelopment), while hyperplasia is an enlargement or overgrowth."
  },
  {
    q: "Both right and left TMJs must work simultaneously and in coordination for balanced jaw function.",
    answer: true,
    explain: "The two TMJs are linked by the solid mandible, requiring coordinated movements for proper function."
  },
  {
    q: "The masseter muscle assists in depressing the mandible (opening the mouth).",
    answer: false,
    explain: "The masseter is a powerful elevator of the mandible, responsible for closing the mouth."
  },
  {
    q: "A bifid condyle is always symptomatic and requires immediate treatment.",
    answer: false,
    explain: "A bifid condyle is often an asymptomatic, incidental finding on radiographs and usually does not require treatment."
  },
  {
    q: "Chewing movements are achieved by combining protrusion, retraction, elevation, and depression.",
    answer: true,
    explain: "Mastication is a complex process involving a combination of all the basic jaw movements in a cyclical pattern."
  },
  {
    q: "The Digastric muscle is considered one of the primary muscles of mastication.",
    answer: false,
    explain: "The Digastric muscle is a secondary or accessory muscle of mastication; it primarily helps in depressing the mandible."
  }
];

const saqs = [
  {
    q: "List the four primary muscles of mastication.",
    a: "The four primary muscles of mastication are: <br> 1. Masseter <br> 2. Temporalis <br> 3. Medial pterygoid <br> 4. Lateral pterygoid"
  },
  {
    q: "Describe the two distinct types of movement that occur in the temporomandibular joint during mouth opening.",
    a: "1. <strong>Rotation (Hinge Movement):</strong> Occurs in the lower joint compartment (meniscomandibular) during the initial 20-25mm of opening. The condylar head rotates on the undersurface of the articular disc. <br> 2. <strong>Translation (Gliding Movement):</strong> Occurs in the upper joint compartment (meniscotemporal) during wider opening. The condyle and the disc glide forward and downward onto the articular eminence."
  },
  {
    q: "A 22-year-old patient presents with significant facial asymmetry. Their chin is deviated to the left side, and they have a posterior open bite on the right side. What developmental abnormality of the TMJ is the most likely diagnosis?",
    a: "The most likely diagnosis is <strong>Right Condylar Hyperplasia</strong>. The overgrowth of the right condyle pushes the mandible down and across to the opposite (unaffected) side, causing chin deviation to the left and an open bite on the affected (right) side."
  },
  {
    q: "Compare the primary actions of the Temporalis muscle and the Lateral Pterygoid muscle.",
    a: `
      <table>
        <thead>
          <tr>
            <th>Muscle</th>
            <th>Primary Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Temporalis</strong></td>
            <td>1. Elevates the mandible (closes mouth).<br>2. Retracts the mandible (posterior fibers).</td>
          </tr>
          <tr>
            <td><strong>Lateral Pterygoid</strong></td>
            <td>1. Protrudes the mandible (main function).<br>2. Assists in depressing the mandible (opening).<br>3. Produces side-to-side movements.</td>
          </tr>
        </tbody>
      </table>
    `
  },
  {
    q: "What are the two main compartments of the TMJ, and what structure divides them?",
    a: "The two compartments are: <br> 1. <strong>Upper (Meniscotemporal) Compartment:</strong> Located between the articular fossa/eminence and the articular disc. <br> 2. <strong>Lower (Meniscomandibular) Compartment:</strong> Located between the articular disc and the head of the mandible. <br><br> They are divided by the <strong>articular disc</strong>."
  },
  {
    q: "List three functions of the TMJ besides mastication (chewing).",
    a: "Three functions of the TMJ besides mastication are: <br> 1. <strong>Speech (Phonation):</strong> Allows for the fine movements of the jaw required to form different sounds. <br> 2. <strong>Swallowing (Deglutition):</strong> The mandible is stabilized during swallowing. <br> 3. <strong>Respiration:</strong> Helps maintain a patent airway by controlling the mandibular rest posture."
  }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
