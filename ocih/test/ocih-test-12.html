<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 12</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (from Lecture: Functional & Radiologic Anatomy of TMJ) -----------
const mcqs = [
  { q:"The TMJ provides hinging and gliding movements, so it is classified as a ______ joint.",
    opts:["Synchondrosis","Fibrous","Ginglymoarthrodial","Pivot"],
    correct:2,
    explain:"TMJ combines ginglymoid (hinge) and arthrodial (gliding) actions ‚Üí ginglymoarthrodial; it is a synovial joint." },
  { q:"The TMJ is a type of ______ joint.",
    opts:["Cartilaginous","Synovial","Fibrous","Suture"],
    correct:1,
    explain:"Lecture explicitly describes TMJ as a synovial joint." },
  { q:"In the TMJ, the meniscotemporal compartment lies between:",
    opts:["Articular disc and head of mandible","Head of mandible and mandibular fossa","Upper articular surface and articular disc","Stylomandibular ligament and condyle"],
    correct:2,
    explain:"Upper (meniscotemporal) compartment: between upper articular surface and the disc." },
  { q:"The meniscomandibular (lower) compartment lies between:",
    opts:["Articular disc and head of mandible","Temporal bone and capsule","Disc and articular eminence","Stylomandibular ligament and ramus"],
    correct:0,
    explain:"Lower compartment is between the disc and head of the mandible." },
  { q:"During the first ~20‚Äì25 mm of mouth opening, the predominant movement is:",
    opts:["Translation of condyle-disc complex","Rotation (hinge) in lower compartment","Lateral excursion only","Posterior rotation of disc in upper compartment"],
    correct:1,
    explain:"Early opening is rotational (hinge) movement; wider opening adds translation." },
  { q:"At wide mouth opening, the head of the mandible comes to lie:",
    opts:["Within the mandibular fossa","Behind the articular eminence","Under the articular tubercle (eminence)","Against the tympanic plate"],
    correct:2,
    explain:"Hinge movement is followed by gliding; at maximum opening the head reaches beneath the articular tubercle." },
  { q:"Protrusion primarily involves:",
    opts:["Disc gliding on upper articular surface with the head moving with it","Pure rotation of the head beneath the disc","Inferior movement of the disc only","Posterior displacement of the condyle"],
    correct:0,
    explain:"In protrusion, the disc glides anteriorly over the upper surface and the head moves with it." },
  { q:"Retraction is best described as:",
    opts:["Forward translation of the condyle","Backward movement reversing protrusion","Superior translation of the disc","Ipsilateral rotation of both condyles"],
    correct:1,
    explain:"Retraction is the reversal of protrusion (backward movement)." },
  { q:"In chewing, when the right condyle translates forward, the left condyle:",
    opts:["Also translates forward","Rotates in place","Retracts posteriorly","Moves superiorly"],
    correct:1,
    explain:"Lecture notes: one side translates, the contralateral condyle rotates; chin deviates to the rotating side." },
  { q:"Primary muscles of mastication include all EXCEPT:",
    opts:["Masseter","Temporalis","Medial pterygoid","Digastric"],
    correct:3,
    explain:"Digastric is listed as a secondary/accessory muscle, not a primary." },
  { q:"Which muscle contributes to retraction via its posterior fibers?",
    opts:["Masseter","Temporalis","Lateral pterygoid (lower head)","Medial pterygoid"],
    correct:1,
    explain:"Posterior fibers of temporalis assist in retraction; temporalis also elevates and aids grinding." },
  { q:"The masseter muscle‚Äôs primary action is:",
    opts:["Depression of mandible","Elevation of mandible and chewing","Protrusion only","Retraction only"],
    correct:1,
    explain:"Masseter is a powerful elevator aiding the chewing motion." },
  { q:"Medial pterygoid functions include:",
    opts:["Elevation; chewing and grinding","Depression only","Retraction only","Opening only"],
    correct:0,
    explain:"Medial pterygoid elevates and assists grinding/chewing." },
  { q:"Lateral pterygoid origin includes:",
    opts:["Zygomatic arch and angle of mandible","Temporal fossa and coronoid process","Greater wing of sphenoid (upper head) and lateral surface of lateral pterygoid plate (lower head)","Medial surface of lateral pterygoid plate (both heads)"],
    correct:2,
    explain:"Upper head from infratemporal surface of greater wing; lower head from lateral surface of lateral pterygoid plate." },
  { q:"Insertion of the lateral pterygoid is mainly on the:",
    opts:["Angle of mandible (medial surface)","Anterior surface of neck of mandible","Coronoid process","Zygomatic arch"],
    correct:1,
    explain:"Lecture states insertion on the anterior surface of the neck of mandible." },
  { q:"The main protrusive muscle of the mandible is:",
    opts:["Masseter","Medial pterygoid","Lateral pterygoid","Temporalis"],
    correct:2,
    explain:"Lateral pterygoid is the principal protrusive muscle." },
  { q:"Regarding lateral pterygoid heads: the upper head assists mainly in ______ and the lower head in ______.",
    opts:["Depression; elevation","Elevation; depression (opening)","Retraction; protrusion","Protrusion; retrusion"],
    correct:1,
    explain:"Upper head‚Äîelevation; lower head‚Äîdepression/opening per the slide text." },
  { q:"Accessory (secondary) depressor muscles include:",
    opts:["Geniohyoid, mylohyoid, digastric","Temporalis, masseter, medial pterygoid","Lateral pterygoid, temporalis","Stylohyoid, buccinator, platysma"],
    correct:0,
    explain:"Depressor/accessory: digastric, mylohyoid, geniohyoid." },
  { q:"Lateral movement is mainly produced by:",
    opts:["Ipsilateral pterygoids","Contralateral pterygoids (lateral + medial)","Suprahyoids only","Masseter alone"],
    correct:1,
    explain:"Side movement is mainly by contralateral pterygoids; controlled by ipsilateral temporalis & masseter." },
  { q:"Which structures help restrict excessive lateral movement?",
    opts:["Only muscles","Ligaments and joint surfaces","Articular disc alone","Teeth only"],
    correct:1,
    explain:"Restricted by ligaments and joint surfaces to prevent over-movement." },
  { q:"A key TMJ function that maintains airway patency at rest is:",
    opts:["Continuous protrusion","Mandibular rest posture","Maximal intercuspation","Bruxism"],
    correct:1,
    explain:"Functions list includes maintaining mandibular rest posture for airway patency." },
  { q:"Which is NOT listed as a function of TMJ?",
    opts:["Mastication","Speech","Swallowing","Vision stabilization"],
    correct:3,
    explain:"Functions include mastication, speech, swallowing, respiration/rest posture, stress absorption, coordination." },
  { q:"Shock absorption during heavy biting is aided by:",
    opts:["Articular disc and synovial fluid","Stylomandibular ligament only","Parotid gland","Auriculotemporal nerve"],
    correct:0,
    explain:"Disc and synovial fluid distribute forces and absorb stress." },
  { q:"During TMJ examination, inspection focuses on:",
    opts:["Lacrimation and sneezing","Swelling, symmetry, clicking","Tongue coating only","Ear wax amount"],
    correct:1,
    explain:"Inspection: swelling, symmetry, clicking in joint region." },
  { q:"Palpation of TMJ is typically performed:",
    opts:["Only intra-orally on coronoid","Pre-auricular and intra-auricular regions","Submental only","At zygomatic arch only"],
    correct:1,
    explain:"Palpation: pre-auricular and intra-auricular; assess temperature, tenderness, crepitus." },
  { q:"Common joint sounds noted in TMJ assessment include:",
    opts:["Murmur and rub","Clicking and crepitus","Crackles only","Silence is pathological"],
    correct:1,
    explain:"Joint sounds include clicking and crepitus as per slides." },
  { q:"Range of movement assessment includes all EXCEPT:",
    opts:["Vertical opening","Lateral (right/left) movements","Protrusion measurement exclusively","Recording tenderness/pain"],
    correct:2,
    explain:"Slides list vertical and lateral ranges; also note tenderness, joint sounds; protrusion not singled out as sole ROM metric." },
  { q:"A typical tool for interincisal distance is:",
    opts:["Otoscope","Metal ruler or Vernier calipers","Thermometer","Tuning fork"],
    correct:1,
    explain:"Slides mention metal ruler/Vernier calipers." },
  { q:"Condylar hyperplasia typically presents with:",
    opts:["Chin deviation to affected side","Chin deviated to the unaffected side with posterior open bite on affected side","No occlusal changes","Trismus only"],
    correct:1,
    explain:"Clinical: chin deviates to unaffected side; posterior open bite on affected side." },
  { q:"Radiographically in condylar hyperplasia, the condylar neck is often:",
    opts:["Short and narrowed","Elongated, thickened, with lateral bend‚Äî‚Äòinverted L‚Äô on coronal view","Absent","Medially displaced only"],
    correct:1,
    explain:"Radiographic feature: elongated, thickened neck; may bend laterally‚Äîdescribed as inverted ‚ÄòL‚Äô." },
  { q:"Condylar hypoplasia is best defined as:",
    opts:["Failure of condyle to attain normal size","Duplication of condylar head","Inflammatory erosion of condyle","Neoplasm of condyle"],
    correct:0,
    explain:"Slides define hypoplasia as failure to reach normal size." }
];

while (mcqs.length < 30) {
  mcqs.push(
    { q:"Radiographic feature of bifid condyle on anteroposterior view often appears:",
      opts:["Round without indentation","As a heart shape due to a central notch","Square","Irregular with multiple cavities"],
      correct:1,
      explain:"AP appearance may show a depression/notch on superior surface giving a heart shape." }
  );
}

// ---- True/False (12) ----
const tfs = [
  { q:"TMJ combines features of both a ginglymoid and an arthrodial joint.", answer:true,  explain:"Hence the term ginglymoarthrodial." },
  { q:"Early mouth opening is predominantly translational.",                answer:false, explain:"Early phase is rotational (hinge) around the lower compartment." },
  { q:"At maximal opening, the condylar head lies under the articular eminence (tubercle).", answer:true,  explain:"Hinge ‚Üí glide; head reaches beneath eminence." },
  { q:"Protrusion is achieved by posterior translation of the disc alone.", answer:false, explain:"Disc glides anteriorly and the head moves with it." },
  { q:"In lateral excursion, the translating condyle is on the side toward which the chin moves.", answer:false, explain:"Chin shifts to the side of the rotating condyle (opposite the translating side)." },
  { q:"Posterior fibers of temporalis assist in mandibular retraction.",   answer:true,  explain:"Listed role in slides." },
  { q:"Masseter is primarily a depressor of the mandible.",                answer:false, explain:"Masseter elevates and assists chewing." },
  { q:"Lateral pterygoid is the main protrusive muscle.",                  answer:true,  explain:"Explicitly mentioned." },
  { q:"Accessory depressor muscles include digastric, mylohyoid, and geniohyoid.", answer:true, explain:"Listed under accessory muscles." },
  { q:"Ligaments and joint surfaces help restrict excessive lateral TMJ movement.", answer:true, explain:"They limit over-movement." },
  { q:"Condylar hyperplasia causes chin deviation toward the affected side.", answer:false, explain:"Deviation toward the unaffected side; posterior open bite on affected side." },
  { q:"Bifid condyle is often an incidental, asymptomatic finding.",       answer:true,  explain:"Clinical feature noted as incidental/asymptomatic." }
];

// ---- SAQs (3) ----
const saqs = [
  { q:"Describe the sequence of movements during mouth opening (depression) and closing (elevation).", 
    a:"Opening starts with rotation (hinge) in the lower compartment for ~20‚Äì25 mm, followed by translation of the disc-condyle complex onto/under the articular eminence; closing reverses this." },
  { q:"List the primary and accessory muscles of mastication with one key action each.", 
    a:"Primary: Masseter (elevation), Temporalis (elevation; posterior fibers retract), Medial pterygoid (elevation, grinding), Lateral pterygoid (protrusion; lower head depression, upper head elevation). Accessory: Digastric, Mylohyoid, Geniohyoid (depressors/assist opening)." },
  { q:"Summarize two clinical considerations and two exam points for TMJ assessment.", 
    a:"Clinical: Condylar hyperplasia (chin deviates to unaffected side; posterior open bite; elongated/thickened neck), Condylar hypoplasia (small condyle and fossa; posteriorly inclined ramus/neck); bifid condyle (often incidental; heart-shaped AP). Exam: Inspect swelling/symmetry/clicking; palpate pre-/intra-auricularly for temperature, tenderness, crepitus; note ROM (vertical & lateral), joint sounds (clicking/crepitus), and pain." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
