<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid var(--card-border); padding: 8px; text-align: left; }
  th { background-color: var(--glass); }
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 17</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
  {
    q: "What is the primary definition of Amelogenesis?",
    opts: [
      "The process of enamel formation.",
      "The process of dentin formation.",
      "The process of cementum formation.",
      "The process of tooth eruption."
    ],
    correct: 0,
    explain: "Amelogenesis is specifically the biological process of forming enamel, the hard outer layer of the tooth crown."
  },
  {
    q: "Amelogenesis begins shortly after which other developmental process?",
    opts: [
      "Cementogenesis",
      "Gingival development",
      "Dentinogenesis",
      "Root formation"
    ],
    correct: 2,
    explain: "Amelogenesis starts after the first layer of dentin has been formed by odontoblasts during dentinogenesis."
  },
  {
    q: "Which cells are directly responsible for the process of amelogenesis?",
    opts: [
      "Odontoblasts",
      "Ameloblasts",
      "Cementoblasts",
      "Fibroblasts"
    ],
    correct: 1,
    explain: "Ameloblasts are the specialized cells that differentiate from the inner enamel epithelium to secrete enamel matrix."
  },
  {
    q: "What are the two major stages of amelogenesis?",
    opts: [
      "Secretion and Maturation",
      "Bud and Cap stage",
      "Proliferation and Differentiation",
      "Matrix deposition and Root formation"
    ],
    correct: 0,
    explain: "The entire process of amelogenesis is divided into the secretory (or formative) stage and the maturation stage."
  },
  {
    q: "How many stages are typically described in the life cycle of an ameloblast?",
    opts: ["Two", "Three", "Four", "Five"],
    correct: 3,
    explain: "The life cycle of an ameloblast is divided into five functional stages: Presecretory, Secretory, Transitional, Maturation, and Protective."
  },
  {
    q: "During which phase of the ameloblast life cycle is the shape of the tooth crown determined?",
    opts: [
      "Differentiation Phase",
      "Secretory Stage",
      "Morphogenetic Phase",
      "Maturation Stage"
    ],
    correct: 2,
    explain: "The Morphogenetic phase, part of the presecretory stage, is when the inner enamel epithelium cells define the shape of the crown."
  },
  {
    q: "What is a key event during the differentiation phase of ameloblasts?",
    opts: [
      "The cells become cuboidal.",
      "The cells begin to rapidly divide.",
      "The cells elongate and their nuclei shift proximally.",
      "The cells form the final enamel layer."
    ],
    correct: 2,
    explain: "During differentiation, the IEE cells elongate into tall columnar cells, and their nuclei move towards the stratum intermedium (proximally)."
  },
  {
    q: "The secretory stage of amelogenesis begins immediately after what event?",
    opts: [
      "The disintegration of the dental lamina.",
      "The formation of the first layer of dentin.",
      "The completion of crown formation.",
      "The start of tooth eruption."
    ],
    correct: 1,
    explain: "Ameloblasts do not begin secreting enamel matrix until the adjacent odontoblasts have laid down the initial layer of dentin."
  },
  {
    q: "What is the Tomes' process?",
    opts: [
      "A gene that regulates enamel formation.",
      "A blood vessel supplying the ameloblasts.",
      "A conical projection at the distal end of a secretory ameloblast.",
      "The nucleus of the ameloblast."
    ],
    correct: 2,
    explain: "The Tomes' process is a distinct, shovel-shaped cytoplasmic extension of the secretory ameloblast that forms enamel rods."
  },
  {
    q: "What is the primary function of the Tomes' process?",
    opts: [
      "To provide nutrients to the cell.",
      "To anchor the cell to the stratum intermedium.",
      "To form both enamel rods and inter-rod enamel.",
      "To absorb excess water from the matrix."
    ],
    correct: 2,
    explain: "The Tomes' process has two secretory surfaces, one for forming the inter-rod substance and another for forming the enamel rod itself."
  },
  {
    q: "The very first layer of enamel deposited against the dentin is characterized as being:",
    opts: [
      "Hypo-mineralized",
      "Rodless or prismless",
      "Rich in collagen",
      "The last layer to mature"
    ],
    correct: 1,
    explain: "The initial layer of enamel is formed before the Tomes' processes are fully developed, resulting in a layer that lacks the typical rod structure."
  },
  {
    q: "How many ameloblasts are involved in the formation of a single keyhole-shaped enamel rod (head and tail)?",
    opts: ["One", "Two", "Three", "Four"],
    correct: 3,
    explain: "One ameloblast forms the head of a rod, while parts of three other ameloblasts contribute to form its tail, meaning four cells contribute in total."
  },
  {
    q: "What major cellular event characterizes the transitional stage of ameloblasts?",
    opts: [
      "A significant increase in cell height and volume.",
      "Development of a ruffled border.",
      "Programmed cell death (apoptosis) of many ameloblasts.",
      "A rapid increase in protein synthesis."
    ],
    correct: 2,
    explain: "During the brief transitional stage, the ameloblast population is reduced by up to 50% through apoptosis as they prepare for the maturation stage."
  },
  {
    q: "What occurs during the maturation stage of amelogenesis?",
    opts: [
      "Initial matrix deposition.",
      "Determination of crown shape.",
      "Selective removal of proteins and water, with a massive influx of minerals.",
      "Formation of the Tomes' process."
    ],
    correct: 2,
    explain: "The maturation stage is defined by the hardening of the enamel through the removal of organic matrix and water, and the growth of hydroxyapatite crystals."
  },
  {
    q: "What does the term 'modulation' refer to in maturative ameloblasts?",
    opts: [
      "The change in enamel rod direction.",
      "The cyclic change between ruffled-ended and smooth-ended phenotypes.",
      "The regulation of gene expression.",
      "The movement of ameloblasts away from the dentin."
    ],
    correct: 1,
    explain: "Modulation is the process where ameloblasts cycle between having a ruffled border and a smooth border at their distal end to perform different functions."
  },
  {
    q: "Ruffled-ended ameloblasts are primarily responsible for:",
    opts: [
      "Removing water and protein fragments from the enamel matrix.",
      "Pumping calcium and phosphate ions into the enamel matrix.",
      "Secreting the initial prismless enamel layer.",
      "Forming the reduced enamel epithelium."
    ],
    correct: 1,
    explain: "The ruffled border increases the surface area for pumping large amounts of calcium and phosphate into the matrix, promoting crystal growth."
  },
  {
    q: "What is the primary role of smooth-ended ameloblasts during maturation?",
    opts: [
      "To secrete enamel proteins.",
      "To form inter-rod enamel.",
      "To allow the exit of protein fragments and water from the matrix.",
      "To initiate mineralization."
    ],
    correct: 2,
    explain: "The smooth-ended phenotype has 'leaky' distal junctions, which facilitates the removal of degraded proteins and water from the maturing enamel."
  },
  {
    q: "The reduced enamel epithelium is formed during which final stage?",
    opts: [
      "Secretory stage",
      "Transitional stage",
      "Maturation stage",
      "Protective stage"
    ],
    correct: 3,
    explain: "In the protective stage, ameloblasts de-differentiate and, along with other enamel organ remnants, form a protective layer over the completed enamel."
  },
  {
    q: "Amelogenesis Imperfecta is a condition that is:",
    opts: [
      "Caused by bacterial infection.",
      "Genomic in origin, affecting enamel structure.",
      "A result of excessive fluoride intake.",
      "Related to poor diet during childhood."
    ],
    correct: 1,
    explain: "Amelogenesis Imperfecta refers to a group of inherited genetic disorders that cause defects in the structure and appearance of enamel."
  },
  {
    q: "During the differentiation phase, where do the Golgi complexes primarily shift within the ameloblast?",
    opts: [
      "Proximally, towards the stratum intermedium.",
      "Distally, towards the dental papilla.",
      "Laterally, between adjacent cells.",
      "They remain centrally located."
    ],
    correct: 1,
    explain: "The cell becomes polarized, with protein-synthesizing organelles like the Golgi complex moving to the distal end to prepare for secretion towards the future dentin."
  },
  {
    q: "What gives the forming enamel its 'picket fence' appearance under a microscope?",
    opts: [
      "The arrangement of enamel rods.",
      "The interdigitation of Tomes' processes with the enamel surface.",
      "Incremental lines of von Ebner.",
      "The scalloped dentinoenamel junction."
    ],
    correct: 1,
    explain: "The cone-shaped Tomes' processes fit into the enamel surface, creating a distinctive picket fence or saw-toothed look."
  },
  {
    q: "The final layers of enamel formed are rodless because:",
    opts: [
      "The ameloblasts run out of matrix proteins.",
      "There is a rapid influx of calcium.",
      "The Tomes' processes are lost or retracted.",
      "The cells undergo apoptosis."
    ],
    correct: 2,
    explain: "As the secretory stage ends, ameloblasts lose their Tomes' processes, resulting in a final, smooth layer of prismless enamel on the surface."
  },
  {
    q: "Which specific enamel protein is predominantly removed during the maturation stage?",
    opts: ["Collagen", "Keratin", "Elastin", "Amelogenin"],
    correct: 3,
    explain: "Amelogenin is the main protein in the enamel matrix, and its selective degradation and removal are crucial for proper mineralization and hardening."
  },
  {
    q: "An ameloblast spends approximately 80% of its time during the maturation stage in which form?",
    opts: [
      "Smooth-ended",
      "Cuboidal",
      "Ruffled-ended",
      "Transitional"
    ],
    correct: 2,
    explain: "The majority of the maturation cycle is spent in the ruffled-ended phase, which is dedicated to pumping minerals into the enamel matrix."
  },
  {
    q: "The junctional complexes between ruffled-ended ameloblasts are described as:",
    opts: [
      "Tight proximally and tight distally.",
      "Leaky proximally and tight distally.",
      "Tight proximally and leaky distally.",
      "Leaky proximally and leaky distally."
    ],
    correct: 2,
    explain: "This arrangement prevents backflow from the enamel matrix while allowing passage of materials from the stratum intermedium."
  },
  {
    q: "What is the clinical consequence of the hypo-mineralization seen in severe Amelogenesis Imperfecta?",
    opts: [
      "The enamel is harder than normal.",
      "The teeth appear whiter.",
      "The enamel is soft and easily fractures or wears away.",
      "The teeth are resistant to decay."
    ],
    correct: 2,
    explain: "Hypo-mineralization means the enamel lacks the necessary hardness, making it prone to damage, discoloration, and rapid wear."
  },
  {
    q: "Which developmental stage of the tooth germ is primarily associated with the initiation of amelogenesis?",
    opts: ["Bud Stage", "Cap Stage", "Early Bell Stage", "Advanced Bell Stage"],
    correct: 3,
    explain: "Amelogenesis begins at the advanced bell stage, following the differentiation of odontoblasts and the start of dentinogenesis."
  },
  {
    q: "Before ameloblasts differentiate, they are known as:",
    opts: [
      "Outer Enamel Epithelium (OEE) cells.",
      "Inner Enamel Epithelium (IEE) cells.",
      "Stellate Reticulum cells.",
      "Dental Papilla cells."
    ],
    correct: 1,
    explain: "The cells of the Inner Enamel Epithelium (IEE) are the precursors that differentiate into ameloblasts."
  },
  {
    q: "What structure must disintegrate before amelogenesis can begin?",
    opts: [
      "The dental lamina.",
      "The stratum intermedium.",
      "The basement membrane between IEE and odontoblasts.",
      "The stellate reticulum."
    ],
    correct: 2,
    explain: "The basement membrane separating the enamel organ from the dental papilla breaks down, allowing direct contact between the newly formed dentin and the pre-ameloblasts."
  },
  {
    q: "The proximal end of the ameloblast is oriented towards the:",
    opts: [
      "Dental papilla",
      "Dentin-enamel junction",
      "Stratum intermedium",
      "Oral cavity"
    ],
    correct: 2,
    explain: "The proximal end is the base of the cell, which faces its nutrient source, the stratum intermedium. The distal end faces the forming enamel."
  }
];

const tfs = [
  {
    q: "Amelogenesis begins before dentinogenesis is initiated.",
    answer: false,
    explain: "Dentinogenesis must begin first; the presence of the initial dentin layer is the trigger for ameloblasts to start secreting enamel."
  },
  {
    q: "Ameloblasts are derived from the Inner Enamel Epithelium (IEE).",
    answer: true,
    explain: "The cells of the IEE differentiate to become pre-ameloblasts and then mature, secretory ameloblasts."
  },
  {
    q: "The first layer of enamel formed is rich in well-defined enamel rods.",
    answer: false,
    explain: "The initial layer of enamel is prismless (rodless) because it is secreted before the Tomes' processes are fully formed."
  },
  {
    q: "Tomes' processes are present on the ameloblast throughout the entire secretory stage.",
    answer: false,
    explain: "Tomes' processes develop after the initial rodless enamel is formed and are lost just before the final rodless layer is secreted."
  },
  {
    q: "A single ameloblast is solely responsible for forming one complete enamel rod.",
    answer: false,
    explain: "While one ameloblast forms the rod head, portions of three other ameloblasts contribute to the tail, making it a collaborative effort of four cells."
  },
  {
    q: "The total population of ameloblasts significantly increases during the transitional stage.",
    answer: false,
    explain: "The population decreases by up to 50% through programmed cell death (apoptosis) during the transitional stage."
  },
  {
    q: "Smooth-ended ameloblasts are primarily responsible for pumping minerals into the enamel matrix.",
    answer: false,
    explain: "Ruffled-ended ameloblasts pump minerals in, while smooth-ended ameloblasts allow water and protein fragments to exit."
  },
  {
    q: "The reduced enamel epithelium forms a protective covering over the enamel until the tooth erupts.",
    answer: true,
    explain: "This layer, formed in the protective stage, shields the fully formed enamel surface prior to and during tooth eruption."
  },
  {
    q: "Amelogenesis Imperfecta is a dental condition caused by poor oral hygiene.",
    answer: false,
    explain: "It is a group of genetic conditions that affect the structure and clinical appearance of enamel due to mutations in genes involved in amelogenesis."
  }
];

const saqs = [
  {
    q: "Describe the key cellular changes that Inner Enamel Epithelium (IEE) cells undergo during the differentiation phase to become ameloblasts.",
    a: "During the differentiation phase, the cuboidal IEE cells elongate to become tall columnar cells. The nucleus shifts proximally (towards the stratum intermedium), and the cell becomes polarized. Protein-synthesizing organelles, such as the Golgi complex and rough endoplasmic reticulum, increase in volume and migrate to the distal end of the cell in preparation for secreting enamel matrix."
  },
  {
    q: "List the five stages in the life cycle of an ameloblast.",
    a: `
      <ol>
        <li>Presecretory stage (containing the Morphogenetic and Differentiation phases)</li>
        <li>Secretory (Formative) stage</li>
        <li>Transitional phase</li>
        <li>Maturation stage</li>
        <li>Protective stage</li>
      </ol>
    `
  },
  {
    q: "Compare and contrast the structure and primary function of ruffled-ended and smooth-ended ameloblasts in a numbered table.",
    a: `
      <table>
        <thead>
          <tr>
            <th>Feature</th>
            <th>Ruffled-ended Ameloblast</th>
            <th>Smooth-ended Ameloblast</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><b>Structure</b></td>
            <td>Has numerous microvilli at its distal end, forming a ruffled border. Has tight distal junctions.</td>
            <td>Has a straight or even distal end with no microvilli. Has leaky distal junctions.</td>
          </tr>
          <tr>
            <td><b>Primary Function</b></td>
            <td>To pump large quantities of calcium and phosphate ions <b>into</b> the enamel matrix for mineralization.</td>
            <td>To allow the removal of water and degraded protein fragments <b>out of</b> the enamel matrix.</td>
          </tr>
           <tr>
            <td><b>Prevalence</b></td>
            <td>Spends ~80% of the maturation cycle in this form.</td>
            <td>Spends ~20% of the maturation cycle in this form.</td>
          </tr>
        </tbody>
      </table>
    `
  },
  {
    q: "What is the Tomes' process, and what is its primary function in enamel formation?",
    a: "The Tomes' process is a specialized conical or shovel-shaped projection that develops at the distal end of an ameloblast during the secretory stage. Its primary function is to secrete the enamel matrix in a structured way, forming both the enamel rods and the surrounding inter-rod enamel. This organized secretion creates the distinct, highly organized prismatic structure of mature enamel."
  },
  {
    q: "A 10-year-old patient presents with teeth that are discolored (yellowish-brown), sensitive, and show signs of rapid wear. The enamel appears thin and chips away easily. Based on the lecture, what is the most likely diagnosis for this genetic condition, and what fundamental process of enamel formation has been disrupted?",
    a: "The most likely diagnosis is <b>Amelogenesis Imperfecta (AI)</b>. This condition is caused by a genetic defect that disrupts amelogenesis. Specifically, the clinical signs of thin, soft, and easily fractured enamel point to a failure in the <b>maturation stage</b>, resulting in hypo-mineralized enamel that lacks the necessary hardness and structural integrity."
  },
  {
    q: "What are the two main stages of amelogenesis, and briefly, what happens during each?",
    a: `
      <ol>
        <li><b>Secretion (or Formative Stage):</b> Ameloblasts deposit the organic enamel matrix, which is composed primarily of proteins (like amelogenin) and water. This stage establishes the full thickness and morphology of the enamel.</li>
        <li><b>Maturation:</b> The organic matrix and water are selectively removed, and a massive influx of minerals (calcium and phosphate) occurs. This process hardens the enamel, transforming it from a soft, protein-rich matrix into the hardest substance in the human body.</li>
      </ol>
    `
  }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
