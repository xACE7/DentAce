<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 17</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (filled from Lecture 17: Amelogenesis) -----------
const mcqs = [
  {
    q:"Amelogenesis begins immediately after which event in tooth development?",
    opts:["Cementogenesis during root formation","Disintegration of the stellate reticulum","Initial dentin deposition by odontoblasts","Fusion of reduced enamel epithelium with oral epithelium"],
    correct:2,
    explain:"Amelogenesis starts shortly after dentinogenesis at the advanced bell stage once the basement membrane breaks down."
  },
  {
    q:"Which cells are directly responsible for enamel matrix secretion?",
    opts:["Odontoblasts","Ameloblasts","Stratum intermedium cells","Outer enamel epithelium"],
    correct:1,
    explain:"Ameloblasts secrete the enamel (organic) matrix before its mineralization."
  },
  {
    q:"During the morphogenetic phase, which feature is established?",
    opts:["Presence of Tomes' processes","Crown shape","Ruffled-ended borders","Reduced enamel epithelium"],
    correct:1,
    explain:"The morphogenic phase determines the final shape of the crown before active secretion begins."
  },
  {
    q:"Inner enamel epithelium first differentiates into pre‚Äëameloblasts that induce which adjacent cells?",
    opts:["Cementoblasts in dental sac","Odontoblasts in dental papilla","Hertwig‚Äôs sheath cells","Stellate reticulum cells"],
    correct:1,
    explain:"Pre‚Äëameloblasts induce dental papilla cells to differentiate into odontoblasts which begin dentin formation."
  },
  {
    q:"Which statement best describes nuclear migration during ameloblast differentiation?",
    opts:["Nuclei shift distally toward the forming enamel","Nuclei remain central throughout","Nuclei shift proximally toward the stratum intermedium","Nuclei move apically toward the basement membrane"],
    correct:2,
    explain:"As IEE cells differentiate, nuclei move proximally (toward the stratum intermedium) while protein‚Äësynthesizing organelles concentrate distally."
  },
  {
    q:"Enamel matrix formation begins against newly formed dentin and initially produces enamel that is:",
    opts:["Highly roded with distinct prisms","Rodless (prism‚Äëfree)","Hypermineralized with no proteins","Interglobular"],
    correct:1,
    explain:"The first enamel formed is aprismatic; Tomes‚Äô processes appear only after this initial layer."
  },
  {
    q:"Tomes‚Äô processes appear when ameloblasts:",
    opts:["First contact the basement membrane","Migrate away from dentin after the first enamel layer","Enter the protective stage","Undergo apoptosis in transition"],
    correct:1,
    explain:"After the initial rodless enamel forms, ameloblasts retreat and develop Tomes‚Äô processes that drive rod/interrod architecture."
  },
  {
    q:"Which pairing is TRUE about enamel microstructure origin?",
    opts:["Rods‚Äîouter enamel epithelium; Interrod‚Äîameloblasts","Rods‚ÄîTomes‚Äô processes; Interrod‚ÄîTomes‚Äô processes","Rods‚Äîodontoblast processes; Interrod‚Äîameloblasts","Rods‚Äîamelogenin; Interrod‚Äîameloblastin"],
    correct:1,
    explain:"Both rods and interrod enamel arise from Tomes‚Äô process domains of secretory ameloblasts."
  },
  {
    q:"Contribution to one enamel rod comes from how many ameloblasts?",
    opts:["1","2","3","4"],
    correct:3,
    explain:"Classically: the rod head by one ameloblast and the tail by contributions of three others (total four)."
  },
  {
    q:"Loss of Tomes‚Äô processes at the end of the secretory stage results in the final enamel layers being:",
    opts:["Hypomineralized","Rich in enamel tufts","Rodless (prismless)","Cross‚Äëstriated"],
    correct:2,
    explain:"When Tomes‚Äô processes disappear, the last secreted enamel lacks prism structure."
  },
  {
    q:"Which change characterizes the transitional stage of ameloblasts?",
    opts:["Cell height increases; abundant RER","Marked reduction of protein‚Äësynthesizing organelles","Development of ruffled borders","Fusion into reduced enamel epithelium"],
    correct:1,
    explain:"Transition: cells shorten; secretory organelles decrease; numerous lysosomes/autophagic vacuoles appear."
  },
  {
    q:"Approximate proportion of ameloblasts lost by apoptosis by the end of transition is:",
    opts:["~10%","~25%","~50%","~75%"],
    correct:2,
    explain:"About half of the ameloblast population is lost during the transitional stage."
  },
  {
    q:"During maturation, ameloblasts modulate between two forms primarily to:",
    opts:["Switch between secreting enamelin and amelogenin","Alternate between ion transport and protein/water removal","Toggle mitosis and meiosis","Control dentin apposition"],
    correct:1,
    explain:"Ruffled‚Äëended cells favor mineral influx; smooth‚Äëended favor removal of proteins and water."
  },
  {
    q:"Ruffled‚Äëended ameloblasts are responsible mainly for:",
    opts:["Protein degradation","Inorganic ion transport into enamel","Basement membrane synthesis","Hemidesmosome formation"],
    correct:1,
    explain:"They spend ~80% of time in ruffled state to drive Ca2+/PO4\u2074‚àí influx and maturation."
  },
  {
    q:"Smooth‚Äëended ameloblasts primarily facilitate:",
    opts:["Matrix secretion","Water and protein fragment exit","Matrix vesicle release","Hunter‚ÄëSchreger band formation"],
    correct:1,
    explain:"Smooth‚Äëended cells open pathways for removal of amelogenin fragments and water."
  },
  {
    q:"Which sequence best matches the life cycle of ameloblasts?",
    opts:["Protective ‚Üí Secretory ‚Üí Maturation ‚Üí Transition ‚Üí Presecretory","Presecretory ‚Üí Secretory ‚Üí Transition ‚Üí Maturation ‚Üí Protective","Secretory ‚Üí Presecretory ‚Üí Maturation ‚Üí Protective ‚Üí Transition","Presecretory ‚Üí Transition ‚Üí Secretory ‚Üí Maturation ‚Üí Protective"],
    correct:1,
    explain:"Standard sequence: presecretory (morphogenetic + differentiation), secretory, transitional, maturation, protective."
  },
  {
    q:"In the morphogenetic phase, IEE cells are typically:",
    opts:["Tall columnar with apical nuclei","Cuboidal/low columnar with central nuclei","Squamous with basophilic cytoplasm","Spindle‚Äëshaped with peripheral chromatin"],
    correct:1,
    explain:"They are cuboidal/low‚Äëcolumnar; nuclei centrally located; Golgi is poorly developed proximally."
  },
  {
    q:"During the differentiation phase of presecretory ameloblasts:",
    opts:["Cells retain mitotic activity","Organelles concentrating distally include RER, Golgi, mitochondria","Nuclei migrate toward the dentin surface","Basement membrane is re‚Äëestablished"],
    correct:1,
    explain:"As cells differentiate, protein‚Äësynthesizing organelles concentrate at distal ends; cells stop dividing."
  },
  {
    q:"The protective stage produces which structure covering fully formed enamel pre‚Äëeruption?",
    opts:["Reduced enamel epithelium","Nasmyth‚Äôs membrane","Cuticle of the hair","Mantle dentin"],
    correct:0,
    explain:"Ameloblasts dedifferentiate into cuboidal cells that, with other enamel organ remnants, form the reduced enamel epithelium."
  },
  {
    q:"Which statement about enamel proteins during maturation is MOST accurate?",
    opts:["Amelogenin content increases steadily","Amelogenin is selectively removed as mineral content rises","Enamelin is entirely absent in mature enamel","Proteins are replaced by collagen"],
    correct:1,
    explain:"Maturation involves proteolysis and loss of amelogenin with a dramatic mineral influx."
  },
  {
    q:"Tomes‚Äô process gives enamel which surface appearance during formation?",
    opts:["Picket‚Äëfence interdigitation","Smooth glassy surface","Lamellar stratification only","Globular calcification front"],
    correct:0,
    explain:"Interdigitation of Tomes‚Äô processes with forming enamel creates a picket‚Äëfence‚Äëlike surface."
  },
  {
    q:"Which is TRUE regarding initial enamel and rod formation?",
    opts:["Initial enamel contains well‚Äëformed rods","Rods appear only after Tomes‚Äô processes develop","Interrod forms before dentin","Rodless enamel never occurs"],
    correct:1,
    explain:"Rods require Tomes‚Äô processes; the first layer formed against dentin is rodless."
  },
  {
    q:"Select the BEST description of the stratum intermedium during secretion:",
    opts:["Inert layer with no role","Metabolically supportive layer aiding ameloblast function","Source of odontoblasts","Future junctional epithelium"],
    correct:1,
    explain:"Stratum intermedium supports enamel secretion metabolically (e.g., alkaline phosphatase)."
  },
  {
    q:"The basement membrane between IEE and odontoblasts is:",
    opts:["Thickened during secretion","Maintained through eruption","Disintegrated before amelogenesis begins","Replaced by dentinal tubules"],
    correct:2,
    explain:"It breaks down after dentinogenesis and prior to enamel secretion."
  },
  {
    q:"Which event signals the end of the secretory stage?",
    opts:["Appearance of ruffled borders","Completion of rod/interrod patterning with loss of Tomes‚Äô processes","Re‚Äëemergence of basement membrane","Formation of Hertwig‚Äôs sheath"],
    correct:1,
    explain:"When Tomes‚Äô processes are lost, secretion winds down and prismless enamel caps the surface."
  },
  {
    q:"Which statement about ameloblast mitotic activity is correct?",
    opts:["They continue dividing throughout secretion","They divide only during maturation","They stop dividing after differentiation","They resume mitosis in the protective stage"],
    correct:2,
    explain:"Once differentiated, ameloblasts are post‚Äëmitotic."
  },
  {
    q:"What primary functional difference separates ruffled‚Äëended from smooth‚Äëended ameloblasts?",
    opts:["Presence of Tomes‚Äô processes","Direction of calcium movement","Degree of junctional tightness","Nuclear ploidy"],
    correct:1,
    explain:"Ruffled‚Äëended cells promote Ca/PO4 influx; smooth‚Äëended favor efflux of water/proteins."
  },
  {
    q:"Which developmental stage immediately precedes amelogenesis?",
    opts:["Bud","Cap","Early bell","Advanced bell"],
    correct:3,
    explain:"Amelogenesis begins at the advanced bell stage after dentinogenesis initiates."
  },
  {
    q:"A defect characterized by hypomineralized enamel due to genetic causes is:",
    opts:["Dentinogenesis imperfecta","Amelogenesis imperfecta","Fluorosis","Enamel hypoplasia from trauma"],
    correct:1,
    explain:"AI comprises inherited conditions affecting enamel structure and appearance, often causing hypomineralization."
  },
  {
    q:"Which ultrastructural organelle profile typifies presecretory ameloblasts?",
    opts:["Sparse Golgi proximally, organelles scattered","Massive lysosomal system distally","Abundant Weibel‚ÄìPalade bodies","Dominant smooth ER for lipid secretion"],
    correct:0,
    explain:"In the morphogenetic phase, Golgi is poorly developed proximally and mitochondria are scattered."
  },
  {
    q:"When do ameloblasts enter the secretory (formative) stage?",
    opts:["Before any dentin is formed","After the first layer of dentin is laid down","After eruption","Only during root formation"],
    correct:1,
    explain:"Secretory activity starts after odontoblasts produce the initial dentin layer."
  }
];

const tfs = [
  { q:"The first enamel deposited against dentin contains well‚Äëdefined enamel rods.", answer:false, explain:"Initial enamel is rodless; rods require Tomes‚Äô processes." },
  { q:"Pre‚Äëameloblasts induce dental papilla cells to become odontoblasts.", answer:true, explain:"Inductive interaction leads to odontoblast differentiation." },
  { q:"Ameloblasts resume mitosis during the maturation stage.", answer:false, explain:"Ameloblasts are post‚Äëmitotic after differentiation." },
  { q:"Tomes‚Äô processes are conical projections at the distal ends of secretory ameloblasts.", answer:true, explain:"They shape rod/interrod enamel." },
  { q:"During transition, ameloblasts increase in height and develop more RER.", answer:false, explain:"They shorten and secretory organelles are reduced." },
  { q:"Approximately half of ameloblasts undergo apoptosis by the end of transition.", answer:true, explain:"~50% reduction is typical." },
  { q:"Ruffled‚Äëended ameloblasts facilitate protein and water removal.", answer:false, explain:"That role is mainly for smooth‚Äëended cells." },
  { q:"Maturation involves massive influx of Ca2+ and phosphate with loss of amelogenin.", answer:true, explain:"Mineral content rises while proteins are degraded/removed." },
  { q:"The reduced enamel epithelium covers enamel until eruption.", answer:true, explain:"Formed in the protective stage and persists pre‚Äëeruption." },
  { q:"Enamel formation begins at the bud stage of tooth development.", answer:false, explain:"It begins at the advanced bell stage after dentinogenesis starts." },
  { q:"Both rods and interrod enamel derive from Tomes‚Äô process domains of ameloblasts.", answer:true, explain:"Yes‚Äîdifferent regions of the same process." },
  { q:"Loss of Tomes‚Äô processes results in hypermineralized enamel tufts at the surface.", answer:false, explain:"Loss leads to prismless (rodless) surface enamel." }
];

const saqs = [
  { 
    q: "A 9‚Äëyear‚Äëold‚Äôs maxillary incisor shows chalky, easily abraded enamel despite normal dentin on radiograph. Identify the most likely condition and the stage of ameloblast activity whose dysfunction explains it.", 
    a: "Amelogenesis imperfecta (hypomineralization type); dysfunction in maturation stage (impaired mineral influx/protein removal)." 
  },
  { 
    q: "List the life‚Äëcycle stages of ameloblasts in order.", 
    a: "1) Presecretory (morphogenetic ‚Üí differentiation); 2) Secretory; 3) Transitional; 4) Maturation; 5) Protective." 
  },
  { 
    q: "Contrast ruffled‚Äëended vs smooth‚Äëended ameloblasts during maturation.", 
    a: `<table style="width:100%;border-collapse:separate;border-spacing:0 6px;">
          <tr><th style="text-align:left;">#</th><th style="text-align:left;">Ruffled‚Äëended</th><th style="text-align:left;">Smooth‚Äëended</th></tr>
          <tr><td>1</td><td>Ion influx (Ca2+/PO4\u2074‚àí) predominates</td><td>Protein fragments & water exit</td></tr>
          <tr><td>2</td><td>Occupies ~80% of modulation time</td><td>Occupies ~20% of time</td></tr>
          <tr><td>3</td><td>Distal border with numerous microvilli</td><td>Distal border appears even/straight</td></tr>
        </table>` 
  }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
