<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam ‚Ä¢ Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">ü¶∑ Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 17</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">ÿßŸÑŸÑŸëŸéŸáŸèŸÖŸëŸé ŸÑÿß ÿ≥ŸéŸáŸíŸÑŸé ÿ•ŸêŸÑŸëŸéÿß ŸÖŸéÿß ÿ¨ŸéÿπŸéŸÑŸíÿ™ŸéŸáŸè ÿ≥ŸéŸáŸíŸÑŸãÿßÿå ŸàŸéÿ£ŸéŸÜŸíÿ™Ÿé ÿ™Ÿéÿ¨ŸíÿπŸéŸÑŸè ÿßŸÑÿ≠Ÿéÿ≤ŸíŸÜŸé ÿ•Ÿêÿ∞Ÿéÿß ÿ¥Ÿêÿ¶Ÿíÿ™Ÿé ÿ≥ŸéŸáŸíŸÑŸãÿß</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (from slides: Amelogenesis) -----------
const mcqs = [
  { q:"Amelogenesis begins shortly after which process?", opts:["Dentinogenesis","Cementogenesis","Eruption","Root resorption"], correct:0, explain:"Begins shortly after dentinogenesis at advanced bell stage." },
  { q:"At which tooth development stage does amelogenesis start?", opts:["Advanced bell stage","Bud stage","Cap stage","Early bell stage"], correct:0, explain:"Commences at the advanced bell stage." },
  { q:"Which cells are responsible for amelogenesis?", opts:["Ameloblasts","Odontoblasts","Cementoblasts","Osteoclasts"], correct:0, explain:"Ameloblasts secrete enamel matrix and regulate maturation." },
  { q:"What happens to the basement membrane between IEE and odontoblasts before amelogenesis?", opts:["Disintegrates","Thickens","Calcifies","Becomes fenestrated"], correct:0, explain:"It disintegrates after dentinogenesis and before amelogenesis." },
  { q:"Correct order of tooth development is:", opts:["Bud ‚Üí Cap ‚Üí Early bell ‚Üí Advanced bell","Cap ‚Üí Bud ‚Üí Advanced bell ‚Üí Early bell","Bud ‚Üí Early bell ‚Üí Cap ‚Üí Advanced bell","Advanced bell ‚Üí Early bell ‚Üí Cap ‚Üí Bud"], correct:0, explain:"Slides list Bud, Cap, Early Bell, Advanced Bell." },
  { q:"Major stages of amelogenesis are best described as:", opts:["Enamel matrix secretion then mineralization/maturation","Cementum deposition then mineralization","Dentin deposition then enamel resorption","Mineralization only"], correct:0, explain:"Two stages: matrix deposition and mineralization (maturation)." },
  { q:"In the morphogenic phase of presecretory stage, which event occurs?", opts:["Crown shape is determined","Tomes' process forms","Rods become rodless","Ameloblast apoptosis peaks"], correct:0, explain:"Morphogenic phase determines crown shape." },
  { q:"During differentiation phase, nuclei of IEE cells shift toward:", opts:["Stratum intermedium (proximally)","Dentin surface (distally)","Stellate reticulum","Cervical loop"], correct:0, explain:"Nuclei move proximally toward stratum intermedium as cells elongate." },
  { q:"A hallmark of differentiation phase is increased:", opts:["Protein-synthesizing organelles","Lipid droplets","Lysosomal activity","Microtubule loss"], correct:0, explain:"Golgi, RER and mitochondria increase at distal end." },
  { q:"The secretory stage begins after formation of:", opts:["First layer of dentin","Reduced enamel epithelium","Hertwig's root sheath","Secondary cementum"], correct:0, explain:"Ameloblasts enter secretory stage after first dentin is formed." },
  { q:"The initial enamel layer formed against dentin is:", opts:["Rodless/prismless","Highly pigmented","Fluoride-rich striae","Enamel spindle"], correct:0, explain:"Initial layer lacks rods." },
  { q:"Tomes‚Äô processes develop when ameloblasts:", opts:["Migrate away from dentin surface","Undergo apoptosis","Form reduced enamel epithelium","Begin morphogenesis"], correct:0, explain:"After first enamel layer, ameloblasts move away and develop Tomes‚Äô process." },
  { q:"Tomes‚Äô process gives forming enamel a characteristic:", opts:["Picket fence appearance","Glass-like smoothness","Checkerboard pattern","Lamellar cracks"], correct:0, explain:"Interdigitation yields picket fence appearance." },
  { q:"Which statement about rod formation is correct?", opts:["Head is formed by 1 ameloblast; tail by 3","Both head and tail by 2","Tail by 1; head by 3","Each rod made by a single cell entirely"], correct:0, explain:"One ameloblast forms rod head; three contribute to tail (total 4)." },
  { q:"The last formed surface layers of enamel at end of secretion are:", opts:["Rodless/prismless","Hyperpigmented","Cross-banded","Perikymata only"], correct:0, explain:"When Tomes' process is lost, final layers are rodless." },
  { q:"During transitional stage, ameloblast height and organelles:", opts:["Decrease with many lysosomes appearing","Increase with new Tomes‚Äô processes","Remain unchanged","Disappear entirely immediately"], correct:0, explain:"Height decreases; protein-synthesizing organelles reduced; many lysosomes noted." },
  { q:"By the end of transitional stage, ameloblast population is reduced approximately:", opts:["50%","10%","80%","5%"], correct:0, explain:"Slides estimate ~50% reduction due to apoptosis." },
  { q:"Primary events in maturation stage include:", opts:["Massive influx of Ca2+ and PO4 and selective loss of proteins/water","New dentin formation by ameloblasts","Formation of Tomes‚Äô processes","Thickening of basement membrane"], correct:0, explain:"Maturation adds mineral and removes amelogenin and water." },
  { q:"Ameloblasts modulate between two phenotypes during maturation:", opts:["Ruffled-ended and smooth-ended","Cuboidal and squamous","Ciliated and non-ciliated","Keratinized and non-keratinized"], correct:0, explain:"They alternate borders during maturation." },
  { q:"Time spent as ruffled-ended vs smooth-ended ameloblasts is about:", opts:["80% ruffled, 20% smooth","50% each","20% ruffled, 80% smooth","100% ruffled"], correct:0, explain:"Cell spends ~80% ruffled, ~20% smooth." },
  { q:"Function mainly associated with ruffled-ended ameloblasts:", opts:["Incorporation of inorganic material","Exit of protein fragments","Secretion of dentin matrix","Formation of enamel lamellae"], correct:0, explain:"Ruffled-ended correlate with mineral influx." },
  { q:"Function mainly associated with smooth-ended ameloblasts:", opts:["Exit of protein fragments and water","Hydroxyapatite crystal growth only","Odontoblast induction","Formation of rod head"], correct:0, explain:"Smooth-ended relate to resorption/transport out." },
  { q:"After enamel is fully matured, ameloblasts and remnants form:", opts:["Reduced enamel epithelium","Dental follicle","Nasmyth's membrane only","Hertwig‚Äôs root sheath"], correct:0, explain:"Protective stage forms reduced enamel epithelium covering enamel until eruption." },
  { q:"Which component is selectively lost during enamel maturation?", opts:["Amelogenin","Type I collagen","Elastin","Keratin"], correct:0, explain:"Slides note loss of enamel proteins, mainly amelogenin, and water." },
  { q:"Which sequence best summarizes enamel mineralization increments?", opts:["Initial enamel ‚Üí calcification ‚Üí further increments formed","Matrix resorption ‚Üí rod fusion ‚Üí prism loss","Cap to bud transition ‚Üí calcification ‚Üí eruption","Secondary dentin ‚Üí enamel spindles ‚Üí maturation"], correct:0, explain:"Summary figure shows progressive calcification as more increments form." },
  { q:"Clinical feature most associated with amelogenesis imperfecta (AI):", opts:["Hypomineralized enamel with discoloration","Bulbous dentin and pulp stones","Cementum aplasia","Accessory roots"], correct:0, explain:"AI affects enamel structure/appearance; severe cases hypomineralized and discolored." },
  { q:"During morphogenic phase, IEE cells are typically:", opts:["Cuboidal/low columnar with central nuclei","Tall columnar with distal nuclei","Flattened squamous","Pyramidal with apical cilia"], correct:0, explain:"They are cuboidal or low columnar with centrally placed nuclei; organelles proximal." },
  { q:"Which statement about cell division during differentiation phase is true?", opts:["Cells can no longer divide","Cells enter rapid mitosis","Only tail-forming cells divide","Division resumes after maturation"], correct:0, explain:"Ameloblasts lose mitotic ability once differentiated." },
  { q:"Rods and interrods are formed from:", opts:["Tomes‚Äô processes of ameloblasts","Odontoblastic processes","Hertwig‚Äôs root sheath","Reduced enamel epithelium"], correct:0, explain:"Both derive from Tomes‚Äô process secretion." },
  { q:"The structural unit each ameloblast definitively forms is:", opts:["Rod head","Rod tail","Entire rod","Interrod only"], correct:0, explain:"Head formed by single ameloblast; tail involves contributions of three others." }
];

const tfs = [
  { q:"Amelogenesis is the process of enamel formation.", answer:true, explain:"Definition provided on slides." },
  { q:"The basement membrane between IEE and odontoblasts thickens during amelogenesis.", answer:false, explain:"It disintegrates before amelogenesis begins." },
  { q:"Initial enamel formed against dentin lacks enamel rods.", answer:true, explain:"First layer is rodless/prismless." },
  { q:"Tomes‚Äô processes are present throughout maturation stage.", answer:false, explain:"They are characteristic of secretory stage and are lost at its end." },
  { q:"During transition, many lysosomes and autophagic vacuoles appear.", answer:true, explain:"Slides explicitly note this." },
  { q:"Ruffled-ended ameloblasts are mainly associated with removal of protein fragments.", answer:false, explain:"That is mainly smooth-ended; ruffled-ended incorporate mineral." },
  { q:"Reduced enamel epithelium remains on enamel surface until eruption.", answer:true, explain:"Protective stage description." },
  { q:"Amelogenesis imperfecta primarily affects dentin structure.", answer:false, explain:"AI affects enamel structure and appearance." },
  { q:"During differentiation, ameloblast nuclei shift proximally toward the stratum intermedium.", answer:true, explain:"Key microscopic feature." }
];

const saqs = [
  // 1 Direct answer
  { q: "Define amelogenesis.", a: "Process of enamel formation by ameloblasts." },
  // 2 List/enumeration (3 or more)
  { q: "List the stages of tooth development in order.", a: "1) Bud  2) Cap  3) Early bell  4) Advanced bell" },
  // 3 Comparison (numbered table)
  { q: "Compare ruffled-ended vs smooth-ended ameloblasts during maturation.", a: `<table style='width:100%;border-collapse:collapse'>
      <tr><th style='text-align:left;border-bottom:1px solid rgba(255,255,255,0.2)'>#</th><th style='text-align:left;border-bottom:1px solid rgba(255,255,255,0.2)'>Ruffled-ended</th><th style='text-align:left;border-bottom:1px solid rgba(255,255,255,0.2)'>Smooth-ended</th></tr>
      <tr><td>1.</td><td>~80% of time</td><td>~20% of time</td></tr>
      <tr><td>2.</td><td>Incorporate Ca/PO4 (mineral influx)</td><td>Exit protein fragments & water</td></tr>
      <tr><td>3.</td><td>Ruffled distal border with microvilli</td><td>Straight (even) distal ends</td></tr>
    </table>` },
  // 4 Case-based scenario
  { q: "A child presents with generalized enamel discoloration and easily worn surfaces; radiographs suggest hypo-mineralized enamel. What condition is most likely?", a: "Amelogenesis imperfecta." },
  // 5 Direct/detail
  { q: "State what happens to the basement membrane between IEE and odontoblasts before amelogenesis.", a: "It disintegrates after dentinogenesis and before amelogenesis." },
  // 6 List/enumeration
  { q: "Enumerate the functional stages of ameloblast life cycle.", a: "1) Presecretory (morphogenic & differentiation)  2) Secretory  3) Transitional  4) Maturation  5) Protective" }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
 tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ‚úñ</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ‚úî</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "‚úì Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
