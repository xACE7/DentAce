<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer ol, .answer ul { padding-left: 20px; margin: 5px 0; }
  .answer table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  .answer th, .answer td { border: 1px solid var(--card-border); padding: 8px; text-align: left; }
  .answer th { background-color: var(--glass); }
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 21</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "What is the primary characteristic of cementum as a tissue?",
        opts: ["Vascular mineralized tissue", "Avascular mineralized connective tissue", "Vascular soft connective tissue", "Avascular non-mineralized tissue"],
        correct: 1,
        explain: "Cementum is defined as an avascular mineralized connective tissue covering the anatomic roots of human teeth."
    },
    {
        q: "Where is cementum typically the thinnest?",
        opts: ["At the root apex", "At the mid-root level", "At the cementoenamel junction (CEJ)", "In the furcation area"],
        correct: 2,
        explain: "Cementum thickness is thinnest at the CEJ (20 to 50 μm) and increases towards the apex."
    },
    {
        q: "What is the chemical composition of cementum in fully formed permanent teeth?",
        opts: ["96% inorganic, 4% organic", "70% inorganic, 30% organic", "45-50% inorganic, 50-55% organic", "20% inorganic, 80% organic"],
        correct: 2,
        explain: "Cementum contains 45-50% inorganic substances and 50-55% organic material and water."
    },
    {
        q: "The main inorganic component of cementum is in the form of:",
        opts: ["Calcium Fluoride", "Hydroxyapatite", "Collagen Type II", "Osteopontin"],
        correct: 1,
        explain: "The inorganic portion of cementum is primarily calcium and phosphate in the form of hydroxyapatite."
    },
    {
        q: "Which cells are responsible for synthesizing the organic matrix of cementum?",
        opts: ["Odontoblasts", "Osteoblasts", "Fibroblasts", "Cementoblasts"],
        correct: 3,
        explain: "Cementoblasts synthesize collagen and protein polysaccharides, which make up the organic matrix."
    },
    {
        q: "What are cementocytes?",
        opts: ["Precursor cells of cementoblasts", "Cementoblasts that have become entrapped in the matrix", "Cells that resorb cementum", "Epithelial cells from HERS"],
        correct: 1,
        explain: "Cementocytes are cells (formerly cementoblasts) that have been incorporated into cellular cementum, residing in lacunae."
    },
    {
        q: "The cell processes of a cementocyte, known as canaliculi, are mostly directed towards:",
        opts: ["The dentin surface", "The pulp", "The periodontal ligament surface", "Adjacent cementocytes only"],
        correct: 2,
        explain: "Most processes (canaliculi) are directed toward the periodontal surface of the cementum, which is the source of nutrients."
    },
    {
        q: "What are the collagen fibers produced by PDL fibroblasts that get embedded in cementum called?",
        opts: ["Intrinsic fibers", "Extrinsic fibers (Sharpey's fibers)", "Reticular fibers", "Elastic fibers"],
        correct: 1,
        explain: "Extrinsic fibers, produced by PDL fibroblasts, are embedded into cementum and are known as Sharpey's fibers."
    },
    {
        q: "What is the most common relationship between cementum and enamel at the CEJ?",
        opts: ["They meet in a sharp line (butt joint)", "There is a gap between them", "Cementum overlaps the enamel", "Enamel overlaps the cementum"],
        correct: 2,
        explain: "In 60% of teeth, the cementum overlaps the enamel for a short distance."
    },
    {
        q: "A gap between enamel and cementum at the cervical region, exposing dentin, occurs in what percentage of teeth?",
        opts: ["10%", "30%", "60%", "5%"],
        correct: 0,
        explain: "In 10% of teeth, enamel and cementum do not meet, leaving a gap of exposed dentin."
    },
    {
        q: "Which type of cementum is formed first and is therefore called 'primary cementum'?",
        opts: ["Cellular intrinsic fiber cementum (CIFC)", "Acellular afibrillar cementum (AAC)", "Acellular extrinsic fiber cementum (AEFC)", "Cellular mixed stratified cementum (CMSC)"],
        correct: 2,
        explain: "AEFC is the first to be formed and is known as primary cementum. It provides anchorage."
    },
    {
        q: "The 'functional stage' of cementum development begins when:",
        opts: ["The root is half-formed", "The tooth is in occlusion", "The crown is fully calcified", "Hertwig's epithelial root sheath fragments"],
        correct: 1,
        explain: "The functional stage starts when the tooth comes into occlusion and continues throughout life."
    },
    {
        q: "Which mineralized tissue in the human body has the highest fluoride content?",
        opts: ["Enamel", "Dentin", "Bone", "Cementum"],
        correct: 3,
        explain: "Cementum has the highest fluoride content of all the mineralized tissues."
    },
    {
        q: "What do the incremental lines in cementum represent?",
        opts: ["Areas of hyper-mineralization", "Rest periods in cementum formation", "Cracks due to trauma", "Channels for blood vessels"],
        correct: 1,
        explain: "Incremental lines represent 'rest periods' in cementum formation and are more mineralized than adjacent cementum."
    },
    {
        q: "Acellular afibrillar cementum (AAC) is typically found:",
        opts: ["At the root apex", "As a thin layer on the enamel at the cervical margin", "Throughout the root surface", "Only in deciduous teeth"],
        correct: 1,
        explain: "AAC is seen chiefly as coronal cementum, as a thin layer (1 to 15 µm) on the enamel at the cervical margin."
    },
    {
        q: "What are the primary functions of cellular cementum?",
        opts: ["Anchorage only", "Adaptation and repair", "Tooth sensitivity regulation", "Formation of the apical foramen"],
        correct: 1,
        explain: "The main functions of cellular cementum are adaptation (to occlusal changes) and repair of cementum."
    },
    {
        q: "The cementodentinal junction (CDJ) in permanent teeth is typically:",
        opts: ["Scalloped", "Smooth", "Interdigitated", "Indistinct"],
        correct: 1,
        explain: "The CDJ is smooth in permanent teeth, whereas it can be scalloped in deciduous teeth."
    },
    {
        q: "Which noncollagenous protein in cementum is primarily involved in regulating mineralization?",
        opts: ["Bone sialoprotein (BSP)", "Osteopontin", "Cementum derived attachment protein (CAP)", "Type I collagen"],
        correct: 1,
        explain: "Osteopontin is a noncollagenous protein that helps regulate the process of mineralization in cementum."
    },
    {
        q: "Cellular mixed stratified cementum (CMSC) is primarily found in which locations?",
        opts: ["Cervical third only", "Middle third of the root", "Apical third and furcation areas", "Covering the entire root surface"],
        correct: 2,
        explain: "CMSC appears primarily on the apical third of the root and in furcation areas of multi-rooted teeth."
    },
    {
        q: "What is the term for the unmineralized layer of matrix on the cemental surface?",
        opts: ["Predentin", "Cementoid", "Intermediate cementum", "Enameloid"],
        correct: 1,
        explain: "Cementoid is the thin, unmineralized layer of cementum matrix found on the surface, lined by cementoblasts."
    },
    {
        q: "The deposition rate of cellular cementum is _______ compared to acellular cementum.",
        opts: ["slower", "faster", "the same", "highly variable but generally slower"],
        correct: 1,
        explain: "Cellular cementum has a faster deposition rate, which leads to the entrapment of cementoblasts."
    },
    {
        q: "The main function of Acellular Extrinsic Fiber Cementum (AEFC) is:",
        opts: ["Repair", "Adaptation", "Anchorage", "Sealing dentinal tubules"],
        correct: 2,
        explain: "The main function of AEFC is anchorage, especially in single-rooted teeth, by embedding Sharpey's fibers."
    },
    {
        q: "What might happen to cementocytes located in the deeper layers of thick cellular cementum?",
        opts: ["They transform back into cementoblasts", "They become hyperactive", "They may not be vital", "They begin to resorb the matrix"],
        correct: 2,
        explain: "Nourishment occurs by diffusion, so cementocytes in deeper layers may not be vital due to the distance from the blood supply in the PDL."
    },
    {
        q: "Which type of cementum contains cells but lacks extrinsic (Sharpey's) fibers?",
        opts: ["AEFC", "CMSC", "AAC", "CIFC"],
        correct: 3,
        explain: "Cellular intrinsic fiber cementum (CIFC) contains cementocytes but is composed of intrinsic fibers secreted by cementoblasts, not extrinsic fibers from the PDL."
    },
    {
        q: "Hertwig's epithelial root sheath (HERS) is crucial for root development. From where do the cells that form cementum (cementoblasts) originate after HERS fragments?",
        opts: ["Odontoblasts from the pulp", "Ectomesenchymal cells of the dental follicle", "Epithelial rests of Malassez", "Osteoblasts from the alveolar bone"],
        correct: 1,
        explain: "As HERS fragments, ectomesenchymal cells from the dental follicle migrate to the newly formed dentin and differentiate into cementoblasts."
    },
    {
        q: "How are the incremental lines of cellular cementum typically characterized compared to those in acellular cementum?",
        opts: ["Regular and closely placed", "Irregular and wide apart", "Absent", "Less mineralized"],
        correct: 1,
        explain: "Incremental lines in cellular cementum are irregular and placed wide apart due to its faster and less regular formation."
    },
    {
        q: "What is the physical appearance of cementum compared to enamel?",
        opts: ["Darker and more lustrous", "Lighter yellow and lacks luster", "Identical in color and luster", "Grayish and translucent"],
        correct: 1,
        explain: "Cementum is light yellow in color and is distinguished from enamel by its lack of luster."
    },
    {
        q: "The structure known as 'intermediate cementum' is a poorly defined zone found near the:",
        opts: ["Cementoenamel junction (CEJ)", "Cementodentinal junction (CDJ)", "Periodontal ligament", "Apical foramen"],
        correct: 1,
        explain: "Intermediate cementum is a poorly defined zone near the CDJ, thought to be of dentinal origin."
    },
    {
        q: "Sharpey's fibers within acellular cementum are generally:",
        opts: ["Partially mineralized", "Unmineralized", "Well mineralized", "Loosely attached"],
        correct: 2,
        explain: "In acellular cementum, Sharpey's fibres are well mineralized, contributing to strong anchorage."
    },
    {
        q: "Which type of cementum is most responsible for the increase in root thickness at the apex and furcations throughout life?",
        opts: ["Acellular afibrillar cementum", "Acellular extrinsic fiber cementum", "Cellular cementum (CIFC and CMSC)", "Intermediate cementum"],
        correct: 2,
        explain: "Cellular cementum is deposited throughout life in response to functional demands (adaptation), leading to thickening of the root apex and inter-radicular areas."
    }
];

const tfs = [
    {
        q: "Cementum is a highly vascular tissue, similar to bone.",
        answer: false,
        explain: "Cementum is specifically defined as an avascular tissue, meaning it does not have its own blood supply."
    },
    {
        q: "The hardness of cementum is greater than that of dentin.",
        answer: false,
        explain: "The hardness of cementum is less than that of dentin."
    },
    {
        q: "The development and deposition of cementum ceases once a tooth erupts and comes into occlusion.",
        answer: false,
        explain: "The functional stage of cementum development starts at occlusion and continues throughout life."
    },
    {
        q: "Intrinsic fibers of cementum are produced by periodontal ligament fibroblasts.",
        answer: false,
        explain: "Intrinsic fibers are produced by cementoblasts. Extrinsic fibers are produced by PDL fibroblasts."
    },
    {
        q: "Cementum is permeable and can allow the passage of a variety of materials.",
        answer: true,
        explain: "The slides state that cementum is permeable to a variety of materials."
    },
    {
        q: "In approximately 30% of teeth, cementum and enamel meet in a sharp line, forming a 'butt joint'.",
        answer: true,
        explain: "This is one of the three main configurations of the CEJ, occurring in 30% of cases."
    },
    {
        q: "The cementodentinal junction is typically scalloped in permanent teeth to provide stronger attachment.",
        answer: false,
        explain: "The CDJ is smooth in permanent teeth and may be scalloped in deciduous teeth."
    },
    {
        q: "Cellular cementum is also referred to as 'primary cementum' because it contains cells.",
        answer: false,
        explain: "Cellular cementum is 'secondary cementum' because it forms after acellular cementum. Acellular (AEFC) is primary."
    },
    {
        q: "Incremental lines are less mineralized than the adjacent cementum, representing periods of matrix formation.",
        answer: false,
        explain: "Incremental lines represent 'rest periods' and are more mineralized than the adjacent cementum."
    }
];

const saqs = [
    {
        q: "Describe the chemical composition of cementum in a fully formed permanent tooth.",
        a: "Cementum consists of approximately 45-50% inorganic substances and 50-55% organic material and water. The main inorganic component is hydroxyapatite, and the primary organic component is Type I collagen along with noncollagenous proteins."
    },
    {
        q: "List the three main configurations of the Cemento-Enamel Junction (CEJ) and their approximate prevalence.",
        a: `
            <ol>
                <li><b>Cementum overlaps enamel:</b> This is the most common relationship, occurring in about 60% of teeth.</li>
                <li><b>Butt joint:</b> Cementum meets the enamel in a sharp line. This occurs in about 30% of teeth.</li>
                <li><b>Gap:</b> Cementum and enamel do not meet, leaving dentin exposed. This occurs in about 10% of teeth.</li>
            </ol>
        `
    },
    {
        q: "Present a comparison of at least three key differences between acellular and cellular cementum.",
        a: `
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Acellular Cementum</th>
                        <th>Cellular Cementum</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><b>Formation Time</b></td>
                        <td>First formed (Primary)</td>
                        <td>Formed later (Secondary)</td>
                    </tr>
                    <tr>
                        <td><b>Deposition Rate</b></td>
                        <td>Slower</td>
                        <td>Faster</td>
                    </tr>
                    <tr>
                        <td><b>Cell Presence</b></td>
                        <td>No embedded cementocytes</td>
                        <td>Contains embedded cementocytes</td>
                    </tr>
                    <tr>
                        <td><b>Location</b></td>
                        <td>Mainly cervical third</td>
                        <td>Mainly apical third and furcations</td>
                    </tr>
                </tbody>
            </table>
        `
    },
    {
        q: "What are the two main types of cells associated with cementum, and what is the primary role of each?",
        a: `
            <ol>
                <li><b>Cementoblasts:</b> These are the cells that form cementum. They are located on the surface of the cementum and synthesize the organic matrix (collagen and proteins).</li>
                <li><b>Cementocytes:</b> These are former cementoblasts that have become entrapped within the cementum matrix they secreted. They reside in spaces called lacunae and are involved in maintaining the vitality of the tissue.</li>
            </ol>
        `
    },
    {
        q: "A radiograph of an older patient shows a marked increase in the thickness of mineralized tissue at the root apex. What specific type of cementum is likely responsible for this, and what is its primary function in this context?",
        a: "The tissue is likely <b>Cellular Cementum</b> (specifically Cellular Mixed Stratified Cementum - CMSC). Its primary function in this context is <b>adaptation</b>. It is deposited throughout life to compensate for occlusal wear and maintain the vertical dimension of the tooth, a process often referred to as passive eruption."
    },
    {
        q: "Describe the origin and function of Sharpey's fibers in relation to cementum.",
        a: "Sharpey's fibers are the terminal portions of the principal collagen fibers of the periodontal ligament (PDL). They are <b>extrinsic fibers</b>, meaning they originate outside the cementum (from PDL fibroblasts). Their function is to embed themselves into the cementum on one side and the alveolar bone on the other, providing the critical <b>anchorage</b> that holds the tooth firmly within its socket."
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      const originalSelectionIndex = visualToOriginal[v];
      state.mcq[idx] = originalSelectionIndex;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    toggleBtn.style.backgroundColor = now ? "rgba(34,197,94,.1)" : "rgba(255,255,255,0.03)";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s, selectedOriginalIndex, i)=>{
    if(selectedOriginalIndex === null) return s;
    return s + (selectedOriginalIndex === mcqs[i].correct ? 1 : 0);
  }, 0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v === null) return s;
    return s + (v === tfs[i].answer ? 1 : 0);
  }, 0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{
    b.textContent="I was correct";
    b.style.outline="none";
    b.style.backgroundColor = "rgba(255,255,255,0.03)";
  });

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
