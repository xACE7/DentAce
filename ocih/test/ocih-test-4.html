<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer table {width: 100%; border-collapse: collapse; margin-top: 10px;}
  .answer th, .answer td { border: 1px solid var(--card-border); padding: 8px; text-align: left; }
  .answer th { background-color: rgba(255,255,255,0.05); }

  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 4</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    { q: "What is the approximate percentage of water in saliva?", opts: ["90-92%", "95-96%", "99-99.5%", "97-98%"], correct: 2, explain: "Saliva is predominantly water, making up 99 to 99.5% of its volume." },
    { q: "The solid components make up what percentage of saliva?", opts: ["5-6%", "2-3%", "0.5-1%", "3-4%"], correct: 2, explain: "The remaining 0.5 to 1% of saliva consists of solids, including electrolytes, enzymes, and other organic molecules." },
    { q: "Which of the following is an essential inorganic ion found in saliva responsible for remineralization?", opts: ["Iron", "Copper", "Calcium", "Zinc"], correct: 2, explain: "Calcium (Ca+), along with phosphate, is crucial for the remineralization of enamel." },
    { q: "Which enzyme present in saliva initiates the digestion of starch?", opts: ["Lipase", "Protease", "Amylase", "Pepsin"], correct: 2, explain: "Salivary amylase begins the breakdown of complex carbohydrates (starches) into simpler sugars." },
    { q: "What is the primary function of the enzyme lysozyme in saliva?", opts: ["Binds to iron", "Breaks down bacterial cell walls", "Digests fats", "Neutralizes acids"], correct: 1, explain: "Lysozyme has antimicrobial properties and causes bacterial lysis by degrading their cell walls." },
    { q: "Which salivary protein deprives bacteria of essential iron, thus inhibiting their growth?", opts: ["Mucin", "Statherin", "Lactoferrin", "Proline-rich proteins"], correct: 2, explain: "Lactoferrin binds to free iron, making it unavailable for bacteria that require it for metabolism." },
    { q: "What is the most abundant immunoglobulin found in saliva, playing a critical role in mucosal immunity?", opts: ["IgG", "IgM", "IgE", "IgA"], correct: 3, explain: "Secretory Immunoglobulin A (sIgA) is the primary antibody in saliva, preventing microbial adhesion to oral surfaces." },
    { q: "Where is the secretory IgA (sIgA) found in saliva primarily produced?", opts: ["Liver", "Blood plasma", "Locally by plasma cells in salivary glands", "Bone marrow"], correct: 2, explain: "sIgA is synthesized by plasma cells located within the salivary glands and then transported into the saliva." },
    { q: "Which of the following is NOT typically considered a component of 'whole saliva'?", opts: ["Desquamated epithelial cells", "Leukocytes", "Red blood cells", "Food remnants"], correct: 2, explain: "Whole saliva contains secretions from all glands plus microorganisms, food debris, epithelial cells, and leukocytes. Red blood cells are not a normal component." },
    { q: "What is the normal pH range of resting saliva?", opts: ["5.5-6.0", "6.7-7.4", "8.0-8.5", "4.5-5.2"], correct: 1, explain: "The pH of saliva is typically near neutral, ranging from 6.7 to 7.4, which is optimal for buffering acids." },
    { q: "Compared to blood plasma, saliva is considered:", opts: ["Isotonic", "Hypertonic", "Hypotonic", "Equitonic"], correct: 2, explain: "Saliva is hypotonic, meaning it has a lower solute concentration than blood plasma, due to the reabsorption of sodium and chloride ions in the salivary ducts." },
    { q: "What is the average daily volume of saliva secreted by a healthy adult?", opts: ["100-200 ml", "2000-2500 ml", "600-1000 ml", "50-100 ml"], correct: 2, explain: "A healthy individual typically produces between 600 and 1000 milliliters (0.6-1 liter) of saliva per day." },
    { q: "What is the typical flow rate of stimulated saliva?", opts: ["0.1 ml/min", "0.5 ml/min", "1.0 ml/min", "2-5 ml/min"], correct: 3, explain: "During stimulation (e.g., eating), the salivary flow rate increases significantly to 2-5 ml/min." },
    { q: "The resting, unstimulated flow rate of saliva is approximately:", opts: ["1.0-1.5 ml/min", "0.2-0.4 ml/min", "2.0-3.0 ml/min", "Less than 0.1 ml/min"], correct: 1, explain: "In a resting state, saliva is produced at a much lower rate of about 0.2-0.4 ml/min." },
    { q: "Which major salivary gland is the largest contributor to the total volume of saliva?", opts: ["Parotid gland", "Submandibular gland", "Sublingual gland", "Minor salivary glands"], correct: 1, explain: "The submandibular gland produces the majority of saliva, accounting for about 60% of the total volume." },
    { q: "The parotid gland primarily secretes which type of saliva?", opts: ["Viscous, mucin-rich saliva", "Watery (serous), enzyme-rich saliva", "A mix of serous and mucous", "Hormone-rich saliva"], correct: 1, explain: "The parotid gland is a pure serous gland, producing a thin, watery saliva rich in enzymes like amylase." },
    { q: "Which major salivary gland produces a predominantly viscous, mucin-rich saliva?", opts: ["Parotid gland", "Submandibular gland", "Sublingual gland", "Von Ebner's glands"], correct: 2, explain: "The sublingual gland is a predominantly mucous gland, secreting a thick, viscous saliva rich in mucins for lubrication." },
    { q: "According to the circadian rhythm of salivary flow, when does the rate typically peak?", opts: ["Early morning", "Late evening", "During sleep", "Mid-afternoon"], correct: 3, explain: "Salivary flow follows a circadian rhythm, with the highest rate occurring in the mid-afternoon." },
    { q: "When is the salivary flow rate at its lowest or negligible?", opts: ["While eating", "During exercise", "During sleep", "In the morning"], correct: 2, explain: "The flow of saliva decreases dramatically and becomes negligible during sleep." },
    { q: "What is the mechanical washing action of saliva primarily responsible for?", opts: ["Remineralizing enamel", "Flushing away non-adherent bacteria and debris", "Digesting proteins", "Forming the pellicle"], correct: 1, explain: "The fluid nature of saliva allows it to physically wash away food particles and microorganisms that have not attached to oral surfaces." },
    { q: "The salivary pellicle, a protective membrane on the tooth surface, is primarily formed from:", opts: ["Bacteria", "Salivary glycoproteins", "Phosphate ions", "Epithelial cells"], correct: 1, explain: "Salivary glycoproteins adsorb to the tooth surface to form the acquired pellicle, which protects the enamel." },
    { q: "Which two inorganic ions in saliva are critical for the remineralization of incipient carious lesions?", opts: ["Sodium and Chloride", "Potassium and Bicarbonate", "Calcium and Phosphate", "Fluoride and Magnesium"], correct: 2, explain: "Saliva is supersaturated with calcium and phosphate ions, which drive the remineralization process to repair early enamel lesions." },
    { q: "The primary buffering action of saliva, which protects enamel from acid dissolution, is mainly due to:", opts: ["Amylase and lipase", "Mucins and glycoproteins", "Bicarbonates and phosphates", "Sodium and potassium"], correct: 2, explain: "Bicarbonate and phosphate ions in saliva act as powerful buffers, neutralizing acids produced by plaque bacteria." },
    { q: "Besides amylase for starch digestion, saliva also contains which enzyme that aids in fat digestion?", opts: ["Trypsin", "Pepsin", "Lipase", "Lactase"], correct: 2, explain: "Saliva contains lingual lipase, which begins the digestion of fats (lipids)." },
    { q: "Which growth factor found in saliva contributes to tissue repair?", opts: ["Nerve Growth Factor (NGF)", "Epidermal Growth Factor (EGF)", "Fibroblast Growth Factor (FGF)", "Insulin-like Growth Factor (IGF)"], correct: 1, explain: "Epidermal Growth Factor (EGF) is present in saliva and helps accelerate the healing of oral mucosal wounds." },
    { q: "How does saliva facilitate the sense of taste?", opts: ["By stimulating taste buds directly", "By dissolving substances so they can contact taste buds", "By cooling the tongue", "By producing a bitter taste"], correct: 1, explain: "For a substance to be tasted, it must first be dissolved. Saliva acts as a solvent, carrying taste molecules to the taste receptors in the taste buds." },
    { q: "In a caries risk assessment, which salivary parameter is most relevant?", opts: ["Volume of secretion", "Glucose concentration", "Buffering capacity and IgA levels", "Urea concentration"], correct: 2, explain: "Measuring the buffering capacity, specific bacterial counts, and protective IgA levels in saliva are key components of a caries risk assessment." },
    { q: "The submandibular glands are responsible for producing approximately what percentage of total saliva volume?", opts: ["30%", "60%", "5%", "90%"], correct: 1, explain: "The submandibular glands are the workhorses of saliva production, contributing about 60% of the total volume." },
    { q: "What percentage of saliva is typically produced by the parotid glands?", opts: ["60%", "5%", "30%", "10%"], correct: 2, explain: "The parotid glands contribute about 30% of the total salivary volume, primarily when stimulated." },
    { q: "The sublingual glands contribute the smallest amount from the major glands. What is their approximate percentage contribution?", opts: ["25%", "15%", "5%", "40%"], correct: 2, explain: "The sublingual glands are the smallest of the major glands and contribute about 5% of the total saliva." }
];

const tfs = [
    { q: "Salivary glands are classified as endocrine glands.", answer: false, explain: "Salivary glands are exocrine glands because they secrete saliva into the oral cavity via ducts, not directly into the bloodstream." },
    { q: "The parotid gland is a pure mucous gland, secreting a thick, viscous fluid.", answer: false, explain: "The parotid gland is a pure serous gland, producing a thin, watery saliva rich in enzymes." },
    { q: "The sublingual gland secretes a saliva that is predominantly mucous in nature.", answer: true, explain: "The sublingual gland is considered a mixed gland but is predominantly mucous, resulting in a viscous secretion." },
    { q: "IgG is the most important and abundant antibody found in saliva.", answer: false, explain: "Secretory IgA (sIgA) is the primary immunoglobulin in saliva, providing mucosal immunity." },
    { q: "Due to its composition, saliva is typically acidic with a pH below 6.0.", answer: false, explain: "The normal pH of saliva is near neutral (6.7-7.4), which is essential for its buffering capacity." },
    { q: "Salivary flow rate is highest during sleep to protect the oral cavity at night.", answer: false, explain: "Salivary flow rate is at its lowest, almost negligible, during sleep." },
    { q: "Lactoferrin, a component of saliva, helps bacteria acquire the iron they need for growth.", answer: false, explain: "Lactoferrin is an antimicrobial protein that binds to iron, making it unavailable to bacteria and thus inhibiting their growth." },
    { q: "The lubricating properties of saliva are essential for the formation of a food bolus to facilitate swallowing.", answer: true, explain: "Saliva moistens and lubricates chewed food, allowing it to be formed into a bolus that can be easily swallowed." },
    { q: "Saliva can be used as a non-invasive diagnostic tool to monitor therapeutic drug levels in the body.", answer: true, explain: "Saliva testing is an emerging application for monitoring the levels of various therapeutic drugs, offering a non-invasive alternative to blood tests." }
];

const saqs = [
    {
        q: "Describe the two main functions of mucin in saliva.",
        a: "Mucin, a glycoprotein, has two primary functions in saliva: 1. **Lubrication:** It coats the oral mucosa and teeth, protecting them from mechanical stress, irritants, and desiccation. It also lubricates the food bolus for easier swallowing. 2. **Antimicrobial Action:** Mucin molecules can aggregate microorganisms, which helps in their rapid clearance from the oral cavity and prevents them from adhering to oral tissues."
    },
    {
        q: "List three distinct antimicrobial components of saliva and briefly explain their mechanism of action.",
        a: "1. **Lysozyme:** This enzyme attacks the cell walls of certain bacteria (specifically targeting peptidoglycan), leading to cell lysis and death.<br>2. **Lactoferrin:** This protein binds to free iron in the saliva. Since many bacteria require iron for growth and metabolism, lactoferrin deprives them of this essential element, acting as a bacteriostatic agent.<br>3. **Secretory IgA (sIgA):** This antibody binds to microorganisms, causing them to clump together (agglutination). This prevents them from attaching to oral surfaces and facilitates their removal by swallowing."
    },
    {
        q: "Compare the secretions of the parotid and sublingual glands.",
        a: `<table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Parotid Gland</th>
                        <th>Sublingual Gland</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1. Secretion Type</td>
                        <td>Purely serous (thin and watery)</td>
                        <td>Predominantly mucous (thick and viscous)</td>
                    </tr>
                    <tr>
                        <td>2. Key Components</td>
                        <td>Rich in enzymes like amylase, and proline-rich proteins</td>
                        <td>Rich in mucins for lubrication</td>
                    </tr>
                    <tr>
                        <td>3. Contribution</td>
                        <td>~30% of total saliva, mainly during stimulation</td>
                        <td>~5% of total saliva, mainly contributing to resting saliva</td>
                    </tr>
                </tbody>
            </table>`
    },
    {
        q: "Explain how saliva helps maintain tooth integrity through buffering and remineralization.",
        a: "Saliva maintains tooth integrity in two key ways: <br><b>1. Buffering:</b> Saliva contains bicarbonate and phosphate systems that neutralize acids produced by plaque bacteria after sugar consumption. This action raises the pH in the oral cavity, preventing the dissolution (demineralization) of tooth enamel.<br><b>2. Remineralization:</b> Saliva is supersaturated with calcium and phosphate ions. When the pH is neutral, these ions can be deposited back into the tooth structure, repairing early carious lesions where minerals have been lost. This process is enhanced by the presence of fluoride."
    },
    {
        q: "What are the five components of 'whole saliva' that are not directly secreted by the salivary glands?",
        a: "Whole saliva, also called oral fluid, contains more than just glandular secretions. The five additional components are:<br>1. Microorganisms and their products<br>2. Food remnants<br>3. Leukocytes (white blood cells)<br>4. Desquamated oral epithelial cells<br>5. Gingival crevicular fluid"
    },
    {
        q: "A patient presents with persistent dry mouth (xerostomia), complains of difficulty swallowing food, and has noticed a recent increase in cavities. Based on the functions of saliva, explain the likely cause for each of these three symptoms.",
        a: "The patient's symptoms are directly related to the loss of key salivary functions: <br><b>1. Difficulty Swallowing:</b> Saliva's water and mucin content are essential for lubricating chewed food to form a cohesive bolus. Without adequate saliva, the food is dry and abrasive, making deglutition (swallowing) difficult and uncomfortable.<br><b>2. Increase in Cavities:</b> This is due to the loss of multiple protective functions. There is reduced mechanical washing to clear food debris, a loss of the buffering capacity to neutralize acids from bacteria, and insufficient calcium and phosphate ions for remineralization of early lesions.<br><b>3. Dry Mouth Sensation:</b> The fundamental role of saliva is to keep the oral tissues moist and protected. The lack of this fluid film leads to the sensation of dryness and can cause tissue desiccation and irritation."
    }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
    const mcqScore = mcqs.reduce((score, mcq, i) => {
        if (state.mcq[i] === null) return score;
        const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
        const originalToVisual = Array(4);
        const buttons = card.querySelectorAll('.opt-btn');
        const visualToOriginal = Array.from(buttons).map(btn => {
            const label = btn.querySelector('.label').textContent;
            return mcq.opts.indexOf(label);
        });
        visualToOriginal.forEach((orig, v) => { originalToVisual[orig] = v; });
        const correctVisualIndex = originalToVisual[mcq.correct];
        return score + (state.mcq[i] === correctVisualIndex ? 1 : 0);
    }, 0);

    const tfScore = tfs.reduce((score, tf, i) => {
        if (state.tf[i] === null) return score;
        return score + (state.tf[i] === tf.answer ? 1 : 0);
    }, 0);

    const saqScore = state.saq.filter(Boolean).length;
    const total = mcqScore + tfScore + saqScore;

    document.getElementById('sMcq').textContent = mcqScore;
    document.getElementById('sTf').textContent = tfScore;
    document.getElementById('sSaq').textContent = saqScore;
    document.getElementById('sTotal').textContent = total;
    document.getElementById('sMcq2').textContent = mcqScore;
    document.getElementById('sTf2').textContent = tfScore;
    document.getElementById('sSaq2').textContent = saqScore;
    document.getElementById('sTotal2').textContent = total;
}


document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
