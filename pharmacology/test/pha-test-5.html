<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 5</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    { q: "Which FDA Pregnancy Risk Category indicates that controlled human studies show no fetal risk in any trimester?", opts: ["Category A", "Category B", "Category C", "Category X"], correct: 0, explain: "Category A is the safest, where adequate and well-controlled studies in pregnant women have failed to demonstrate a risk to the fetus." },
    { q: "The drug Thalidomide, known for causing severe limb defects, belongs to which FDA category?", opts: ["Category C", "Category D", "Category B", "Category X"], correct: 3, explain: "Thalidomide is a classic example of a Category X drug, where the risks involved in use of the drug in pregnant women clearly outweigh potential benefits." },
    { q: "Exposure to which of the following drugs during pregnancy is associated with skeletal abnormalities and curvature of the spine?", opts: ["Aminoglycosides", "Warfarin", "ACE inhibitors", "Antineoplastics"], correct: 1, explain: "Warfarin (Category D) is known to cause skeletal and limb abnormalities if taken during pregnancy." },
    { q: "According to the dental drug chart, which antibiotic can cause discoloration of teeth in the developing fetus?", opts: ["Amoxicillin", "Metronidazole", "Tetracycline", "Clindamycin"], correct: 2, explain: "Tetracycline is contraindicated because it can lead to permanent discoloration of the teeth." },
    { q: "Use of ACE inhibitors during pregnancy is linked to which of the following congenital defects?", opts: ["VIII cranial nerve damage", "Limb defects", "Renal tubular dysplasia", "Cleft palate"], correct: 2, explain: "ACE inhibitors (Category D) are associated with renal tubular dysplasia, as well as skull and pulmonary hypoplasia." },
    { q: "Which analgesic is specifically contraindicated in the 3rd trimester of pregnancy?", opts: ["Acetaminophen", "Morphine", "Ibuprofen", "Oxycodone"], correct: 2, explain: "Aspirin, Ibuprofen, and Naproxen are to be avoided in the third trimester due to risks like postpartum hemorrhage." },
    { q: "Which local anesthetic should be used with caution during pregnancy due to a risk of fetal bradycardia?", opts: ["Lidocaine", "Prilocaine", "Mepivacaine", "Etidocaine"], correct: 2, explain: "Mepivacaine and Bupivacaine should be used with caution because they are associated with fetal bradycardia." },
    { q: "Exposure to which sedative/hypnotic group during pregnancy is associated with a risk of cleft lip/palate?", opts: ["Nitrous oxide", "Barbiturates", "Benzodiazepines", "Prednisolone"], correct: 2, explain: "Benzodiazepines are noted to have a risk of causing cleft lip and/or palate." },
    { q: "What is the primary risk of using high-dose Aminoglycosides during pregnancy?", opts: ["Cardiac defects", "VIII cranial nerve damage", "Growth retardation", "Pulmonary hypoplasia"], correct: 1, explain: "High doses of Aminoglycosides (Category C) can cause damage to the VIII cranial nerve (auditory nerve)." },
    { q: "The fetal development stage, occurring from 9 weeks to birth, is primarily associated with the development of:", opts: ["Major anatomical structures", "Implantation", "Neurologic function and growth", "Cellular division only"], correct: 2, explain: "During the fetal stage (9 weeks to birth), development is focused on growth, as well as physiologic, neurologic, and biochemical functioning." },
    { q: "Which of these antifungals is considered safe to use during pregnancy according to the provided chart?", opts: ["Ketoconazole", "Clotrimazole", "Fluconazole", "Nystatin"], correct: 1, explain: "Clotrimazole is marked as 'YES' for use in pregnancy. Ketoconazole and Fluconazole should be used with caution." },
    { q: "What potential adverse effect is associated with Chloramphenicol use during pregnancy?", opts: ["Fetal ototoxicity", "Discoloration of teeth", "Maternal toxicity/fetal death", "Skeletal abnormalities"], correct: 2, explain: "The remarks for Chloramphenicol explicitly state 'Maternal toxicity/fetal death'." },
    { q: "According to the FDA classifications, Category D means:", opts: ["No fetal risk shown in human studies.", "Risk to fetus clearly outweighs any benefits.", "Fetal risk shown in animals, but not in humans.", "Studies show fetal risk, but use may be acceptable."], correct: 3, explain: "Category D indicates there is positive evidence of human fetal risk, but potential benefits may warrant use of the drug in pregnant women despite potential risks." },
    { q: "Which of the following dental procedures is considered unsafe during pregnancy?", opts: ["Root canals", "Restorations", "Local anesthetics with epinephrine", "None of the above"], correct: 3, explain: "The lecture states that preventive, diagnostic, and restorative dental treatment, including root canals and restorations with local anesthetics, is safe throughout pregnancy." },
    { q: "What is the main concern with dental personnel's exposure to nitrous oxide during the first trimester?", opts: ["Fetal bradycardia", "Spontaneous abortions", "Renal dysplasia", "Limb abnormalities"], correct: 1, explain: "The chart notes that nitrous oxide is associated with spontaneous abortions and should not be used in the first trimester." },
    { q: "Which of the following is NOT considered a characteristic of teratogenesis?", opts: ["Structural defects", "Functional defects", "Intrauterine growth retardation", "Enhanced fetal growth"], correct: 3, explain: "Teratogenesis involves defects, growth retardation, and death, not enhanced growth." },
    { q: "Which drug is mentioned to potentially cause respiratory depression when used with caution during pregnancy?", opts: ["Acetaminophen", "Ibuprofen", "Aspirin", "Morphine"], correct: 3, explain: "The analgesics chart indicates a risk of respiratory depression associated with opioids like Morphine, Oxycodone, etc." },
    { q: "What is the FDA risk category for Warfarin?", opts: ["Category A", "Category B", "Category C", "Category D"], correct: 3, explain: "Warfarin is listed as a Category D drug due to its known risk of causing skeletal abnormalities." },
    { q: "Which of these corticosteroids is considered safe to use during pregnancy and lactation?", opts: ["Hydrocortisone", "Dexamethasone", "Prednisolone", "Betamethasone"], correct: 2, explain: "Prednisolone is the only corticosteroid listed, and it is marked 'YES' for use in both pregnancy and lactation." },
    { q: "In the post-implantation stage (0-8 weeks), a teratogen may produce all of the following EXCEPT:", opts: ["Abortion", "An anatomic defect", "No effect at all", "Only minor functional defects"], correct: 3, explain: "During this critical period, teratogens can cause major anatomic defects, abortion, or no effect. The idea of 'only minor' effects is misleading for this stage." },
    { q: "Which of the following antibiotics is generally considered safe in pregnancy?", opts: ["Gentamycin", "Tetracycline", "Amoxicillin", "Chloramphenicol"], correct: 2, explain: "Amoxicillin is listed as 'YES' for use in pregnancy. Gentamycin, Tetracycline, and Chloramphenicol have significant fetal risks." },
    { q: "The term 'transplacental carcinogenesis' refers to:", opts: ["The drug causing cancer in the mother.", "The drug causing cancer in the fetus.", "The drug being unable to cross the placenta.", "The drug preventing cancer development."], correct: 1, explain: "Transplacental carcinogenesis is when a substance crosses the placenta and induces cancer in the fetus." },
    { q: "Which of the following is a known teratogenic effect of antineoplastic agents?", opts: ["Enhanced VIII cranial nerve function", "Accelerated fetal growth", "Growth retardation and cleft palate", "Improved skeletal formation"], correct: 2, explain: "Antineoplastics (Category D) are associated with a wide range of defects, including growth retardation and cleft palate." },
    { q: "Fetal toxicity is a specific concern for which antifungal drug?", opts: ["Nystatin", "Clotrimazole", "Ketoconazole", "Amphotericin B"], correct: 2, explain: "The remarks section for antifungals explicitly mentions 'Fetal toxicity with ketoconazole'." },
    { q: "Barbiturates are contraindicated for use in:", opts: ["Pregnancy only", "Lactation only", "Both pregnancy and lactation", "Neither pregnancy nor lactation"], correct: 2, explain: "The chart for sedatives shows Barbiturates are marked 'NO' for both use in pregnancy and lactation." },
    { q: "Which class of drugs is associated with pulmonary hypoplasia when used during pregnancy?", opts: ["ACE inhibitors", "Aminoglycosides", "Beta-blockers", "Corticosteroids"], correct: 0, explain: "ACE inhibitors are linked to renal tubular dysplasia, skull hypoplasia, and pulmonary hypoplasia." },
    { q: "What is the recommendation for Metronidazole use during pregnancy and lactation?", opts: ["NO in both", "YES in both", "YES in pregnancy, NO in lactation", "NO in pregnancy, YES in lactation"], correct: 1, explain: "Metronidazole is listed as 'YES' for use in both pregnancy and lactation." },
    { q: "Anatomic defects caused by teratogens are most likely to occur during which period?", opts: ["Pre-implantation", "Post-implantation (0-8 weeks)", "Fetal development (9-birth)", "During labor"], correct: 1, explain: "The post-implantation stage is when organogenesis occurs, making the embryo most vulnerable to major structural/anatomic defects." },
    { q: "FDA Category B implies that:", opts: ["Human studies show no risk.", "Animal studies show risk, not confirmed in humans.", "Risk clearly outweighs benefits.", "Human studies show definite risk."], correct: 1, explain: "Category B means animal reproduction studies have shown a risk but there are no adequate and well-controlled studies in pregnant women." },
    { q: "Which common analgesic is considered safe throughout pregnancy and lactation?", opts: ["Aspirin", "Ibuprofen", "Naproxen", "Acetaminophen"], correct: 3, explain: "Acetaminophen is the only analgesic listed as 'YES' for use in both pregnancy and lactation without major restrictions." }
];

const tfs = [
    { q: "Preventive and restorative dental treatment is considered safe throughout the entire duration of pregnancy.", answer: true, explain: "The lecture explicitly states that preventive, diagnostic, and restorative dental treatment is safe throughout pregnancy." },
    { q: "Lidocaine with epinephrine is contraindicated for use as a local anesthetic in pregnant patients.", answer: false, explain: "The presentation notes that local anesthetics like lidocaine with epinephrine may be used during pregnancy." },
    { q: "The use of Tetracycline during pregnancy can lead to fetal ototoxicity (hearing damage).", answer: false, explain: "Tetracycline causes discoloration of teeth. Fetal ototoxicity is associated with Gentamycin (an aminoglycoside)." },
    { q: "According to the FDA, Category X drugs may be acceptable to use in pregnancy if the benefits are significant.", answer: false, explain: "For Category X drugs, the risk to the fetus clearly outweighs any possible benefits. They are contraindicated." },
    { q: "The drug Warfarin is classified as an FDA Category D agent.", answer: true, explain: "Warfarin is listed as a Category D drug, known to cause skeletal and limb abnormalities." },
    { q: "Nitrous oxide is considered safe to use for sedation in a dental patient who is in her first trimester.", answer: false, explain: "The chart indicates that nitrous oxide should NOT be used in the first trimester due to its association with spontaneous abortions." },
    { q: "All cephalosporin antibiotics are contraindicated during pregnancy.", answer: false, explain: "The chart groups Cephalosporins with Amoxicillin, Metronidazole, and Penicillin as 'YES' for use in pregnancy." },
    { q: "Exposure to a teratogen during the pre-implantation stage will always result in a severe anatomic defect.", answer: false, explain: "During the pre-implantation stage, a teratogen is more likely to cause an 'all-or-none' effect: either abortion or no effect at all." },
    { q: "Prednisolone is a corticosteroid that can be safely used during both pregnancy and lactation.", answer: true, explain: "The chart on corticosteroids lists Prednisolone as 'YES' for use in both pregnancy and lactation." }
];

const saqs = [
    { q: "Define teratogenesis as described in the lecture.", a: "Teratogenesis is characterized by structural or functional defects in the developing embryo or fetus. It also includes intrauterine growth retardation, death of the embryo or fetus, and transplacental carcinogenesis." },
    { q: "List the five FDA Pregnancy Risk Categories, starting from the one with the least demonstrated risk to the one with the highest.", a: "The five categories are:<br>1. <b>Category A:</b> No risk in controlled human studies.<br>2. <b>Category B:</b> No risk in human studies, despite animal findings (or only animal studies showing no risk).<br>3. <b>Category C:</b> Risk shown in animals, but no human studies available.<br>4. <b>Category D:</b> Evidence of human fetal risk, but benefits may outweigh risks.<br>5. <b>Category X:</b> Risk clearly outweighs any benefits; contraindicated." },
    { q: "Compare the FDA risk categories D and X. What is the key difference in their clinical recommendation?", a: "<b>Category D</b> drugs have shown a risk to the human fetus, but their use may be acceptable if the potential benefits to the mother are great (e.g., for a life-threatening condition).<br><b>Category X</b> drugs have also shown fetal abnormalities and risk, but this risk clearly and unequivocally outweighs any possible benefit. These drugs are contraindicated in women who are or may become pregnant." },
    { q: "A pregnant patient in her third trimester has a severe dental abscess. The dentist considers prescribing an analgesic. Based on the lecture, which class of common analgesics must be avoided and why?", a: "NSAIDs like Aspirin, Ibuprofen, and Naproxen must be avoided. They are specifically contraindicated in the third trimester due to risks such as causing premature closure of the fetal ductus arteriosus and potential for postpartum hemorrhage." },
    { q: "List three different teratogenic agents mentioned in the lecture and the primary defect associated with each.", a: "1. <b>Thalidomide:</b> Limb defects.<br>2. <b>Warfarin:</b> Skeletal abnormalities (e.g., curvature of the spine).<br>3. <b>ACE inhibitors:</b> Renal tubular dysplasia and pulmonary hypoplasia." },
    { q: "Describe the three main stages of intrauterine development discussed and the general effect a teratogen might have in each stage.", a: "1. <b>Pre-implantation/Post-implantation (0-8 weeks):</b> This is the period of organogenesis. Teratogens can produce major anatomical defects, abortion, or have no effect at all.<br>2. <b>Fetal development (9 weeks to birth):</b> This period influences growth, neurologic and functional development. Teratogens can cause functional or metabolic defects, growth retardation, or death of the fetus." }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
    // Recalculate MCQ score based on whether the chosen answer was correct
    const mcqScore = state.mcq.reduce((score, selectedVisualIndex, idx) => {
        if (selectedVisualIndex === null) return score;
        const item = mcqs[idx];
        const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${idx}"]`);
        const buttons = card.querySelectorAll('.opt-btn');

        // Re-derive the correct visual index for this card
        const originalToVisual = Array(4);
        const btnLabels = Array.from(buttons).map(b => b.querySelector('.label').textContent);
        item.opts.forEach((optText, origIdx) => {
          const visualIdx = btnLabels.findIndex(label => label === optText);
          originalToVisual[origIdx] = visualIdx;
        });
        const correctVisualIndex = originalToVisual[item.correct];

        return score + (selectedVisualIndex === correctVisualIndex ? 1 : 0);
    }, 0);

    // Recalculate T/F score
    const tfScore = state.tf.reduce((score, selectedValue, idx) => {
        if (selectedValue === null) return score;
        return score + (selectedValue === tfs[idx].answer ? 1 : 0);
    }, 0);

    const saqScore = state.saq.filter(Boolean).length;
    const total = mcqScore + tfScore + saqScore;

    const ids = ["sMcq", "sTf", "sSaq", "sTotal", "sMcq2", "sTf2", "sSaq2", "sTotal2"];
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (id.includes('Mcq')) el.textContent = mcqScore;
        if (id.includes('Tf')) el.textContent = tfScore;
        if (id.includes('Saq')) el.textContent = saqScore;
        if (id.includes('Total')) el.textContent = total;
    });
}


document.getElementById('resetAll').addEventListener('click', ()=>{
  if (!confirm("Are you sure you want to reset all answers and scores?")) return;
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
