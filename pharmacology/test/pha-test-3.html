<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 3</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "What is the primary definition of Pharmacodynamics?",
        opts: [
            "The study of how the body absorbs, distributes, metabolizes, and excretes drugs.",
            "The detailed study of the mode of action of drugs in the body.",
            "The process of developing new pharmaceutical products.",
            "The study of drug toxicity and adverse effects on organs."
        ],
        correct: 1,
        explain: "Pharmacodynamics specifically studies what drugs do to the body and their mechanisms of action at a cellular level."
    },
    {
        q: "Which of the following is NOT a major receptor family?",
        opts: [
            "Ligand-gated ion channels",
            "G protein-coupled receptors",
            "Enzyme-linked receptors",
            "Voltage-gated sodium channels"
        ],
        correct: 3,
        explain: "While important, voltage-gated channels are a different category. The four major families are Ligand-gated, G protein-coupled, Enzyme-linked, and Intracellular receptors."
    },
    {
        q: "Which type of receptor family demonstrates the fastest response time, typically in milliseconds?",
        opts: [
            "Nuclear intracellular receptors",
            "Kinase-linked receptors",
            "Ligand-gated ion channels",
            "G-protein-coupled receptors"
        ],
        correct: 2,
        explain: "Ligand-gated ion channels act the fastest (milliseconds) because they directly open or close to allow ion flow, causing an immediate change in membrane potential."
    },
    {
        q: "Steroid and thyroid hormones typically interact with which family of receptors?",
        opts: [
            "G protein-coupled receptors",
            "Enzyme-linked receptors",
            "Intracellular receptors",
            "Ligand-gated ion channels"
        ],
        correct: 2,
        explain: "These lipid-soluble hormones can diffuse across the cell membrane to bind with intracellular (nuclear) receptors, which then alter gene expression."
    },
    {
        q: "Aspirin and other NSAIDs produce their anti-inflammatory effects by inhibiting which enzyme?",
        opts: [
            "Dihydrofolate reductase",
            "Cyclo-oxygenase (COX)",
            "DNA polymerase",
            "Acetylcholinesterase"
        ],
        correct: 1,
        explain: "NSAIDs block the cyclo-oxygenase enzyme, which prevents the synthesis of prostaglandins from arachidonic acid, thereby reducing inflammation."
    },
    {
        q: "What does the term EC50 represent in a dose-response curve?",
        opts: [
            "The dose of a drug that is lethal to 50% of a population.",
            "The concentration of a drug that produces 50% of the maximal response.",
            "The time it takes for 50% of the drug to be eliminated from the body.",
            "The dose that produces a therapeutic effect in 50% of patients."
        ],
        correct: 1,
        explain: "EC50 stands for 'half maximal effective concentration' and is a measure of a drug's potency."
    },
    {
        q: "Which of the following drugs acts by inhibiting the synthesis of the bacterial cell wall?",
        opts: [
            "Methotrexate",
            "Trimethoprim",
            "Penicillin",
            "Dactinomycin"
        ],
        correct: 2,
        explain: "Penicillins and cephalosporins are classic examples of antibiotics that interfere with bacterial cell wall synthesis."
    },
    {
        q: "The interaction of a drug with which of the following initiates the events leading to a biological response?",
        opts: [
            "Plasma proteins",
            "Red blood cells",
            "Receptors",
            "Adipose tissue"
        ],
        correct: 2,
        explain: "The formation of a drug-receptor complex is the critical first step that triggers a cascade of events resulting in a cellular and biological response."
    },
    {
        q: "Insulin binds to which type of receptor?",
        opts: [
            "G protein-coupled receptor",
            "Ligand-gated ion channel",
            "Intracellular receptor",
            "Enzyme-linked receptor"
        ],
        correct: 3,
        explain: "The insulin receptor is a classic example of an enzyme-linked receptor, specifically a tyrosine kinase receptor, which activates intracellular signaling pathways."
    },
    {
        q: "What concept describes a subject's reduced reaction to a drug after repeated use?",
        opts: [
            "Drug allergy",
            "Drug toxicity",
            "Drug tolerance",
            "Drug dependency"
        ],
        correct: 2,
        explain: "Drug tolerance occurs when the body adapts to a drug, requiring a higher dose to achieve the same effect."
    },
    {
        q: "Methotrexate is a chemotherapeutic agent that interferes with DNA synthesis by inhibiting the formation of:",
        opts: [
            "Prostaglandins",
            "Folic acid",
            "Arachidonic acid",
            "Nucleic acids directly"
        ],
        correct: 1,
        explain: "Methotrexate inhibits dihydrofolate reductase, an enzyme crucial for the synthesis of folic acid, which is necessary for DNA production."
    },
    {
        q: "Muscarinic ACh receptors and adrenoceptors are examples of which receptor family?",
        opts: [
            "G-protein-coupled receptors",
            "Kinase-linked receptors",
            "Ligand-gated ion channels",
            "Nuclear intracellular receptors"
        ],
        correct: 0,
        explain: "Both muscarinic and adrenergic receptors are classic examples of G-protein-coupled receptors, which act within seconds."
    },
    {
        q: "The magnitude of a drug's effect primarily depends on:",
        opts: [
            "The color of the drug.",
            "The time of day it is administered.",
            "The drug's concentration at the receptor site.",
            "The patient's age and gender only."
        ],
        correct: 2,
        explain: "The dose-response relationship dictates that the drug's effect increases as its concentration at the receptor site increases, up to a maximal point."
    },
    {
        q: "Which process is NOT considered part of pharmacodynamics?",
        opts: [
            "Drug binding to a receptor.",
            "Activation of a second messenger system.",
            "Drug metabolism in the liver.",
            "Alteration of gene expression by a steroid."
        ],
        correct: 2,
        explain: "Metabolism is a key component of pharmacokinetics (what the body does to the drug), not pharmacodynamics (what the drug does to the body)."
    },
    {
        q: "A drug that binds to a receptor and initiates a cellular response is known as a(n):",
        opts: [
            "Antagonist",
            "Agonist",
            "Chelator",
            "Enzyme inhibitor"
        ],
        correct: 1,
        explain: "An agonist is a molecule that, by binding to a receptor site, stimulates a response. This is a core concept in pharmacodynamics."
    },
    {
        q: "What is the consequence of a drug binding to a receptor?",
        opts: [
            "The receptor is permanently destroyed.",
            "The drug is immediately metabolized.",
            "A biological response is triggered.",
            "The cell undergoes apoptosis."
        ],
        correct: 2,
        explain: "The binding of a drug to its receptor is the signal that initiates a cascade of intracellular events leading to a biological response."
    },
    {
        q: "A response that is continuous and gradual as the dose increases is called a:",
        opts: [
            "Quantal effect",
            "All-or-none effect",
            "Toxic effect",
            "Graded effect"
        ],
        correct: 3,
        explain: "Graded dose-response curves show that the magnitude of the response increases with the drug concentration."
    },
    {
        q: "Which of the following is an example of a ligand for a ligand-gated ion channel?",
        opts: [
            "Steroid hormone",
            "Insulin",
            "Acetylcholine (at nicotinic receptors)",
            "Thyroid hormone"
        ],
        correct: 2,
        explain: "Acetylcholine binds to nicotinic receptors, which are ligand-gated ion channels, causing them to open and allow ion flow."
    },
    {
        q: "The process of drug tolerance is generally:",
        opts: [
            "Permanent and irreversible.",
            "Reversible, for example, through a drug holiday.",
            "Only a psychological phenomenon.",
            "Caused exclusively by liver damage."
        ],
        correct: 1,
        explain: "Tolerance can often be reversed by temporarily discontinuing the drug, allowing the body's sensitivity to reset."
    },
    {
        q: "What is the richest source of therapeutically relevant pharmacologic receptors?",
        opts: [
            "Carbohydrates in the cell wall",
            "Lipids in the adipose tissue",
            "Proteins that transduce extracellular signals",
            "Inorganic ions in the cytoplasm"
        ],
        correct: 2,
        explain: "Proteins that are involved in signal transduction are the most common and important targets for therapeutic drugs."
    },
    {
        q: "The name of a receptor, like 'histamine receptor', is typically based on:",
        opts: [
            "The scientist who discovered it.",
            "The organ where it is most abundant.",
            "The type of drug/chemical that interacts best with it.",
            "The disease it is associated with."
        ],
        correct: 2,
        explain: "Receptors are most often named for their primary endogenous ligand or the drug that was first found to bind to them."
    },
    {
        q: "Which action is characteristic of an intracellular receptor?",
        opts: [
            "Opening an ion channel immediately.",
            "Activating a G-protein.",
            "Altering gene expression.",
            "Phosphorylating another protein directly."
        ],
        correct: 2,
        explain: "Intracellular receptors, when bound by their ligand, typically act as transcription factors to alter gene expression, a process that takes hours."
    },
    {
        q: "Opiates and amphetamines are classic examples of drugs that can lead to:",
        opts: [
            "Cell wall destruction",
            "Inhibition of folic acid synthesis",
            "Drug tolerance",
            "Activation of kinase receptors"
        ],
        correct: 2,
        explain: "These drugs are well-known for causing tolerance with repeated use, where users need to take more to get the same effect."
    },
    {
        q: "What is the initial source of prostaglandins in the inflammatory pathway?",
        opts: [
            "Cyclo-oxygenase",
            "Arachidonic acid",
            "Folic acid",
            "Damaged cell membranes"
        ],
        correct: 1,
        explain: "Arachidonic acid, released from damaged cell membranes, is the precursor molecule that cyclo-oxygenase converts into prostaglandins."
    },
    {
        q: "Which factor is part of a drug's pharmacokinetic profile, which influences its concentration at the receptor site?",
        opts: [
            "Receptor binding affinity",
            "Rate of absorption",
            "Second messenger activation",
            "Intrinsic activity"
        ],
        correct: 1,
        explain: "Absorption, distribution, metabolism, and excretion (ADME) are the core components of pharmacokinetics that determine drug concentration."
    },
    {
        q: "GABA-benzodiazepine receptors are an example of which receptor type?",
        opts: [
            "Enzyme-linked receptors",
            "G-protein coupled receptors",
            "Nuclear receptors",
            "Ligand-gated ion channels"
        ],
        correct: 3,
        explain: "The GABA-A receptor, where benzodiazepines act, is a classic example of a ligand-gated ion channel that allows chloride ions to enter the neuron."
    },
    {
        q: "Kinase-linked receptors, such as the insulin receptor, typically have a response time of:",
        opts: [
            "Milliseconds",
            "Seconds",
            "Hours",
            "Days"
        ],
        correct: 2,
        explain: "Their mechanism involves protein phosphorylation and downstream signaling cascades, which take a longer time (hours) to manifest a full effect compared to ion channels or GPCRs."
    },
    {
        q: "The term 'ligand' in pharmacology refers to:",
        opts: [
            "A type of cell membrane.",
            "A molecule that binds to a receptor.",
            "An enzyme that breaks down drugs.",
            "A component of DNA."
        ],
        correct: 1,
        explain: "A ligand is any substance (like a drug, hormone, or neurotransmitter) that forms a complex with a biomolecule (like a receptor) to serve a biological purpose."
    },
    {
        q: "A drug's ability to produce a maximal response is known as its:",
        opts: [
            "Potency",
            "Efficacy",
            "Affinity",
            "Selectivity"
        ],
        correct: 1,
        explain: "Efficacy refers to the maximum effect a drug can produce, regardless of the dose. Potency (related to EC50) refers to the amount of drug needed to produce an effect."
    },
    {
        q: "Understanding pharmacodynamics helps predict:",
        opts: [
            "The cost of a drug.",
            "The rate of drug absorption.",
            "Drug interactions and toxicities.",
            "The shelf life of a medication."
        ],
        correct: 2,
        explain: "By knowing how drugs act at a cellular level, clinicians can anticipate potential interactions with other drugs and understand their toxic effects."
    }
];

const tfs = [
    {
        q: "Pharmacodynamics is the study of what the body does to a drug.",
        answer: false,
        explain: "This statement describes pharmacokinetics. Pharmacodynamics is the study of what the drug does to the body."
    },
    {
        q: "Most drugs exert their effects by interacting with specific receptors.",
        answer: true,
        explain: "The drug-receptor interaction is the fundamental basis for the action of most therapeutic agents."
    },
    {
        q: "Enzyme-linked receptors are the fastest-acting type of receptor.",
        answer: false,
        explain: "Ligand-gated ion channels are the fastest (milliseconds), while enzyme-linked receptors take hours to produce their effect."
    },
    {
        q: "The EC50 is a measure of a drug's efficacy.",
        answer: false,
        explain: "The EC50 is a measure of a drug's potency (the concentration needed for a 50% response), not its efficacy (the maximal response)."
    },
    {
        q: "The development of drug tolerance is an irreversible process.",
        answer: false,
        explain: "Drug tolerance is often reversible, for example, by temporarily stopping the drug (a drug holiday)."
    },
    {
        q: "Penicillin acts by inhibiting the synthesis of folic acid in bacteria.",
        answer: false,
        explain: "Penicillin inhibits the synthesis of the bacterial cell wall. Methotrexate is an example of a drug that inhibits folic acid formation."
    },
    {
        q: "An increase in drug concentration at the receptor site generally leads to an increase in the pharmacologic effect.",
        answer: true,
        explain: "This is the principle of the dose-response relationship, where a greater concentration leads to a greater effect, up to a maximum."
    },
    {
        q: "All receptors for drugs are located on the cell surface.",
        answer: false,
        explain: "Some receptors, like those for steroid hormones, are intracellular (located within the cell, often in the nucleus)."
    },
    {
        q: "G-protein coupled receptors typically elicit their effects within a few seconds.",
        answer: true,
        explain: "Their response time is in seconds, which is slower than ligand-gated ion channels but faster than enzyme-linked or nuclear receptors."
    }
];

const saqs = [
    {
        q: "Define 'Pharmacodynamics' and state the three main ways drugs can exert their action as discussed in the lecture.",
        a: "<b>Definition:</b> Pharmacodynamics is the detailed study of the mode of action of drugs in the body, or how drugs exert their effect at a cellular level.<br><br><b>Three mechanisms of action:</b><br>1. Binding to Receptors<br>2. Interacting with Enzymes<br>3. Through Chemotherapy (e.g., interfering with cell growth or bacterial processes)."
    },
    {
        q: "List the four major families of receptors.",
        a: "The four major receptor families are:<br><br>1. Ligand-gated ion channels<br>2. G protein-coupled receptors<br>3. Enzyme-linked receptors<br>4. Intracellular receptors"
    },
    {
        q: "Compare the typical response times for Ligand-gated ion channels and Kinase-linked receptors.",
        a: "A comparison of response times is shown below:<br><br><ol><li><b>Ligand-gated ion channels:</b> Very fast, with a response time in the order of milliseconds.</li><li><b>Kinase-linked receptors:</b> Slow, with a response time that typically takes hours to develop.</li></ol>"
    },
    {
        q: "A patient with rheumatoid arthritis is prescribed a Non-Steroidal Anti-Inflammatory Drug (NSAID). Briefly explain the mechanism by which this drug reduces inflammation, mentioning the enzyme and the substance whose synthesis is blocked.",
        a: "The NSAID reduces inflammation by inhibiting the <b>cyclo-oxygenase (COX) enzyme</b>. This enzyme is responsible for converting arachidonic acid into <b>prostaglandins</b>. By blocking the COX enzyme, the synthesis of prostaglandins is inhibited, leading to a reduction in inflammation."
    },
    {
        q: "Explain the concept of drug tolerance and give an example of a class of drugs where this is commonly observed.",
        a: "Drug tolerance is a pharmacological concept where a subject has a reduced reaction to a drug following its repeated use. This means a higher dose is required to achieve the original effect. The process is often reversible.<br><br>A common example is with <b>Opiates</b> or <b>Amphetamines</b>."
    },
    {
        q: "Describe the key difference between a drug's potency and its efficacy, referencing the dose-response curve.",
        a: "<b>Potency:</b> Refers to the amount of drug needed to produce an effect. On a dose-response curve, potency is determined by the EC50 value (the concentration that gives 50% of the maximal effect). A drug with a lower EC50 is more potent.<br><br><b>Efficacy:</b> Refers to the maximum possible effect that a drug can produce, regardless of the dose. On a dose-response curve, it is represented by the plateau (the highest point) of the curve."
    }
];


// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[j]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      const originalIndex = visualToOriginal[v];
      state.mcq[idx] = originalIndex; // Store original index

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});


// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      const isCorrect = (val === item.answer);
      
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      if(!isCorrect){
        btn.classList.add('wrong');
      }
      
      feedback.hidden=false;
      feedback.innerHTML = `<b>${isCorrect ? 'Correct ✔' : 'Wrong ✖'}</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      
      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc() {
    const mcqScore = state.mcq.reduce((score, selectedOriginalIndex, i) => {
        if (selectedOriginalIndex === null) return score;
        const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
        const buttons = card.querySelectorAll('.opt-btn');
        let isCorrect = false;

        buttons.forEach(btn => {
            if(btn.classList.contains('correct') && !btn.classList.contains('wrong')) {
                const visualIndex = parseInt(btn.dataset.v);
                
                // We need to find which original option corresponds to this visual button.
                // The shuffle mapping is local to the creation scope. We have to re-evaluate based on DOM.
                // A simpler check: if the feedback says 'Correct', score it.
                const feedback = card.querySelector('.feedback').innerHTML;
                if(feedback.includes('<b>Correct ✔</b>')) {
                    isCorrect = true;
                }
            }
        });
        
        const feedback = card.querySelector('.feedback').innerHTML;
        if (feedback.includes('<b>Correct ✔</b>')) {
          return score + 1;
        }

        return score;
    }, 0);

    const tfScore = state.tf.reduce((score, selectedValue, i) => {
        if (selectedValue === null) return score;
        return score + (selectedValue === tfs[i].answer ? 1 : 0);
    }, 0);

    const saqScore = state.saq.filter(Boolean).length;
    const total = mcqScore + tfScore + saqScore;

    document.getElementById('sMcq').textContent = mcqScore;
    document.getElementById('sTf').textContent = tfScore;
    document.getElementById('sSaq').textContent = saqScore;
    document.getElementById('sTotal').textContent = total;
    document.getElementById('sMcq2').textContent = mcqScore;
    document.getElementById('sTf2').textContent = tfScore;
    document.getElementById('sSaq2').textContent = saqScore;
    document.getElementById('sTotal2').textContent = total;
}


document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
