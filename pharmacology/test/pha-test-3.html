<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);} 

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);} 
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 3</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/12</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/3</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data (from Pharma Lecture 3: General Pharmacodynamics) -----------
const mcqs = [
  {
    q: "Pharmacodynamics primarily studies:",
    opts: [
      "How drugs produce effects at molecular/cellular targets",
      "How the body absorbs, distributes, and eliminates drugs",
      "Population-level drug utilization patterns",
      "Formulation stability of dosage forms"
    ],
    correct: 0,
    explain: "Pharmacodynamics = mode of action at receptors/enzymes and resulting responses; pharmacokinetics covers ADME."
  },
  {
    q: "Most therapeutic and adverse drug effects result from interactions with:",
    opts: ["Receptors (cell-surface or intracellular)", "Bile acids", "Enteric coatings", "Tight junction proteins only"],
    correct: 0,
    explain: "Receptor binding initiates signaling that alters cellular/organ function."
  },
  {
    q: "A histamine receptor is named based on:",
    opts: ["The ligand that best binds it", "Its tissue location", "Its intracellular domain length", "The first lab to clone it"],
    correct: 0,
    explain: "Receptors are often named for the agonist/chemical that interacts best (e.g., histamine receptor)."
  },
  {
    q: "On the heart, dynamic control of function arises from the interplay between:",
    opts: ["β-adrenoceptors and muscarinic ACh receptors", "Dopamine D2 and NMDA receptors", "Histamine H1 and opioid μ receptors", "Insulin and IGF-2 receptors"],
    correct: 0,
    explain: "Cardiac rate/contractility reflect sympathetic (β) vs parasympathetic (muscarinic) receptor activity."
  },
  {
    q: "Which is NOT one of the four major pharmacologic receptor families?",
    opts: ["Voltage-gated ion channels", "Ligand-gated ion channels", "G protein–coupled receptors", "Enzyme-linked receptors"],
    correct: 0,
    explain: "Major families: ligand-gated channels, GPCRs, enzyme-linked receptors, intracellular (nuclear) receptors. Voltage-gated channels are important but not the classic 'ligand-activated' receptor family listed here."
  },
  {
    q: "Ligand-gated ion channels typically signal on the time scale of:",
    opts: ["Milliseconds", "Seconds", "Minutes to hours", "Days"],
    correct: 0,
    explain: "Ligand-gated channels open within milliseconds (e.g., nicotinic ACh, GABA)."
  },
  {
    q: "G protein–coupled receptors (e.g., muscarinic, adrenergic) produce responses in:",
    opts: ["Seconds", "Milliseconds", "Days", "Weeks"],
    correct: 0,
    explain: "GPCRs couple via G proteins to second messengers; responses develop over seconds."
  },
  {
    q: "Kinase-linked receptors (e.g., insulin) typically exert effects over:",
    opts: ["Hours", "Milliseconds", "Microseconds", "Years"],
    correct: 0,
    explain: "Transcriptional/metabolic changes downstream of kinase activation take hours."
  },
  {
    q: "Nuclear (intracellular) receptors (e.g., steroid/thyroid hormones) generally act over:",
    opts: ["Hours", "Seconds", "Milliseconds", "Minutes"],
    correct: 0,
    explain: "Ligand diffuses into cell, binds intracellular receptor, modulates gene transcription → hours."
  },
  {
    q: "Which pairing of receptor family and example is CORRECT?",
    opts: [
      "Ligand-gated channel – Nicotinic ACh receptor",
      "GPCR – Insulin receptor",
      "Enzyme-linked – β1-adrenoceptor",
      "Intracellular – GABA\u209a receptor"
    ],
    correct: 0,
    explain: "nAChR is a ligand-gated ion channel. Insulin is enzyme-linked; β1 is GPCR; GABA_A is ionotropic (not intracellular)."
  },
  {
    q: "Trimethoprim's antibacterial action best illustrates drug action via:",
    opts: ["Enzyme inhibition (dihydrofolate reductase)", "Membrane depolarization", "DNA intercalation", "Microtubule stabilization"],
    correct: 0,
    explain: "Trimethoprim inhibits dihydrofolate reductase (DHFR)."
  },
  {
    q: "Dactinomycin exerts cytotoxicity mainly by:",
    opts: ["Blocking transcription", "Inhibiting COX-1 selectively", "Chelating calcium", "Opening K+ channels"],
    correct: 0,
    explain: "Dactinomycin (actinomycin D) blocks RNA synthesis (transcription)."
  },
  {
    q: "Aspirin's primary mechanism relevant to analgesia/anti-inflammatory action is:",
    opts: ["Irreversible cyclooxygenase inhibition", "Competitive histamine H1 blockade", "Na+ channel blockade", "Adenosine uptake inhibition"],
    correct: 0,
    explain: "Aspirin acetylates and irreversibly inhibits COX enzymes → ↓prostaglandins."
  },
  {
    q: "Penicillins and cephalosporins kill bacteria primarily by:",
    opts: ["Inhibiting cell wall synthesis", "Inhibiting DNA gyrase", "Disrupting folate salvage", "Blocking 30S initiation complex"],
    correct: 0,
    explain: "They inhibit peptidoglycan cross-linking → cell wall synthesis failure."
  },
  {
    q: "Methotrexate interferes with DNA synthesis by:",
    opts: ["Inhibiting folate formation/folate cycle enzymes", "Directly breaking DNA strands", "Binding ribosomes irreversibly", "Blocking cell wall porins"],
    correct: 0,
    explain: "MTX inhibits dihydrofolate reductase and folate metabolism → impaired thymidylate synthesis."
  },
  {
    q: "The magnitude of a graded drug response depends MOST directly on:",
    opts: ["Drug concentration at receptors", "Patient's blood group", "Drug taste", "Syringe volume"],
    correct: 0,
    explain: "Effect ∝ concentration at site, which is governed by dose and pharmacokinetics."
  },
  {
    q: "EC50 is defined as the concentration that:",
    opts: ["Produces 50% of the maximal effect", "Binds 50% of plasma proteins", "Yields 50% bioavailability", "Produces toxicity in 50% of patients"],
    correct: 0,
    explain: "EC50 is the potency index for graded responses: half-maximal effect concentration."
  },
  {
    q: "Which statement about graded dose–response curves is TRUE?",
    opts: [
      "They depict continuous changes in effect with concentration",
      "They measure quantal all-or-none responses",
      "They cannot estimate potency",
      "They require receptor saturation at all points"
    ],
    correct: 0,
    explain: "Graded curves show continuous effect; EC50 derives from them."
  },
  {
    q: "Drug tolerance best describes:",
    opts: [
      "Reduced response after repeated use",
      "Enhanced response after withdrawal",
      "Idiosyncratic immune reaction",
      "Inability to cross membranes"
    ],
    correct: 0,
    explain: "Tolerance = diminished effect with repeated exposure; may reverse after a drug holiday."
  },
  {
    q: "Which can ACCELERATE the development of tolerance?",
    opts: ["Increasing drug dose repeatedly", "Switching to intermittent dosing with holidays", "Using a structurally unrelated agent", "Avoiding chronic exposure"],
    correct: 0,
    explain: "Up-dosing can re-amplify effect transiently but often hastens tolerance."
  },
  {
    q: "Physiological variability affecting drug response includes all EXCEPT:",
    opts: ["Hair color", "Liver disease", "Renal disease", "Allergy/atopy"],
    correct: 0,
    explain: "Slides emphasize liver/renal disease and allergy; hair color is not a standard determinant."
  },
  {
    q: "Which receptor type is most directly modulated by benzodiazepines?",
    opts: ["GABA_A ligand-gated Cl− channel", "Dopamine D1 GPCR", "Insulin receptor tyrosine kinase", "Nuclear estrogen receptor"],
    correct: 0,
    explain: "Benzodiazepines are positive allosteric modulators of GABA_A channels."
  },
  {
    q: "Pilocarpine primarily alters membranes by:",
    opts: ["Activating muscarinic receptors to change permeability indirectly", "Forming pores in lipid bilayers", "Chelating Ca2+ to open TRP channels", "Inhibiting Na+/K+ ATPase"],
    correct: 0,
    explain: "Slide example mentions alteration of membrane receptor–mediated permeability (muscarinic agonist)."
  },
  {
    q: "Which pair correctly matches receptor family with a typical endogenous ligand?",
    opts: [
      "GPCR – Norepinephrine",
      "Ligand-gated channel – Cortisol",
      "Enzyme-linked – Acetylcholine at nicotinic sites",
      "Intracellular – Insulin"
    ],
    correct: 0,
    explain: "NE acts at adrenergic GPCRs; cortisol uses intracellular receptors; nicotinic ACh is ionotropic; insulin is enzyme-linked."
  },
  {
    q: "A leftward shift in a graded dose–response curve most likely indicates:",
    opts: ["Increased potency (lower EC50)", "Increased efficacy (higher Emax)", "Reduced receptor reserve only", "Increased clearance"],
    correct: 0,
    explain: "Left shift = lower concentration needed for same effect = higher potency."
  },
  {
    q: "Cytotoxic chemotherapeutic drugs typically act by:",
    opts: ["Interfering with cell growth/division at cycle-specific stages", "Enhancing mitochondrial ATP output", "Strengthening cell walls", "Increasing ribosomal proofreading"],
    correct: 0,
    explain: "They disrupt cell cycle processes to inhibit proliferation."
  },
  {
    q: "Which statement about receptor recognition is MOST accurate?",
    opts: [
      "Drug–receptor complex formation triggers a biological response",
      "Binding without any conformational change produces maximal effect",
      "Only extracellular receptors are clinically relevant",
      "Enzymes cannot be pharmacologic receptors"
    ],
    correct: 0,
    explain: "Formation of drug–receptor (or enzyme target) complex leads to response; enzymes can be receptors."
  },
  {
    q: "Which example best represents an intracellular (nuclear) receptor pathway?",
    opts: ["Thyroid hormone modulating gene transcription", "GABA opening Cl− channels", "β1-adrenergic increasing cAMP", "Insulin phosphorylating IRS-1"],
    correct: 0,
    explain: "Thyroid hormone crosses membrane and binds nuclear receptor to regulate transcription."
  },
  {
    q: "Which factor MOST directly links administered dose to effect magnitude?",
    opts: ["Pharmacokinetics determining concentration at receptors", "Syringe gauge size", "Drug brand name", "Patient handedness"],
    correct: 0,
    explain: "Dose → ADME → concentration at site → response."
  },
  {
    q: "A competitive antagonist would be expected to:",
    opts: ["Shift the agonist dose–response curve rightward without changing Emax", "Reduce Emax without shifting EC50", "Increase Emax and reduce potency", "Create all-or-none (quantal) responses"],
    correct: 0,
    explain: "Competitive antagonism increases EC50 (right shift) but typically preserves Emax (with enough agonist)."
  },
  {
    q: "Which clinical scenario most likely reflects tolerance?",
    opts: [
      "A patient needs progressively higher opioid doses for the same analgesia",
      "A single dose of antihistamine causes sedation",
      "A rash appears after first penicillin dose",
      "An IV bolus of atropine causes tachycardia"
    ],
    correct: 0,
    explain: "Repeated opioid exposure leading to reduced effect is classic tolerance."
  }
];

const tfs = [
  { q: "Receptors are exclusively located on the cell surface.", answer: false, explain: "They can be intracellular (e.g., steroid/thyroid receptors)." },
  { q: "Ligand-gated ion channels act within milliseconds.", answer: true, explain: "Ionotropic responses are fast (e.g., GABA_A, nicotinic ACh)." },
  { q: "GPCR signaling is typically faster than ligand-gated ion channels.", answer: false, explain: "GPCRs: seconds; ligand-gated: milliseconds." },
  { q: "Insulin receptor is kinase-linked.", answer: true, explain: "Insulin receptor has intrinsic tyrosine kinase activity." },
  { q: "Nuclear receptors usually produce effects within hours via gene transcription.", answer: true, explain: "They alter transcription/translation." },
  { q: "EC50 refers to the dose producing an all-or-none response in 50% of individuals.", answer: false, explain: "That's a quantal ED50; EC50 is for graded effects (50% of Emax)." },
  { q: "Aspirin acts by inhibiting cyclooxygenase involved in prostaglandin synthesis.", answer: true, explain: "Irreversible COX inhibition lowers prostaglandins." },
  { q: "Penicillins act by inhibiting bacterial protein synthesis at the 50S ribosome.", answer: false, explain: "They inhibit cell wall synthesis, not ribosomes." },
  { q: "Methotrexate impairs DNA synthesis by interfering with folate metabolism.", answer: true, explain: "Inhibits DHFR/folate cycle → ↓thymidylate." },
  { q: "Tolerance is irreversible once developed.", answer: false, explain: "Often reversible after a drug holiday; mechanisms vary." },
  { q: "Physiological variability such as liver or renal disease can alter drug responses.", answer: true, explain: "Organ dysfunction changes PK/PD relationships." },
  { q: "Dactinomycin blocks transcription.", answer: true, explain: "It intercalates and inhibits RNA synthesis." }
];

const saqs = [
  // 1) Direct Answer (very short)
  { q: "Define pharmacodynamics in one line.", a: "Study of how drugs exert effects at targets (receptors/enzymes) to produce biological responses." },
  // 2) List/Enumeration (≥3; numbered)
  { q: "List the four major pharmacologic receptor families.", a: "1) Ligand-gated ion channels 2) G protein–coupled receptors 3) Enzyme-linked receptors 4) Intracellular (nuclear) receptors" },
  // 3) Comparison (table + numbered)
  { q: "Compare signaling speed across receptor families (fastest → slowest).", a: `
    <table style="width:100%;border-collapse:collapse">
      <thead>
        <tr>
          <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.2);padding:6px">#</th>
          <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.2);padding:6px">Receptor Family</th>
          <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.2);padding:6px">Typical Timescale</th>
          <th style="text-align:left;border-bottom:1px solid rgba(255,255,255,0.2);padding:6px">Example</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="padding:6px">1</td><td style="padding:6px">Ligand-gated ion channels</td><td style="padding:6px">Milliseconds</td><td style="padding:6px">GABA_A, Nicotinic ACh</td></tr>
        <tr><td style="padding:6px">2</td><td style="padding:6px">G protein–coupled receptors</td><td style="padding:6px">Seconds</td><td style="padding:6px">Muscarinic, β-adrenoceptors</td></tr>
        <tr><td style="padding:6px">3</td><td style="padding:6px">Enzyme-linked receptors</td><td style="padding:6px">Hours</td><td style="padding:6px">Insulin, Growth factors</td></tr>
        <tr><td style="padding:6px">4</td><td style="padding:6px">Intracellular (nuclear) receptors</td><td style="padding:6px">Hours</td><td style="padding:6px">Steroid, Thyroid hormones</td></tr>
      </tbody>
    </table>
  ` }
];

// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
    <h3 class="qtitle">${item.q}</h3>
    <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);"></textarea>
    <div class="btnrow" style="margin-top:10px">
      <button class="primary" data-act="reveal">Reveal Answer</button>
      <button class="ghost" data-act="toggle">I was correct</button>
    </div>
    <div class="answer" hidden>${item.a}</div>
  `;

  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
