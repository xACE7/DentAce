<!DOCTYPE html>
<html lang="en" style="direction:ltr;">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Interactive Exam • Glowing Dark Theme</title>
<meta name="color-scheme" content="dark" />
<style>
  :root{
    --bg:#0b0b12;
    --text:#f6f7fb;
    --muted:#a6afc6;
    --card:rgba(255,255,255,0.05);
    --card-border:rgba(255,255,255,0.12);
    --glass:rgba(255,255,255,0.04);
    --glass-border:rgba(255,255,255,0.10);
    --glow-cyan:#06b6d4;
    --glow-cyan-outer:rgba(6,182,212,0.40);
    --glow-purple:#8b5cf6;
    --glow-purple-outer:rgba(139,92,246,0.35);
    --white-haze:rgba(255,255,255,0.08);
    --white-outer:rgba(255,255,255,0.15);
    --radius:16px;
    --gap:1.25rem;
    --pad:1.5rem;
    --ok:#22c55e;  /* green */
    --bad:#ef4444; /* red */
  }

  *{box-sizing:border-box}
  body{margin:0;font:16px/1.65 Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;color:var(--text);background:var(--bg);min-height:100dvh;}
  .wrap{max-width:1100px;margin:0 auto;padding:24px;}

  .titlebar{
    position: static;z-index:10;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg,rgba(11,11,18,0.75),rgba(11,11,18,0.35));
    border-bottom:1px solid var(--glass-border);
  }
  .titlebar .inner{max-width:1100px;margin:0 auto;padding:16px 24px;display:grid;gap:8px;align-items:center;}
  .grad-text{
    font-weight:800;
    letter-spacing:.3px;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    text-shadow:0 0 10px var(--glow-cyan-outer), 0 0 14px var(--glow-purple-outer);
  }
  h1.grad-text{font-size:clamp(1.6rem,2vw+1rem,2.6rem);margin:0;text-align:center;}
  .subtitle{margin:0;text-align:center;color:var(--muted);font-size:0.95rem}

  .section-h{
    margin:28px 0 14px;
    padding:12px 16px;
    border-radius:var(--radius);
    background:var(--glass);
    border:1px solid var(--glass-border);
    box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    text-align:center;
    font-weight:750;
    font-size:1.15rem;
  }
  .section-h .grad-text{font-size:1.3rem;}

  .grid{display:grid;gap:var(--gap)}
  @media (min-width:800px){
    .grid.mcq{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid.tf {grid-template-columns:repeat(3,minmax(0,1fr));}
  }

  /* Cards (no accent on the card itself) */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:var(--pad);
    box-shadow: 0 2px 8px var(--white-haze), 0 0 0 1px rgba(255,255,255,0.02), 0 0 24px rgba(255,255,255,0.06);
    position:relative;
  }

  .qtitle{font-weight:650;margin:0 0 12px}
  .meta{color:var(--muted);font-size:0.88rem;margin-bottom:10px}

  .opts{display:grid;gap:10px}
  .opt-btn{
    all:unset;cursor:pointer;display:flex;gap:10px;align-items:center;
    padding:12px 14px;border-radius:12px;
    background:rgba(255,255,255,0.03);
    border:1px solid rgba(255,255,255,0.10);
    transition:transform .06s ease, background .15s ease, border-color .15s ease;
  }
  .opt-btn .key{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;font-weight:700;
    background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;
    box-shadow:0 0 10px var(--glow-cyan-outer),0 0 10px var(--glow-purple-outer) inset;
  }
  .opt-btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);}

  /* Accent line ONLY on the chosen/correct answer box, no background highlight */
  .opt-btn.correct{
    border-left:6px solid var(--ok);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn.wrong{
    border-left:6px solid var(--bad);
    outline:none;
    background:rgba(255,255,255,0.03);
  }
  .opt-btn[disabled]{opacity:.85;cursor:not-allowed;pointer-events:none;}

  .feedback{margin-top:10px;border-radius:12px;padding:10px 12px;border:1px dashed rgba(255,255,255,0.18);background:rgba(255,255,255,0.03);color:var(--muted);}
  .feedback[hidden]{display:none;}
  .feedback b{color:var(--text)}

  .answer{margin-top:10px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(255,255,255,0.04)}
  .answer[hidden]{display:none;}
  .answer table { width: 100%; border-collapse: collapse; }
  .answer th, .answer td { padding: 8px 12px; text-align: left; border-bottom: 1px solid var(--card-border); }
  .answer th { font-weight: 700; color: var(--text); }
  .answer td { color: var(--muted); }
  .answer ol, .answer ul { padding-left: 20px; }


  .btnrow{display:flex;gap:10px;flex-wrap:wrap}
  .ghost, .primary{
    all:unset;cursor:pointer;border-radius:12px;padding:10px 14px;font-weight:650;border:1px solid rgba(255,255,255,0.18);
    background:rgba(255,255,255,0.03);
  }
  .primary{background:linear-gradient(90deg,var(--glow-cyan),var(--glow-purple));color:#0b0b12;border-color:transparent;}

  .score{
    margin:16px 0;padding:12px 14px;border-radius:14px;
    background:var(--glass);border:1px solid var(--glass-border);box-shadow: 0 2px 10px var(--white-haze), 0 0 18px rgba(255,255,255,0.06), 0 0 30px var(--white-outer);
    display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
  }
  .score .part{color:var(--muted);font-weight:600}
  .score b{color:var(--text)}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-57Q3BDNKFW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-57Q3BDNKFW');
</script>
<body>
  <header class="titlebar">
    <div class="inner">
      <h1 class="grad-text">🦷 Dentistry 3rd year</h1>
      <p class="subtitle">Test based on Lecture 1</p>
    </div>
  </header>

  <main class="wrap">

    <h2 class="section-h"><span class="grad-text">اللَّهُمَّ لا سَهْلَ إِلَّا مَا جَعَلْتَهُ سَهْلًا، وَأَنْتَ تَجْعَلُ الحَزْنَ إِذَا شِئْتَ سَهْلًا</span></h2>

    <section class="score" id="scoreTop">
      <div class="part">MCQs: <b><span id="sMcq">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal">0</span>/45</b></div>
      <div class="btnrow">
        <button class="ghost" id="resetAll">Reset</button>
      </div>
    </section>

    <h2 class="section-h"><span class="grad-text">MCQs</span></h2>
    <div class="grid mcq" id="mcqGrid"></div>

    <h2 class="section-h"><span class="grad-text">True / False</span></h2>
    <div class="grid tf" id="tfGrid"></div>

    <h2 class="section-h"><span class="grad-text">Short Answer Questions</span></h2>
    <div class="grid" id="saqGrid"></div>

    <section class="score" id="scoreBottom">
      <div class="part">MCQs: <b><span id="sMcq2">0</span>/30</b></div>
      <div class="part">True/False: <b><span id="sTf2">0</span>/9</b></div>
      <div class="part">SAQs: <b><span id="sSaq2">0</span>/6</b></div>
      <div class="part">Total: <b><span id="sTotal2">0</span>/45</b></div>
    </section>
  </main>

<script>
// ----------- Data -----------
const mcqs = [
    {
        q: "Which term describes what the body does to a drug?",
        opts: ["Pharmacodynamics", "Pharmacokinetics", "Pharmacogenomics", "Toxicology"],
        correct: 1,
        explain: "Pharmacokinetics is the study of how the body absorbs, distributes, metabolizes, and excretes a drug."
    },
    {
        q: "Which of the following is an example of an enteral route of administration?",
        opts: ["Intravenous (IV)", "Intramuscular (IM)", "Sublingual (SL)", "Inhalation"],
        correct: 2,
        explain: "The enteral route involves the gastrointestinal tract. Sublingual (under the tongue) is a method of enteral administration."
    },
    {
        q: "What is a primary advantage of the intravenous (IV) route in emergencies?",
        opts: ["Slower absorption rate", "Avoidance of the first-pass effect", "Good for self-administering", "Localized effect"],
        correct: 1,
        explain: "IV administration delivers the drug directly into the systemic circulation, bypassing the liver and avoiding the first-pass effect, which allows for rapid action."
    },
    {
        q: "The term 'bioavailability' refers to the:",
        opts: ["Proportion of the administered dose that reaches the systemic circulation", "Time it takes for a drug to be completely eliminated", "Binding affinity of a drug to plasma proteins", "Process of drug movement from blood to tissues"],
        correct: 0,
        explain: "Bioavailability is the fraction of an administered drug that reaches the systemic circulation unchanged."
    },
    {
        q: "What is the 'First Pass Effect'?",
        opts: ["The initial feeling a patient gets after taking a drug", "The circulation of a drug to the liver via the hepatic portal vein before systemic circulation", "The binding of a drug to plasma proteins", "The process of a drug crossing the blood-brain barrier"],
        correct: 1,
        explain: "Drugs absorbed from the GI tract are first circulated to the liver, where they may be metabolized. This is known as the first-pass effect."
    },
    {
        q: "Which of the following routes of administration has 100% bioavailability by definition?",
        opts: ["Oral (PO)", "Subcutaneous (SC)", "Intravenous (IV)", "Rectal (PR)"],
        correct: 2,
        explain: "Intravenous (IV) administration delivers the drug directly into the bloodstream, resulting in 100% bioavailability."
    },
    {
        q: "The presence of food in the stomach generally does what to the absorption of drugs like penicillin?",
        opts: ["Increases absorption", "Decreases or delays absorption", "Has no effect on absorption", "Enhances bioavailability"],
        correct: 1,
        explain: "Food, especially fatty food, can delay gastric emptying and affect the absorption of certain drugs, such as penicillin."
    },
    {
        q: "A drug that is highly bound to plasma proteins is generally:",
        opts: ["Pharmacologically active", "Pharmacologically inactive", "Rapidly excreted", "Easily distributed to tissues"],
        correct: 1,
        explain: "Only the unbound (free) fraction of a drug is pharmacologically active, as the drug-protein complex is too large to cross cell membranes."
    },
    {
        q: "Which parenteral route has a slower absorption rate than Intramuscular (IM)?",
        opts: ["Intravenous (IV)", "Intraosseous (IO)", "Endotracheal (ET)", "Subcutaneous (SC)"],
        correct: 3,
        explain: "Subcutaneous (SC) injection provides a slower and more sustained absorption compared to the IM route."
    },
    {
        q: "Glyceryl trinitrate is not effective when taken orally because:",
        opts: ["It is poorly soluble", "It causes severe gastric irritation", "It undergoes complete first-pass metabolism", "It cannot be absorbed from the GI tract"],
        correct: 2,
        explain: "Glyceryl trinitrate is almost completely metabolized by the liver during the first pass, which is why it is administered sublingually."
    },
    {
        q: "Which factor is NOT listed as affecting drug absorption?",
        opts: ["Mesenteric blood flow", "Patient's age", "Composition of GI contents", "Concurrent administration with other drugs"],
        correct: 1,
        explain: "While age can influence pharmacokinetics, it was not explicitly listed on the slide as a primary factor affecting absorption."
    },
    {
        q: "Pharmacodynamics is defined as:",
        opts: ["What the body does to the drug", "The study of drug distribution", "What the drug does to the body", "The rate of drug elimination"],
        correct: 2,
        explain: "Pharmacodynamics concerns the effects of the drug on the body and its mechanisms of action."
    },
    {
        q: "The rectal (PR) route is often reserved for which type of patient?",
        opts: ["Pediatric patients", "Geriatric patients", "Unconscious or vomiting patients", "Patients with liver disease"],
        correct: 2,
        explain: "Rectal administration is a useful alternative when oral administration is not possible, such as in patients who are unconscious or vomiting."
    },
    {
        q: "Low levels of which plasma protein can significantly affect drug distribution?",
        opts: ["Globulin", "Fibrinogen", "Albumin", "Hemoglobin"],
        correct: 2,
        explain: "Albumin is the primary plasma protein that binds to drugs. Low albumin levels can lead to a higher concentration of free, active drug."
    },
    {
        q: "Which process is NOT a part of pharmacokinetics?",
        opts: ["Absorption", "Distribution", "Molecular mechanism of action", "Metabolism"],
        correct: 2,
        explain: "The molecular mechanism of action is a key aspect of pharmacodynamics, not pharmacokinetics."
    },
    {
        q: "Which drug's absorption is slowed down by fatty food?",
        opts: ["Metformin", "Levodopa", "Sildenafil", "Penicillin"],
        correct: 2,
        explain: "The slides mention that sildenafil's absorption is slowed by fatty food."
    },
    {
        q: "Which of these is a parenteral route of administration?",
        opts: ["Oral", "Buccal", "Topical", "Rectal"],
        correct: 2,
        explain: "Parenteral routes are those other than the GI tract. Topical application is a parenteral route."
    },
    {
        q: "A delayed response to oral analgesia in a migraine patient can be lessened by a drug that:",
        opts: ["Increases gastric emptying", "Decreases gastric motility", "Reduces mesenteric blood flow", "Increases gastric pH"],
        correct: 0,
        explain: "The slides state that metoclopramide can lessen the delay by increasing gastric emptying."
    },
    {
        q: "The 'Area under the curve' (AUC) on a drug concentration-time graph represents:",
        opts: ["Peak height concentration", "Time of peak concentration", "Total amount of drug absorbed", "Rate of drug elimination"],
        correct: 2,
        explain: "The AUC represents the total exposure to a drug that the body receives and is proportional to the total amount of drug absorbed."
    },
    {
        q: "What is the main reason emergency medications are often given intravenously?",
        opts: ["To increase bioavailability", "To avoid drug degradation in the liver", "To ensure slower absorption", "Because it's the easiest route"],
        correct: 1,
        explain: "IV administration bypasses the first-pass metabolism in the liver, ensuring the full dose reaches systemic circulation quickly."
    },
    {
        q: "The sublingual (SL) route offers excellent absorption without the problems of:",
        opts: ["Hepatic metabolism", "Gastric acidity", "Plasma protein binding", "Systemic circulation"],
        correct: 1,
        explain: "The SL route bypasses the stomach, avoiding issues with gastric acidity and enzymatic degradation."
    },
    {
        q: "Poor solubility of an orally administered drug typically results in:",
        opts: ["High bioavailability", "Low bioavailability", "Rapid absorption", "Complete first-pass effect"],
        correct: 1,
        explain: "A drug must dissolve to be absorbed. Poor solubility leads to less drug being absorbed and thus, low bioavailability."
    },
    {
        q: "Which factor can affect drug distribution by altering blood flow?",
        opts: ["Gastric pH", "Cardiac output", "Dosage form", "Presence of food"],
        correct: 1,
        explain: "Cardiac output and regional blood flow are key factors that determine how quickly and to what extent a drug is distributed to various tissues."
    },
    {
        q: "The process of drug movement from the administration site to systemic circulation is called:",
        opts: ["Distribution", "Metabolism", "Excretion", "Absorption"],
        correct: 3,
        explain: "Absorption is the first step in pharmacokinetics, defining the movement of the drug into the bloodstream."
    },
    {
        q: "Intraosseous (IO) administration is an alternative emergency route most commonly used in:",
        opts: ["Newborns", "Adults", "Pediatrics", "Geriatrics"],
        correct: 2,
        explain: "The slides specify that the IO route is mostly used in pediatrics as an alternative emergency access route."
    },
    {
        q: "Which of the following drugs is mentioned as undergoing substantial first-pass metabolism?",
        opts: ["Metformin", "Penicillin", "Propranolol", "Thyroxine"],
        correct: 2,
        explain: "Propranolol is listed as an example of a drug that undergoes significant first-pass metabolism, requiring different oral and injectable doses."
    },
    {
        q: "The 'buccal' route of administration involves placing the drug:",
        opts: ["Under the tongue", "On the skin", "Between the cheek and gum", "In the rectum"],
        correct: 2,
        explain: "Buccal administration involves absorption through the mucous membranes of the cheek."
    },
    {
        q: "Why are drugs like metformin and levodopa better given with food?",
        opts: ["To increase their bioavailability", "To speed up their absorption", "To reduce gastric irritation", "To avoid first-pass effect"],
        correct: 2,
        explain: "These drugs can cause gastric irritation when taken on an empty stomach, so administering them with food can mitigate this side effect."
    },
    {
        q: "A drug-protein complex is unable to cross cell membranes because:",
        opts: ["It is pharmacologically active", "It is too large", "It is electrically charged", "It is rapidly metabolized"],
        correct: 1,
        explain: "The complex of a drug bound to a plasma protein (like albumin) is too large to pass through capillaries and reach the site of action."
    },
    {
        q: "The study of drugs and their actions on the body is known as:",
        opts: ["Pharmacokinetics", "Pharmacology", "Pharmacodynamics", "Therapeutics"],
        correct: 1,
        explain: "Pharmacology is the broad science that deals with the study of drugs and their effects on living systems."
    }
];

const tfs = [
    {
        q: "Pharmacokinetics is what the drug does to the body.",
        answer: false,
        explain: "This is the definition of Pharmacodynamics. Pharmacokinetics is what the body does to the drug."
    },
    {
        q: "The enteral route of administration delivers medications via routes other than the GI tract.",
        answer: false,
        explain: "The enteral route involves the GI tract (oral, sublingual, rectal). The parenteral route bypasses the GI tract."
    },
    {
        q: "Drugs administered by the IV route are 100% bioavailable.",
        answer: true,
        explain: "IV administration delivers the drug directly into the systemic circulation, ensuring complete bioavailability."
    },
    {
        q: "The presence of food in the stomach always increases drug absorption.",
        answer: false,
        explain: "Food can delay or decrease the absorption of many drugs, such as penicillin."
    },
    {
        q: "Only the unbound, free form of a drug is pharmacologically active.",
        answer: true,
        explain: "Drugs bound to plasma proteins are too large to cross cell membranes and are considered inactive."
    },
    {
        q: "The first-pass effect increases the concentration of a drug in systemic circulation.",
        answer: false,
        explain: "The first-pass effect involves metabolism in the liver before the drug reaches systemic circulation, which reduces its concentration."
    },
    {
        q: "Inhalation is a very slow method of drug absorption.",
        answer: false,
        explain: "Inhalation provides very rapid absorption via the large surface area of the lungs."
    },
    {
        q: "Low albumin levels in the blood can lead to a lower concentration of free drug.",
        answer: false,
        explain: "Low albumin means less protein for the drug to bind to, resulting in a higher concentration of free, active drug."
    },
    {
        q: "All orally administered drugs are affected by the first-pass effect to the same extent.",
        answer: false,
        explain: "The extent of first-pass metabolism varies significantly between drugs, from negligible to complete breakdown."
    }
];

const saqs = [
    {
        q: "Define Pharmacokinetics and Pharmacodynamics.",
        a: "<b>Pharmacokinetics:</b> What the body does to the drug. This includes the processes of absorption, distribution, metabolism, and excretion.<br><br><b>Pharmacodynamics:</b> What the drug does to the body. This includes the molecular mechanisms by which the drug produces its pharmacological effect."
    },
    {
        q: "List three factors that can determine the amount and rate of drug absorption from the GI tract.",
        a: "<ol><li>Physical nature of the dosage form</li><li>Presence or absence of food in the stomach</li><li>Gastric or intestinal pH</li><li>Mesenteric blood flow</li><li>Concurrent administration with other drugs</li></ol> (Any three are correct)"
    },
    {
        q: "Compare the Enteral and Parenteral routes of administration.",
        a: "<table><thead><tr><th>Feature</th><th>Enteral Route</th><th>Parenteral Route</th></tr></thead><tbody><tr><td><b>Definition</b></td><td>Delivers medication via the gastrointestinal (GI) tract.</td><td>Delivers medication via routes other than the GI tract.</td></tr><tr><td><b>Examples</b></td><td>Oral, Sublingual, Rectal</td><td>Intravenous, Intramuscular, Subcutaneous, Inhalation</td></tr><tr><td><b>First-Pass Effect</b></td><td>Subject to first-pass metabolism (e.g., oral)</td><td>Bypasses the first-pass effect.</td></tr><tr><td><b>Absorption</b></td><td>Variable and can be slower.</td><td>Often more rapid and predictable.</td></tr></tbody></table>"
    },
    {
        q: "A patient with severe liver disease is given a standard oral dose of a drug that is highly metabolized by the liver. What is a likely consequence regarding the drug's bioavailability and potential for toxicity?",
        a: "In a patient with severe liver disease, the liver's ability to metabolize drugs is impaired. This would significantly reduce the first-pass effect. As a result, a much larger proportion of the oral dose will reach the systemic circulation, leading to unexpectedly high bioavailability. This increased concentration can lead to a higher risk of drug toxicity and adverse effects."
    },
    {
        q: "Explain why a drug that is highly bound to plasma proteins is considered 'pharmacologically inactive'.",
        a: "When a drug binds to a plasma protein, such as albumin, it forms a large drug-protein complex. This complex is too large to pass from the bloodstream across cell membranes to reach its site of action. Only the unbound or 'free' fraction of the drug is small enough to be distributed to tissues and exert a pharmacological effect. Therefore, the bound portion acts as a reservoir and is considered inactive."
    },
    {
        q: "List three examples of enteral routes and three examples of parenteral routes of drug administration.",
        a: "<b>Enteral Routes:</b><ol><li>Oral (PO)</li><li>Sublingual (SL)</li><li>Rectal (PR)</li></ol><b>Parenteral Routes:</b><ol><li>Intravenous (IV)</li><li>Intramuscular (IM)</li><li>Subcutaneous (SC)</li></ol>"
    }
];
// ----------- State -----------
const state = {
  mcq: Array(mcqs.length).fill(null), // null | selectedIndex
  tf: Array(tfs.length).fill(null),   // null | boolean
  saq: Array(saqs.length).fill(false) // self-marked
};

function shuffleIndices(n){
  const arr = Array.from({length:n}, (_,i)=>i);
  for(let i=n-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

// ----------- Render MCQs -----------
const mcqGrid = document.getElementById('mcqGrid');
mcqs.forEach((item, idx)=>{
  const map = shuffleIndices(4);
  const visualToOriginal = map;
  const originalToVisual = Array(4);
  map.forEach((orig, v)=>{ originalToVisual[orig] = v; });
  const correctVisualIndex = originalToVisual[item.correct];

  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='mcq';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Question ${idx+1} of ${mcqs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      ${[0,1,2,3].map(v=>`
        <button class="opt-btn" data-v="${v}" aria-label="Answer option ${String.fromCharCode(65+v)}">
          <span class="key">${String.fromCharCode(65+v)}</span>
          <span class="label">${item.opts[ visualToOriginal[v] ]}</span>
        </button>
      `).join('')}
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const v = Number(btn.dataset.v);
      state.mcq[idx] = v;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct option (green)
      const correctBtn = buttons[correctVisualIndex];
      correctBtn.classList.add('correct');

      if(v !== correctVisualIndex){
        // Mark chosen wrong option (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${String.fromCharCode(65+correctVisualIndex)}</b><br>${item.explain}`;
      }
      lock();
      recalc();
    });
  });

  mcqGrid.appendChild(card);
});

// ----------- Render True/False -----------
const tfGrid = document.getElementById('tfGrid');
tfs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='tf';
  card.dataset.index = idx;
  card.dataset.locked = 'false';
  card.innerHTML = `
    <p class="meta">Statement ${idx+1} of ${tfs.length}</p>
    <h3 class="qtitle">${item.q}</h3>
    <div class="opts">
      <button class="opt-btn" data-v="true">
        <span class="key">T</span><span class="label">True</span>
      </button>
      <button class="opt-btn" data-v="false">
        <span class="key">F</span><span class="label">False</span>
      </button>
    </div>
    <div class="feedback" hidden></div>
  `;

  const buttons = card.querySelectorAll('.opt-btn');
  const feedback = card.querySelector('.feedback');

  function lock(){
    card.dataset.locked = 'true';
    buttons.forEach(b=>b.setAttribute('disabled',''));
  }

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(card.dataset.locked === 'true') return; // one attempt
      const val = btn.dataset.v === "true";
      state.tf[idx] = val;

      // clear classes
      buttons.forEach(b=>b.classList.remove('correct','wrong'));

      // Always mark the correct button (green)
      const correctBtn = Array.from(buttons).find(b => (b.dataset.v === (item.answer ? "true" : "false")));
      correctBtn.classList.add('correct');

      const isCorrect = (val === item.answer);
      if(!isCorrect){
        // mark chosen wrong (red)
        btn.classList.add('wrong');
        feedback.hidden=false;
        feedback.innerHTML = `<b>Wrong ✖</b><br>Correct answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }else{
        feedback.hidden=false;
        feedback.innerHTML = `<b>Correct ✔</b><br>Answer: <b>${item.answer ? 'True' : 'False'}</b><br>${item.explain}`;
      }

      lock();
      recalc();
    });
  });

  tfGrid.appendChild(card);
});

// ----------- Render SAQs -----------
const saqGrid = document.getElementById('saqGrid');
saqs.forEach((item, idx)=>{
  const card = document.createElement('article');
  card.className='card qcard';
  card.dataset.type='saq';
  card.dataset.index = idx;
  card.innerHTML = `
  <p class="meta">Question ${idx + 1} of ${saqs.length}</p>
  <h3 class="qtitle">${item.q}</h3>
  <textarea rows="4" placeholder="Type your answer..." style="width:100%;padding:12px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.14);color:var(--text);font-family:inherit;font-size:inherit;"></textarea>
  <div class="btnrow" style="margin-top:10px">
    <button class="primary" data-act="reveal">Reveal Answer</button>
    <button class="ghost" data-act="toggle">I was correct</button>
  </div>
  <div class="answer" hidden>${item.a}</div>
`;


  const revealBtn = card.querySelector('[data-act="reveal"]');
  const toggleBtn = card.querySelector('[data-act="toggle"]');
  const answer = card.querySelector('.answer');

  revealBtn.addEventListener('click', ()=>{
    answer.hidden = !answer.hidden;
    revealBtn.textContent = answer.hidden ? "Reveal Answer" : "Hide Answer";
  });

  toggleBtn.addEventListener('click', ()=>{
    const now = !state.saq[idx];
    state.saq[idx] = now;
    toggleBtn.textContent = now ? "✓ Counted as correct" : "I was correct";
    toggleBtn.style.outline = now ? "2px solid rgba(34,197,94,.7)" : "none";
    recalc();
  });

  saqGrid.appendChild(card);
});

// ----------- Score + Reset -----------
function recalc(){
  const mcqScore = state.mcq.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="mcq"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const tfScore = state.tf.reduce((s,v,i)=>{
    if(v===null) return s;
    const card = document.querySelector(`.qcard[data-type="tf"][data-index="${i}"]`);
    const feedback = card.querySelector('.feedback').textContent;
    return s + (feedback.startsWith("Correct") ? 1 : 0);
  },0);
  const saqScore = state.saq.filter(Boolean).length;
  const total = mcqScore + tfScore + saqScore;

  const ids = ["sMcq","sTf","sSaq","sTotal","sMcq2","sTf2","sSaq2","sTotal2"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(id.includes('Mcq')) el.textContent = mcqScore;
    if(id.includes('Tf')) el.textContent = tfScore;
    if(id.includes('Saq')) el.textContent = saqScore;
    if(id.includes('Total')) el.textContent = total;
  });
}

document.getElementById('resetAll').addEventListener('click', ()=>{
  document.querySelectorAll('.qcard .feedback').forEach(f=>{f.hidden=true; f.textContent=''; f.innerHTML='';});
  document.querySelectorAll('.opt-btn').forEach(b=>{
    b.classList.remove('correct','wrong');
    b.removeAttribute('disabled');
  });
  document.querySelectorAll('.qcard[data-type="mcq"], .qcard[data-type="tf"]').forEach(c=>{c.dataset.locked='false';});
  document.querySelectorAll('.qcard[data-type="saq"] textarea').forEach(t=>t.value="");
  document.querySelectorAll('.qcard[data-type="saq"] .answer').forEach(a=>a.hidden=true);
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="reveal"]').forEach(b=>b.textContent="Reveal Answer");
  document.querySelectorAll('.qcard[data-type="saq"] [data-act="toggle"]').forEach(b=>{b.textContent="I was correct"; b.style.outline="none";});

  state.mcq.fill(null); state.tf.fill(null); state.saq.fill(false);
  recalc();
});

recalc();
</script>
</body>
</html>
